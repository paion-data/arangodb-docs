<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743775370></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="JavaScript Transactions allow you to submit single-request transactions that leverage ArangoDB&amp;rsquo;s JavaScript API to run complex operations that can read and modify multiple documents from multiple collections"><meta property="og:url" content="http://localhost/3.11/develop/transactions/javascript-transactions/"><meta property="og:title" content="JavaScript Transactions"><meta property="og:type" content="website"><meta property="og:description" content="JavaScript Transactions allow you to submit single-request transactions that leverage ArangoDB&amp;rsquo;s JavaScript API to run complex operations that can read and modify multiple documents from multiple collections"><meta name=docsearch:version content="3.11"><title>JavaScript Transactions | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743775370 defer></script>
<script src=/js/featherlight.min.js?1743775370 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743775370 defer></script>
<script src=/js/theme.js?1743775370 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.11"><a itemprop=item class=link href=/3.11/><span itemprop=name class=breadcrumb-entry>3.11.13</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Develop"><a itemprop=item class=link href=/3.11/develop/><span itemprop=name class=breadcrumb-entry>Develop</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Transactions"><a itemprop=item class=link href=/3.11/develop/transactions/><span itemprop=name class=breadcrumb-entry>Transactions</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="JavaScript Transactions"><a itemprop=item class=link href=/3.11/develop/transactions/javascript-transactions/><span itemprop=name class=breadcrumb-entry>JavaScript Transactions</span></a></li></ol></nav><article class=default><hgroup><h1>JavaScript Transactions</h1><p class=lead>JavaScript Transactions allow you to submit single-request transactions that leverage ArangoDB&rsquo;s JavaScript API to run complex operations that can read and modify multiple documents from multiple collections</p></hgroup><p>JavaScript transactions are different from transactions in SQL.</p><p>In SQL, transactions are started with explicit <em>BEGIN</em> or <em>START TRANSACTION</em>
command. Following any series of data retrieval or modification operations, an
SQL transaction is finished with a <em>COMMIT</em> command, or rolled back with a
<em>ROLLBACK</em> command. There may be client/server communication between the start
and the commit/rollback of an SQL transaction.</p><p>In ArangoDB, a transaction is always a server-side operation, and is executed
on the server in one go, without any client interaction. All operations to be
executed inside a transaction need to be known by the server when the transaction
is started.</p><p>There are no individual <em>BEGIN</em>, <em>COMMIT</em> or <em>ROLLBACK</em> transaction commands
in ArangoDB. Instead, a transaction in ArangoDB is started by providing a
description of the transaction to the <code>db._executeTransaction()</code> JavaScript
function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>(</span><span class=nx>options</span><span class=p>);</span></span></span></code></pre></div><p>This function automatically starts a transaction, executes all required
data retrieval and/or modification operations, and automatically
commit the transaction at the end. If an error occurs during transaction execution, the
transaction is automatically aborted, and all changes are rolled back.</p><h2 id=javascript-api>JavaScript API <a href=/3.11/develop/transactions/javascript-transactions/#javascript-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=execute-transaction>Execute Transaction <a href=/3.11/develop/transactions/javascript-transactions/#execute-transaction class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>db._executeTransaction(options)</code></p><p>Executes a server-side JavaScript transaction.</p><p><code>options</code> must be an object and have the following attributes:</p><ul><li><code>collections</code>: A sub-object that defines which collections you want to use
in the transaction. It can have the following sub-attributes:<ul><li><code>read</code>: A single collection or a list of collections to use in the
transaction in read-only mode.</li><li><code>write</code>: A single collection or a list of collections to use in the
transaction in write or read mode.</li><li><code>exclusive</code>: A single collection or a list of collections to acquire
exclusive write access for.</li></ul></li><li><code>action</code>: A JavaScript function or a string with JavaScript code
containing all the instructions to be executed inside the transaction.
If the code runs through successfully, the transaction is committed
at the end. If the code throws an exception, the transaction is
aborted and all database operations are be rolled back.</li></ul><p>Additionally, <code>options</code> can have the following optional attributes:</p><ul><li><code>params</code>: Optional arguments passed to the function specified in <code>action</code>.</li><li><code>allowImplicit</code>: Allow reading from undeclared collections.</li><li><code>waitForSync</code>: An optional boolean flag that, if set, forces the
transaction to write all data to disk before returning.</li><li><code>lockTimeout</code>: A numeric value that can be used to set a timeout in seconds for
waiting on collection locks. This option is only meaningful when using
<code>exclusive</code> locks. If not specified, a default value of 900 seconds is used.
Setting <code>lockTimeout</code> to <code>0</code> makes ArangoDB not time out waiting for a lock.</li><li><code>maxTransactionSize</code>: Transaction size limit in bytes.</li></ul><h3 id=declaration-of-collections>Declaration of Collections <a href=/3.11/develop/transactions/javascript-transactions/#declaration-of-collections class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>All collections participating in a transaction need to be declared
beforehand. This is necessary to ensure proper locking and isolation.</p><p>Collections can be used in a transaction in write mode or in read-only mode.</p><p>If any data modification operations are to be executed, the collection must be
declared for use in write mode. The write mode allows modifying and reading data
from the collection during the transaction (i.e. the write mode includes the
read mode).</p><p>Contrary, using a collection in read-only mode will only allow performing
read operations on a collection. Any attempt to write into a collection used
in read-only mode will make the transaction fail.</p><p>Collections for a transaction are declared by providing them in the <code>collections</code>
attribute of the object passed to the <code>_executeTransaction()</code> function. The
<code>collections</code> attribute can have the sub-attributes <code>read</code>, <code>write</code>, and
<code>exclusive</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;users&#34;</span><span class=p>,</span> <span class=s2>&#34;logins&#34;</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nx>read</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;recommendations&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p><code>read</code>, <code>write</code>, and <code>exclusive</code> are optional attributes, and only need to be
specified if the operations inside the transactions demand for it.</p><p>The attribute values can each be lists of collection names or a single
collection name (as a string):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=s2>&#34;users&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>read</span><span class=o>:</span> <span class=s2>&#34;recommendations&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p><strong>Note</strong>: It is optional to specify collections for read-only access by default.
Even without specifying them, it is still possible to read from such collections
from within a transaction, but with relaxed isolation. Please refer to
<a href=/3.11/develop/transactions/locking-and-isolation/ class=link>Transactions Locking</a> for more details.</p><p>In order to make a transaction fail when a non-declared collection is used inside
for reading, the optional <code>allowImplicit</code> sub-attribute of <code>collections</code> can be
set to <code>false</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>read</span><span class=o>:</span> <span class=s2>&#34;recommendations&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>allowImplicit</span><span class=o>:</span> <span class=kc>false</span>  <span class=cm>/* this disallows read access to other collections
</span></span></span><span class=line><span class=cl><span class=cm>                             than specified */</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb&#34;</span><span class=p>).</span><span class=nx>db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>foobar</span><span class=p>.</span><span class=nx>toArray</span><span class=p>();</span> <span class=cm>/* will fail because db.foobar must not be accessed
</span></span></span><span class=line><span class=cl><span class=cm>                                   for reading inside this transaction */</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>The default value for <code>allowImplicit</code> is <code>true</code>. Write-accessing collections that
have not been declared in the <code>collections</code> array is never possible, regardless of
the value of <code>allowImplicit</code>.</p><h3 id=declaration-of-data-modification-and-retrieval-operations>Declaration of Data Modification and Retrieval Operations <a href=/3.11/develop/transactions/javascript-transactions/#declaration-of-data-modification-and-retrieval-operations class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>All data modification and retrieval operations that are to be executed inside
the transaction need to be specified in a JavaScript function, using the <code>action</code>
attribute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=s2>&#34;users&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// all operations go here
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>Any valid JavaScript code is allowed inside <code>action</code> but the code may only
access the collections declared in <code>collections</code>.
<code>action</code> may be a JavaScript function as shown above, or a string representation
of a JavaScript function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=s2>&#34;users&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=s2>&#34;function () { doSomething(); }&#34;</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>Note that any operations specified in <code>action</code> will be executed on the
server, in a separate scope. Variables will be bound late. Accessing any JavaScript
variables defined on the client-side or in some other server context from inside
a transaction may not work.
Instead, any variables used inside <code>action</code> should be defined inside <code>action</code> itself:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=s2>&#34;users&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(...).</span><span class=nx>db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=p>...</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>When the code inside the <code>action</code> attribute is executed, the transaction is
already started and all required locks have been acquired. When the code inside
the <code>action</code> attribute finishes, the transaction will automatically commit.
There is no explicit commit command.</p><p>To make a transaction abort and roll back all changes, an exception needs to
be thrown and not caught inside the transaction:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=s2>&#34;users&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb&#34;</span><span class=p>).</span><span class=nx>db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;hello&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// will abort and roll back the transaction
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>throw</span> <span class=s2>&#34;doh!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>There is no explicit abort or roll back command.</p><p>As mentioned earlier, a transaction commits automatically when the end of
the <code>action</code> function is reached and no exception were thrown. In this
case, the user can return any legal JavaScript value from the function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=s2>&#34;users&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb&#34;</span><span class=p>).</span><span class=nx>db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;hello&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// will commit the transaction and return the value &#34;hello&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=s2>&#34;hello&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><h3 id=passing-parameters-to-transactions>Passing parameters to transactions <a href=/3.11/develop/transactions/javascript-transactions/#passing-parameters-to-transactions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Arbitrary parameters can be passed to transactions by setting the <code>params</code>
attribute when declaring the transaction. This feature is handy to re-use the
same transaction code for multiple calls but with different parameters.</p><p>A basic example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>params</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>params</span><span class=o>:</span> <span class=p>[</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span> <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>The above example will return <code>2</code>.</p><p>Some example that uses collections:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=s2>&#34;users&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>read</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;c1&#34;</span><span class=p>,</span> <span class=s2>&#34;c2&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@arangodb&#39;</span><span class=p>).</span><span class=nx>db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>doc</span> <span class=o>=</span> <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nb>document</span><span class=p>(</span><span class=nx>params</span><span class=p>[</span><span class=s1>&#39;c1Key&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>doc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>doc</span> <span class=o>=</span> <span class=nx>db</span><span class=p>.</span><span class=nx>c2</span><span class=p>.</span><span class=nb>document</span><span class=p>(</span><span class=nx>params</span><span class=p>[</span><span class=s1>&#39;c2Key&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>doc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>params</span><span class=o>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nx>c1Key</span><span class=o>:</span> <span class=s2>&#34;foo&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nx>c2Key</span><span class=o>:</span> <span class=s2>&#34;bar&#34;</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><h3 id=throwing-exceptions>Throwing Exceptions <a href=/3.11/develop/transactions/javascript-transactions/#throwing-exceptions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>If you catch errors in your transaction, try to get them solved. If you can&rsquo;t,
you may want to mimic original ArangoDB error messages to ease the control flow
of your invoking environment. This can be done like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>arangodb</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@arangodb&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>err</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>arangodb</span><span class=p>.</span><span class=nx>ArangoError</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>err</span><span class=p>.</span><span class=nx>errorNum</span> <span class=o>=</span> <span class=nx>arangodb</span><span class=p>.</span><span class=nx>ERROR_BAD_PARAMETER</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>err</span><span class=p>.</span><span class=nx>errorMessage</span> <span class=o>=</span> <span class=s2>&#34;who&#39;s bad?&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>err</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>For a complete list of possible ArangoDB errors, see
<a href=/3.11/develop/error-codes-and-meanings/ class=link>Error codes and meanings</a>.</p><h3 id=custom-exceptions>Custom Exceptions <a href=/3.11/develop/transactions/javascript-transactions/#custom-exceptions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>You may want to define custom exceptions inside of a transaction. To have the
exception propagate upwards properly, please throw an an instance of base
JavaScript <code>Error</code> class or a derivative. To specify an error number, include it
as the <code>errorNumber</code> field. As an example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>err</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;My error context&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>err</span><span class=p>.</span><span class=nx>errorNum</span> <span class=o>=</span> <span class=mi>1234</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>err</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p><strong>Note</strong>: In previous versions, custom exceptions which did not have an
<code>Error</code>-like form were simply converted to strings and exposed in the
<code>exception</code> field of the returned error. This is no longer the case, as it had
the potential to leak unwanted information if improperly used.</p><p><strong>Note</strong>: In some versions the above example wouldn&rsquo;t propagate the <code>errorNum</code> to the
invoking party, you may need to upgrade your ArangoDB.</p><h3 id=examples>Examples <a href=/3.11/develop/transactions/javascript-transactions/#examples class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><h4 id=single-collection-example>Single Collection Example <a href=/3.11/develop/transactions/javascript-transactions/#single-collection-example class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The first example writes 3 documents into a collection named <code>c1</code>.
The <code>c1</code> collection needs to be declared in the <code>write</code> attribute of the
<code>collections</code> attribute passed to the <code>_executeTransaction()</code> function.</p><p>The <code>action</code> attribute contains the actual transaction code to be executed.
This code contains all data modification operations (3 in this example).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// setup
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;c1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;c1&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb&#34;</span><span class=p>).</span><span class=nx>db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key1&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key2&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key3&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 3
</span></span></span></code></pre></div><p>Aborting the transaction by throwing an exception in the <code>action</code> function
will revert all changes, so as if the transaction never happened:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// setup
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;c1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;c1&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb&#34;</span><span class=p>).</span><span class=nx>db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key1&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key2&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>throw</span> <span class=s2>&#34;doh!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 0
</span></span></span></code></pre></div><p>The automatic rollback is also executed when an internal exception is thrown
at some point during transaction execution:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// setup
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;c1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;c1&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb&#34;</span><span class=p>).</span><span class=nx>db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key1&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// will throw duplicate a key error, not explicitly requested by the user
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key1&#34;</span> <span class=p>});</span>  
</span></span><span class=line><span class=cl>    <span class=c1>// we&#39;ll never get here...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 0
</span></span></span></code></pre></div><p>As required by the <em>consistency</em> principle, aborting or rolling back a
transaction will also restore secondary indexes to the state at transaction
start.</p><h4 id=cross-collection-transactions>Cross-collection Transactions <a href=/3.11/develop/transactions/javascript-transactions/#cross-collection-transactions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>There&rsquo;s also the possibility to run a transaction across multiple collections.
In this case, multiple collections need to be declared in the <code>collections</code>
attribute, e.g.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// setup
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;c1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;c2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;c1&#34;</span><span class=p>,</span> <span class=s2>&#34;c2&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb&#34;</span><span class=p>).</span><span class=nx>db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key1&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c2</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key2&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>c2</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 1
</span></span></span></code></pre></div><p>Again, throwing an exception from inside the <code>action</code> function will make the
transaction abort and roll back all changes in all collections:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// setup
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;c1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;c2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_executeTransaction</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>collections</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;c1&#34;</span><span class=p>,</span> <span class=s2>&#34;c2&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>action</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb&#34;</span><span class=p>).</span><span class=nx>db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>100</span><span class=p>;</span> <span class=o>++</span><span class=nx>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key&#34;</span> <span class=o>+</span> <span class=nx>i</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=nx>db</span><span class=p>.</span><span class=nx>c2</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;key&#34;</span> <span class=o>+</span> <span class=nx>i</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 100
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>db</span><span class=p>.</span><span class=nx>c2</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 100
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// abort
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>throw</span> <span class=s2>&#34;doh!&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>c1</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>c2</span><span class=p>.</span><span class=nx>count</span><span class=p>();</span> <span class=c1>// 0
</span></span></span></code></pre></div><h2 id=http-api>HTTP API <a href=/3.11/develop/transactions/javascript-transactions/#http-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>See the <a href=/3.11/develop/http-api/transactions/javascript-transactions/ class=link>HTTP Interface for JavaScript Transactions</a>
documentation.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.11/develop/transactions/><i class="fas fa-chevron-left fa-fw"></i><p>Transactions</p></a></span><span class=next><a class="nav nav-next link" href=/3.11/develop/transactions/stream-transactions/><p>Stream Transactions</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.11/develop/transactions/javascript-transactions.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#javascript-api>JavaScript API</a></div><div class=level-3><a href=#execute-transaction>Execute Transaction</a></div><div class=level-3><a href=#declaration-of-collections>Declaration of Collections</a></div><div class=level-3><a href=#declaration-of-data-modification-and-retrieval-operations>Declaration of Data Modification and Retrieval Operations</a></div><div class=level-3><a href=#passing-parameters-to-transactions>Passing parameters to transactions</a></div><div class=level-3><a href=#throwing-exceptions>Throwing Exceptions</a></div><div class=level-3><a href=#custom-exceptions>Custom Exceptions</a></div><div class=level-3><a href=#examples>Examples</a></div><div class=level-4><a href=#single-collection-example>Single Collection Example</a></div><div class=level-4><a href=#cross-collection-transactions>Cross-collection Transactions</a></div><div class=level-2><a href=#http-api>HTTP API</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>