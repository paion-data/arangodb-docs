<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743774193></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="ArangoDB is a scalable graph database system with native support for other data models and a built-in search engine, for the cloud and on-premises"><meta property="og:url" content="http://localhost/3.11/develop/foxx-microservices/guides/foxx-in-a-cluster/"><meta property="og:title" content="Foxx in a cluster setup"><meta property="og:type" content="website"><meta property="og:description" content="ArangoDB is a scalable graph database system with native support for other data models and a built-in search engine, for the cloud and on-premises"><meta name=docsearch:version content="3.11"><title>Foxx in a cluster setup | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743774193 defer></script>
<script src=/js/featherlight.min.js?1743774193 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743774193 defer></script>
<script src=/js/theme.js?1743774193 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.11"><a itemprop=item class=link href=/3.11/><span itemprop=name class=breadcrumb-entry>3.11.13</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Develop"><a itemprop=item class=link href=/3.11/develop/><span itemprop=name class=breadcrumb-entry>Develop</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Foxx Microservices"><a itemprop=item class=link href=/3.11/develop/foxx-microservices/><span itemprop=name class=breadcrumb-entry>Foxx Microservices</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Guides"><a itemprop=item class=link href=/3.11/develop/foxx-microservices/guides/><span itemprop=name class=breadcrumb-entry>Guides</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Foxx in a cluster"><a itemprop=item class=link href=/3.11/develop/foxx-microservices/guides/foxx-in-a-cluster/><span itemprop=name class=breadcrumb-entry>Foxx in a cluster</span></a></li></ol></nav><article class=default><hgroup><h1>Foxx in a cluster setup</h1></hgroup><p>When running ArangoDB in a cluster the Foxx services will run on each
Coordinator. Installing, upgrading and uninstalling services on any Coordinator
will automatically distribute the changes to the service to the other Coordinators,
making deployments as easy as in single-server mode.</p><p>The same considerations that apply to writing Foxx services for a
standalone server also apply to writing services for a cluster:</p><p>You should avoid any kind of file system state beyond the deployed service
bundle itself. Don&rsquo;t <a href=/3.11/develop/foxx-microservices/guides/working-with-files/ class=link>write data to the file system</a> or encode
any expectations of the file system state other than the files in the
service folder that were installed as part of the service
(e.g. don&rsquo;t use file uploads or custom log files).</p><p>Additionally, special precautions need to be taken when using the
<a href=/3.11/develop/foxx-microservices/guides/development-mode/#in-a-cluster class=link>development mode in a cluster</a>.</p><h2 id=how-arangodb-distributes-services>How ArangoDB distributes services <a href=/3.11/develop/foxx-microservices/guides/foxx-in-a-cluster/#how-arangodb-distributes-services class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>When you install, replace, upgrade or remove a service, these actions first
take place on a single Coordinator and are then distributed to the other
Coordinators. If a Coordinator for some reason fails to be informed,
its periodic self-healing process will pick up the changes eventually
and apply them anyway.</p><ol><li><p>When installing, upgrading or replacing a service, the new service is
extracted to a temporary directory where Foxx validates the manifest file
and parses the referenced scripts and main file.</p></li><li><p>When replacing, upgrading or removing a service, the old service&rsquo;s teardown
script is executed in a single thread of the Coordinator as desired.</p></li><li><p>When replacing, upgrading or installing a service, the new service&rsquo;s setup
script is executed in a single thread of the Coordinator as desired.</p></li><li><p>The validated service bundle is copied to the Coordinator&rsquo;s service bundles
directory, extracted to the Coordinator&rsquo;s service directory and committed
to an internal collection along with a signature.</p></li><li><p>The service metadata stored in another internal collection is updated,
replaced or created with the new service bundle&rsquo;s signature. An upgrade
retains existing metadata like configuration and dependencies whereas
a replace completely discards any existing metadata.</p></li><li><p>The existing service is unloaded from the Coordinator&rsquo;s worker threads
and the new service is reloaded. If the new service runs into an error
at this point, the service will be marked as broken and
needs to be replaced manually.</p></li><li><p>The Coordinator triggers a local self-heal followed by triggering
a self-heal on all other Coordinators.</p></li><li><p>During the self-heal the Coordinator compares the signature of the
local bundle of each service against the signature stored in that
service&rsquo;s metadata in the database. If necessary, the corresponding
new bundle is downloaded from the database and extracted and the service
is reloaded as in step 6 before.</p></li></ol><p>Note that this means that any service that passes the initial validation step
will complete the install, upgrade or replace process, even if any of the
consecutive steps fail (e.g. due to a runtime error encountered while executing
the service&rsquo;s main file or a syntax error in a required file not referenced
from the manifest directly).</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.11/develop/foxx-microservices/guides/testing-foxx-services/><i class="fas fa-chevron-left fa-fw"></i><p>Testing Foxx services</p></a></span><span class=next><a class="nav nav-next link" href=/3.11/develop/foxx-microservices/guides/scripts-and-scheduling/><p>Scripts and scheduling</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.11/develop/foxx-microservices/guides/foxx-in-a-cluster.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>