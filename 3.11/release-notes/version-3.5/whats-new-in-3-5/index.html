<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743775370></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="Customized Analyzers, multiple shortest path algorithm for graphs, fast cluster joins, a new transaction API, hot backups, a feature for expiring documents"><meta property="og:url" content="http://localhost/3.11/release-notes/version-3.5/whats-new-in-3-5/"><meta property="og:title" content="Features and Improvements in ArangoDB 3.5"><meta property="og:type" content="website"><meta property="og:description" content="Customized Analyzers, multiple shortest path algorithm for graphs, fast cluster joins, a new transaction API, hot backups, a feature for expiring documents"><meta name=docsearch:version content="3.11"><title>Features and Improvements in ArangoDB 3.5 | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743775370 defer></script>
<script src=/js/featherlight.min.js?1743775370 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743775370 defer></script>
<script src=/js/theme.js?1743775370 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.11"><a itemprop=item class=link href=/3.11/><span itemprop=name class=breadcrumb-entry>3.11.13</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Release Notes"><a itemprop=item class=link href=/3.11/release-notes/><span itemprop=name class=breadcrumb-entry>Release Notes</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Version 3.5"><a itemprop=item class=link href=/3.11/release-notes/version-3.5/><span itemprop=name class=breadcrumb-entry>Version 3.5</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="What&rsquo;s New in 3.5"><a itemprop=item class=link href=/3.11/release-notes/version-3.5/whats-new-in-3-5/><span itemprop=name class=breadcrumb-entry>What&rsquo;s New in 3.5</span></a></li></ol></nav><article class=default><hgroup><h1>Features and Improvements in ArangoDB 3.5</h1><p class=lead>Customized Analyzers, multiple shortest path algorithm for graphs, fast cluster joins, a new transaction API, hot backups, a feature for expiring documents</p></hgroup><p>The following list shows in detail which features have been added or improved in
ArangoDB 3.5. ArangoDB 3.5 also contains several bug fixes that are not listed
here.</p><h2 id=arangosearch>ArangoSearch <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#arangosearch class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=configurable-analyzers>Configurable Analyzers <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#configurable-analyzers class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Analyzers can split string values into smaller parts and perform additional
processing such as word stemming and case conversion. In ArangoDB 3.4 there
is a fixed set of text analyzers for 12 different languages, which tokenize
strings into case-insensitive word stems using language-dependent rules based
on the chosen locale, without discarding any stop-words (common words which
carry little meaning such as &ldquo;the&rdquo;). An additional no-operation analyzer
<em>identity</em> is available to keep the input unaltered in its entirety.</p><p>In 3.5, analyzers can be customized as well as used independent of
ArangoSearch Views in AQL. It is possible to tokenize strings without
word stemming, remove user-defined stop-words, split by a delimiting
character only, perform case conversion and/or removal of diacritic
characters against the full input without tokenization and more.</p><p>See <a href=/3.11/index-and-search/analyzers/ class=link>Analyzers</a> for all available options.</p><h3 id=sorted-index>Sorted Index <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#sorted-index class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The index behind an ArangoSearch View can have a primary sort order.
A direction can be specified upon View creation for each uniquely named
attribute (ascending or descending), to enable an optimization for AQL
queries which iterate over a view and sort by one of the attributes.
If the index direction matches the requested <code>SORT</code> direction, then
the data can be read in order directly from the index without actual
sort operation.</p><p>View definition example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;links&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;coll1&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;coll2&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;primarySort&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;field&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;direction&#34;</span><span class=p>:</span> <span class=s2>&#34;desc&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>AQL query example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Execution plan <strong>without</strong> a sorted index being used:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>            <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>          <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>EnumerateViewNode</span>      <span class=mi>1</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>   <span class=cm>/* view query */</span>
</span></span><span class=line><span class=cl>  <span class=mi>3</span>   <span class=n>CalculationNode</span>        <span class=mi>1</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#1</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`val`</span>   <span class=cm>/* attribute expression */</span>
</span></span><span class=line><span class=cl>  <span class=mi>4</span>   <span class=n>SortNode</span>               <span class=mi>1</span>       <span class=o>-</span> <span class=kr>SORT</span> <span class=nl>#1</span> <span class=kr>DESC</span>   <span class=cm>/* sorting strategy: standard */</span>
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>ReturnNode</span>             <span class=mi>1</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Execution plan with the primary sort order of the index being utilized:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>            <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>          <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>EnumerateViewNode</span>      <span class=mi>1</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span> <span class=kr>SORT</span> <span class=n>doc</span><span class=p>.</span><span class=n>`val`</span> <span class=kr>DESC</span>   <span class=cm>/* view query */</span>
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>ReturnNode</span>             <span class=mi>1</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Note that the <code>primarySort</code> option is immutable: it cannot be changed after
View creation. It is therefore not possible to configure it through the Web UI.
The View needs to be created via the HTTP or JavaScript API (arangosh) to set it.</p><p>See <a href=/3.11/index-and-search/arangosearch/performance/#primary-sort-order class=link>Primary Sort Order</a>
of ArangoSearch Views.</p><h3 id=aql-integration>AQL Integration <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#aql-integration class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Some small new features give more control over ArangoSearch from AQL.</p><ul><li><p>The scoring functions <code>BM25()</code> and <code>TFIDF()</code> are not limited to the <code>SORT</code>
operation anymore, but can also be returned as part of the query result:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>doc</span><span class=p>,</span> <span class=n>score</span> <span class=p>}</span></span></span></code></pre></div></li><li><p>The score can be manipulated to influence the ranking based on
attribute values and using numeric AQL functions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>movie</span> <span class=kr>IN</span> <span class=n>imdbView</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=s2>&#34;Star Wars&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>movie</span><span class=p>)</span> <span class=o>*</span> <span class=nf>LOG</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>runtime</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>movie</span></span></span></code></pre></div></li><li><p>The <code>SEARCH</code> operation accepts an options object to restrict the search to
certain collections indexed by a View:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=o>..</span><span class=p>.</span> <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>collections</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;coll1&#34;</span><span class=p>,</span> <span class=s2>&#34;coll2&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div></li><li><p>A new function <code>IN_RANGE()</code> was added for matching values within defined
boundaries, to enable easy range searching primarily for numbers and strings.</p></li></ul><p>See:</p><ul><li><a href=/3.11/aql/functions/arangosearch/#scoring-functions class=link>AQL Scoring Functions</a></li><li><a href=/3.11/aql/high-level-operations/search/#search-options class=link>AQL Search Options</a></li><li><a href=/3.11/aql/functions/arangosearch/#in_range class=link>IN_RANGE() function</a></li></ul><h2 id=aql>AQL <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#aql class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=pruning-in-traversals>Pruning in Traversals <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#pruning-in-traversals class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>With <code>PRUNE</code> you can stop walking down certain paths early in a graph traversal
to improve its efficiency. This is different to <code>FILTER</code>, which would perform
a post-filtering after the actual traversal was carried out already in most
cases. Using <code>PRUNE</code>, the traverser will not follow any more edges on the
current path if the pruning condition is met, but will emit the traversal
variables for whatever stopped it.</p><p>See: <a href=/3.11/aql/graphs/traversals/#pruning class=link>Graph Traversal Pruning</a></p><h3 id=sort-limit-optimization>SORT-LIMIT optimization <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#sort-limit-optimization class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>A new SORT-LIMIT optimization has been added. This optimization will be pulled off
by the query optimizer if there is a SORT statement followed by a LIMIT node, and the
overall number of documents to return is relatively small in relation to the total
number of documents to be sorted. In this case, the optimizer will use a size-constrained
heap for keeping only the required number of results in memory, which can drastically
reduce memory usage and, for some queries, also execution time for the sorting.</p><p>If the optimization is applied, it will show as &ldquo;sort-limit&rdquo; rule in the query execution
plan.</p><p>Also see:</p><ul><li><a href=/3.11/aql/execution-and-performance/query-optimization/#optimizer-rules class=link>AQL Optimizer Rules</a>
(<code>sort-limit</code> rule)</li><li><a href=https://www.arangodb.com/2019/03/sort-limit-optimization-aql/ target=_blank rel="noopener noreferrer" class=link>Sort-Limit Optimization in AQL</a>&nbsp;<i class="fas fa-external-link-alt"></i>
(blog post)</li></ul><h3 id=index-hints-in-aql>Index hints in AQL <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#index-hints-in-aql class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Users may now take advantage of the <code>indexHint</code> inline query option to override
the internal optimizer decision regarding which index to use to serve content
from a given collection. The index hint works with the <a href=#named-indexes class=link>named indexes</a>
feature, making it easy to specify which index to use.</p><p>See:</p><ul><li><a href=/3.11/aql/high-level-operations/for/#indexhint class=link>AQL Index Hints</a></li><li><a href=https://www.arangodb.com/learn/development/index-hints-named-indices/ target=_blank rel="noopener noreferrer" class=link>An introduction to index hints and named indices</a>&nbsp;<i class="fas fa-external-link-alt"></i>
(tutorial)</li></ul><h3 id=sorted-primary-index-rocksdb-engine>Sorted primary index (RocksDB engine) <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#sorted-primary-index-rocksdb-engine class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The query optimizer can now make use of the sortedness of primary indexes if the
RocksDB engine is used. This means the primary index can be utilized for queries
that sort by either the <code>_key</code> or <code>_id</code> attributes of a collection and also for
range queries on these attributes.</p><p>In the list of documents for a collection in the web interface, the documents will
now always be sorted in lexicographical order of their <code>_key</code> values. An exception for
keys representing quasi-numerical values has been removed when doing the sorting in
the web interface. Removing this exception can also speed up the display of the list
of documents.</p><p>This change potentially affects the order in which documents are displayed in the
list of documents overview in the web interface. A document with a key value &ldquo;10&rdquo; will
now be displayed before a document with a key value of &ldquo;9&rdquo;. In previous versions of
ArangoDB this was exactly opposite.</p><h3 id=edge-index-query-optimization-rocksdb-engine>Edge index query optimization (RocksDB engine) <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#edge-index-query-optimization-rocksdb-engine class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>An AQL query that uses the edge index only and returns the opposite side of
the edge can now be executed in a more optimized way, e.g.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>edge</span> <span class=kr>IN</span> <span class=n>edgeCollection</span> <span class=kr>FILTER</span> <span class=n>edge</span><span class=p>.</span><span class=n>_from</span> <span class=o>==</span> <span class=s2>&#34;v/1&#34;</span> <span class=kr>RETURN</span> <span class=n>edge</span><span class=p>.</span><span class=n>_to</span></span></span></code></pre></div><p>is fully covered by the RocksDB edge index.</p><p>For MMFiles this rule does not apply.</p><h3 id=aql-syntax-improvements>AQL syntax improvements <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#aql-syntax-improvements class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>AQL now allows the usage of floating point values without leading zeros, e.g.
<code>.1234</code>. Previous versions of ArangoDB required a leading zero in front of
the decimal separator, i.e <code>0.1234</code>.</p><p>Also see: <a href=/3.11/aql/fundamentals/data-types/#numeric-literals class=link>AQL Numeric Literals</a></p><h3 id=k-shortest-paths-queries>k Shortest Paths queries <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#k-shortest-paths-queries class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>AQL now allows to perform k Shortest Paths queries, that is, query a number of
paths of increasing length from a start vertex to a target vertex.</p><p>See: <a href=/3.11/aql/graphs/k-shortest-paths/ class=link>AQL k Shortest Paths</a></p><h2 id=smartjoins>SmartJoins <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#smartjoins class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The SmartJoins feature available in the ArangoDB Enterprise Edition allows
running joins between two sharded collections with performance close to that
of a local join operation.</p><p>The prerequisite for this is that the two collections have an identical sharding setup,
established via the <code>distributeShardsLike</code> attribute of one of the collections.</p><p>Quick example setup for two collections with identical sharding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;products&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>numberOfShards</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span> <span class=nx>shardKeys</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;_key&#34;</span><span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;orders&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>distributeShardsLike</span><span class=o>:</span> <span class=s2>&#34;products&#34;</span><span class=p>,</span> <span class=nx>shardKeys</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;productId&#34;</span><span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>orders</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;productId&#34;</span><span class=p>]</span> <span class=p>});</span></span></span></code></pre></div><p>Now an AQL query that joins the two collections via their shard keys will benefit from
the SmartJoins optimization, e.g.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>p</span> <span class=kr>IN</span> <span class=n>products</span> 
</span></span><span class=line><span class=cl>  <span class=kr>FOR</span> <span class=n>o</span> <span class=kr>IN</span> <span class=n>orders</span> 
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>p</span><span class=p>.</span><span class=n>_key</span> <span class=o>==</span> <span class=n>o</span><span class=p>.</span><span class=n>productId</span> 
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=n>o</span></span></span></code></pre></div><p>In this query&rsquo;s execution plan, the extra hop via the coordinator can be saved
that is normally there for generic joins. Thanks to the SmartJoins optimization,
the query&rsquo;s execution is as simple as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Id</span>   <span class=n>NodeType</span>                  <span class=n>Site</span>  <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>   <span class=mi>1</span>   <span class=n>SingletonNode</span>             <span class=n>DBS</span>      <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>   <span class=mi>3</span>   <span class=n>EnumerateCollectionNode</span>   <span class=n>DBS</span>      <span class=mi>9</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>o</span> <span class=kr>IN</span> <span class=n>orders</span>   <span class=cm>/* full collection scan, 3 shard(s) */</span>
</span></span><span class=line><span class=cl>   <span class=mi>7</span>   <span class=n>IndexNode</span>                 <span class=n>DBS</span>      <span class=mi>0</span>       <span class=o>-</span> <span class=kr>FOR</span> <span class=n>p</span> <span class=kr>IN</span> <span class=n>products</span>   <span class=cm>/* primary index scan, scan only, 3 shard(s) */</span>
</span></span><span class=line><span class=cl>  <span class=mi>10</span>   <span class=n>RemoteNode</span>                <span class=n>COOR</span>     <span class=mi>0</span>         <span class=o>-</span> <span class=n>REMOTE</span>
</span></span><span class=line><span class=cl>  <span class=mi>11</span>   <span class=n>GatherNode</span>                <span class=n>COOR</span>     <span class=mi>0</span>         <span class=o>-</span> <span class=n>GATHER</span>
</span></span><span class=line><span class=cl>   <span class=mi>6</span>   <span class=n>ReturnNode</span>                <span class=n>COOR</span>     <span class=mi>0</span>         <span class=o>-</span> <span class=kr>RETURN</span> <span class=n>o</span></span></span></code></pre></div><p>Without the SmartJoins optimization, there will be an extra hop via the
coordinator for shipping the data from each shard of the one collection to
each shard of the other collection, which will be a lot more expensive:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>        <span class=n>Site</span>  <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>   <span class=n>DBS</span>      <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl> <span class=mi>16</span>   <span class=n>IndexNode</span>       <span class=n>DBS</span>      <span class=mi>3</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>p</span> <span class=kr>IN</span> <span class=n>products</span>   <span class=cm>/* primary index scan, index only, projections: `_key`, 3 shard(s) */</span>
</span></span><span class=line><span class=cl> <span class=mi>14</span>   <span class=n>RemoteNode</span>      <span class=n>COOR</span>     <span class=mi>3</span>       <span class=o>-</span> <span class=n>REMOTE</span>
</span></span><span class=line><span class=cl> <span class=mi>15</span>   <span class=n>GatherNode</span>      <span class=n>COOR</span>     <span class=mi>3</span>       <span class=o>-</span> <span class=n>GATHER</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>ScatterNode</span>     <span class=n>COOR</span>     <span class=mi>3</span>       <span class=o>-</span> <span class=n>SCATTER</span>
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>RemoteNode</span>      <span class=n>DBS</span>      <span class=mi>3</span>       <span class=o>-</span> <span class=n>REMOTE</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>IndexNode</span>       <span class=n>DBS</span>      <span class=mi>3</span>       <span class=o>-</span> <span class=kr>FOR</span> <span class=n>o</span> <span class=kr>IN</span> <span class=n>orders</span>   <span class=cm>/* hash index scan, 3 shard(s) */</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>RemoteNode</span>      <span class=n>COOR</span>     <span class=mi>3</span>         <span class=o>-</span> <span class=n>REMOTE</span>
</span></span><span class=line><span class=cl> <span class=mi>11</span>   <span class=n>GatherNode</span>      <span class=n>COOR</span>     <span class=mi>3</span>         <span class=o>-</span> <span class=n>GATHER</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>ReturnNode</span>      <span class=n>COOR</span>     <span class=mi>3</span>         <span class=o>-</span> <span class=kr>RETURN</span> <span class=n>o</span></span></span></code></pre></div><p>In the end, SmartJoins can optimize away a lot of the inter-node network
requests normally required for performing a join between sharded collections.
The performance advantage of SmartJoins compared to regular joins will grow
with the number of shards of the underlying collections.</p><p>In general, for two collections with <code>n</code> shards each, the minimal number of
network requests for the general join (<em>no</em> SmartJoins optimization) will be
<code>n * (n + 2)</code>. The number of network requests increases quadratically with the
number of shards.</p><p>SmartJoins can get away with a minimal number of <code>n</code> requests here, which scales
linearly with the number of shards.</p><p>SmartJoins will also be especially advantageous for queries that have to ship a lot
of data around for performing the join, but that will filter out most of the data
after the join. In this case SmartJoins should greatly outperform the general join,
as they will eliminate most of the inter-node data shipping overhead.</p><p>Also see:</p><ul><li><a href=/3.11/develop/smartjoins/ class=link>SmartJoins documentation</a></li><li><a href=https://www.arangodb.com/enterprise-server/smartjoins/ target=_blank rel="noopener noreferrer" class=link>SmartJoins tutorial</a>&nbsp;<i class="fas fa-external-link-alt"></i></li></ul><h2 id=background-index-creation>Background Index Creation <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#background-index-creation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Creating new indexes is by default done under an exclusive collection lock. This means
that the collection (or the respective shards) are not available for write operations
as long as the index is created. This &ldquo;foreground&rdquo; index creation can be undesirable,
if you have to perform it on a live system without a dedicated maintenance window.</p><p>Starting with ArangoDB 3.5, indexes can also be created in &ldquo;background&rdquo;, not using an
exclusive lock during the entire index creation. The collection remains basically available,
so that other CRUD operations can run on the collection while the index is being created.
This can be achieved by setting the <em>inBackground</em> attribute when creating an index.</p><p>To create an index in the background in <em>arangosh</em> just specify <code>inBackground: true</code>,
like in the following example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;value&#34;</span> <span class=p>],</span> <span class=nx>inBackground</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span></span></span></code></pre></div><p>Indexes that are still in the build process will not be visible via the ArangoDB APIs.
Nevertheless it is not possible to create the same index twice via the <em>ensureIndex</em> API
while an index is still being created. AQL queries also will not use these indexes until
the index reports back as fully created. Note that the initial <em>ensureIndex</em> call or HTTP
request will still block until the index is completely ready. Existing single-threaded
client programs can thus safely set the <em>inBackground</em> option to <em>true</em> and continue to
work as before.</p><p>Should you be building an index in the background you cannot rename or drop the collection.
These operations will block until the index creation is finished. This is equally the case
with foreground indexing.</p><p>After an interrupted index build (i.e. due to a server crash) the partially built index
will the removed. In the ArangoDB cluster the index might then be automatically recreated
on affected shards.</p><p>Background index creation might be slower than the &ldquo;foreground&rdquo; index creation and require
more RAM. Under a write heavy load (specifically many remove, update or replace operations),
the background index creation needs to keep a list of removed documents in RAM. This might
become unsustainable if this list grows to tens of millions of entries.</p><p>Building an index is always a write-heavy operation, so it is always a good idea to build
indexes during times with less load.</p><p>Please note that background index creation is useful only in combination with the RocksDB
storage engine. With the MMFiles storage engine, creating an index will always block any
other operations on the collection.</p><p>Also see: <a href=/3.11/index-and-search/indexing/basics/#creating-indexes-in-background class=link>Creating Indexes in Background</a></p><h2 id=ttl-time-to-live-indexes>TTL (time-to-live) Indexes <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#ttl-time-to-live-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The new TTL indexes feature provided by ArangoDB can be used for automatically
removing expired documents from a collection.</p><p>TTL indexes support eventual removal of documents which are past a configured
expiration timepoint. The expiration timepoints can be based upon the documents&rsquo;
original insertion or last-updated timepoints, with adding a period during
which to retain the documents.
Alternatively, expiration timepoints can be specified as absolute values per
document.
It is also possible to exclude documents from automatic expiration and removal.</p><p>Please also note that TTL indexes are designed exactly for the purpose of removing
expired documents from collections. It is <em>not recommended</em> to rely on TTL indexes
for user-land AQL queries. This is because TTL indexes internally may store a transformed,
always numerical version of the index attribute value even if it was originally passed in
as a datestring. As a result TTL indexes will likely not be used for filtering and sort
operations in user-land AQL queries.</p><p>Also see: <a href=/3.11/index-and-search/indexing/working-with-indexes/ttl-indexes/ class=link>TTL Indexes</a></p><h2 id=collections>Collections <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#collections class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>All collections now support a minimum replication factor (minReplicationFactor)
property. This is default set to <code>1</code>, which is identical to previous behavior.
If in a failover scenario a shard of a collection has less than minReplicationFactor
many in sync followers it will go into &ldquo;read-only&rdquo; mode and will reject writes
until enough followers are in sync again.</p><p>In more detail:</p><ul><li>Having <code>minReplicationFactor == 1</code> means as soon as a &ldquo;master-copy&rdquo; is
available of the data writes are allowed.</li><li>Having <code>minReplicationFactor > 1</code> requires additional in sync copies on
follower servers to allow writes.</li></ul><p>The feature is used to reduce the diverging of data in case of server failures
and to help new followers to catch up.</p><p>Also see the <a href=/3.11/develop/javascript-api/@arangodb/db-object/#db_createcollection-name--properties--type--options class=link><code>db</code> object</a></p><h2 id=http-api-extensions>HTTP API extensions <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#http-api-extensions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=extended-index-api>Extended index API <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#extended-index-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The HTTP API for creating indexes at POST <code>/_api/index</code> has been extended two-fold:</p><ul><li><p>to create a TTL (time-to-live) index, it is now possible to specify a value of <code>ttl</code>
in the <code>type</code> attribute. When creating a TTL index, the attribute <code>expireAfter</code> is
also required. That attribute contains the expiration time (in seconds), which is
based on the documents&rsquo; index attribute value.</p></li><li><p>to create an index in background, the attribute <code>inBackground</code> can be set to <code>true</code>.</p></li></ul><h3 id=api-for-querying-the-responsible-shard>API for querying the responsible shard <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#api-for-querying-the-responsible-shard class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The HTTP API for collections has got an additional route for retrieving the responsible
shard for a document at PUT <code>/_api/collection/&lt;name>/responsibleShard</code>.</p><p>When calling this route, the request body is supposed to contain the document for which
the responsible shard should be determined. The response will contain an attribute <code>shardId</code>
containing the ID of the shard that is responsible for that document.</p><p>A method <code>collection.getResponsibleShard(document)</code> was added to the JS API as well.</p><p>It does not matter if the document actually exists or not, as the shard responsibility
is determined from the document&rsquo;s attribute values only.</p><p>Please note that this API is only meaningful and available on a cluster coordinator.</p><p>See:</p><ul><li><a href=/3.11/develop/javascript-api/@arangodb/collection-object/#collectiongetresponsiblesharddocument class=link>Get responsible shard in JS API</a></li><li><a href=/3.11/develop/http-api/collections/#get-the-responsible-shard-for-a-document class=link>Get responsible shard in HTTP API</a></li></ul><h3 id=foxx-api-for-running-tests>Foxx API for running tests <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#foxx-api-for-running-tests class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The HTTP API for running Foxx service tests now supports a <code>filter</code> attribute,
which can be used to limit which test cases should be executed.</p><h3 id=stream-transaction-api>Stream Transaction API <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#stream-transaction-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>There is a new HTTP API for transactions. This API allows clients to add operations to a
transaction in a streaming fashion. A transaction can consist of a series of supported
transactional operations, followed by a commit or abort command.
This allows clients to construct transactions in a more natural way than
with JavaScript-based transactions.</p><p>Note that this requires client applications to abort transactions which are no
longer necessary. Otherwise resources and locks acquired by the transactions
will be in use until the server decides to garbage-collect them.</p><p>In order to keep resource usage low, a maximum lifetime and transaction size for stream
transactions is enforced on the coordinator to ensure that transactions cannot block the
cluster from operating properly:</p><ul><li>Maximum idle timeout of <strong>10 seconds</strong> between operations</li><li>Maximum transaction size of <strong>128 MB</strong> per DB-Server</li></ul><p>These limits are also enforced for stream transactions on single servers.</p><p>Enforcing the limits is useful to free up resources used by abandoned
transactions, for example from transactions that are abandoned by client
applications due to programming errors or that were left over because client
connections were interrupted. Also see
<a href=/3.11/release-notes/version-3.5/known-issues-in-3-5/#stream-transactions class=link>Known Issues</a></p><p>See: <a href=/3.11/develop/http-api/transactions/stream-transactions/ class=link>Stream Transaction HTTP API</a></p><h3 id=minimal-replication-factor>Minimal replication Factor <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#minimal-replication-factor class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Within the properties of a collection we can now define a <code>minReplicationFactor</code>.
This affects all routes that can create or modify the properties of a collection,
including the graph API <code>_api/gharial</code>. All places where a replicationFactor can
be modified, can now modify the minReplicationFactor as well.</p><h2 id=web-interface>Web interface <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#web-interface class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>When using the RocksDB engine, the selection of index types &ldquo;hash&rdquo; and &ldquo;skiplist&rdquo;
has been removed from the web interface when creating new indexes.</p><p>The index types &ldquo;hash&rdquo;, &ldquo;skiplist&rdquo; and &ldquo;persistent&rdquo; are just aliases of each other
when using the RocksDB engine, so there is no need to offer them all. In the web
interface there remains the index of type &ldquo;persistent&rdquo;, which is feature-wise
identical with &ldquo;hash&rdquo; and &ldquo;skiplist&rdquo; indexes for the RocksDB engine.
Existing &ldquo;hash&rdquo; and &ldquo;skiplist&rdquo; indexes will remain fully functional.</p><h2 id=javascript>JavaScript <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#javascript class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=v8-updated>V8 updated <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#v8-updated class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The bundled version of the V8 JavaScript engine has been upgraded from 5.7.492.77 to
7.1.302.28.</p><p>Among other things, the new version of V8 provides a native JavaScript <code>BigInt</code> type which
can be used to store arbitrary-precision integers. However, to store such <code>BigInt</code> objects
in ArangoDB, they need to be explicitly converted to either strings or simple JavaScript
numbers.
Converting BigInts to strings for storage is preferred because converting a BigInt to a
simple number may lead to precision loss.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// will fail with &#34;bad parameter&#34; error:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>value</span> <span class=o>=</span> <span class=nx>BigInt</span><span class=p>(</span><span class=s2>&#34;123456789012345678901234567890&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>value</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// will succeed:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>value</span><span class=o>:</span> <span class=nb>String</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// will succeed, but lead to precision loss:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>value</span><span class=o>:</span> <span class=nb>Number</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>});</span></span></span></code></pre></div><p>The new V8 version also changes the default timezone of date strings to be conditional
on whether a time part is included:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>&gt;</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=s2>&#34;2019-04-01&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Mon</span> <span class=nx>Apr</span> <span class=mi>01</span> <span class=mi>2019</span> <span class=mi>02</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span> <span class=nx>GMT</span><span class=o>+</span><span class=mi>0200</span> <span class=p>(</span><span class=nx>Central</span> <span class=nx>European</span> <span class=nx>Summer</span> <span class=nx>Time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=s2>&#34;2019-04-01T00:00:00&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Mon</span> <span class=nx>Apr</span> <span class=mi>01</span> <span class=mi>2019</span> <span class=mi>00</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span> <span class=nx>GMT</span><span class=o>+</span><span class=mi>0200</span> <span class=p>(</span><span class=nx>Central</span> <span class=nx>European</span> <span class=nx>Summer</span> <span class=nx>Time</span><span class=p>)</span></span></span></code></pre></div><p>If the timezone is explicitly set in the date string, then the specified timezone will
always be honored:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>&gt;</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=s2>&#34;2019-04-01Z&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Mon</span> <span class=nx>Apr</span> <span class=mi>01</span> <span class=mi>2019</span> <span class=mi>02</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span> <span class=nx>GMT</span><span class=o>+</span><span class=mi>0200</span> <span class=p>(</span><span class=nx>Central</span> <span class=nx>European</span> <span class=nx>Summer</span> <span class=nx>Time</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=s2>&#34;2019-04-01T00:00:00Z&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Mon</span> <span class=nx>Apr</span> <span class=mi>01</span> <span class=mi>2019</span> <span class=mi>02</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span> <span class=nx>GMT</span><span class=o>+</span><span class=mi>0200</span> <span class=p>(</span><span class=nx>Central</span> <span class=nx>European</span> <span class=nx>Summer</span> <span class=nx>Time</span><span class=p>)</span></span></span></code></pre></div><h3 id=javascript-dependencies>JavaScript Dependencies <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#javascript-dependencies class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>More than a dozen JavaScript dependencies were updated in 3.5
(<a href=https://github.com/arangodb/arangodb/blob/3.5/CHANGELOG target=_blank rel="noopener noreferrer" class=link>changelog</a>&nbsp;<i class="fas fa-external-link-alt"></i>).</p><p>The most significant one is the update of <code>joi</code> from 9.2.0 to 14.3.1. See the
respective <a href="https://github.com/hapijs/joi/issues?q=is%3Aissue+label%3A%22release+notes%22" target=_blank rel="noopener noreferrer" class=link>release notes</a>&nbsp;<i class="fas fa-external-link-alt"></i>
to see if there are breaking changes for you.</p><p>Note that you can bundle your own version of <code>joi</code> if you need to rely on
version-dependent features.</p><h3 id=javascript-security-options>JavaScript Security Options <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#javascript-security-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>ArangoDB 3.5 provides several new options for restricting the functionality of
JavaScript application code running in the server, with the intent to make a setup
more secure.</p><p>There now exist startup options for restricting which environment variables and
values of which configuration options JavaScript code is allowed to read. These
options can be set to prevent leaking of confidential information from the
environment or the setup into the JavaScript application code.
Additionally there are options to restrict outbound HTTP connections from JavaScript
applications to certain endpoints and to restrict filesystem access from JavaScript
applications to certain directories only.</p><p>Finally there are startup options to turn off the REST APIs for managing Foxx
services, which can be used to prevent installation and uninstallation of Foxx
applications on a server. A separate option is provided to turn off access and
connections to the central Foxx app store via the web interface.</p><p>A complete overview of the security options can be found in
<a href=/3.11/operations/security/security-options/ class=link>Security Options</a>.</p><h3 id=foxx>Foxx <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#foxx class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Request credentials are now exposed via the <code>auth</code> property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>tokens</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>collection</span><span class=p>(</span><span class=s2>&#34;tokens&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;/authorized&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>req</span><span class=p>.</span><span class=nx>auth</span> <span class=o>||</span> <span class=o>!</span><span class=nx>req</span><span class=p>.</span><span class=nx>auth</span><span class=p>.</span><span class=nx>bearer</span> <span class=o>||</span> <span class=o>!</span><span class=nx>tokens</span><span class=p>.</span><span class=nx>exists</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>auth</span><span class=p>.</span><span class=nx>bearer</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=k>throw</span><span class=p>(</span><span class=mi>403</span><span class=p>,</span> <span class=s2>&#34;Not authenticated&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span></span></span></code></pre></div><h3 id=api-improvements>API improvements <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#api-improvements class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Collections now provide the <code>documentId</code> method to derive document ids from keys.</p><p>Before:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>collection</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>collection</span><span class=p>(</span><span class=s2>&#34;users&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>documentKey</span> <span class=o>=</span> <span class=s2>&#34;my-document-key&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>documentId</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>collection</span><span class=p>.</span><span class=nx>name</span><span class=p>()</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>documentKey</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span></span></span></code></pre></div><p>After:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>collection</span> <span class=o>=</span> <span class=nx>context</span><span class=p>.</span><span class=nx>collection</span><span class=p>(</span><span class=s2>&#34;users&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>documentKey</span> <span class=o>=</span> <span class=s2>&#34;my-document-key&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>documentId</span> <span class=o>=</span> <span class=nx>collection</span><span class=p>.</span><span class=nx>documentId</span><span class=p>(</span><span class=nx>documentKey</span><span class=p>);</span></span></span></code></pre></div><h2 id=client-tools>Client tools <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#client-tools class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=dump-and-restore-all-databases>Dump and restore all databases <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#dump-and-restore-all-databases class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><strong>arangodump</strong> got an option <code>--all-databases</code> to make it dump all available databases
instead of just a single database specified via the option <code>--server.database</code>.</p><p>When set to true, this makes arangodump dump all available databases the current
user has access to. The option <code>--all-databases</code> cannot be used in combination with
the option <code>--server.database</code>.</p><p>When <code>--all-databases</code> is used, arangodump will create a subdirectory with the data
of each dumped database. Databases will be dumped one after the after. However,
inside each database, the collections of the database can be dumped in parallel
using multiple threads.
When dumping all databases, the consistency guarantees of arangodump are the same
as when dumping multiple single database individually, so the dump does not provide
cross-database consistency of the data.</p><p><strong>arangorestore</strong> got an option <code>--all-databases</code> to make it restore all databases from
inside the subdirectories of the specified dump directory, instead of just the
single database specified via the option <code>--server.database</code>.</p><p>Using the option for arangorestore only makes sense for dumps created with arangodump
and the <code>--all-databases</code> option. As for arangodump, arangorestore cannot be invoked
with the both options <code>--all-databases</code> and <code>--server.database</code> at the same time.
Additionally, the option <code>--force-same-database</code> cannot be used together with
<code>--all-databases</code>.</p><p>If the to-be-restored databases do not exist on the target server, then restoring data
into them will fail unless the option <code>--create-database</code> is also specified for
arangorestore. Please note that in this case a database user must be used that has
access to the <code>_system</code> database, in order to create the databases on restore.</p><p>Also see:</p><ul><li><a href=/3.11/components/tools/arangodump/ class=link><em>arangodump</em></a></li><li><a href=/3.11/components/tools/arangorestore/ class=link><em>arangorestore</em></a></li></ul><h3 id=warning-if-connected-to-db-server>Warning if connected to DB-Server <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#warning-if-connected-to-db-server class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Under normal circumstances there should be no need to connect to a
database server in a cluster with one of the client tools, and it is
likely that any user operations carried out there with one of the client
tools may cause trouble.</p><p>The client tools arangosh, arangodump and arangorestore will now emit
a warning when connecting with them to a database server node in a cluster.</p><h2 id=startup-option-changes>Startup option changes <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#startup-option-changes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The value type of the hidden startup option <code>--rocksdb.recycle-log-file-num</code> has
been changed from numeric to boolean in ArangoDB 3.5, as the option is also a
boolean option in the underlying RocksDB library.</p><p>Client configurations that use this configuration variable should adjust their
configuration and set this variable to a boolean value instead of to a numeric
value.</p><h2 id=miscellaneous>Miscellaneous <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#miscellaneous class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=improved-overview-of-available-program-options>Improved overview of available program options <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#improved-overview-of-available-program-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>--help-all</code> command-line option for all ArangoDB executables will now also
show all hidden program options.</p><p>Previously hidden program options were only returned when invoking arangod or
a client tool with the cryptic <code>--help-.</code> option. Now <code>--help-all</code> simply returns
them as well.</p><h3 id=fewer-system-collections>Fewer system collections <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#fewer-system-collections class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The system collections <code>_frontend</code>, <code>_modules</code> and <code>_routing</code> are not created
anymore for new databases by default.</p><p><code>_modules</code> and <code>_routing</code> are only needed for legacy functionality.
Existing <code>_routing</code> collections will not be touched as they may contain user-defined
entries, and will continue to work.</p><p>Existing <code>_modules</code> collections will also remain functional.</p><p>The <code>_frontend</code> collection may still be required for actions triggered by the
web interface, but it will automatically be created lazily if needed.</p><h3 id=named-indexes>Named indexes <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#named-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>indexes now have an additional <code>name</code> field, which allows for more useful
identifiers. System indexes, like the primary and edge indexes, have default
names (<code>primary</code> and <code>edge</code>, respectively). If no <code>name</code> value is specified
on index creation, one will be auto-generated (e.g. <code>idx_13820395</code>). The index
name <em>cannot</em> be changed after index creation. No two indexes on the same
collection may share the same name, but two indexes on different collections
may.</p><h3 id=id-values-in-log-messages>ID values in log messages <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#id-values-in-log-messages class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>By default, ArangoDB and its client tools now show a 5 digit unique ID value in
any of their log messages, e.g.</p><pre tabindex=0><code>2019-03-25T21:23:19Z [8144] INFO [cf3f4] ArangoDB (version 3.5.0 enterprise [linux]) is ready for business. Have fun!.
</code></pre><p>In this message, the <code>cf3f4</code> is the message&rsquo;s unique ID value. ArangoDB users can
use this ID to build custom monitoring or alerting based on specific log ID values.
Existing log ID values are supposed to stay constant in future releases of arangod.</p><p>Additionally the unique log ID values can be used by the ArangoDB support to find
out which component of the product exactly generated a log message. The IDs also
make disambiguation of identical log messages easier.</p><p>The presence of these ID values in log messages may confuse custom log message filtering
or routing mechanisms that parse log messages and that rely on the old log message
format.</p><p>This can be fixed adjusting any existing log message parsers and making them aware
of the ID values. The ID values are always 5 byte strings, consisting of the characters
<code>[0-9a-f]</code>. ID values are placed directly behind the log level (e.g. <code>INFO</code>).</p><p>Alternatively, the log IDs can be suppressed in all log messages by setting the startup
option <code>--log.ids false</code> when starting arangod or any of the client tools.</p><h2 id=internal>Internal <a href=/3.11/release-notes/version-3.5/whats-new-in-3-5/#internal class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>We have moved from C++11 to C++14, which allows us to use some of the simplifications,
features and guarantees that this standard has in stock.
To compile ArangoDB from source, a compiler that supports C++14 is now required.</p><p>The bundled JEMalloc memory allocator used in ArangoDB release packages has been
upgraded from version 5.0.1 to version 5.2.0.</p><p>The bundled version of the RocksDB library has been upgraded from 5.16 to 6.2.</p><p>The unit test framework has been changed from catch to googletest. This change also
renames a CMake configuration variable from <code>USE_CATCH_TESTS</code> to <code>USE_GOOGLE_TESTS</code>.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.11/release-notes/version-3.5/><i class="fas fa-chevron-left fa-fw"></i><p>Version 3.5</p></a></span><span class=next><a class="nav nav-next link" href=/3.11/release-notes/version-3.5/known-issues-in-3-5/><p>Known Issues in 3.5</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.11/release-notes/version-3.5/whats-new-in-3-5.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#arangosearch>ArangoSearch</a></div><div class=level-3><a href=#configurable-analyzers>Configurable Analyzers</a></div><div class=level-3><a href=#sorted-index>Sorted Index</a></div><div class=level-3><a href=#aql-integration>AQL Integration</a></div><div class=level-2><a href=#aql>AQL</a></div><div class=level-3><a href=#pruning-in-traversals>Pruning in Traversals</a></div><div class=level-3><a href=#sort-limit-optimization>SORT-LIMIT optimization</a></div><div class=level-3><a href=#index-hints-in-aql>Index hints in AQL</a></div><div class=level-3><a href=#sorted-primary-index-rocksdb-engine>Sorted primary index (RocksDB engine)</a></div><div class=level-3><a href=#edge-index-query-optimization-rocksdb-engine>Edge index query optimization (RocksDB engine)</a></div><div class=level-3><a href=#aql-syntax-improvements>AQL syntax improvements</a></div><div class=level-3><a href=#k-shortest-paths-queries>k Shortest Paths queries</a></div><div class=level-2><a href=#smartjoins>SmartJoins</a></div><div class=level-2><a href=#background-index-creation>Background Index Creation</a></div><div class=level-2><a href=#ttl-time-to-live-indexes>TTL (time-to-live) Indexes</a></div><div class=level-2><a href=#collections>Collections</a></div><div class=level-2><a href=#http-api-extensions>HTTP API extensions</a></div><div class=level-3><a href=#extended-index-api>Extended index API</a></div><div class=level-3><a href=#api-for-querying-the-responsible-shard>API for querying the responsible shard</a></div><div class=level-3><a href=#foxx-api-for-running-tests>Foxx API for running tests</a></div><div class=level-3><a href=#stream-transaction-api>Stream Transaction API</a></div><div class=level-3><a href=#minimal-replication-factor>Minimal replication Factor</a></div><div class=level-2><a href=#web-interface>Web interface</a></div><div class=level-2><a href=#javascript>JavaScript</a></div><div class=level-3><a href=#v8-updated>V8 updated</a></div><div class=level-3><a href=#javascript-dependencies>JavaScript Dependencies</a></div><div class=level-3><a href=#javascript-security-options>JavaScript Security Options</a></div><div class=level-3><a href=#foxx>Foxx</a></div><div class=level-3><a href=#api-improvements>API improvements</a></div><div class=level-2><a href=#client-tools>Client tools</a></div><div class=level-3><a href=#dump-and-restore-all-databases>Dump and restore all databases</a></div><div class=level-3><a href=#warning-if-connected-to-db-server>Warning if connected to DB-Server</a></div><div class=level-2><a href=#startup-option-changes>Startup option changes</a></div><div class=level-2><a href=#miscellaneous>Miscellaneous</a></div><div class=level-3><a href=#improved-overview-of-available-program-options>Improved overview of available program options</a></div><div class=level-3><a href=#fewer-system-collections>Fewer system collections</a></div><div class=level-3><a href=#named-indexes>Named indexes</a></div><div class=level-3><a href=#id-values-in-log-messages>ID values in log messages</a></div><div class=level-2><a href=#internal>Internal</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>