<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1747031427></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="A summary of the changes to the HTTP API and other interfaces that are relevant for developers, like maintainers of drivers and integrations for ArangoDB"><meta property="og:url" content="http://localhost/3.11/release-notes/version-3.11/api-changes-in-3-11/"><meta property="og:title" content="API Changes in ArangoDB 3.11"><meta property="og:type" content="website"><meta property="og:description" content="A summary of the changes to the HTTP API and other interfaces that are relevant for developers, like maintainers of drivers and integrations for ArangoDB"><meta name=docsearch:version content="3.11"><title>API Changes in ArangoDB 3.11 | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1747031427 defer></script>
<script src=/js/featherlight.min.js?1747031427 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1747031427 defer></script>
<script src=/js/theme.js?1747031427 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.11"><a itemprop=item class=link href=/3.11/><span itemprop=name class=breadcrumb-entry>3.11.13</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Release Notes"><a itemprop=item class=link href=/3.11/release-notes/><span itemprop=name class=breadcrumb-entry>Release Notes</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Version 3.11"><a itemprop=item class=link href=/3.11/release-notes/version-3.11/><span itemprop=name class=breadcrumb-entry>Version 3.11</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="API changes in 3.11"><a itemprop=item class=link href=/3.11/release-notes/version-3.11/api-changes-in-3-11/><span itemprop=name class=breadcrumb-entry>API changes in 3.11</span></a></li></ol></nav><article class=default><hgroup><h1>API Changes in ArangoDB 3.11</h1><p class=lead>A summary of the changes to the HTTP API and other interfaces that are relevant for developers, like maintainers of drivers and integrations for ArangoDB</p></hgroup><h2 id=http-restful-api>HTTP RESTful API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#http-restful-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=behavior-changes>Behavior changes <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#behavior-changes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><h4 id=extended-naming-constraints-for-collections-views-and-indexes>Extended naming constraints for collections, Views, and indexes <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#extended-naming-constraints-for-collections-views-and-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>In ArangoDB 3.9, the <code>--database.extended-names-databases</code> startup option was
added to optionally allow database names to contain most UTF-8 characters.
The startup option has been renamed to <code>--database.extended-names</code> in 3.11 and
now controls whether you want to use the extended naming constraints for
database, collection, View, and index names.</p><p>The feature is disabled by default to ensure compatibility with existing client
drivers and applications that only support ASCII names according to the
traditional naming constraints used in previous ArangoDB versions.</p><p>If the feature is enabled, then any endpoints that contain database, collection,
View, or index names in the URL may contain special characters that were
previously not allowed (percent-encoded). They are also to be expected in
payloads that contain database, collection, View, or index names, as well as
document identifiers (because they are comprised of the collection name and the
document key). If client applications assemble URLs with extended names
programmatically, they need to ensure that extended names are properly
URL-encoded.</p><p>When using extended names, any Unicode characters in names need to be
<a href=http://unicode.org/reports/tr15/#Norm_Forms target=_blank rel="noopener noreferrer" class=link>NFC-normalized</a>&nbsp;<i class="fas fa-external-link-alt"></i>.
If you try to create a database, collection, View, or index with a non-NFC-normalized
name, the server rejects it.</p><p>The ArangoDB web interface as well as the <em>arangobench</em>, <em>arangodump</em>,
<em>arangoexport</em>, <em>arangoimport</em>, <em>arangorestore</em>, and <em>arangosh</em> client tools
ship with support for the extended naming constraints, but they require you
to provide NFC-normalized names.</p><p>Please be aware that dumps containing extended names cannot be restored
into older versions that only support the traditional naming constraints. In a
cluster setup, it is required to use the same naming constraints for all
Coordinators and DB-Servers of the cluster. Otherwise, the startup is
refused. In DC2DC setups, it is also required to use the same naming
constraints for both datacenters to avoid incompatibilities.</p><p>Also see:</p><ul><li><a href=/3.11/concepts/data-structure/collections/#collection-names class=link>Collection names</a></li><li><a href=/3.11/concepts/data-structure/views/#view-names class=link>View names</a></li><li>Index names have the same character restrictions as collection names</li></ul><h4 id=stricter-validation-of-unicode-surrogate-values-in-json-data>Stricter validation of Unicode surrogate values in JSON data <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#stricter-validation-of-unicode-surrogate-values-in-json-data class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>ArangoDB 3.11 employs a stricter validation of Unicode surrogate pairs in
incoming JSON data, for all REST APIs.</p><p>In previous versions, the following loopholes existed when validating UTF-8
surrogate pairs in incoming JSON data:</p><ul><li>a high surrogate, followed by something other than a low surrogate
(or the end of the string)</li><li>a low surrogate, not preceded by a high surrogate</li></ul><p>These validation loopholes have been closed in 3.11, which means that any JSON
inputs containing such invalid surrogate pair data are rejected by the server.</p><p>This is normally the desired behavior, as it helps invalid data from entering
the database. However, in situations when a database is known to contain invalid
data and must continue supporting it (at least temporarily), the extended
validation can be disabled by setting the server startup option
<code>--server.validate-utf8-strings</code> to <code>false</code>. This is not recommended long-term,
but only during upgrading or data cleanup.</p><h4 id=status-code-if-write-concern-not-fulfilled>Status code if write concern not fulfilled <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#status-code-if-write-concern-not-fulfilled class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The new <code>--cluster.failed-write-concern-status-code</code> startup option can be used
to change the default <code>403</code> status code to <code>503</code> when the write concern cannot
be fulfilled for a write operation to a collection in a cluster deployment.
This signals client applications that it is a temporary error. Only the
HTTP status code changes in this case, no automatic retry of the operation is
attempted by the cluster.</p><h4 id=graph-api-gharial>Graph API (Gharial) <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#graph-api-gharial class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The <code>POST /_api/gharial/</code> endpoint for creating named graphs validates the
<code>satellites</code> property of the graph <code>options</code> for SmartGraphs differently now.</p><p>If the <code>satellites</code> property is set, it must be an array, either empty or with
one or more collection name strings. If the value is not in that format, the
error &ldquo;Missing array for field <code>satellites</code>&rdquo; is now returned, for example, if
it is a string or a <code>null</code> value. Previously, it returned &ldquo;invalid parameter type&rdquo;.
If the graph is not a SmartGraph, the <code>satellites</code> property is ignored unless its
value is an array but its elements are not strings, in which case the error
&ldquo;Invalid parameter type&rdquo; is returned.</p><h4 id=validation-of-smartgraphattribute-in-smartgraphs>Validation of <code>smartGraphAttribute</code> in SmartGraphs <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#validation-of-smartgraphattribute-in-smartgraphs class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.10.13, v3.11.7</small></p><p>The attribute defined by the <code>smartGraphAttribute</code> graph property is not allowed to be
changed in the documents of SmartGraph vertex collections. This is now strictly enforced.
You must set the attribute when creating a document. Any attempt to modify or remove
the attribute afterward by update or replace operations now throws an error. Previously,
the <code>smartGraphAttribute</code> value was checked only when inserting documents into a
SmartGraph vertex collection, but not for update or replace operations.</p><p>The missing checks on update and replace operations allowed to retroactively
modify the value of the <code>smartGraphAttribute</code> for existing documents, which
could have led to problems when the data of such a SmartGraph vertex collection was
replicated to a new follower shard. On the new follower shard, the documents
went through the full validation and led to documents with modified
<code>smartGraphAttribute</code> values being rejected on the follower. This could have
led to follower shards not getting in sync.</p><p>Now, the value of the <code>smartGraphAttribute</code> is fully validated with every
insert, update, or replace operation, and every attempt to modify the value of
the <code>smartGraphAttribute</code> retroactively fails with the <code>4003</code> error,
<code>ERROR_KEY_MUST_BE_PREFIXED_WITH_SMART_GRAPH_ATTRIBUTE</code>.
Additionally, if upon insertion the <code>smartGraphAttribute</code> is missing for a
SmartGraph vertex, the error code is error <code>4001</code>, <code>ERROR_NO_SMART_GRAPH_ATTRIBUTE</code>.</p><p>To retroactively repair the data in any of the affected collections, it is
possible to update every (affected) document with the correct value of the
<code>smartGraphAttribute</code> via an AQL query as follows:</p><pre tabindex=0><code>FOR doc IN @@collection
  LET expected = SUBSTRING(doc._key, 0, FIND_FIRST(doc._key, &#39;:&#39;))
  LET actual = doc.@attr
  FILTER expected != actual
  UPDATE doc WITH {@attr: expected} IN @@collection
  COLLECT WITH COUNT INTO updated
  RETURN updated
</code></pre><p>This updates all documents with the correct (expected) value of the
<code>smartGraphAttribute</code> if it deviates from the expected value. The query
returns the number of updated documents as well.</p><p>The bind parameters necessary to run this query are:</p><ul><li><code>@@collection</code>: name of a SmartGraph vertex collection to be updated</li><li><code>@attr</code>: attribute name of the <code>smartGraphAttribute</code> of the collection</li></ul><h4 id=database-api>Database API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#database-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The <code>POST /_api/database</code> endpoint for creating a new database has changed.
If the specified database name is invalid/illegal, it now returns the error code
<code>1208</code> (<code>ERROR_ARANGO_ILLEGAL_NAME</code>). It previously returned <code>1229</code>
(<code>ERROR_ARANGO_DATABASE_NAME_INVALID</code>) in this case.</p><p>This is a downwards-incompatible change, but unifies the behavior for database
creation with the behavior of collection and View creation, which also return
the error code <code>1208</code> in case the specified name is not allowed.</p><h4 id=document-api>Document API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#document-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The following endpoints support a new <code>refillIndexCaches</code> query
parameter to repopulate the index caches after requests that insert, update,
replace, or remove single or multiple documents (including edges) if this
affects an edge index or cache-enabled persistent indexes:</p><ul><li><code>POST /_api/document/{collection}</code></li><li><code>PATCH /_api/document/{collection}/{key}</code></li><li><code>PUT /_api/document/{collection}/{key}</code></li><li><code>DELETE /_api/document/{collection}/{key}</code></li></ul><p>It is a boolean option and the default is <code>false</code>.</p><p>This also applies to the <code>INSERT</code>, <code>UPDATE</code>, <code>REPLACE</code>, and <code>REMOVE</code> operations
in AQL queries, which support a <code>refillIndexCache</code> option, too.</p><p>In 3.9 and 3.10, <code>refillIndexCaches</code> was experimental and limited to edge caches.</p><hr><p><small>Introduced in: v3.11.1</small></p><p>When inserting multiple documents/edges at once in a cluster, the Document API
used to let the entire request fail if any of the documents/edges failed to be
saved due to a key error. More specifically, if the value of a <code>_key</code> attribute
contains illegal characters or if the key doesn&rsquo;t meet additional requirements,
for instance, coming from the collection being used in a Disjoint SmartGraph,
the <code>POST /_api/document/{collection}</code> endpoint would not reply with the usual
array of either the document metadata or the error object for each attempted
document insertion. Instead, it used to return an error object for the first
offending document only, and aborted the operation with an HTTP <code>400 Bad Request</code>
status code so that none of the documents were saved. Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -d <span class=s1>&#39;[{&#34;_key&#34;:&#34;valid&#34;},{&#34;_key&#34;:&#34;invalid space&#34;}]&#39;</span> http://localhost:8529/_api/document/coll
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;code&#34;</span>:400,<span class=s2>&#34;error&#34;</span>:true,<span class=s2>&#34;errorMessage&#34;</span>:<span class=s2>&#34;illegal document key&#34;</span>,<span class=s2>&#34;errorNum&#34;</span>:1221<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; curl http://localhost:8529/_api/document/coll/valid
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;code&#34;</span>:404,<span class=s2>&#34;error&#34;</span>:true,<span class=s2>&#34;errorMessage&#34;</span>:<span class=s2>&#34;document not found&#34;</span>,<span class=s2>&#34;errorNum&#34;</span>:1202<span class=o>}</span>
</span></span></code></pre></div><p>Now, such key errors in cluster deployments no longer fail the entire request,
matching the behavior of single server deployments. Any errors are reported in
the result array for the respective documents, along with the successful ones:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -d <span class=s1>&#39;[{&#34;_key&#34;:&#34;valid&#34;},{&#34;_key&#34;:&#34;invalid space&#34;}]&#39;</span> http://localhost:8529/_api/document/coll
</span></span><span class=line><span class=cl><span class=o>[{</span><span class=s2>&#34;_id&#34;</span>:<span class=s2>&#34;coll/valid&#34;</span>,<span class=s2>&#34;_key&#34;</span>:<span class=s2>&#34;valid&#34;</span>,<span class=s2>&#34;_rev&#34;</span>:<span class=s2>&#34;_gG9JHsW---&#34;</span><span class=o>}</span>,<span class=o>{</span><span class=s2>&#34;error&#34;</span>:true,<span class=s2>&#34;errorNum&#34;</span>:1221,<span class=s2>&#34;errorMessage&#34;</span>:<span class=s2>&#34;illegal document key&#34;</span><span class=o>}]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; curl http://localhost:8529/_api/document/coll/valid
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;_key&#34;</span>:<span class=s2>&#34;valid&#34;</span>,<span class=s2>&#34;_id&#34;</span>:<span class=s2>&#34;coll/valid&#34;</span>,<span class=s2>&#34;_rev&#34;</span>:<span class=s2>&#34;_gG9JHsW---&#34;</span><span class=o>}</span>
</span></span></code></pre></div><hr><p><small>Introduced in: v3.11.1</small></p><p>Using the Document API for reading multiple documents used to return an error
if the request body was an empty array. Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -XPUT -d <span class=s1>&#39;[]&#39;</span> <span class=s1>&#39;http://localhost:8529/_api/document/coll?onlyget=true&#39;</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;code&#34;</span>:500,<span class=s2>&#34;error&#34;</span>:true,<span class=s2>&#34;errorMessage&#34;</span>:<span class=s2>&#34;internal error&#34;</span>,<span class=s2>&#34;errorNum&#34;</span>:4<span class=o>}</span>
</span></span></code></pre></div><p>Now, a request like this succeeds and returns an empty array as response.</p><h4 id=collection-api>Collection API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#collection-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The edge collections of EnterpriseGraphs and SmartGraphs (including
Disjoint SmartGraphs and SmartGraphs using SatelliteCollections but excluding
the edge collections of the SatelliteCollections) previously reported a
value of <code>0</code> as the <code>numberOfShards</code>. They now return the actual number of
shards. This value can be higher than the configured <code>numberOfShards</code> value of
the graph due to internally used hidden collections.</p><h4 id=cursor-api>Cursor API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#cursor-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>When you link a collection to an <code>arangosearch</code> View and run an AQL query
against this View while it is still being indexed, you now receive the query result
including a warning. This warning alerts you about potentially incomplete results obtained
from a partially indexed collection. The error code associated with this
warning is <code>1240</code> (<code>ERROR_ARANGO_INCOMPLETE_READ</code>).</p><hr><p><small>Introduced in: v3.9.11, v3.10.7</small></p><p>In AQL graph traversals (<code>POST /_api/cursor</code> endpoint), you can restrict the
vertex and edge collections in the traversal options like so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>v</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>p</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>3</span> <span class=kr>OUTBOUND</span> <span class=s1>&#39;products/123&#39;</span> <span class=n>components</span>
</span></span><span class=line><span class=cl>  <span class=kp>OPTIONS</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>vertexCollections</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;bolts&#34;</span><span class=p>,</span> <span class=s2>&#34;screws&#34;</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>edgeCollections</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;productsToBolts&#34;</span><span class=p>,</span> <span class=s2>&#34;productsToScrews&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>v</span> 
</span></span></code></pre></div><p>If you specify collections that don&rsquo;t exist, queries now fail with
a &ldquo;collection or view not found&rdquo; error (code <code>1203</code> and HTTP status
<code>404 Not Found</code>). In previous versions, unknown vertex collections were ignored,
and the behavior for unknown edge collections was undefined.</p><p>Additionally, the collection types are now validated. If a document collection
or View is specified in <code>edgeCollections</code>, an error is raised
(code <code>1218</code> and HTTP status <code>400 Bad Request</code>).</p><p>Furthermore, it is now an error if you specify a vertex collection that is not
part of the specified named graph (code <code>1926</code> and HTTP status <code>404 Not Found</code>).
It is also an error if you specify an edge collection that is not part of the
named graph&rsquo;s definition or of the list of edge collections (code <code>1939</code> and
HTTP status <code>400 Bad Request</code>).</p><h4 id=log-api>Log API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#log-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Setting the log level for the <code>graphs</code> log topic to <code>TRACE</code> now logs detailed
information about AQL graph traversals and (shortest) path searches.
Some new log messages are also logged for the <code>DEBUG</code> level.</p><h4 id=disabled-foxx-apis>Disabled Foxx APIs <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#disabled-foxx-apis class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.10.5</small></p><p>A <code>--foxx.enable</code> startup option has been added to <em>arangod</em>. It defaults to <code>true</code>.
If the option is set to <code>false</code>, access to Foxx services is forbidden and is
responded with an HTTP <code>403 Forbidden</code> error. Access to the management APIs for
Foxx services are also disabled as if <code>--foxx.api false</code> is set manually.</p><h4 id=configurable-whitespace-in-metrics>Configurable whitespace in metrics <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#configurable-whitespace-in-metrics class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.10.6</small></p><p>The output format of the <code>/_admin/metrics</code> and <code>/_admin/metrics/v2</code> endpoints
slightly changes for metrics with labels. By default, the metric label and value
are separated by a space for improved compatibility with some tools. This is
controlled by the new <code>--server.ensure-whitespace-metrics-format</code> startup option,
which is enabled by default from v3.10.6 onward. Example:</p><p>Enabled:</p><pre tabindex=0><code>arangodb_agency_cache_callback_number{role=&#34;SINGLE&#34;} 0
</code></pre><p>Disabled:</p><pre tabindex=0><code>arangodb_agency_cache_callback_number{role=&#34;SINGLE&#34;}0
</code></pre><h4 id=limit-to-the-number-of-databases-in-a-deployment>Limit to the number of databases in a deployment <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#limit-to-the-number-of-databases-in-a-deployment class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.10.10, v3.11.2</small></p><p>The new <code>--database.max-databases</code> startup option can cap the number of databases
and creating databases using the <code>POST /_api/database</code> endpoint can thus now fail
for this reason if your deployment is at or above the configured maximum. Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;errorMessage&#34;</span><span class=p>:</span> <span class=s2>&#34;unable to create additional database because it would exceed the configured maximum number of databases (2)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;errorNum&#34;</span><span class=p>:</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=endpoint-return-value-changes>Endpoint return value changes <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#endpoint-return-value-changes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.8.8, v3.9.4, v3.10.1</small></p><p>Changed the encoding of revision IDs returned by the below listed REST APIs:</p><ul><li><code>GET /_api/collection/&lt;collection-name>/revision</code>: The revision ID was
previously returned as numeric value, and now it is returned as
a string value with either numeric encoding or HLC-encoding inside.</li><li><code>GET /_api/collection/&lt;collection-name>/checksum</code>: The revision ID in
the <code>revision</code> attribute was previously encoded as a numeric value
in single server, and as a string in cluster. This is now unified so
that the <code>revision</code> attribute always contains a string value with
either numeric encoding or HLC-encoding inside.</li></ul><h3 id=endpoints-added>Endpoints added <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#endpoints-added class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><h4 id=maintenance-mode-for-db-servers>Maintenance mode for DB-Servers <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#maintenance-mode-for-db-servers class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.10.1</small></p><p>For rolling upgrades or rolling restarts, DB-Servers can now be put into
maintenance mode, so that no attempts are made to re-distribute the data in a
cluster for such planned events. DB-Servers in maintenance mode are not
considered viable failover targets because they are likely restarted soon.</p><p>To query the maintenance status of a DB-Server, use this new endpoint:</p><p><code>GET /_admin/cluster/maintenance/&lt;DB-Server-ID></code></p><p>An example reply of a DB-Server that is in maintenance mode:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Mode&#34;</span><span class=p>:</span> <span class=s2>&#34;maintenance&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Until&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-10-26T06:14:23Z&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If the DB-Server is not in maintenance mode, then the <code>result</code> attribute is
omitted:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>To put a DB-Server into maintenance mode, use this new endpoint:</p><p><code>PUT /_admin/cluster/maintenance/&lt;DB-Server-ID></code></p><p>The payload of the request needs to be as follows, with the <code>timeout</code> in seconds:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;mode&#34;</span><span class=p>:</span> <span class=s2>&#34;maintenance&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;timeout&#34;</span><span class=p>:</span> <span class=mi>360</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>To turn the maintenance mode off, set <code>mode</code> to <code>"normal"</code> instead, and omit the
<code>timeout</code> attribute or set it to <code>0</code>.</p><p>You can send another request when the DB-Server is already in maintenance mode
to extend the timeout.</p><p>The maintenance mode ends automatically after the defined timeout.</p><p>Also see the <a href=/3.11/develop/http-api/cluster/#get-the-maintenance-status-of-a-db-server class=link>HTTP interface for cluster maintenance</a>.</p><h4 id=shard-usage-metrics>Shard usage metrics <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#shard-usage-metrics class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.10.13, v3.11.7</small></p><p>With <code>GET /_admin/usage-metrics</code> you can retrieve detailed shard usage metrics on
DB-Servers.</p><p>These metrics can be enabled by setting the <code>--server.export-shard-usage-metrics</code>
startup option to <code>enabled-per-shard</code> to make DB-Servers collect per-shard
usage metrics, or to <code>enabled-per-shard-per-user</code> to make DB-Servers collect
usage metrics per shard and per user whenever a shard is accessed.</p><p>For more information, see the <a href=/3.11/develop/http-api/monitoring/metrics/#get-usage-metrics class=link>HTTP API description</a>
and <a href=/3.11/release-notes/version-3.11/whats-new-in-3-11/#monitoring-per-collectiondatabaseuser class=link>Monitoring per collection/database/user</a>.</p><h3 id=endpoints-augmented>Endpoints augmented <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#endpoints-augmented class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><h4 id=cursor-api-1>Cursor API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#cursor-api-1 class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><ul><li><p>The <code>POST /_api/cursor</code> and <code>POST /_api/cursor/{cursor-identifier}</code> endpoints
can now return an additional statistics value in the <code>stats</code> sub-attribute,
<code>intermediateCommits</code>. It is the total number of intermediate commits the
query has performed. This number can only be greater than zero for
data modification queries that perform modifications beyond the
<code>--rocksdb.intermediate-commit-count</code> or <code>--rocksdb.intermediate-commit-size</code>
thresholds. In clusters, the intermediate commits are tracked per DB-Server
that participates in the query and are summed up in the end.</p></li><li><p>The <code>/_api/cursor</code> endpoint accepts a new <code>allowRetry</code> attribute in the
<code>options</code> object. Set this option to <code>true</code> to make it possible to retry
fetching the latest batch from a cursor. The default is <code>false</code>.</p><p>If retrieving a result batch fails because of a connection issue, you can ask
for that batch again using the new <code>POST /_api/cursor/&lt;cursor-id>/&lt;batch-id></code>
endpoint. The first batch has an ID of <code>1</code> and the value is incremented by 1
with every batch. Every result response except the last one also includes a
<code>nextBatchId</code> attribute, indicating the ID of the batch after the current.
You can remember and use this batch ID should retrieving the next batch fail.</p><p>You can only request the latest batch again (or the next batch).
Earlier batches are not kept on the server-side.
Requesting a batch again does not advance the cursor.</p><p>You can also call this endpoint with the next batch identifier, i.e. the value
returned in the <code>nextBatchId</code> attribute of a previous request. This advances the
cursor and returns the results of the next batch. This is only supported if there
are more results in the cursor (i.e. <code>hasMore</code> is <code>true</code> in the latest batch).</p><p>From v3.11.1 onward, you may use the <code>POST /_api/cursor/&lt;cursor-id>/&lt;batch-id></code>
endpoint even if the <code>allowRetry</code> attribute is <code>false</code> to fetch the next batch,
but you cannot request a batch again unless you set it to <code>true</code>.
The <code>nextBatchId</code> attribute is always present in result objects (except in the
last batch) from v3.11.1 onward.</p><p>To allow refetching of the very last batch of the query, the server cannot
automatically delete the cursor. After the first attempt of fetching the last
batch, the server would normally delete the cursor to free up resources. As you
might need to reattempt the fetch, it needs to keep the final batch when the
<code>allowRetry</code> option is enabled. Once you successfully received the last batch,
you should call the <code>DELETE /_api/cursor/&lt;cursor-id></code> endpoint so that the
server doesn&rsquo;t unnecessarily keep the batch until the cursor times out
(<code>ttl</code> query option).</p></li><li><p>When profiling a query (<code>profile</code> option <code>true</code>, <code>1</code>, or <code>2</code>), the <code>profile</code>
object returned under <code>extra</code> now includes a new <code>"instantiating executors"</code>
attribute with the time needed to create the query executors, and in cluster
mode, this also includes the time needed for physically distributing the query
snippets to the participating DB-Servers. Previously, the time spent for
instantiating executors and the physical distribution was contained in the
<code>optimizing plan</code> stage.</p></li><li><p>The endpoint supports a new <code>maxDNFConditionMembers</code> query option, which is a
threshold for the maximum number of <code>OR</code> sub-nodes in the internal
representation of an AQL <code>FILTER</code> condition and defaults to <code>786432</code>.</p></li></ul><h4 id=analyzer-types>Analyzer types <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#analyzer-types class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The <code>/_api/analyzer</code> endpoint supports a new Analyzer type in the
Enterprise Edition:</p><ul><li><a href=/3.11/index-and-search/analyzers/#geo_s2 class=link><code>geo_s2</code></a> (introduced in v3.10.5):
Like the existing <code>geojson</code> Analyzer, but with an additional <code>format</code> property
that can be set to <code>"latLngDouble"</code> (default), <code>"latLngInt"</code>, or <code>"s2Point"</code>.</li></ul><h4 id=query-api>Query API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#query-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The <a href=/3.11/develop/http-api/queries/aql-queries/#list-the-running-aql-queries class=link><code>GET /_api/query/current</code></a>
and <a href=/3.11/develop/http-api/queries/aql-queries/#list-the-slow-aql-queries class=link><code>GET /_api/query/slow</code></a>
endpoints include a new numeric <code>peakMemoryUsage</code> attribute.</p><hr><p>The <code>GET /_api/query/current</code> endpoint can return a new value
<code>"instantiating executors"</code> as <code>state</code> in the query list.</p><h4 id=index-api>Index API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#index-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><h5 id=progress-indication-on-the-index-generation>Progress indication on the index generation <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#progress-indication-on-the-index-generation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h5><p><small>Introduced in: v3.10.13, v3.11.7</small></p><p>The <code>GET /_api/index</code> endpoint may now include a <code>progress</code> attribute for the
elements in the <code>indexes</code> array. For every index that is currently being created,
it indicates the progress of the index generation (in percent).</p><p>To return indexes that are not yet fully built but are in the building phase,
add the <code>withHidden=true</code> query parameter to the call of the endpoint.
Note that this includes internal indexes in the response as well, such as
<code>arangosearch</code> indexes.</p><pre tabindex=0><code>curl &#34;http://localhost:8529/_api/index?collection=myCollection&amp;withHidden=true&#34;
</code></pre><h5 id=restriction-of-indexable-fields>Restriction of indexable fields <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#restriction-of-indexable-fields class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h5><p>It is now forbidden to create indexes that cover fields whose attribute names
start or end with <code>:</code> , for example, <code>fields: ["value:"]</code>. This notation is
reserved for internal use.</p><p>Existing indexes are not affected but you cannot create new indexes with a
preceding or trailing colon using the <code>POST /_api/index</code> endpoint.</p><h5 id=inverted-indexes>Inverted indexes <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#inverted-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h5><p><small>Introduced in: v3.10.2</small></p><p><a href=/3.11/develop/http-api/indexes/inverted/ class=link>Inverted indexes</a> support new
caching options in the Enterprise Edition.</p><ul><li><p>A new <code>cache</code> option for inverted indexes as the default (boolean, default:
<code>false</code>) or for specific <code>fields</code> (boolean, default: the value of the
top-level <code>cache</code> option) to always cache field normalization values and
Geo Analyzer auxiliary data in memory.</p></li><li><p>A new <code>cache</code> option per object in the definition of the <code>storedValues</code>
elements to always cache stored values in memory (boolean, default: <code>false</code>).</p></li><li><p>A new <code>cache</code> option in the <code>primarySort</code> property to always cache the
primary sort columns in memory (boolean, default: <code>false</code>).</p></li><li><p>A new <code>primaryKeyCache</code> property for inverted indexes to always cache the
primary key column in memory (boolean, default: <code>false</code>).</p></li></ul><p>The <code>POST /_api/index</code> endpoint accepts these new options for <code>inverted</code> indexes
and the <code>GET /_api/index</code> and <code>GET /_api/index/&lt;index-id></code> endpoints may return
these options. The attributes are omitted in responses unless you enable the
respective option.</p><h4 id=view-api>View API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#view-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Views of the type <code>arangosearch</code> support new caching options in the
Enterprise Edition.</p><p><small>Introduced in: v3.9.5, v3.10.2</small></p><ul><li>A <code>cache</code> option for individual View links or fields (boolean, default: <code>false</code>).</li><li>A <code>cache</code> option in the definition of a <code>storedValues</code> View property
(boolean, immutable, default: <code>false</code>).</li></ul><p><small>Introduced in: v3.9.6, v3.10.2</small></p><ul><li>A <code>primarySortCache</code> View property (boolean, immutable, default: <code>false</code>).</li><li>A <code>primaryKeyCache</code> View property (boolean, immutable, default: <code>false</code>).</li></ul><p>The <code>POST /_api/view</code> endpoint accepts these new options for <code>arangosearch</code>
Views, the <code>GET /_api/view/&lt;view-name>/properties</code> endpoint may return these
options, and you can change the <code>cache</code> View link/field property with the
<code>PUT /_api/view/&lt;view-name>/properties</code> and <code>PATCH /_api/view/&lt;view-name>/properties</code>
endpoints.</p><p><small>Introduced in: v3.10.3</small></p><p>You may use a shorthand notations on <code>arangosearch</code> View creation or the
<code>storedValues</code> option, like <code>["attr1", "attr2"]</code>, instead of using an array of
objects.</p><p>See the <a href=/3.11/index-and-search/arangosearch/arangosearch-views-reference/#link-properties class=link><code>arangosearch</code> Views Reference</a>
for details.</p><h4 id=pregel-api>Pregel API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#pregel-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Four new endpoints have been added to the Pregel HTTP interface for the new
persisted execution statistics for Pregel jobs:</p><ul><li><code>GET /_api/control_pregel/history/{id}</code> to retrieve the persisted execution
statistics of a specific Pregel job</li><li><code>GET /_api/control_pregel/history</code> to retrieve the persisted execution
statistics of all currently active and past Pregel jobs</li><li><code>DELETE /_api/control_pregel/history/{id}</code> to delete the persisted execution
statistics of a specific Pregel job</li><li><code>DELETE /_api/control_pregel/history</code> to delete the persisted execution
statistics of all Pregel jobs</li></ul><p>See <a href=/3.11/develop/http-api/pregel/ class=link>Pregel HTTP API</a> for details.</p><h4 id=cluster-rebalance-api>Cluster rebalance API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#cluster-rebalance-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The <code>POST /_admin/cluster/rebalance</code> and <code>PUT /_admin/cluster/rebalance</code>
endpoints support a new <code>excludeSystemCollections</code> option that lets you ignore
system collections in the shard rebalance plan.</p><p>The <code>/_admin/cluster/rebalance</code> route (<code>GET</code>, <code>POST</code>, and <code>PUT</code> methods) returns
a new <code>totalShardsFromSystemCollections</code> property in the <code>shards</code> object of the
<code>result</code> with the number of leader shards from system collections. The adjacent
<code>totalShards</code> property may not include system collections depending on the
<code>excludeSystemCollections</code> option.</p><h4 id=explain-api>Explain API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#explain-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.10.4</small></p><p>The <code>POST /_api/explain</code> endpoint for explaining AQL queries includes the
following two new statistics in the <code>stats</code> attribute of the response now:</p><ul><li><code>peakMemoryUsage</code> (number): The maximum memory usage of the query during
explain (in bytes)</li><li><code>executionTime</code> (number): The (wall-clock) time in seconds needed to explain
the query.</li></ul><h4 id=metrics-api>Metrics API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#metrics-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The following metric has been added in version 3.11:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>arangodb_search_num_primary_docs</code></td><td style=text-align:left>Number of primary documents for current snapshot.</td></tr></tbody></table><hr><p><small>Introduced in: v3.10.7, v3.11.1</small></p><p>This new metric reports the number of RocksDB <code>.sst</code> files:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>rocksdb_total_sst_files</code></td><td style=text-align:left>Total number of RocksDB sst files, aggregated over all levels.</td></tr></tbody></table><hr><p><small>Introduced in: v3.10.7</small></p><p>The metrics endpoints include the following new file descriptors metrics:</p><ul><li><code>arangodb_file_descriptors_current</code></li><li><code>arangodb_file_descriptors_limit</code></li></ul><hr><p><small>Introduced in: v3.8.9, v3.9.6, v3.10.2</small></p><p>The metrics endpoints include the following new traffic accounting metrics:</p><ul><li><code>arangodb_client_user_connection_statistics_bytes_received</code></li><li><code>arangodb_client_user_connection_statistics_bytes_sent</code></li><li><code>arangodb_http1_connections_total</code></li></ul><hr><p><small>Introduced in: v3.9.6, v3.10.2</small></p><p>The metrics endpoints include the following new edge cache (re-)filling metrics:</p><ul><li><code>rocksdb_cache_auto_refill_loaded_total</code></li><li><code>rocksdb_cache_auto_refill_dropped_total</code></li><li><code>rocksdb_cache_full_index_refills_total</code></li></ul><hr><p><small>Introduced in: v3.9.10, v3.10.5</small></p><p>The following metrics for write-ahead log (WAL) file tracking have been added:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>rocksdb_live_wal_files</code></td><td style=text-align:left>Number of live RocksDB WAL files.</td></tr><tr><td style=text-align:left><code>rocksdb_wal_released_tick_flush</code></td><td style=text-align:left>Lower bound sequence number from which WAL files need to be kept because of external flushing needs.</td></tr><tr><td style=text-align:left><code>rocksdb_wal_released_tick_replication</code></td><td style=text-align:left>Lower bound sequence number from which WAL files need to be kept because of replication.</td></tr><tr><td style=text-align:left><code>arangodb_flush_subscriptions</code></td><td style=text-align:left>Number of currently active flush subscriptions.</td></tr></tbody></table><hr><p><small>Introduced in: v3.10.5</small></p><p>The following metric for the number of replication clients for a server has
been added:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>arangodb_replication_clients</code></td><td style=text-align:left>Number of currently connected/active replication clients.</td></tr></tbody></table><hr><p><small>Introduced in: v3.9.11, v3.10.6</small></p><p>The following metrics for diagnosing delays in cluster-internal network requests
have been added:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>arangodb_network_dequeue_duration</code></td><td style=text-align:left>Internal request duration for the dequeue in seconds.</td></tr><tr><td style=text-align:left><code>arangodb_network_response_duration</code></td><td style=text-align:left>Internal request duration from fully sent till response received in seconds.</td></tr><tr><td style=text-align:left><code>arangodb_network_send_duration</code></td><td style=text-align:left>Internal request send duration in seconds.</td></tr><tr><td style=text-align:left><code>arangodb_network_unfinished_sends_total</code></td><td style=text-align:left>Number of internal requests for which sending has not finished.</td></tr></tbody></table><hr><p><small>Introduced in: v3.10.7</small></p><p>The following metric stores the peak value of the <code>rocksdb_cache_allocated</code> metric:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>rocksdb_cache_peak_allocated</code></td><td style=text-align:left>Global peak memory allocation of ArangoDB in-memory caches.</td></tr></tbody></table><hr><p><small>Introduced in: v3.11.2</small></p><p>The following metrics have been added about the LZ4 compression for values in
the in-memory edge cache:</p><ul><li><code>rocksdb_cache_edge_inserts_effective_entries_size_total</code></li><li><code>rocksdb_cache_edge_inserts_uncompressed_entries_size_total</code></li><li><code>rocksdb_cache_edge_compression_ratio</code></li></ul><hr><p><small>Introduced in: v3.10.11, v3.11.4</small></p><p>The following metrics have been added to improve the observability of in-memory
cache subsystem:</p><ul><li><code>rocksdb_cache_free_memory_tasks_total</code></li><li><code>rocksdb_cache_free_memory_tasks_duration_total</code></li><li><code>rocksdb_cache_migrate_tasks_total</code></li><li><code>rocksdb_cache_migrate_tasks_duration_total</code></li></ul><hr><p><small>Introduced in: v3.11.4</small></p><p>The following metrics have been added to improve the observability of in-memory
edge cache:</p><ul><li><code>rocksdb_cache_edge_compressed_inserts_total</code></li><li><code>rocksdb_cache_edge_empty_inserts_total</code></li><li><code>rocksdb_cache_edge_inserts_total</code></li></ul><hr><p><small>Introduced in: v3.11.5</small></p><p>The following metrics have been added to monitor and detect temporary or
permanent connectivity issues as well as how many scheduler threads are in the
detached state:</p><ul><li><code>arangodb_network_connectivity_failures_coordinators</code></li><li><code>arangodb_network_connectivity_failures_dbservers_total</code></li><li><code>arangodb_scheduler_num_detached_threads</code></li></ul><h4 id=log-level-api>Log level API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#log-level-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.10.2</small></p><p>The <code>GET /_admin/log/level</code> and <code>PUT /_admin/log/level</code> endpoints support a new
query parameter <code>serverId</code>, to forward log level get and set requests to a
specific server. This makes it easier to adjust the log levels in clusters
because DB-Servers require JWT authentication whereas Coordinators also support
authentication using usernames and passwords.</p><h4 id=explain-api-1>Explain API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#explain-api-1 class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.10.4</small></p><p>The <code>POST /_api/explain</code> endpoint for explaining AQL queries includes the
following two new statistics in the <code>stats</code> attribute of the response now:</p><ul><li><code>peakMemoryUsage</code> (number): The maximum memory usage of the query during
explain (in bytes)</li><li><code>executionTime</code> (number): The (wall-clock) time in seconds needed to explain
the query.</li></ul><h4 id=optimizer-rule-descriptions>Optimizer rule descriptions <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#optimizer-rule-descriptions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.10.9, v3.11.2</small></p><p>The <code>GET /_api/query/rules</code> endpoint now includes a <code>description</code> attribute for
every optimizer rule that briefly explains what it does.</p><h3 id=endpoints-deprecated>Endpoints deprecated <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#endpoints-deprecated class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>GET /_admin/database/target-version</code> endpoint is deprecated in favor of the
more general version API with the endpoint <code>GET /_api/version</code>.
The endpoint will be removed in ArangoDB v3.12.</p><h2 id=javascript-api>JavaScript API <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#javascript-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=database-creation>Database creation <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#database-creation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>db._createDatabase()</code> method for creating a new database has changed.
If the specified database name is invalid/illegal, it now returns the error code
<code>1208</code> (<code>ERROR_ARANGO_ILLEGAL_NAME</code>). It previously returned <code>1229</code>
(<code>ERROR_ARANGO_DATABASE_NAME_INVALID</code>) in this case.</p><p>This is a downwards-incompatible change, but unifies the behavior for database
creation with the behavior of collection and View creation, which also return
the error code <code>1208</code> in case the specified name is not allowed.</p><h3 id=index-methods>Index methods <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#index-methods class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Calling <code>collection.dropIndex(...)</code> or <code>db._dropIndex(...)</code> now raises an error
if the specified index does not exist or cannot be dropped (for example, because
it is a primary index or edge index). The methods previously returned <code>false</code>.
In case of success, they still return <code>true</code>.</p><p>You can wrap calls to these methods with a <code>try { ... }</code> block to catch errors,
for example, in <em>arangosh</em> or in Foxx services.</p><h3 id=aql-queries>AQL queries <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#aql-queries class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>When you use e.g. the <code>db._query()</code> method to execute an AQL query against an
<code>arangosearch</code> View while it is still in the process of being built,
the query now includes a warning message that the results may not be
complete due to the ongoing indexing process of the View.</p><p>The error code associated with this warning is <code>1240</code>
(<code>ERROR_ARANGO_INCOMPLETE_READ</code>).</p><hr><p><small>Introduced in: v3.9.11, v3.10.7</small></p><p>If you specify collections that don&rsquo;t exist in the options of AQL graph traversals
(<code>vertexCollections</code>, <code>edgeCollections</code>), queries now fail. In previous versions,
unknown vertex collections were ignored, and the behavior for unknown
edge collections was undefined.</p><p>Additionally, queries fail if you specify a document collection or View
in <code>edgeCollections</code>.</p><h3 id=pregel-module>Pregel module <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#pregel-module class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Two new methods have been added to the <code>@arangodb/pregel</code> module:</p><ul><li><code>history(...)</code> to get the persisted execution statistics of a specific or all
algorithm executions</li><li><code>removeHistory(...)</code> to delete the persisted execution statistics of a
specific or all algorithm executions</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>pregel</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/pregel&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>execution</span> <span class=o>=</span> <span class=nx>pregel</span><span class=p>.</span><span class=nx>start</span><span class=p>(</span><span class=s2>&#34;sssp&#34;</span><span class=p>,</span> <span class=s2>&#34;demograph&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>source</span><span class=o>:</span> <span class=s2>&#34;vertices/V&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>historyStatus</span> <span class=o>=</span> <span class=nx>pregel</span><span class=p>.</span><span class=nx>history</span><span class=p>(</span><span class=nx>execution</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>pregel</span><span class=p>.</span><span class=nx>removeHistory</span><span class=p>();</span></span></span></code></pre></div><p>See <a href=/3.11/data-science/pregel/#get-persisted-execution-statistics class=link>Distributed Iterative Graph Processing (Pregel)</a>
for details.</p><h3 id=collectioniterate-deprecated><code>collection.iterate()</code> deprecated <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#collectioniterate-deprecated class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>collection.iterate()</code> method is deprecated from v3.11.0 onwards and will be
removed in a future version.</p><h3 id=arangodbrequest-certificate-validation><code>@arangodb/request</code> certificate validation <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#arangodbrequest-certificate-validation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.11.11</small></p><p>The <code>@arangodb/request</code> module now supports two additional options for making
HTTPS requests:</p><ul><li><code>verifyCertificates</code> (optional): if set to <code>true</code>, the server certificate of
the remote server is verified using the default certificate store of the system.
Default: <code>false</code>.</li><li><code>verifyDepth</code> (optional): limit the maximum length of the certificate chain
that counts as valid. Default: <code>10</code>.</li></ul><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/><i class="fas fa-chevron-left fa-fw"></i><p>Incompatible changes in 3.11</p></a></span><span class=next><a class="nav nav-next link" href=/3.11/release-notes/version-3.10/><p>Version 3.10</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.11/release-notes/version-3.11/api-changes-in-3-11.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#http-restful-api>HTTP RESTful API</a></div><div class=level-3><a href=#behavior-changes>Behavior changes</a></div><div class=level-4><a href=#extended-naming-constraints-for-collections-views-and-indexes>Extended naming constraints for collections, Views, and indexes</a></div><div class=level-4><a href=#stricter-validation-of-unicode-surrogate-values-in-json-data>Stricter validation of Unicode surrogate values in JSON data</a></div><div class=level-4><a href=#status-code-if-write-concern-not-fulfilled>Status code if write concern not fulfilled</a></div><div class=level-4><a href=#graph-api-gharial>Graph API (Gharial)</a></div><div class=level-4><a href=#validation-of-smartgraphattribute-in-smartgraphs>Validation of <code>smartGraphAttribute</code> in SmartGraphs</a></div><div class=level-4><a href=#database-api>Database API</a></div><div class=level-4><a href=#document-api>Document API</a></div><div class=level-4><a href=#collection-api>Collection API</a></div><div class=level-4><a href=#cursor-api>Cursor API</a></div><div class=level-4><a href=#log-api>Log API</a></div><div class=level-4><a href=#disabled-foxx-apis>Disabled Foxx APIs</a></div><div class=level-4><a href=#configurable-whitespace-in-metrics>Configurable whitespace in metrics</a></div><div class=level-4><a href=#limit-to-the-number-of-databases-in-a-deployment>Limit to the number of databases in a deployment</a></div><div class=level-3><a href=#endpoint-return-value-changes>Endpoint return value changes</a></div><div class=level-3><a href=#endpoints-added>Endpoints added</a></div><div class=level-4><a href=#maintenance-mode-for-db-servers>Maintenance mode for DB-Servers</a></div><div class=level-4><a href=#shard-usage-metrics>Shard usage metrics</a></div><div class=level-3><a href=#endpoints-augmented>Endpoints augmented</a></div><div class=level-4><a href=#cursor-api-1>Cursor API</a></div><div class=level-4><a href=#analyzer-types>Analyzer types</a></div><div class=level-4><a href=#query-api>Query API</a></div><div class=level-4><a href=#index-api>Index API</a></div><div class=level-5><a href=#progress-indication-on-the-index-generation>Progress indication on the index generation</a></div><div class=level-5><a href=#restriction-of-indexable-fields>Restriction of indexable fields</a></div><div class=level-5><a href=#inverted-indexes>Inverted indexes</a></div><div class=level-4><a href=#view-api>View API</a></div><div class=level-4><a href=#pregel-api>Pregel API</a></div><div class=level-4><a href=#cluster-rebalance-api>Cluster rebalance API</a></div><div class=level-4><a href=#explain-api>Explain API</a></div><div class=level-4><a href=#metrics-api>Metrics API</a></div><div class=level-4><a href=#log-level-api>Log level API</a></div><div class=level-4><a href=#explain-api-1>Explain API</a></div><div class=level-4><a href=#optimizer-rule-descriptions>Optimizer rule descriptions</a></div><div class=level-3><a href=#endpoints-deprecated>Endpoints deprecated</a></div><div class=level-2><a href=#javascript-api>JavaScript API</a></div><div class=level-3><a href=#database-creation>Database creation</a></div><div class=level-3><a href=#index-methods>Index methods</a></div><div class=level-3><a href=#aql-queries>AQL queries</a></div><div class=level-3><a href=#pregel-module>Pregel module</a></div><div class=level-3><a href=#collectioniterate-deprecated><code>collection.iterate()</code> deprecated</a></div><div class=level-3><a href=#arangodbrequest-certificate-validation><code>@arangodb/request</code> certificate validation</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>