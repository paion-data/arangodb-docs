<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743774193></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="Check the following list of potential breaking changes before upgrading to this ArangoDB version and adjust any client applications if necessary"><meta property="og:url" content="http://localhost/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/"><meta property="og:title" content="Incompatible changes in ArangoDB 3.11"><meta property="og:type" content="website"><meta property="og:description" content="Check the following list of potential breaking changes before upgrading to this ArangoDB version and adjust any client applications if necessary"><meta name=docsearch:version content="3.11"><title>Incompatible changes in ArangoDB 3.11 | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743774193 defer></script>
<script src=/js/featherlight.min.js?1743774193 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743774193 defer></script>
<script src=/js/theme.js?1743774193 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.11"><a itemprop=item class=link href=/3.11/><span itemprop=name class=breadcrumb-entry>3.11.13</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Release Notes"><a itemprop=item class=link href=/3.11/release-notes/><span itemprop=name class=breadcrumb-entry>Release Notes</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Version 3.11"><a itemprop=item class=link href=/3.11/release-notes/version-3.11/><span itemprop=name class=breadcrumb-entry>Version 3.11</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Incompatible changes in 3.11"><a itemprop=item class=link href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/><span itemprop=name class=breadcrumb-entry>Incompatible changes in 3.11</span></a></li></ol></nav><article class=default><hgroup><h1>Incompatible changes in ArangoDB 3.11</h1><p class=lead>Check the following list of potential breaking changes <strong>before</strong> upgrading to this ArangoDB version and adjust any client applications if necessary</p></hgroup><h2 id=resolving-known-issues-with-versions-up-to-31111>Resolving known issues with versions up to 3.11.11 <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#resolving-known-issues-with-versions-up-to-31111 class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Due to an issue with the versions up to 3.11.11, please read the
information below and follow the linked procedures to avoid a potential problem.
Not following these procedures can cause your deployment to become
read-only in rare cases.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>If you are a paying customer with a self-hosted deployment, contact the
ArangoDB support for direct assistance.
ArangoGraph customers do not need to take any action.</div></div></div></div><p><strong>Issues that has been discovered that requires action:</strong></p><ul><li><a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes class=link>Issues with the comparison of large indexed numbers</a></li></ul><p><strong>Who should check for a potential issue:</strong></p><ul><li>Deployments created with a version prior to 3.11.11</li></ul><p><strong>Deployments not impacted:</strong></p><ul><li>Deployments created with 3.11.11 or later 3.11.x version</li></ul><p><strong>Overview of impact</strong></p><p>There is a risk of the RocksDB storage engine entering a state where no write operations are
possible anymore, should it discover index entries that are in an unexpected order.</p><p>This can occur at any time, even if a previous check reported no affected indexes,
as there is no protection against storing and indexing data that may cause issues.
To prevent RocksDB from becoming read-only at some point in the future, it is
essential to follow the linked procedures.</p><div class="box notices cstyle tip"><div class=box-content-container><div class=box-content><i class="fas fa-check"></i><div class=box-text>It is recommended to schedule a maintenance time window for taking the ArangoDB
deployment offline to perform the upgrade procedure in the safest possible manner.</div></div></div></div><p><strong>Paths to resolution:</strong></p><table><thead><tr><th>Current version</th><th>Resolved version</th><th>Steps to take</th></tr></thead><tbody><tr><td>3.11.10 (or older)</td><td>3.11.11 (or newer 3.11.x)</td><td>Create a backup, upgrade normally (following the standard <a href=/3.11/operations/upgrading/#upgrade-paths class=link>Upgrade path</a> all the way to the latest 3.11.x version), then check for <a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes class=link>affected numbers in indexes</a> and fix them.</td></tr><tr><td>3.11.11 (or newer 3.11.x)</td><td>3.12.4 (or newer)</td><td><strong>Do not upgrade to version 3.12.0, 3.12.1, 3.12.2, or 3.12.3</strong>. Create a backup, check for <a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes class=link>affected numbers in indexes</a> and fix them (if you haven&rsquo;t done so already or created the deployment with 3.11.11 or a later 3.11.x version), then upgrade to the latest 3.11.x version first, and finally upgrade to version 3.12.4 or later.</td></tr></tbody></table><h2 id=incompatibilities-due-to-switch-to-glibc>Incompatibilities due to switch to glibc <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#incompatibilities-due-to-switch-to-glibc class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>From version 3.11.10 onward, ArangoDB uses the glibc C standard library
implementation instead of libmusl. Even though glibc is statically linked into
the ArangoDB server and client tool executables, it may load additional modules
at runtime that are installed on your system. Under rare circumstances, it is
possible that ArangoDB crashes when performing host name or address lookups.
This is only the case if all of the following conditions are true:</p><ul><li>You either use ArangoDB version 3.11.10 (non-hotfix), or you use a 3.11 version
from 3.11.10-1 onward with the <code>--honor-nsswitch</code> startup option enabled.</li><li>You use an ArangoDB package on bare metal (not a Docker container)</li><li>Your operating system uses glibc (like Ubuntu, Debian, RedHat, Centos, or
most other Linux distributions, but not Alpine for instance)</li><li>The glibc version of your system is different than the one used by ArangoDB,
in particular if the system glibc is older than version 2.35</li><li>The <code>libnss-*</code> dynamic libraries are installed</li><li>The <code>/etc/nsswitch.conf</code> configuration file contains settings other than for
<code>files</code> and <code>dns</code> in the <code>hosts:</code> line, or the <code>passwd:</code> and <code>group:</code> lines
contain something other than <code>files</code></li></ul><p>If you are affected, consider using Docker containers, <code>chroot</code>, or change
<code>nsswitch.conf</code>.</p><h2 id=velocystream-protocol-deprecation>VelocyStream protocol deprecation <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#velocystream-protocol-deprecation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>ArangoDB&rsquo;s own bi-directional asynchronous binary protocol VelocyStream (VST) is
deprecated in v3.11 and removed in v3.12.0.</p><p>While VelocyStream support is still available in v3.11, it is highly recommended
to already switch to the HTTP(S) protocol because of better performance and
reliability. ArangoDB supports both VelocyPack and JSON over HTTP(S).</p><h2 id=active-failover-deployment-mode-deprecation>Active Failover deployment mode deprecation <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#active-failover-deployment-mode-deprecation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Running a single server with asynchronous replication to one or more passive
single servers for automatic failover is deprecated and will no longer be
supported in the next minor version of ArangoDB, from v3.12 onward.</p><h2 id=extended-naming-constraints-for-collections-views-and-indexes>Extended naming constraints for collections, Views, and indexes <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#extended-naming-constraints-for-collections-views-and-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>In ArangoDB 3.9, the <code>--database.extended-names-databases</code> startup option was
added to optionally allow database names to contain most UTF-8 characters.
The startup option has been renamed to <code>--database.extended-names</code> in 3.11 and
now controls whether you want to use the extended naming constraints for
database, collection, View, and index names.</p><p>The old <code>--database.extended-names-databases</code> startup option should no longer
be used, but if you do, it behaves the same as the new
<code>--database.extended-names</code> option.</p><p>The feature is disabled by default to ensure compatibility with existing client
drivers and applications that only support ASCII names according to the
traditional naming constraints used in previous ArangoDB versions.</p><p>If the feature is enabled, then any endpoints that contain database, collection,
View, or index names in the URL may contain special characters that were
previously not allowed (percent-encoded). They are also to be expected in
payloads that contain database, collection, View, or index names, as well as
document identifiers (because they are comprised of the collection name and the
document key). If client applications assemble URLs with extended names
programmatically, they need to ensure that extended names are properly
URL-encoded.</p><p>When using extended names, any Unicode characters in names need to be
<a href=http://unicode.org/reports/tr15/#Norm_Forms target=_blank rel="noopener noreferrer" class=link>NFC-normalized</a>&nbsp;<i class="fas fa-external-link-alt"></i>.
If you try to create a database, collection, View, or index with a non-NFC-normalized
name, the server rejects it.</p><p>The ArangoDB web interface as well as the <em>arangobench</em>, <em>arangodump</em>,
<em>arangoexport</em>, <em>arangoimport</em>, <em>arangorestore</em>, and <em>arangosh</em> client tools
ship with support for the extended naming constraints, but they require you
to provide NFC-normalized names.</p><p>Please be aware that dumps containing extended names cannot be restored
into older versions that only support the traditional naming constraints. In a
cluster setup, it is required to use the same naming constraints for all
Coordinators and DB-Servers of the cluster. Otherwise, the startup is
refused. In DC2DC setups, it is also required to use the same naming
constraints for both datacenters to avoid incompatibilities.</p><p>Also see:</p><ul><li><a href=/3.11/concepts/data-structure/collections/#collection-names class=link>Collection names</a></li><li><a href=/3.11/concepts/data-structure/views/#view-names class=link>View names</a></li><li>Index names have the same character restrictions as collection names</li></ul><h2 id=no-aql-user-defined-functions-udf-in-prune>No AQL user-defined functions (UDF) in <code>PRUNE</code> <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#no-aql-user-defined-functions-udf-in-prune class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>AQL user-defined functions (UDFs) cannot be used inside traversal PRUNE conditions
nor inside FILTER conditions that can be moved into the traversal execution on DB-Servers.
This limitation also applies to single servers to keep the differences to cluster
deployments minimal.</p><h2 id=stricter-validation-of-unicode-surrogate-values-in-json-data>Stricter validation of Unicode surrogate values in JSON data <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#stricter-validation-of-unicode-surrogate-values-in-json-data class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>ArangoDB 3.11 employs a stricter validation of Unicode surrogate pairs in
incoming JSON data, for all REST APIs.</p><p>In previous versions, the following loopholes existed when validating UTF-8
surrogate pairs in incoming JSON data:</p><ul><li>a high surrogate, followed by something other than a low surrogate
(or the end of the string)</li><li>a low surrogate, not preceded by a high surrogate</li></ul><p>These validation loopholes have been closed in 3.11, which means that any JSON
inputs containing such invalid surrogate pair data are rejected by the server.</p><p>This is normally the desired behavior, as it helps invalid data from entering
the database. However, in situations when a database is known to contain invalid
data and must continue supporting it (at least temporarily), the extended
validation can be disabled by setting the server startup option
<code>--server.validate-utf8-strings</code> to <code>false</code>. This is not recommended long-term,
but only during upgrading or data cleanup.</p><h2 id=restriction-of-indexable-fields>Restriction of indexable fields <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#restriction-of-indexable-fields class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>It is now forbidden to create indexes that cover fields whose attribute names
start or end with <code>:</code> , for example, <code>fields: ["value:"]</code>. This notation is
reserved for internal use.</p><p>Existing indexes are not affected but you cannot create new indexes with a
preceding or trailing colon.</p><h2 id=write-write-conflict-improvements>Write-write conflict improvements <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#write-write-conflict-improvements class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Writes to the same document in quick succession can result in write-write
conflicts, requiring you to retry the operations. In v3.11, single document
operations via the <a href=/3.11/develop/http-api/documents/ class=link>HTTP Interface for Documents</a> try to
avoid conflicts by locking the key of the document before performing the
modification. This serializes the write operations on the same document.
The behavior of AQL queries, Stream Transactions, and multi-document operations
remains unchanged.</p><p>It is still possible for write-write conflicts to occur, and in these cases the
reported error is now slightly different.</p><p>The lock acquisition on the key of the document that is supposed to be
inserted/modified has a hard-coded timeout of 1 second. If the lock cannot be
acquired, the error message is as follows:</p><pre tabindex=0><code>Timeout waiting to lock key - in index primary of type primary over &#39;_key&#39;; conflicting key: &lt;key&gt;
</code></pre><p>The <code>&lt;key></code> corresponds to the document key of the write attempt. In addition,
the error object contains <code>_key</code>, <code>_id</code>, and <code>_rev</code> attributes. The <code>_key</code> and
<code>_id</code> correspond to the document of the write attempt, and <code>_rev</code> corresponds
to the current revision of the document as stored in the database (if available,
otherwise empty).</p><p>If the lock cannot be acquired on a unique index entry, the error message is as
follows:</p><pre tabindex=0><code>Timeout waiting to lock key - in index &lt;indexName&gt; of type persistent over &#39;&lt;fields&gt;&#39;; document key: &lt;key&gt;; indexed values: [&lt;values&gt;]
</code></pre><p>The <code>&lt;indexName></code> is the name of the index in which the write attempt tried to
lock the entry, <code>&lt;fields></code> is the list of fields included in that index, <code>&lt;key></code>
corresponds to the document key of the write attempt, and <code>&lt;values></code>
corresponds to the indexed values of the document. In addition, the error object
contains <code>_key</code>, <code>_id</code>, and <code>_rev</code> attributes. The <code>_key</code> and <code>_id</code> correspond
to the document of the write attempt, and <code>_rev</code> corresponds to the current
revision of the document as stored in the database (if available, otherwise empty).</p><h2 id=deprecated-and-removed-pregel-features>Deprecated and removed Pregel features <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#deprecated-and-removed-pregel-features class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><ul><li><p>The experimental <em>Custom Pregel</em> feature, also known as
<em>programmable Pregel algorithms</em> (PPA), has been removed.</p></li><li><p>The built-in <em>DMID</em> Pregel algorithm has been deprecated and will be removed
in a future release.</p></li><li><p>The <code>async</code> option for Pregel jobs has been removed. Some algorithms supported
an asynchronous mode to run without synchronized global iterations. This is no
longer supported.</p></li><li><p>The <code>useMemoryMaps</code> option for Pregel jobs to use memory-mapped files as a
backing storage for large datasets has been removed. Memory paging/swapping
provided by the operating system is equally effective.</p></li></ul><h2 id=new-query-stage>New query stage <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#new-query-stage class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><ul><li><p>When profiling a query (<code>profile</code> option <code>true</code>, <code>1</code>, or <code>2</code>), the <code>profile</code>
object returned under <code>extra</code> now includes a new <code>"instantiating executors"</code>
attribute with the time needed to create the query executors, and in cluster
mode, this also includes the time needed for physically distributing the query
snippets to the participating DB-Servers. Previously, the time spent for
instantiating executors and the physical distribution was contained in the
<code>optimizing plan</code> stage.</p></li><li><p>The <code>state</code> of a query can now additionally be <code>"instantiating executors"</code> in
the list of currently running queries.</p></li></ul><h2 id=limit-for-the-normalization-of-filter-conditions>Limit for the normalization of <code>FILTER</code> conditions <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#limit-for-the-normalization-of-filter-conditions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Converting complex AQL <code>FILTER</code> conditions with a lot of logical branches
(<code>AND</code>, <code>OR</code>, <code>NOT</code>) into the internal DNF (disjunctive normal form) format can
take a large amount of processing time and memory. The new <code>maxDNFConditionMembers</code>
query option is a threshold for the maximum number of <code>OR</code> sub-nodes in the
internal representation and defaults to <code>786432</code>.</p><p>You can also set the threshold globally instead of per query with the
<a href=/3.11/components/arangodb-server/options/#--querymax-dnf-condition-members class=link><code>--query.max-dnf-condition-members</code> startup option</a>.</p><p>If the threshold is hit, the query continues with a simplified representation of
the condition, which is <strong>not usable in index lookups</strong>. However, this should
still be better than overusing memory or taking a very long time to compute the
DNF version.</p><h2 id=validation-of-smartgraphattribute-in-smartgraphs>Validation of <code>smartGraphAttribute</code> in SmartGraphs <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#validation-of-smartgraphattribute-in-smartgraphs class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.10.13, v3.11.7</small></p><p>The attribute defined by the <code>smartGraphAttribute</code> graph property is not allowed to be
changed in the documents of SmartGraph vertex collections. This is now strictly enforced.
See <a href=/3.11/release-notes/version-3.11/api-changes-in-3-11/#validation-of-smartgraphattribute-in-smartgraphs class=link>API Changes in ArangoDB 3.11</a>
for details and instructions on how to repair affected attributes.</p><h2 id=validation-of-traversal-collection-restrictions>Validation of traversal collection restrictions <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#validation-of-traversal-collection-restrictions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.9.11, v3.10.7</small></p><p>In AQL graph traversals, you can restrict the vertex and edge collections in the
traversal options like so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>v</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>p</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>3</span> <span class=kr>OUTBOUND</span> <span class=s1>&#39;products/123&#39;</span> <span class=n>components</span>
</span></span><span class=line><span class=cl>  <span class=kp>OPTIONS</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>vertexCollections</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;bolts&#34;</span><span class=p>,</span> <span class=s2>&#34;screws&#34;</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>edgeCollections</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;productsToBolts&#34;</span><span class=p>,</span> <span class=s2>&#34;productsToScrews&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>v</span> 
</span></span></code></pre></div><p>If you specify collections that don&rsquo;t exist, queries now fail with
a &ldquo;collection or view not found&rdquo; error (code <code>1203</code> and HTTP status
<code>404 Not Found</code>). In previous versions, unknown vertex collections were ignored,
and the behavior for unknown edge collections was undefined.</p><p>Additionally, the collection types are now validated. If a document collection
or View is specified in <code>edgeCollections</code>, an error is raised
(code <code>1218</code> and HTTP status <code>400 Bad Request</code>).</p><p>Furthermore, it is now an error if you specify a vertex collection that is not
part of the specified named graph (code <code>1926</code> and HTTP status <code>404 Not Found</code>).
It is also an error if you specify an edge collection that is not part of the
named graph&rsquo;s definition or of the list of edge collections (code <code>1939</code> and
HTTP status <code>400 Bad Request</code>).</p><h2 id=batch-insertions-of-documents-with-key-errors-no-longer-fail-the-entire-operation>Batch insertions of documents with key errors no longer fail the entire operation <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#batch-insertions-of-documents-with-key-errors-no-longer-fail-the-entire-operation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.11.1</small></p><p>When inserting multiple documents/edges at once in a cluster, the Document API
used to let the entire request fail if any of the documents/edges failed to be
saved due to a key error. More specifically, if the value of a <code>_key</code> attribute
contains illegal characters or if the key doesn&rsquo;t meet additional requirements,
for instance, coming from the collection being used in a Disjoint SmartGraph,
the <code>POST /_api/document/{collection}</code> endpoint would not reply with the usual
array of either the document metadata or the error object for each attempted
document insertion. Instead, it used to return an error object for the first
offending document only, and aborted the operation so that none of the documents
were saved. Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -d <span class=s1>&#39;[{&#34;_key&#34;:&#34;valid&#34;},{&#34;_key&#34;:&#34;invalid space&#34;}]&#39;</span> http://localhost:8529/_api/document/coll
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;code&#34;</span>:400,<span class=s2>&#34;error&#34;</span>:true,<span class=s2>&#34;errorMessage&#34;</span>:<span class=s2>&#34;illegal document key&#34;</span>,<span class=s2>&#34;errorNum&#34;</span>:1221<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; curl http://localhost:8529/_api/document/coll/valid
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;code&#34;</span>:404,<span class=s2>&#34;error&#34;</span>:true,<span class=s2>&#34;errorMessage&#34;</span>:<span class=s2>&#34;document not found&#34;</span>,<span class=s2>&#34;errorNum&#34;</span>:1202<span class=o>}</span>
</span></span></code></pre></div><p>Now, such key errors in cluster deployments no longer fail the entire request,
matching the behavior of single server deployments. Any errors are reported in
the result array for the respective documents, along with the successful ones:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -d <span class=s1>&#39;[{&#34;_key&#34;:&#34;valid&#34;},{&#34;_key&#34;:&#34;invalid space&#34;}]&#39;</span> http://localhost:8529/_api/document/coll
</span></span><span class=line><span class=cl><span class=o>[{</span><span class=s2>&#34;_id&#34;</span>:<span class=s2>&#34;coll/valid&#34;</span>,<span class=s2>&#34;_key&#34;</span>:<span class=s2>&#34;valid&#34;</span>,<span class=s2>&#34;_rev&#34;</span>:<span class=s2>&#34;_gG9JHsW---&#34;</span><span class=o>}</span>,<span class=o>{</span><span class=s2>&#34;error&#34;</span>:true,<span class=s2>&#34;errorNum&#34;</span>:1221,<span class=s2>&#34;errorMessage&#34;</span>:<span class=s2>&#34;illegal document key&#34;</span><span class=o>}]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; curl http://localhost:8529/_api/document/coll/valid
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;_key&#34;</span>:<span class=s2>&#34;valid&#34;</span>,<span class=s2>&#34;_id&#34;</span>:<span class=s2>&#34;coll/valid&#34;</span>,<span class=s2>&#34;_rev&#34;</span>:<span class=s2>&#34;_gG9JHsW---&#34;</span><span class=o>}</span>
</span></span></code></pre></div><h2 id=exit-code-adjustments>Exit code adjustments <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#exit-code-adjustments class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.10.13, v3.11.7</small></p><p>For some fatal errors like a required database upgrade or a failed version check,
<em>arangod</em> set the generic exit code of <code>1</code>. It now returns a different, more
specific exit code in these cases.</p><h2 id=batch-reading-an-empty-list-of-documents-succeeds>Batch-reading an empty list of documents succeeds <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#batch-reading-an-empty-list-of-documents-succeeds class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.11.1</small></p><p>Using the Document API for reading multiple documents used to return an error
if the request body was an empty array. Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -XPUT -d <span class=s1>&#39;[]&#39;</span> <span class=s1>&#39;http://localhost:8529/_api/document/coll?onlyget=true&#39;</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;code&#34;</span>:500,<span class=s2>&#34;error&#34;</span>:true,<span class=s2>&#34;errorMessage&#34;</span>:<span class=s2>&#34;internal error&#34;</span>,<span class=s2>&#34;errorNum&#34;</span>:4<span class=o>}</span>
</span></span></code></pre></div><p>Now, a request like this succeeds and returns an empty array as response.</p><h2 id=corrected-sorting-order-for-numbers-in-velocypack-indexes>Corrected sorting order for numbers in VelocyPack indexes <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#corrected-sorting-order-for-numbers-in-velocypack-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.11.11, v3.12.2</small></p><ul><li><a href=#issues-with-the-comparison-of-large-indexed-numbers class=link>Issues with the comparison of large indexed numbers</a></li><li><a href=#check-if-you-are-affected class=link>Check if you are affected</a></li><li><a href=#if-the-deployment-is-not-affected class=link>If the deployment is NOT affected</a></li><li><a href=#if-the-deployment-is-affected class=link>If the deployment is affected</a></li></ul><h3 id=issues-with-the-comparison-of-large-indexed-numbers>Issues with the comparison of large indexed numbers <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#issues-with-the-comparison-of-large-indexed-numbers class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>If you store very large numeric values in ArangoDB – greater than/equal to
2<sup>53</sup> (9,007,199,254,740,992) or less than/equal to
-2<sup>53</sup> (-9,007,199,254,740,992) – and index them with an affected
index type, the values may not be in the correct order. This is due to how the
comparison is executed in versions before v3.11.11 and v3.12.2. If the numbers
are represented using different VelocyPack types internally, they are converted
to doubles and then compared. This conversion is lossy for integers with a very
large absolute value, resulting in an incorrect ordering of the values.</p><p>The possibly affected index types are the following that allow storing
VelocyPack data in them:</p><ul><li><code>persistent</code> (including vertex-centric indexes)</li><li><code>mdi-prefixed</code> (but not <code>mdi</code> indexes; only available from v3.12.0 onward)</li><li><code>hash</code> (legacy alias for persistent indexes)</li><li><code>skiplist</code> (legacy alias for persistent indexes)</li></ul><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>The incorrect sort order in an index can lead to the RocksDB storage engine
discovering out-of-order keys and then refusing further write operations with
errors and warnings.</div></div></div></div><p>To prevent ArangoDB deployments from entering a read-only mode due to this issue,
please follow the below procedures to check if your deployment is affected and
how to correct it if necessary.</p><h3 id=check-if-you-are-affected>Check if you are affected <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#check-if-you-are-affected class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following procedure is recommended for every deployment unless it has been
created with v3.11.11, v3.12.2, or any later version.</p><ol><li><p>Create a backup as a precaution. If you run the Enterprise Edition, you can
create a Hot Backup. Otherwise, create a full dump with <em>arangodump</em>
(including all databases and system collections).</p></li><li><p>If your deployment is on a 3.11.x version older than 3.11.11, upgrade to
the latest 3.11 version that is available.</p><p>If your deployment is on version 3.12.0 or 3.12.1, upgrade to the latest
3.12 version that is available but be sure to also read about the string
sorting issue in <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#resolving-known-issues-with-versions-prior-to-3124 class=link>Resolving known issues with versions prior to 3.12.4</a>
and the linked upgrade procedures.</p></li><li><p>Call the <code>GET /_admin/cluster/vpackSortMigration/check</code> endpoint to let
ArangoDB check all indexes. As it can take a while for large deployments,
it is recommended to run this operation as an asynchronous job
(<code>x-arango-async: store</code> header) so that you can check the result later.</p><p>The endpoint is available for all deployment modes, not only in clusters.
In case of a cluster, send the request to one of the Coordinators.
Example with ArangoDB running locally on the default port:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl --dump-header - -H <span class=s2>&#34;x-arango-async: store&#34;</span> http://localhost:8529/_admin/cluster/vpackSortMigration/check
</span></span></code></pre></div></li><li><p>Inspect the response to find the job ID in the <code>X-Arango-Async-Id</code> HTTP header.
The job ID is <code>12345</code> in the following example:</p><pre tabindex=0><code>HTTP/1.1 202 Accepted
X-Arango-Queue-Time-Seconds: 0.000000
Strict-Transport-Security: max-age=31536000 ; includeSubDomains
Expires: 0
Pragma: no-cache
Cache-Control: no-cache, no-store, must-revalidate, pre-check=0, post-check=0, max-age=0, s-maxage=0
Content-Security-Policy: frame-ancestors &#39;self&#39;; form-action &#39;self&#39;;
X-Content-Type-Options: nosniff
X-Arango-Async-Id: 12345
Server: ArangoDB
Connection: Keep-Alive
Content-Type: text/plain; charset=utf-8
Content-Length: 0
</code></pre></li><li><p>Call the <code>PUT /_api/job/12345</code> endpoint, substituting <code>12345</code> with your
actual job ID. It returns nothing if the job is still ongoing. You can repeat
this call every once in a while to check again.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl -XPUT http://localhost:8529/_api/job/12345
</span></span></code></pre></div></li><li><p>If there are no issues with your deployment, the check result reports an
empty list of affected indexes and an according message.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;affected&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorCode&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorMessage&#34;</span><span class=p>:</span> <span class=s2>&#34;all good with sorting order&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If this is the case, continue with
<a href=#if-the-deployment-is-not-affected class=link>If the deployment is NOT affected</a>.</p><p>If affected indexes are found, the check result looks similar to this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;affected&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;database&#34;</span><span class=p>:</span> <span class=s2>&#34;_system&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;collection&#34;</span><span class=p>:</span> <span class=s2>&#34;coll&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indexId&#34;</span><span class=p>:</span> <span class=mi>195</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indexName&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_1806192152446763008&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorCode&#34;</span><span class=p>:</span> <span class=mi>1242</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorMessage&#34;</span><span class=p>:</span> <span class=s2>&#34;some indexes have legacy sorted keys&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If this is the case, continue with
<a href=#if-the-deployment-is-affected class=link>If the deployment is affected</a>.</p></li></ol><h3 id=if-the-deployment-is-not-affected>If the deployment is NOT affected <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#if-the-deployment-is-not-affected class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><ol><li><p>Make sure that no problematic values are written to or removed from an index
between checking for affected indexes and completing the procedure.
To be safe, you may want to stop all writes to the database system.</p></li><li><p>You can perform a regular in-place upgrade and mark the deployment as correct
using a special HTTP API endpoint in the next step.</p><p>That is, create a backup and upgrade your deployment to the
latest bugfix version with the same major and minor version (e.g. from 3.11.x
to at least 3.11.11 or from 3.12.x to at least 3.12.2).</p></li><li><p>Call the <code>PUT /_admin/cluster/vpackSortMigration/migrate</code> endpoint to mark
the deployment as having the correct sorting order. This requires
<a href=/3.11/develop/http-api/authentication/#jwt-superuser-tokens class=link>superuser permissions</a>
unless authentication is disabled.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl -H <span class=s2>&#34;Authorization: bearer &lt;superuser-token&gt;&#34;</span> -XPUT http://localhost:8529/_admin/cluster/vpackSortMigration/migrate
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorCode&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorMessage&#34;</span><span class=p>:</span> <span class=s2>&#34;VPack sorting migration done.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li><li><p>For the corrected sorting order to take effect, restart the ArangoDB server,
respectively restart the DB-Servers of the cluster.</p></li><li><p>Complete the procedure by resuming writes to the database systems.</p></li></ol><h3 id=if-the-deployment-is-affected>If the deployment is affected <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#if-the-deployment-is-affected class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>If you are a customer, please contact the ArangoDB support to assist you with
the following steps.</div></div></div></div><ol><li><p>This step depends on the deployment mode:</p><ul><li><p><strong>Single server</strong>: Create a new server. Then create a full dump with
<a href=/3.11/components/tools/arangodump/ class=link>arangodump</a> of the old server,
using the <code>--all-databases</code> and <code>--include-system-collections</code> startup options
and a user account with administrate access to the <code>_system</code> database and
at least read access to all other databases to ensure all data including
the <code>_users</code> system collection are dumped.</p><p>Restore the dump to the new single server using at least v3.11.11 or v3.12.4
(v3.12.2 only addresses this but not <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#corrected-sorting-order-for-strings-in-velocypack-indexes class=link>another issue</a>).
You need to use a new database directory.</p></li><li><p><strong>Active Failover</strong>: You need to replace all servers of the deployment.
You can do so in a rolling manner.</p><p>Create a new server and add it as a new follower to the deployment.
When it is in-sync with the leader, remove one of the old followers.
Replace any other old followers in the same manner. Then create
one more new server, add it as a follower, and wait until it is in-sync.
Then remove the old leader, failing over to one of the new followers.
You should stop all writes temporarily before and after the failover so
that nothing is lost, as the Active Failover replication is asynchronous.</p><p>You can also follow the single server instructions if it&rsquo;s acceptable to
have downtime.</p></li><li><p><strong>Cluster</strong>: Replace the DB-Server nodes until they all run at least
v3.11.11 or v3.12.4 (rolling upgrade). Syncing new nodes writes the data in
the correct order. This deployment mode and approach avoids downtimes.</p><p>For each DB-Server, add a new DB-Server node to the cluster. Wait until all
new DB-Servers are in sync, then clean out the old DB-Server nodes.</p></li></ul></li><li><p>New instances using the fixed versions initialize the database directory
with the sorting order marked as correct and also restore data from dumps
correctly. There is no need to call the <code>.../vpackSortMigration/migrate</code>
HTTP API endpoint like in the unaffected case.</p></li><li><p>If you revert to an older state with affected indexes by restoring a
Hot Backup, you need to repeat the procedure.</p></li></ol><h2 id=changed-json-serialization-and-velocypack-format-for-replication>Changed JSON serialization and VelocyPack format for replication <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#changed-json-serialization-and-velocypack-format-for-replication class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.11.12, v3.12.3</small></p><p>While there is only one number type in JSON, the VelocyPack format that ArangoDB
uses supports different numeric data types. When converting between VelocyPack
and JSON, it was previously possible for precision loss to occur in edge cases.
This also affected creating and restoring dumps with arangodump and arangorestore.</p><p>A double (64-bit floating-point) value <code>1152921504606846976.0</code> (2<sup>60</sup>)
used to be serialized to <code>1152921504606847000</code> in JSON, which deserializes back
to <code>1152921504606846976</code> when using a double. However, the serialized value got
parsed as an unsigned integer, resulting in an incorrect value of
<code>1152921504606847000</code>.</p><p>Numbers with an absolute value greater or equal to 2<sup>53</sup> and less than
2<sup>64</sup> (which always represents an integer) are now serialized faithfully
to JSON using an integer conversion routine and then <code>.0</code> is appended (e.g.
<code>1152921504606846976.0</code>) to ensure that they get parsed back to the exact same
double value. All other values are serialized as before, e.g. small integral
values don&rsquo;t get <code>.0</code> appended, and they get parsed back to integers with the
same numerical value.</p><p>Moreover, replication-related APIs such as the <code>/_api/wal/tail</code> endpoint now
support the VelocyPack format. The cluster replication has been changed to use
VelocyPack instead of JSON to avoid unnecessary conversions and avoiding any
risk of deviations due to the serialization.</p><h2 id=javascript-api>JavaScript API <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#javascript-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=database-creation>Database creation <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#database-creation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>db._createDatabase()</code> method for creating a new database has changed.
If the specified database name is invalid/illegal, it now returns the error code
<code>1208</code> (<code>ERROR_ARANGO_ILLEGAL_NAME</code>). It previously returned <code>1229</code>
(<code>ERROR_ARANGO_DATABASE_NAME_INVALID</code>) in this case.</p><p>This is a downwards-incompatible change, but unifies the behavior for database
creation with the behavior of collection and View creation, which also return
the error code <code>1208</code> in case the specified name is not allowed.</p><h3 id=index-methods>Index methods <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#index-methods class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Calling <code>collection.dropIndex(...)</code> or <code>db._dropIndex(...)</code> now raises an error
if the specified index does not exist or cannot be dropped (for example, because
it is a primary index or edge index). The methods previously returned <code>false</code>.
In case of success, they still return <code>true</code>.</p><p>You can wrap calls to these methods with a <code>try { ... }</code> block to catch errors,
for example, in <em>arangosh</em> or in Foxx services.</p><h2 id=startup-options>Startup options <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#startup-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=--serverdisable-authentication-and---serverdisable-authentication-unix-sockets-obsoleted><code>--server.disable-authentication</code> and <code>--server.disable-authentication-unix-sockets</code> obsoleted <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#--serverdisable-authentication-and---serverdisable-authentication-unix-sockets-obsoleted class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>--server.disable-authentication</code> and <code>--server.disable-authentication-unix-sockets</code>
startup options are now obsolete. Specifying them is still tolerated but has
no effect anymore. These options were deprecated in v3.0 and mapped to
<code>--server.authentication</code> and <code>--server.authentication-unix-sockets</code>, which
made them do the opposite of what their names suggest.</p><h3 id=--databaseforce-sync-properties-deprecated><code>--database.force-sync-properties</code> deprecated <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#--databaseforce-sync-properties-deprecated class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>--database.force-sync-properties</code> option was useful with the MMFiles
storage engine, which has been removed in v3.7. The option does not have any
useful effect if you use the RocksDB storage engine. From v3.11.0 onwards, it
has no effect at all, is deprecated, and will be removed in a future version.</p><h3 id=--agencypool-size-deprecated><code>--agency.pool-size</code> deprecated <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#--agencypool-size-deprecated class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>--agency.pool-size</code> option was effectively not properly supported in any
version of ArangoDB. Setting the option to anything but the value of
<code>--agency.size</code> should be avoided.</p><p>From v3.11.0 onwards, this option is deprecated, and setting it to a value
different than the value of <code>--agency.size</code> leads to a startup error.</p><h3 id=--queryparallelize-gather-writes-obsoleted><code>--query.parallelize-gather-writes</code> obsoleted <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#--queryparallelize-gather-writes-obsoleted class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Parallel gather is now enabled by default and supported for most queries.
The <code>--query.parallelize-gather-writes</code> startup option has no effect anymore,
but specifying it still tolerated.</p><p>See <a href=/3.11/release-notes/version-3.11/whats-new-in-3-11/#parallel-gather class=link>Features and Improvements in ArangoDB 3.11</a>
for details.</p><h3 id=--pregelmemory-mapped-files-obsoleted><code>--pregel.memory-mapped-files*</code> obsoleted <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#--pregelmemory-mapped-files-obsoleted class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Pregel no longer supports use memory-mapped files as a backing storage.
The following startup options have therefore been removed:</p><ul><li><code>--pregel.memory-mapped-files</code></li><li><code>--pregel.memory-mapped-files-custom-path</code></li><li><code>--pregel.memory-mapped-files-location-type</code></li></ul><p>You can still specify them on startup without raising errors but they have no
effect anymore.</p><h2 id=client-tools>Client tools <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#client-tools class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=arangoexport>arangoexport <a href=/3.11/release-notes/version-3.11/incompatible-changes-in-3-11/#arangoexport class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The default output file type produced by arangoexport, controlled by the <code>--type</code>
startup option, has been changed from <code>json</code> to <code>jsonl</code>.
This allows for more efficient processing of the files produced by arangoexport
with other tools, such as arangoimport, by default.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.11/release-notes/version-3.11/known-issues-in-3-11/><i class="fas fa-chevron-left fa-fw"></i><p>Known Issues in 3.11</p></a></span><span class=next><a class="nav nav-next link" href=/3.11/release-notes/version-3.11/api-changes-in-3-11/><p>API changes in 3.11</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.11/release-notes/version-3.11/incompatible-changes-in-3-11.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#resolving-known-issues-with-versions-up-to-31111>Resolving known issues with versions up to 3.11.11</a></div><div class=level-2><a href=#incompatibilities-due-to-switch-to-glibc>Incompatibilities due to switch to glibc</a></div><div class=level-2><a href=#velocystream-protocol-deprecation>VelocyStream protocol deprecation</a></div><div class=level-2><a href=#active-failover-deployment-mode-deprecation>Active Failover deployment mode deprecation</a></div><div class=level-2><a href=#extended-naming-constraints-for-collections-views-and-indexes>Extended naming constraints for collections, Views, and indexes</a></div><div class=level-2><a href=#no-aql-user-defined-functions-udf-in-prune>No AQL user-defined functions (UDF) in <code>PRUNE</code></a></div><div class=level-2><a href=#stricter-validation-of-unicode-surrogate-values-in-json-data>Stricter validation of Unicode surrogate values in JSON data</a></div><div class=level-2><a href=#restriction-of-indexable-fields>Restriction of indexable fields</a></div><div class=level-2><a href=#write-write-conflict-improvements>Write-write conflict improvements</a></div><div class=level-2><a href=#deprecated-and-removed-pregel-features>Deprecated and removed Pregel features</a></div><div class=level-2><a href=#new-query-stage>New query stage</a></div><div class=level-2><a href=#limit-for-the-normalization-of-filter-conditions>Limit for the normalization of <code>FILTER</code> conditions</a></div><div class=level-2><a href=#validation-of-smartgraphattribute-in-smartgraphs>Validation of <code>smartGraphAttribute</code> in SmartGraphs</a></div><div class=level-2><a href=#validation-of-traversal-collection-restrictions>Validation of traversal collection restrictions</a></div><div class=level-2><a href=#batch-insertions-of-documents-with-key-errors-no-longer-fail-the-entire-operation>Batch insertions of documents with key errors no longer fail the entire operation</a></div><div class=level-2><a href=#exit-code-adjustments>Exit code adjustments</a></div><div class=level-2><a href=#batch-reading-an-empty-list-of-documents-succeeds>Batch-reading an empty list of documents succeeds</a></div><div class=level-2><a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes>Corrected sorting order for numbers in VelocyPack indexes</a></div><div class=level-3><a href=#issues-with-the-comparison-of-large-indexed-numbers>Issues with the comparison of large indexed numbers</a></div><div class=level-3><a href=#check-if-you-are-affected>Check if you are affected</a></div><div class=level-3><a href=#if-the-deployment-is-not-affected>If the deployment is NOT affected</a></div><div class=level-3><a href=#if-the-deployment-is-affected>If the deployment is affected</a></div><div class=level-2><a href=#changed-json-serialization-and-velocypack-format-for-replication>Changed JSON serialization and VelocyPack format for replication</a></div><div class=level-2><a href=#javascript-api>JavaScript API</a></div><div class=level-3><a href=#database-creation>Database creation</a></div><div class=level-3><a href=#index-methods>Index methods</a></div><div class=level-2><a href=#startup-options>Startup options</a></div><div class=level-3><a href=#--serverdisable-authentication-and---serverdisable-authentication-unix-sockets-obsoleted><code>--server.disable-authentication</code> and <code>--server.disable-authentication-unix-sockets</code> obsoleted</a></div><div class=level-3><a href=#--databaseforce-sync-properties-deprecated><code>--database.force-sync-properties</code> deprecated</a></div><div class=level-3><a href=#--agencypool-size-deprecated><code>--agency.pool-size</code> deprecated</a></div><div class=level-3><a href=#--queryparallelize-gather-writes-obsoleted><code>--query.parallelize-gather-writes</code> obsoleted</a></div><div class=level-3><a href=#--pregelmemory-mapped-files-obsoleted><code>--pregel.memory-mapped-files*</code> obsoleted</a></div><div class=level-2><a href=#client-tools>Client tools</a></div><div class=level-3><a href=#arangoexport>arangoexport</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>