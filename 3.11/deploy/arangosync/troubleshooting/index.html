<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743774193></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="Procedures for investigating and fixing issues with DC2DC setups"><meta property="og:url" content="http://localhost/3.11/deploy/arangosync/troubleshooting/"><meta property="og:title" content="Troubleshooting Datacenter-to-Datacenter Replication"><meta property="og:type" content="website"><meta property="og:description" content="Procedures for investigating and fixing issues with DC2DC setups"><meta name=docsearch:version content="3.11"><title>Troubleshooting Datacenter-to-Datacenter Replication | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743774193 defer></script>
<script src=/js/featherlight.min.js?1743774193 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743774193 defer></script>
<script src=/js/theme.js?1743774193 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.11"><a itemprop=item class=link href=/3.11/><span itemprop=name class=breadcrumb-entry>3.11.13</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Deploy"><a itemprop=item class=link href=/3.11/deploy/><span itemprop=name class=breadcrumb-entry>Deploy</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Datacenter-to-Datacenter Replication"><a itemprop=item class=link href=/3.11/deploy/arangosync/><span itemprop=name class=breadcrumb-entry>Datacenter-to-Datacenter Replication</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Troubleshooting"><a itemprop=item class=link href=/3.11/deploy/arangosync/troubleshooting/><span itemprop=name class=breadcrumb-entry>Troubleshooting</span></a></li></ol></nav><article class=default><hgroup><h1>Troubleshooting Datacenter-to-Datacenter Replication</h1><p class=lead>Procedures for investigating and fixing issues with DC2DC setups</p></hgroup><p class=labels><span class=label>ArangoDB Enterprise Edition</span></p><p>The <em>Datacenter-to-Datacenter Replication</em> is a distributed system with a lot
different components. As with any such system, it requires some, but not a lot,
of operational support.</p><p>This section includes information on how to troubleshoot the
<em>Datacenter-to-Datacenter Replication</em>.</p><h2 id=what-means-are-available-to-monitor-status>What means are available to monitor status <a href=/3.11/deploy/arangosync/troubleshooting/#what-means-are-available-to-monitor-status class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>All of the components of <em>ArangoSync</em> provide means to monitor their status.
Below you&rsquo;ll find an overview per component.</p><ul><li><p>Sync master & workers: The <code>arangosync</code> servers running as either master
or worker, provide:</p><ul><li>A status API, see <code>arangosync get status</code>. Make sure that all statuses report <code>running</code>.
For even more detail the following commands are also available:
<code>arangosync get tasks</code>, <code>arangosync get masters</code> & <code>arangosync get workers</code>.</li><li>A log on the standard output. Log levels can be configured using <code>--log.level</code> settings.</li><li>A metrics API <code>GET /metrics</code>. This API is compatible with Prometheus.
Sample Grafana dashboards for inspecting these metrics are available.</li></ul></li><li><p>ArangoDB cluster: The <code>arangod</code> servers that make up the ArangoDB cluster
provide:</p><ul><li>A log file. This is configurable with settings with a <code>log.</code> prefix.
E.g. <code>--log.output=file://myLogFile</code> or <code>--log.level=info</code>.</li><li>A statistics API <code>GET /_admin/statistics</code></li></ul></li></ul><h2 id=what-to-look-for-while-monitoring-status>What to look for while monitoring status <a href=/3.11/deploy/arangosync/troubleshooting/#what-to-look-for-while-monitoring-status class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The very first thing to do when monitoring the status of ArangoSync is to
look into the status provided by <code>arangosync get status ... -v</code>.
When not everything is in the <code>running</code> state (on both datacenters), this is an
indication that something may be wrong. In case that happens, give it some time
(incremental synchronization may take quite some time for large collections)
and look at the status again. If the statuses do not change (or change, but not reach <code>running</code>)
it is time to inspects the metrics and log files.</p><p>When the metrics or logs seem to indicate a problem in a sync master or worker, it is
safe to restart it, as long as only 1 instance is restarted at a time.
Give restarted instances some time to &ldquo;catch up&rdquo;.</p><h2 id=what-to-do-when-problems-remain>What to do when problems remain <a href=/3.11/deploy/arangosync/troubleshooting/#what-to-do-when-problems-remain class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>When a problem remains and restarting masters/workers does not solve the problem,
contact support. Make sure to include provide support with the following information:</p><ul><li><p>Output of <code>arangosync get version ...</code> on both datacenters.</p></li><li><p>Output of <code>arangosync get status ... -v</code> on both datacenters.</p></li><li><p>Output of <code>arangosync get tasks ... -v</code> on both datacenters.</p></li><li><p>Output of <code>arangosync get masters ... -v</code> on both datacenters.</p></li><li><p>Output of <code>arangosync get workers ... -v</code> on both datacenters.</p></li><li><p>Log files of all components</p></li><li><p>A complete description of the problem you observed and what you did to resolve it.</p></li><li><p>How to monitor status of ArangoSync</p></li><li><p>How to keep it alive</p></li><li><p>What to do in case of failures or bugs</p></li></ul><h2 id=what-to-do-when-a-source-datacenter-is-down>What to do when a source datacenter is down <a href=/3.11/deploy/arangosync/troubleshooting/#what-to-do-when-a-source-datacenter-is-down class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>When you use ArangoSync for backup of your cluster from one datacenter
to another and the source datacenter has a complete outage, you may consider
switching your applications to the target (backup) datacenter.</p><p>This is what you must do in that case:</p><ol><li><p>Stop synchronization using:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>arangosync stop sync ...
</span></span></code></pre></div><p>When the source datacenter is completely unresponsive this will not succeed.
In that case use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>arangosync abort sync ...
</span></span></code></pre></div><p>See <a href=/3.11/deploy/arangosync/administration/#stopping-synchronization class=link>Stopping synchronization</a>
for how to cleanup the source datacenter when it becomes available again.</p></li><li><p>Verify that synchronization has completely stopped using:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>arangosync get status ... -v
</span></span></code></pre></div></li><li><p>Reconfigure your applications to use the target (backup) datacenter.</p></li></ol><p>When the original source datacenter is restored, you may switch roles and
make it the target datacenter. To do so, use <code>arangosync configure sync ...</code>
as described in <a href=/3.11/deploy/arangosync/administration/#reversing-synchronization-direction class=link>Reversing synchronization direction</a>.</p><h2 id=what-to-do-in-case-of-a-planned-network-outage>What to do in case of a planned network outage <a href=/3.11/deploy/arangosync/troubleshooting/#what-to-do-in-case-of-a-planned-network-outage class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>All ArangoSync tasks send out heartbeat messages out to the other datacenter
to indicate &ldquo;it is still alive&rdquo;. The other datacenter assumes the connection is
&ldquo;out of sync&rdquo; when it does not receive any messages for a certain period of time.</p><p>If you&rsquo;re planning some sort of maintenance where you know the connectivity
will be lost for some time (e.g. 3 hours), you can prepare ArangoSync for that
such that it will hold off re-synchronization for a given period of time.</p><p>To do so, on both datacenters, run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>arangosync <span class=nb>set</span> message timeout <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --master.endpoint<span class=o>=</span>&lt;endpoints of sync masters in the datacenter&gt; <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --auth.user<span class=o>=</span>&lt;username used <span class=k>for</span> authentication of this command&gt; <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --auth.password<span class=o>=</span>&lt;password of auth.user&gt; <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    3h
</span></span></code></pre></div><p>The last argument is the period that ArangoSync should hold-off resynchronization for.
This can be minutes (e.g. <code>15m</code>) or hours (e.g. <code>3h</code>).</p><p>If maintenance is taking longer than expected, you can use the same command the extend
the hold-off period (e.g. to <code>4h</code>).</p><p>After the maintenance, use the same command restore the hold-off period to its
default of <code>1h</code>.</p><h2 id=what-to-do-in-case-of-a-document-that-exceeds-the-message-queue-limits>What to do in case of a document that exceeds the message queue limits <a href=/3.11/deploy/arangosync/troubleshooting/#what-to-do-in-case-of-a-document-that-exceeds-the-message-queue-limits class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>Starting with ArangoSync version 2.0.0, there is no limitation in terms of
document size anymore.</div></div></div></div><p>If you insert/update a document in a collection and the size of that document
is greater than the maximum message size of your message queue, the collection
will no longer be able to synchronize. It will go into a <code>failed</code> state.</p><p>To recover from that, first remove the document from the ArangoDB cluster
in the source datacenter. After that, for each failed shard, run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>arangosync reset failed shard <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --master.endpoint<span class=o>=</span>&lt;endpoints of sync masters in the datacenter&gt; <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --auth.user<span class=o>=</span>&lt;username used <span class=k>for</span> authentication of this command&gt; <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --auth.password<span class=o>=</span>&lt;password of auth.user&gt; <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --database<span class=o>=</span>&lt;name of the database&gt; <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --collection<span class=o>=</span>&lt;name of the collection&gt; <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --shard<span class=o>=</span>&lt;index of the shard <span class=o>(</span>starting at 0<span class=o>)</span>&gt;
</span></span></code></pre></div><p>After this command, a new set of tasks will be started to synchronize the shard.
It can take some time for the shard to reach <code>running</code> state.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.11/deploy/arangosync/monitoring/><i class="fas fa-chevron-left fa-fw"></i><p>Monitoring</p></a></span><span class=next><a class="nav nav-next link" href=/3.11/deploy/kubernetes/><p>Kubernetes</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.11/deploy/arangosync/troubleshooting.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#what-means-are-available-to-monitor-status>What means are available to monitor status</a></div><div class=level-2><a href=#what-to-look-for-while-monitoring-status>What to look for while monitoring status</a></div><div class=level-2><a href=#what-to-do-when-problems-remain>What to do when problems remain</a></div><div class=level-2><a href=#what-to-do-when-a-source-datacenter-is-down>What to do when a source datacenter is down</a></div><div class=level-2><a href=#what-to-do-in-case-of-a-planned-network-outage>What to do in case of a planned network outage</a></div><div class=level-2><a href=#what-to-do-in-case-of-a-document-that-exceeds-the-message-queue-limits>What to do in case of a document that exceeds the message queue limits</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>