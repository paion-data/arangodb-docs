<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743775370></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="Aggregate adjacent documents or value ranges with a sliding window to calculate running totals, rolling averages, and other statistical properties"><meta property="og:url" content="http://localhost/3.11/aql/high-level-operations/window/"><meta property="og:title" content="WINDOW operation in AQL"><meta property="og:type" content="website"><meta property="og:description" content="Aggregate adjacent documents or value ranges with a sliding window to calculate running totals, rolling averages, and other statistical properties"><meta name=docsearch:version content="3.11"><title>WINDOW operation in AQL | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743775370 defer></script>
<script src=/js/featherlight.min.js?1743775370 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743775370 defer></script>
<script src=/js/theme.js?1743775370 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.11"><a itemprop=item class=link href=/3.11/><span itemprop=name class=breadcrumb-entry>3.11.13</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="AQL"><a itemprop=item class=link href=/3.11/aql/><span itemprop=name class=breadcrumb-entry>AQL</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="High-level Operations"><a itemprop=item class=link href=/3.11/aql/high-level-operations/><span itemprop=name class=breadcrumb-entry>High-level Operations</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="WINDOW"><a itemprop=item class=link href=/3.11/aql/high-level-operations/window/><span itemprop=name class=breadcrumb-entry>WINDOW</span></a></li></ol></nav><article class=default><hgroup><h1><code>WINDOW</code> operation in AQL</h1><p class=lead>Aggregate adjacent documents or value ranges with a sliding window to calculate running totals, rolling averages, and other statistical properties</p></hgroup><p>The <code>WINDOW</code> operation can be used for aggregations over adjacent documents, or
preceding and / or following rows in other words. It can also aggregate based
on a value or duration range relative to a document attribute.</p><p>The operation performs a <code>COLLECT AGGREGATE</code>-like operation on a set
of query rows. However, whereas a <code>COLLECT</code> operation groups multiple query
rows into a single result group, a <code>WINDOW</code> operation produces a result for
each query row:</p><ul><li>The row for which function evaluation occurs is called the current row.</li><li>The query rows related to the current row over which function evaluation
occurs, comprise the window frame for the current row.</li></ul><p>Window frames are determined with respect to the current row:</p><ul><li>By defining a window frame to be all rows from the query start to the current
row, you can compute running totals for each row.</li><li>By defining a frame as extending <em>N</em> rows on either side of the current row,
you can compute rolling averages.</li></ul><h2 id=syntax>Syntax <a href=/3.11/aql/high-level-operations/window/#syntax class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>There are two syntax variants for <code>WINDOW</code> operations.</p><p><strong>Row-based</strong> (adjacent documents):</p><pre><code>WINDOW { preceding: <em>numPrecedingRows</em>, following: <em>numFollowingRows</em> } AGGREGATE <em>variableName</em> = <em>aggregateExpression</em></code></pre><p><strong>Range-based</strong> (value or duration range):</p><pre><code>WINDOW <em>rangeValue</em> WITH { preceding: <em>offsetPreceding</em>, following: <em>offsetFollowing</em> } AGGREGATE <em>variableName</em> = <em>aggregateExpression</em></code></pre><p>Calls to the following functions are supported in aggregation expressions:</p><ul><li><code>LENGTH()</code> / <code>COUNT()</code></li><li><code>MIN()</code></li><li><code>MAX()</code></li><li><code>SUM()</code></li><li><code>AVERAGE()</code> / <code>AVG()</code></li><li><code>STDDEV_POPULATION()</code> / <code>STDDEV()</code></li><li><code>STDDEV_SAMPLE()</code></li><li><code>VARIANCE_POPULATION()</code> / <code>VARIANCE()</code></li><li><code>VARIANCE_SAMPLE()</code></li><li><code>UNIQUE()</code></li><li><code>SORTED_UNIQUE()</code></li><li><code>COUNT_DISTINCT()</code> / <code>COUNT_UNIQUE()</code></li><li><code>BIT_AND()</code></li><li><code>BIT_OR()</code></li><li><code>BIT_XOR()</code></li></ul><h2 id=row-based-aggregation>Row-based Aggregation <a href=/3.11/aql/high-level-operations/window/#row-based-aggregation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The first syntax form of <code>WINDOW</code> allows aggregating over a fixed number of
rows, following or preceding the current row. It is also possible to define
that <strong>all</strong> preceding or following rows should be aggregated (<code>"unbounded"</code>).
The number of rows has to be determined at query compile time.</p><p>Below query demonstrates the use of window frames to compute <strong>running totals</strong>
as well as <strong>rolling averages</strong> computed from the current row and the rows that
immediately precede and follow it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>t</span> <span class=kr>IN</span> <span class=n>observations</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>t</span><span class=p>.</span><span class=n>time</span>
</span></span><span class=line><span class=cl>  <span class=kr>WINDOW</span> <span class=p>{</span> <span class=n>preceding</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>following</span><span class=o>:</span> <span class=mi>1</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>AGGREGATE</span> <span class=n>rollingAverage</span> <span class=o>=</span> <span class=nf>AVG</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>),</span> <span class=n>rollingSum</span> <span class=o>=</span> <span class=nf>SUM</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>WINDOW</span> <span class=p>{</span> <span class=n>preceding</span><span class=o>:</span> <span class=s2>&#34;unbounded&#34;</span><span class=p>,</span> <span class=n>following</span><span class=o>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>AGGREGATE</span> <span class=n>cumulativeSum</span> <span class=o>=</span> <span class=nf>SUM</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>:</span> <span class=n>t</span><span class=p>.</span><span class=n>time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>subject</span><span class=o>:</span> <span class=n>t</span><span class=p>.</span><span class=n>subject</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>val</span><span class=o>:</span> <span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>rollingAverage</span><span class=p>,</span> <span class=c1>// average of the window&#39;s values
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>rollingSum</span><span class=p>,</span>     <span class=c1>// sum of the window&#39;s values
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>cumulativeSum</span>   <span class=c1>// running total
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>10</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>6.333333333333333</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>19</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>10</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:15:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>9</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>6.333333333333333</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>19</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>19</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:15:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=mf>4.666666666666666</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>44</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>29</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:30:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=mf>3.333333333333334</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>40</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>54</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:30:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=mf>6.666666666666668</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>50</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>59</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:45:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>20</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=mf>8.333333333333332</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>55</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>79</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:45:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>30</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>75</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>109</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 08:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>2</span><span class=mf>7.5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>55</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>134</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div><br><p>The row order is controlled by the <code>SORT</code> operation on the <code>time</code> attribute.</p><p>The first <code>WINDOW</code> operation aggregates the previous, current, and next row
(preceding and following is set to 1) and calculates the average and sum of
these three values. In case of the first row, there is no preceding row but a
following row, hence the values <code>10</code> and <code>0</code> are added up to calculate the sum,
which is divided by 2 to compute the average. For the second row, the values
<code>10</code>, <code>0</code> and <code>9</code> are summed up and divided by 3, and so on.</p><p>The second <code>WINDOW</code> operation aggregates all previous values (unbounded) to
calculate a running sum. For the first row, that is just <code>10</code>, for the second
row it is <code>10</code> + <code>0</code>, for the third <code>10</code> + <code>0</code> + <code>9</code>, and so on.</p><table><thead><tr><th>time</th><th>subject</th><th style=text-align:right>val</th><th style=text-align:right>rollingAverage</th><th style=text-align:right>rollingSum</th><th style=text-align:right>cumulativeSum</th></tr></thead><tbody><tr><td>2021-05-25 07:00:00</td><td>st113</td><td style=text-align:right>10</td><td style=text-align:right>5</td><td style=text-align:right>10</td><td style=text-align:right>10</td></tr><tr><td>2021-05-25 07:00:00</td><td>xh458</td><td style=text-align:right>0</td><td style=text-align:right>6.333…</td><td style=text-align:right>19</td><td style=text-align:right>10</td></tr><tr><td>2021-05-25 07:15:00</td><td>st113</td><td style=text-align:right>9</td><td style=text-align:right>6.333…</td><td style=text-align:right>19</td><td style=text-align:right>19</td></tr><tr><td>2021-05-25 07:15:00</td><td>xh458</td><td style=text-align:right>10</td><td style=text-align:right>14.666…</td><td style=text-align:right>44</td><td style=text-align:right>29</td></tr><tr><td>2021-05-25 07:30:00</td><td>st113</td><td style=text-align:right>25</td><td style=text-align:right>13.333…</td><td style=text-align:right>40</td><td style=text-align:right>54</td></tr><tr><td>2021-05-25 07:30:00</td><td>xh458</td><td style=text-align:right>5</td><td style=text-align:right>16.666…</td><td style=text-align:right>50</td><td style=text-align:right>59</td></tr><tr><td>2021-05-25 07:45:00</td><td>st113</td><td style=text-align:right>20</td><td style=text-align:right>18.333…</td><td style=text-align:right>55</td><td style=text-align:right>79</td></tr><tr><td>2021-05-25 07:45:00</td><td>xh458</td><td style=text-align:right>30</td><td style=text-align:right>25</td><td style=text-align:right>75</td><td style=text-align:right>109</td></tr><tr><td>2021-05-25 08:00:00</td><td>xh458</td><td style=text-align:right>25</td><td style=text-align:right>27.5</td><td style=text-align:right>55</td><td style=text-align:right>134</td></tr></tbody></table><p>The below query demonstrates the use of window frames to compute running totals
within each <code>subject</code> group of <code>time</code>-ordered query rows, as well as rolling
sums and averages computed from the current row and the rows that immediately
precede and follow it, also per <code>subject</code> group and sorted by <code>time</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>t</span> <span class=kr>IN</span> <span class=n>observations</span>
</span></span><span class=line><span class=cl>  <span class=kr>COLLECT</span> <span class=n>subject</span> <span class=o>=</span> <span class=n>t</span><span class=p>.</span><span class=n>subject</span> <span class=kr>INTO</span> <span class=n>group</span> <span class=o>=</span> <span class=n>t</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>subquery</span> <span class=o>=</span> <span class=p>(</span><span class=kr>FOR</span> <span class=n>t2</span> <span class=kr>IN</span> <span class=n>group</span>
</span></span><span class=line><span class=cl>    <span class=kr>SORT</span> <span class=n>t2</span><span class=p>.</span><span class=n>time</span>
</span></span><span class=line><span class=cl>    <span class=kr>WINDOW</span> <span class=p>{</span> <span class=n>preceding</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>following</span><span class=o>:</span> <span class=mi>1</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>AGGREGATE</span> <span class=n>rollingAverage</span> <span class=o>=</span> <span class=nf>AVG</span><span class=p>(</span><span class=n>t2</span><span class=p>.</span><span class=n>val</span><span class=p>),</span> <span class=n>rollingSum</span> <span class=o>=</span> <span class=nf>SUM</span><span class=p>(</span><span class=n>t2</span><span class=p>.</span><span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>WINDOW</span> <span class=p>{</span> <span class=n>preceding</span><span class=o>:</span> <span class=s2>&#34;unbounded&#34;</span><span class=p>,</span> <span class=n>following</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>AGGREGATE</span> <span class=n>cumulativeSum</span> <span class=o>=</span> <span class=nf>SUM</span><span class=p>(</span><span class=n>t2</span><span class=p>.</span><span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>time</span><span class=o>:</span> <span class=n>t2</span><span class=p>.</span><span class=n>time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>subject</span><span class=o>:</span> <span class=n>t2</span><span class=p>.</span><span class=n>subject</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>val</span><span class=o>:</span> <span class=n>t2</span><span class=p>.</span><span class=n>val</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>rollingAverage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>rollingSum</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>cumulativeSum</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// flatten subquery result
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>FOR</span> <span class=n>t2</span> <span class=kr>IN</span> <span class=n>subquery</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=n>t2</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>9.5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>19</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>10</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:15:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>9</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=mf>4.666666666666666</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>44</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>19</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:30:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>18</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>54</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>44</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:45:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>20</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>2</span><span class=mf>2.5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>45</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>64</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>0</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:15:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>15</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>10</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:30:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>15</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>45</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>15</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:45:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>30</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>20</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>60</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>45</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 08:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>2</span><span class=mf>7.5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>55</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;cumulativeSum&#34;</span> <span class=o>:</span> <span class=mi>70</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div><br><p>If you look at the first row with the subject <code>xh458</code>, then you can see the
cumulative sum reset and that the rolling average and sum does not take the
previous row into account that belongs to subject <code>st113</code>.</p><table><thead><tr><th>time</th><th>subject</th><th style=text-align:right>val</th><th style=text-align:right>rollingAverage</th><th style=text-align:right>rollingSum</th><th style=text-align:right>cumulativeSum</th></tr></thead><tbody><tr><td>2021-05-25 07:00:00</td><td>st113</td><td style=text-align:right>10</td><td style=text-align:right>9.5</td><td style=text-align:right>19</td><td style=text-align:right>10</td></tr><tr><td>2021-05-25 07:15:00</td><td>st113</td><td style=text-align:right>9</td><td style=text-align:right>14.666…</td><td style=text-align:right>44</td><td style=text-align:right>19</td></tr><tr><td>2021-05-25 07:30:00</td><td>st113</td><td style=text-align:right>25</td><td style=text-align:right>18</td><td style=text-align:right>54</td><td style=text-align:right>44</td></tr><tr><td>2021-05-25 07:45:00</td><td>st113</td><td style=text-align:right>20</td><td style=text-align:right>22.5</td><td style=text-align:right>45</td><td style=text-align:right>64</td></tr><tr><td>2021-05-25 07:00:00</td><td>xh458</td><td style=text-align:right>0</td><td style=text-align:right>5</td><td style=text-align:right>10</td><td style=text-align:right>0</td></tr><tr><td>2021-05-25 07:15:00</td><td>xh458</td><td style=text-align:right>10</td><td style=text-align:right>5</td><td style=text-align:right>15</td><td style=text-align:right>10</td></tr><tr><td>2021-05-25 07:30:00</td><td>xh458</td><td style=text-align:right>5</td><td style=text-align:right>15</td><td style=text-align:right>45</td><td style=text-align:right>15</td></tr><tr><td>2021-05-25 07:45:00</td><td>xh458</td><td style=text-align:right>30</td><td style=text-align:right>20</td><td style=text-align:right>60</td><td style=text-align:right>45</td></tr><tr><td>2021-05-25 08:00:00</td><td>xh458</td><td style=text-align:right>25</td><td style=text-align:right>27.5</td><td style=text-align:right>55</td><td style=text-align:right>70</td></tr></tbody></table><h2 id=range-based-aggregation>Range-based Aggregation <a href=/3.11/aql/high-level-operations/window/#range-based-aggregation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The second syntax form of <code>WINDOW</code> allows aggregating over a all documents
within a value range. Offsets are differences in attribute values from the
current document.</p><p>Attribute values have to be numeric. The offset calculations are performed by
adding or subtracting the numeric offsets specified in the <code>following</code> and
<code>preceding</code> attribute. The offset numbers have to be positive and have to be
determined at query compile time. The default offset is <code>0</code>.</p><p>The range based window syntax requires the input rows to be sorted by the row
value. To ensure correctness of the result, the AQL optimizer will
automatically insert a <code>SORT</code> statement into the query in front of the <code>WINDOW</code>
statement. The optimizer may be able to optimize away that <code>SORT</code> statement
later if a sorted index is present on the group criteria.</p><p>The following query demonstrates the use of window frames to compute totals as
well as averages computed from the current document and the documents that have
attribute values in <code>t.val</code> in the range of <code>[-10, +5]</code> (inclusive), preceding
and following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>t</span> <span class=kr>IN</span> <span class=n>observations</span>
</span></span><span class=line><span class=cl>  <span class=kr>WINDOW</span> <span class=n>t</span><span class=p>.</span><span class=n>val</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=n>preceding</span><span class=o>:</span> <span class=mi>10</span><span class=p>,</span> <span class=n>following</span><span class=o>:</span> <span class=mi>5</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>AGGREGATE</span> <span class=n>rollingAverage</span> <span class=o>=</span> <span class=nf>AVG</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>),</span> <span class=n>rollingSum</span> <span class=o>=</span> <span class=nf>SUM</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>:</span> <span class=n>t</span><span class=p>.</span><span class=n>time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>subject</span><span class=o>:</span> <span class=n>t</span><span class=p>.</span><span class=n>subject</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>val</span><span class=o>:</span> <span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>rollingAverage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>rollingSum</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>2.5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>5</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:30:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>6.8</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>34</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:15:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>9</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>6.8</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>34</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>6.8</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>34</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:15:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>6.8</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>34</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:45:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>20</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>18</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>90</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:30:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>100</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 08:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>100</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:45:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>30</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>100</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div><br><p>The value range of the first row is <code>[-10, 5]</code> since <code>val</code> is <code>0</code>, thus the
values from the first and second row are added up to <code>5</code> with the average being
<code>2.5</code>. The value range of the last row is <code>[20, 35]</code> as <code>val</code> is <code>30</code>, which
means that the last four rows get aggregated to a sum of <code>100</code> and an average
of <code>25</code> (the range is inclusive, i.e. <code>val</code> falls within the range with a value
of <code>20</code>).</p><table><thead><tr><th>time</th><th>subject</th><th style=text-align:right>val</th><th style=text-align:right>rollingAverage</th><th style=text-align:right>rollingSum</th></tr></thead><tbody><tr><td>2021-05-25 07:00:00</td><td>xh458</td><td style=text-align:right>0</td><td style=text-align:right>2.5</td><td style=text-align:right>5</td></tr><tr><td>2021-05-25 07:30:00</td><td>xh458</td><td style=text-align:right>5</td><td style=text-align:right>6.8</td><td style=text-align:right>34</td></tr><tr><td>2021-05-25 07:15:00</td><td>st113</td><td style=text-align:right>9</td><td style=text-align:right>6.8</td><td style=text-align:right>34</td></tr><tr><td>2021-05-25 07:00:00</td><td>st113</td><td style=text-align:right>10</td><td style=text-align:right>6.8</td><td style=text-align:right>34</td></tr><tr><td>2021-05-25 07:15:00</td><td>xh458</td><td style=text-align:right>10</td><td style=text-align:right>6.8</td><td style=text-align:right>34</td></tr><tr><td>2021-05-25 07:45:00</td><td>st113</td><td style=text-align:right>20</td><td style=text-align:right>18</td><td style=text-align:right>90</td></tr><tr><td>2021-05-25 07:30:00</td><td>st113</td><td style=text-align:right>25</td><td style=text-align:right>25</td><td style=text-align:right>100</td></tr><tr><td>2021-05-25 08:00:00</td><td>xh458</td><td style=text-align:right>25</td><td style=text-align:right>25</td><td style=text-align:right>100</td></tr><tr><td>2021-05-25 07:45:00</td><td>xh458</td><td style=text-align:right>30</td><td style=text-align:right>25</td><td style=text-align:right>100</td></tr></tbody></table><h2 id=duration-based-aggregation>Duration-based Aggregation <a href=/3.11/aql/high-level-operations/window/#duration-based-aggregation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Aggregating by time intervals is a subtype of range-based aggregation that
uses the second syntax form of <code>WINDOW</code> but with ISO durations.</p><p>To support <code>WINDOW</code> frames over time-series data the <code>WINDOW</code> operation may
calculate timestamp offsets using positive ISO 8601 duration strings, like
<code>P1Y6M</code> (1 year and 6 months) or <code>PT12H30M</code> (12 hours and 30 minutes). Also see
<a href=/3.11/aql/functions/date/#comparison-and-calculation class=link>Date functions</a>.
In contrast to the ISO 8601 standard, week components may be freely combined
with other components. For example, <code>P1WT1H</code> and <code>P1M1W</code> are both valid.
Fractional values are only supported for seconds, and only with up to three
decimals after the separator, i.e., millisecond precision. For example,
<code>PT0.123S</code> is a valid duration while <code>PT0.5H</code> and <code>PT0.1234S</code> are not.</p><p>Durations can be specified separately in <code>following</code> and <code>preceding</code>.
If such a duration is used, then the attribute value of the current document
must be a number and is treated as numeric <strong>timestamp in milliseconds</strong>.
The range is inclusive. If either bound is not specified, it is treated as an
empty duration (i.e., <code>P0D</code>).</p><p>The following query demonstrates the use of window frames to compute rolling
sums and averages over observations in the last 30 minutes (inclusive), based
on the document attribute <code>time</code> that is converted from a datetime string to a
numeric timestamp:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>t</span> <span class=kr>IN</span> <span class=n>observations</span>
</span></span><span class=line><span class=cl>  <span class=kr>WINDOW</span> <span class=nf>DATE_TIMESTAMP</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>time</span><span class=p>)</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=n>preceding</span><span class=o>:</span> <span class=s2>&#34;PT30M&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>AGGREGATE</span> <span class=n>rollingAverage</span> <span class=o>=</span> <span class=nf>AVG</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>),</span> <span class=n>rollingSum</span> <span class=o>=</span> <span class=nf>SUM</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>:</span> <span class=n>t</span><span class=p>.</span><span class=n>time</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>subject</span><span class=o>:</span> <span class=n>t</span><span class=p>.</span><span class=n>subject</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>val</span><span class=o>:</span> <span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>rollingAverage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>rollingSum</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>10</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>10</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:15:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>9</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>7.25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>29</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:15:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>7.25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>29</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:30:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>9.833333333333334</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>59</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:30:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mf>9.833333333333334</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>59</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:45:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;st113&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>20</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=mf>6.5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>99</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 07:45:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>30</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=mf>6.5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>99</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;time&#34;</span> <span class=o>:</span> <span class=s2>&#34;2021-05-25 08:00:00&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;subject&#34;</span> <span class=o>:</span> <span class=s2>&#34;xh458&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;val&#34;</span> <span class=o>:</span> <span class=mi>25</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingAverage&#34;</span> <span class=o>:</span> <span class=mi>21</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;rollingSum&#34;</span> <span class=o>:</span> <span class=mi>105</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div><br><p>With a time of <code>07:30:00</code>, everything from <code>07:00:00</code> to <code>07:30:00</code> on the same
day falls within the duration range with <code>preceding: "PT30M"</code>, thus aggregating
the top six rows to a sum of <code>59</code> and an average of <code>9.8333…</code>.</p><table><thead><tr><th>time</th><th>subject</th><th style=text-align:right>val</th><th style=text-align:right>rollingAverage</th><th style=text-align:right>rollingSum</th></tr></thead><tbody><tr><td>2021-05-25 07:00:00</td><td>st113</td><td style=text-align:right>10</td><td style=text-align:right>5</td><td style=text-align:right>10</td></tr><tr><td>2021-05-25 07:00:00</td><td>xh458</td><td style=text-align:right>0</td><td style=text-align:right>5</td><td style=text-align:right>10</td></tr><tr><td>2021-05-25 07:15:00</td><td>st113</td><td style=text-align:right>9</td><td style=text-align:right>7.25</td><td style=text-align:right>29</td></tr><tr><td>2021-05-25 07:15:00</td><td>xh458</td><td style=text-align:right>10</td><td style=text-align:right>7.25</td><td style=text-align:right>29</td></tr><tr><td>2021-05-25 07:30:00</td><td>st113</td><td style=text-align:right>25</td><td style=text-align:right>9.8333…</td><td style=text-align:right>59</td></tr><tr><td>2021-05-25 07:30:00</td><td>xh458</td><td style=text-align:right>5</td><td style=text-align:right>9.8333…</td><td style=text-align:right>59</td></tr><tr><td>2021-05-25 07:45:00</td><td>st113</td><td style=text-align:right>20</td><td style=text-align:right>16.5</td><td style=text-align:right>99</td></tr><tr><td>2021-05-25 07:45:00</td><td>xh458</td><td style=text-align:right>30</td><td style=text-align:right>16.5</td><td style=text-align:right>99</td></tr><tr><td>2021-05-25 08:00:00</td><td>xh458</td><td style=text-align:right>25</td><td style=text-align:right>21</td><td style=text-align:right>105</td></tr></tbody></table><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.11/aql/high-level-operations/collect/><i class="fas fa-chevron-left fa-fw"></i><p>COLLECT</p></a></span><span class=next><a class="nav nav-next link" href=/3.11/aql/high-level-operations/remove/><p>REMOVE</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.11/aql/high-level-operations/window.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#syntax>Syntax</a></div><div class=level-2><a href=#row-based-aggregation>Row-based Aggregation</a></div><div class=level-2><a href=#range-based-aggregation>Range-based Aggregation</a></div><div class=level-2><a href=#duration-based-aggregation>Duration-based Aggregation</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>