<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1747031427></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="The SEARCH operation lets you filter Views, accelerated by the underlying indexes"><meta property="og:url" content="http://localhost/3.11/aql/high-level-operations/search/"><meta property="og:title" content="SEARCH operation in AQL"><meta property="og:type" content="website"><meta property="og:description" content="The SEARCH operation lets you filter Views, accelerated by the underlying indexes"><meta name=docsearch:version content="3.11"><title>SEARCH operation in AQL | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1747031427 defer></script>
<script src=/js/featherlight.min.js?1747031427 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1747031427 defer></script>
<script src=/js/theme.js?1747031427 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.11"><a itemprop=item class=link href=/3.11/><span itemprop=name class=breadcrumb-entry>3.11.13</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="AQL"><a itemprop=item class=link href=/3.11/aql/><span itemprop=name class=breadcrumb-entry>AQL</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="High-level Operations"><a itemprop=item class=link href=/3.11/aql/high-level-operations/><span itemprop=name class=breadcrumb-entry>High-level Operations</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="SEARCH"><a itemprop=item class=link href=/3.11/aql/high-level-operations/search/><span itemprop=name class=breadcrumb-entry>SEARCH</span></a></li></ol></nav><article class=default><hgroup><h1><code>SEARCH</code> operation in AQL</h1><p class=lead>The <code>SEARCH</code> operation lets you filter Views, accelerated by the underlying indexes</p></hgroup><p>The <code>SEARCH</code> operation guarantees to use View indexes for an efficient
execution plan. If you use the <code>FILTER</code> keyword for Views, no indexes are
utilized and the filtering is performed as a post-processing step.</p><p>Conceptually, a View is just another document data source,
similar to an array or a document/edge collection, over which you can iterate
using a <a href=/3.11/aql/high-level-operations/for/ class=link><code>FOR</code> operation</a> in AQL:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>The optional <code>SEARCH</code> operation provides the capabilities to:</p><ul><li>filter documents based on AQL Boolean expressions and functions</li><li>match documents located in different collections backed by a fast index</li><li>sort the result set based on how closely each document matched the
search conditions</li></ul><p>See <a href=/3.11/index-and-search/arangosearch/arangosearch-views-reference/ class=link><code>arangosearch</code> Views</a> and
<a href=/3.11/index-and-search/arangosearch/search-alias-views-reference/ class=link><code>search-alias</code> Views</a> on how to set up Views.</p><h2 id=syntax>Syntax <a href=/3.11/aql/high-level-operations/search/#syntax class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The <code>SEARCH</code> keyword is followed by an ArangoSearch filter expressions, which
is mostly comprised of calls to ArangoSearch AQL functions.</p><pre><code>FOR <em>doc</em> IN <em>viewName</em>
  SEARCH <em>expression</em>
  OPTIONS { … }
  ...</code></pre><h2 id=usage>Usage <a href=/3.11/aql/high-level-operations/search/#usage class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The <code>SEARCH</code> statement, in contrast to <code>FILTER</code>, is treated as a part of the
<code>FOR</code> operation, not as an individual statement. It cannot be placed freely
in a query nor multiple times in the body of a <code>FOR</code> loop. <code>FOR ... IN</code> must be
followed by the name of a View, not a collection. The <code>SEARCH</code> operation has to
follow next, other operations before <code>SEARCH</code> such as <code>FILTER</code>, <code>COLLECT</code> etc.
are not allowed in this position. Subsequent operations are possible after
<code>SEARCH</code> and the expression however, including <code>SORT</code> to order the search
results based on a ranking value computed by the View.</p><p><em>expression</em> must be an ArangoSearch expression. The full power of ArangoSearch
is harnessed and exposed via special <a href=/3.11/aql/functions/arangosearch/ class=link>ArangoSearch functions</a>,
during both the search and sort stages. On top of that, common AQL operators
are supported.</p><p>Note that inline expressions and a few other things are not supported by
<code>SEARCH</code>. The server will raise a query error in case of an invalid expression.</p><p>The <code>OPTIONS</code> keyword and an object can optionally follow the search expression
to set <a href=#search-options class=link>Search Options</a>.</p><h3 id=logical-operators>Logical operators <a href=/3.11/aql/high-level-operations/search/#logical-operators class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Logical or Boolean operators allow you to combine multiple search conditions.</p><ul><li><code>AND</code>, <code>&&</code> (conjunction)</li><li><code>OR</code>, <code>||</code> (disjunction)</li><li><code>NOT</code>, <code>!</code> (negation / inversion)</li></ul><p><a href=/3.11/aql/operators/#operator-precedence class=link>Operator precedence</a> needs to be taken
into account and can be controlled with parentheses.</p><p>Consider the following contrived expression:</p><p><code>doc.value &lt; 0 OR doc.value > 5 AND doc.value IN [-10, 10]</code></p><p><code>AND</code> has a higher precedence than <code>OR</code>. The expression is equivalent to:</p><p><code>doc.value &lt; 0 OR (doc.value > 5 AND doc.value IN [-10, 10])</code></p><p>The conditions are thus:</p><ul><li>values less than 0</li><li>values greater than 5, but only if it is 10
(or -10, but this can never be fulfilled)</li></ul><p>Parentheses can be used as follows to apply the <code>AND</code> condition to both of the
<code>OR</code> conditions:</p><p><code>(doc.value &lt; 0 OR doc.value > 5) AND doc.value IN [-10, 10]</code></p><p>The conditions are now:</p><ul><li>values less than 0, but only if it is -10</li><li>values greater than 5, but only if it is 10</li></ul><h3 id=comparison-operators>Comparison operators <a href=/3.11/aql/high-level-operations/search/#comparison-operators class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><ul><li><code>==</code> (equal)</li><li><code>&lt;=</code> (less than or equal)</li><li><code>>=</code> (greater than or equal)</li><li><code>&lt;</code> (less than)</li><li><code>></code> (greater than)</li><li><code>!=</code> (unequal)</li><li><code>IN</code> (contained in array or range), also <code>NOT IN</code></li><li><code>LIKE</code> (equal with wildcards), also <code>NOT LIKE</code></li></ul><p>Also see the <a href=/3.11/aql/functions/arangosearch/#in_range class=link><code>IN_RANGE()</code> function</a> for
an alternative to a combination of <code>&lt;</code>, <code>&lt;=</code>, <code>></code>, <code>>=</code> operators for range
searches.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=o>==</span> <span class=s2>&#34;quick&#34;</span> <span class=kr>OR</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=o>==</span> <span class=s2>&#34;brown&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// -- or --
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>IN</span> <span class=p>[</span><span class=s2>&#34;quick&#34;</span><span class=p>,</span> <span class=s2>&#34;brown&#34;</span><span class=p>],</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>The alphabetical order of characters is not taken into account by ArangoSearch,
i.e. range queries in SEARCH operations against Views will not follow the
language rules as per the defined Analyzer locale (except for the
<a href=/3.11/index-and-search/analyzers/#collation class=link><code>collation</code> Analyzer</a>) nor the server language
(startup option <code>--default-language</code>)!
Also see <a href=/3.11/release-notes/version-3.11/known-issues-in-3-11/#arangosearch class=link>Known Issues</a>.</div></div></div></div><h3 id=array-comparison-operators>Array comparison operators <a href=/3.11/aql/high-level-operations/search/#array-comparison-operators class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><a href=/3.11/aql/operators/#array-comparison-operators class=link>Array comparison operators</a> are
supported:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>tokens</span> <span class=o>=</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;some input&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>                 <span class=c1>// [&#34;some&#34;, &#34;input&#34;]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=n>tokens</span>  <span class=kr>ALL</span> <span class=kr>IN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>RETURN</span> <span class=n>doc</span> <span class=c1>// dynamic conjunction
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=n>tokens</span>  <span class=kr>ANY</span> <span class=kr>IN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>RETURN</span> <span class=n>doc</span> <span class=c1>// dynamic disjunction
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=n>tokens</span> <span class=kr>NONE</span> <span class=kr>IN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>RETURN</span> <span class=n>doc</span> <span class=c1>// dynamic negation
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=n>tokens</span>  <span class=kr>ALL</span> <span class=o>&gt;</span>  <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>RETURN</span> <span class=n>doc</span> <span class=c1>// dynamic conjunction with comparison
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=n>tokens</span>  <span class=kr>ANY</span> <span class=o>&lt;=</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>RETURN</span> <span class=n>doc</span> <span class=c1>// dynamic disjunction with comparison
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=n>tokens</span> <span class=kr>NONE</span> <span class=o>&lt;</span>  <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>RETURN</span> <span class=n>doc</span> <span class=c1>// dynamic negation with comparison
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=n>tokens</span> <span class=kr>AT LEAST</span> <span class=p>(</span><span class=mi>1</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=kr>IN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>RETURN</span> <span class=n>doc</span> <span class=c1>// dynamically test for a subset of elements
</span></span></span></code></pre></div><p>The following operators are equivalent in <code>SEARCH</code> expressions:</p><ul><li><code>ALL IN</code>, <code>ALL ==</code>, <code>NONE !=</code>, <code>NONE NOT IN</code></li><li><code>ANY IN</code>, <code>ANY ==</code></li><li><code>NONE IN</code>, <code>NONE ==</code>, <code>ALL !=</code>, <code>ALL NOT IN</code></li><li><code>ALL ></code>, <code>NONE &lt;=</code></li><li><code>ALL >=</code>, <code>NONE &lt;</code></li><li><code>ALL &lt;</code>, <code>NONE >=</code></li><li><code>ALL &lt;=</code>, <code>NONE ></code></li><li><code>AT LEAST (...) IN</code>, <code>AT LEAST (...) ==</code></li><li><code>AT LEAST (1) IN</code>, <code>ANY IN</code></li></ul><p>The stored attribute referenced on the right side of the operator is like a
single, primitive value. In case of multiple tokens, it is like having multiple
such values as opposed to an array of values, even if the actual document
attribute is an array. <code>IN</code> and <code>==</code> as part of array comparison operators are
treated the same in <code>SEARCH</code> expressions for ease of use. The behavior is
different outside of <code>SEARCH</code>, where <code>IN</code> needs to be followed by an array.</p><h3 id=question-mark-operator>Question mark operator <a href=/3.11/aql/high-level-operations/search/#question-mark-operator class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>You can use the <a href=/3.11/aql/operators/#question-mark-operator class=link>Question mark operator</a>
to perform <a href=/3.11/index-and-search/arangosearch/nested-search/ class=link>Nested searches with ArangoSearch</a>
(Enterprise Edition only):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>dimensions</span><span class=p>[</span><span class=o>?</span> <span class=kr>FILTER</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;height&#34;</span> <span class=kr>AND</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>value</span> <span class=o>&gt;</span> <span class=mi>40</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>It allows you to match nested objects in arrays that satisfy multiple conditions
each, and optionally define how often these conditions should be fulfilled for
the entire array. You need to configure the View specifically for this type of
search using the <code>nested</code> property in <a href=/3.11/index-and-search/arangosearch/arangosearch-views-reference/#link-properties class=link><code>arangosearch</code> Views</a>
or in the definition of <a href=/3.11/index-and-search/indexing/working-with-indexes/inverted-indexes/#nested-search-enterprise-edition class=link>Inverted Indexes</a>
that you can add to <a href=/3.11/index-and-search/arangosearch/search-alias-views-reference/ class=link><code>search-alias</code> Views</a>.</p><h2 id=handling-of-non-indexed-fields>Handling of non-indexed fields <a href=/3.11/aql/high-level-operations/search/#handling-of-non-indexed-fields class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Document attributes which are not configured to be indexed by a View are
treated by <code>SEARCH</code> as non-existent. This affects tests against the documents
emitted from the View only.</p><p>For example, given a collection <code>myCol</code> with the following documents:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span> <span class=s2>&#34;someAttr&#34;</span><span class=o>:</span> <span class=s2>&#34;One&#34;</span><span class=p>,</span> <span class=s2>&#34;anotherAttr&#34;</span><span class=o>:</span> <span class=s2>&#34;One&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span> <span class=s2>&#34;someAttr&#34;</span><span class=o>:</span> <span class=s2>&#34;Two&#34;</span><span class=p>,</span> <span class=s2>&#34;anotherAttr&#34;</span><span class=o>:</span> <span class=s2>&#34;Two&#34;</span> <span class=p>}</span></span></span></code></pre></div><p>… with an <code>arangosearch</code> View where <code>someAttr</code> is indexed by the following View <code>myView</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;type&#34;</span><span class=o>:</span> <span class=s2>&#34;arangosearch&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;links&#34;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;myCol&#34;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;fields&#34;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;someAttr&#34;</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>… a search on <code>someAttr</code> yields the following result:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>someAttr</span> <span class=o>==</span> <span class=s2>&#34;One&#34;</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span> <span class=p>{</span> <span class=nt>&#34;someAttr&#34;</span><span class=p>:</span> <span class=s2>&#34;One&#34;</span><span class=p>,</span> <span class=nt>&#34;anotherAttr&#34;</span><span class=p>:</span> <span class=s2>&#34;One&#34;</span> <span class=p>}</span> <span class=p>]</span>
</span></span></code></pre></div><p>A search on <code>anotherAttr</code> yields an empty result because only <code>someAttr</code>
is indexed by the View:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>anotherAttr</span> <span class=o>==</span> <span class=s2>&#34;One&#34;</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[]</span>
</span></span></code></pre></div><p>You can use the special <code>includeAllFields</code>
<a href=/3.11/index-and-search/arangosearch/arangosearch-views-reference/#link-properties class=link><code>arangosearch</code> View property</a>
to index all (sub-)attributes of the source documents if desired.</p><h2 id=search-with-sort><code>SEARCH</code> with <code>SORT</code> <a href=/3.11/aql/high-level-operations/search/#search-with-sort class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The documents emitted from a View can be sorted by attribute values with the
standard <a href=/3.11/aql/high-level-operations/sort/ class=link><code>SORT()</code> operation</a>, using one or multiple
attributes, in ascending or descending order (or a mix thereof).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>value</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>If the (left-most) fields and their sorting directions match up with the
<a href=/3.11/index-and-search/arangosearch/performance/#primary-sort-order class=link>primary sort order</a> definition
of the View then the <code>SORT</code> operation is optimized away.</p><p>Apart from simple sorting, it is possible to sort the matched View documents by
relevance score (or a combination of score and attribute values if desired).
The document search via the <code>SEARCH</code> keyword and the sorting via the
<a href=/3.11/aql/functions/arangosearch/#scoring-functions class=link>ArangoSearch Scoring Functions</a>,
namely <code>BM25()</code> and <code>TFIDF()</code>, are closely intertwined.
The query given in the <code>SEARCH</code> expression is not only used to filter documents,
but also is used with the scoring functions to decide which document matches
the query best. Other documents in the View also affect this decision.</p><p>Therefore the ArangoSearch scoring functions can work <em>only</em> on documents
emitted from a View, as both the corresponding <code>SEARCH</code> expression and the View
itself are consulted in order to sort the results.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>The <a href=/3.11/aql/functions/arangosearch/#boost class=link><code>BOOST()</code> function</a> can be used to
fine-tune the resulting ranking by weighing sub-expressions in <code>SEARCH</code>
differently.</p><p>If there is no <code>SEARCH</code> operation prior to calls to scoring functions or if
the search expression does not filter out documents (e.g. <code>SEARCH true</code>) then
a score of <code>0</code> will be returned for all documents.</p><h2 id=search-options>Search Options <a href=/3.11/aql/high-level-operations/search/#search-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The <code>SEARCH</code> operation supports an optional <code>OPTIONS</code> clause to modify the
behavior. The general syntax is as follows:</p><pre><code>SEARCH <em>expression</em> OPTIONS { <em>option</em>: <em>value</em>, <em>...</em> }</code></pre><h3 id=collections><code>collections</code> <a href=/3.11/aql/high-level-operations/search/#collections class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>You can specify an array of strings with collection names to restrict the search
to certain source collections.</p><p>Given a View with three linked collections <code>coll1</code>, <code>coll2</code>, and <code>coll3</code>, you
can return documents from the first two collections only and ignore the third
collection by setting the <code>collections</code> option to <code>["coll1", "coll2"]</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=kc>true</span> <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>collections</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;coll1&#34;</span><span class=p>,</span> <span class=s2>&#34;coll2&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>The search expression <code>true</code> in the above example matches all View documents.
You can use any valid expression here while limiting the scope to the chosen
source collections.</p><h3 id=conditionoptimization><code>conditionOptimization</code> <a href=/3.11/aql/high-level-operations/search/#conditionoptimization class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>You can specify one of the following values for this option to control how
search criteria get optimized:</p><ul><li><code>"auto"</code> (default): convert conditions to disjunctive normal form (DNF) and
apply optimizations. Removes redundant or overlapping conditions, but can
take quite some time even for a low number of nested conditions.</li><li><code>"none"</code>: search the index without optimizing the conditions.</li></ul><p>See <a href=/3.11/index-and-search/arangosearch/performance/#condition-optimization-options class=link>Optimizing View and inverted index query performance</a>
for an example.</p><h3 id=countapproximate><code>countApproximate</code> <a href=/3.11/aql/high-level-operations/search/#countapproximate class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>This option controls how the total count of rows is calculated if the <code>fullCount</code>
option is enabled for a query or when a <code>COLLECT WITH COUNT</code> clause is executed.
You can set it to one of the following values:</p><ul><li><code>"exact"</code> (default): rows are actually enumerated for a precise count.</li><li><code>"cost"</code>: a cost-based approximation is used. Does not enumerate rows and
returns an approximate result with O(1) complexity. Gives a precise result
if the <code>SEARCH</code> condition is empty or if it contains a single term query
only (e.g. <code>SEARCH doc.field == "value"</code>), the usual eventual consistency
of Views aside.</li></ul><p>See <a href=/3.11/index-and-search/arangosearch/performance/#count-approximation class=link>Optimizing View and inverted index query performance</a>
for an example.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.11/aql/high-level-operations/filter/><i class="fas fa-chevron-left fa-fw"></i><p>FILTER</p></a></span><span class=next><a class="nav nav-next link" href=/3.11/aql/high-level-operations/sort/><p>SORT</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.11/aql/high-level-operations/search.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#syntax>Syntax</a></div><div class=level-2><a href=#usage>Usage</a></div><div class=level-3><a href=#logical-operators>Logical operators</a></div><div class=level-3><a href=#comparison-operators>Comparison operators</a></div><div class=level-3><a href=#array-comparison-operators>Array comparison operators</a></div><div class=level-3><a href=#question-mark-operator>Question mark operator</a></div><div class=level-2><a href=#handling-of-non-indexed-fields>Handling of non-indexed fields</a></div><div class=level-2><a href=#search-with-sort><code>SEARCH</code> with <code>SORT</code></a></div><div class=level-2><a href=#search-options>Search Options</a></div><div class=level-3><a href=#collections><code>collections</code></a></div><div class=level-3><a href=#conditionoptimization><code>conditionOptimization</code></a></div><div class=level-3><a href=#countapproximate><code>countApproximate</code></a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>