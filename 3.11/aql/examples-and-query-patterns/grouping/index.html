<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1747031427></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="You can group data by arbitrary criteria with AQL&amp;rsquo;s COLLECT operation, with optional aggregation during grouping or using post-aggregation"><meta property="og:url" content="http://localhost/3.11/aql/examples-and-query-patterns/grouping/"><meta property="og:title" content="Grouping and aggregating data in AQL"><meta property="og:type" content="website"><meta property="og:description" content="You can group data by arbitrary criteria with AQL&amp;rsquo;s COLLECT operation, with optional aggregation during grouping or using post-aggregation"><meta name=docsearch:version content="3.11"><title>Grouping and aggregating data in AQL | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1747031427 defer></script>
<script src=/js/featherlight.min.js?1747031427 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1747031427 defer></script>
<script src=/js/theme.js?1747031427 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.11"><a itemprop=item class=link href=/3.11/><span itemprop=name class=breadcrumb-entry>3.11.13</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="AQL"><a itemprop=item class=link href=/3.11/aql/><span itemprop=name class=breadcrumb-entry>AQL</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Examples & Query Patterns"><a itemprop=item class=link href=/3.11/aql/examples-and-query-patterns/><span itemprop=name class=breadcrumb-entry>Examples & Query Patterns</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Grouping"><a itemprop=item class=link href=/3.11/aql/examples-and-query-patterns/grouping/><span itemprop=name class=breadcrumb-entry>Grouping</span></a></li></ol></nav><article class=default><hgroup><h1>Grouping and aggregating data in AQL</h1><p class=lead>You can group data by arbitrary criteria with AQL&rsquo;s <code>COLLECT</code> operation, with optional aggregation during grouping or using post-aggregation</p></hgroup><p>To group results by arbitrary criteria, AQL provides the <code>COLLECT</code> keyword.
<code>COLLECT</code> will perform a grouping, but no aggregation. Aggregation can still be
added in the query if required.</p><h2 id=ensuring-uniqueness>Ensuring uniqueness <a href=/3.11/aql/examples-and-query-patterns/grouping/#ensuring-uniqueness class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><code>COLLECT</code> can be used to make a result set unique. The following query will return each distinct
<code>age</code> attribute value only once:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>COLLECT</span> <span class=n>age</span> <span class=o>=</span> <span class=n>u</span><span class=p>.</span><span class=n>age</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=n>age</span></span></span></code></pre></div><p>This is grouping without tracking the group values, but just the group criterion (<em>age</em>) value.</p><p>Grouping can also be done on multiple levels using <code>COLLECT</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>COLLECT</span> <span class=n>status</span> <span class=o>=</span> <span class=n>u</span><span class=p>.</span><span class=n>status</span><span class=p>,</span> <span class=n>age</span> <span class=o>=</span> <span class=n>u</span><span class=p>.</span><span class=n>age</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>status</span><span class=p>,</span> <span class=n>age</span> <span class=p>}</span></span></span></code></pre></div><p>Alternatively <code>RETURN DISTINCT</code> can be used to make a result set unique.
<code>RETURN DISTINCT</code> supports a single criterion only:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=kr>DISTINCT</span> <span class=n>u</span><span class=p>.</span><span class=n>age</span></span></span></code></pre></div><p><code>RETURN DISTINCT</code> does not change the order of results. For above query that
means the order is undefined because no particular order is guaranteed when
iterating over a collection without explicit <code>SORT</code> operation.</p><h2 id=fetching-group-values>Fetching group values <a href=/3.11/aql/examples-and-query-patterns/grouping/#fetching-group-values class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>To group users by age, and return the names of the users with the highest ages,
we&rsquo;ll issue a query like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>active</span> <span class=o>==</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=kr>COLLECT</span> <span class=n>age</span> <span class=o>=</span> <span class=n>u</span><span class=p>.</span><span class=n>age</span> <span class=kr>INTO</span> <span class=n>usersByAge</span>
</span></span><span class=line><span class=cl>    <span class=kr>SORT</span> <span class=n>age</span> <span class=kr>DESC</span> <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>age</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>users</span><span class=o>:</span> <span class=n>usersByAge</span><span class=p>[</span><span class=o>*</span><span class=p>].</span><span class=n>u</span><span class=p>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>37</span><span class=p>,</span> <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span> <span class=s2>&#34;Sophia&#34;</span> <span class=p>]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>36</span><span class=p>,</span> <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;Fred&#34;</span><span class=p>,</span> <span class=s2>&#34;Emma&#34;</span> <span class=p>]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>34</span><span class=p>,</span> <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;Madison&#34;</span> <span class=p>]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>33</span><span class=p>,</span> <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;Chloe&#34;</span><span class=p>,</span> <span class=s2>&#34;Michael&#34;</span> <span class=p>]</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>32</span><span class=p>,</span> <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;Alexander&#34;</span> <span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>The query will put all users together by their <em>age</em> attribute. There will be one
result document per distinct <em>age</em> value (let aside the <code>LIMIT</code>). For each group,
we have access to the matching document via the <em>usersByAge</em> variable introduced in
the <code>COLLECT</code> statement.</p><h2 id=variable-expansion>Variable Expansion <a href=/3.11/aql/examples-and-query-patterns/grouping/#variable-expansion class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The <em>usersByAge</em> variable contains the full documents found, and as we&rsquo;re only
interested in user names, we&rsquo;ll use the expansion operator <code>[*]</code> to extract just the
<em>name</em> attribute of all user documents in each group:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>usersByAge</span><span class=p>[</span><span class=o>*</span><span class=p>].</span><span class=n>u</span><span class=p>.</span><span class=n>name</span></span></span></code></pre></div><p>The <code>[*]</code> expansion operator is just a handy short-cut. We could also write
a subquery:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=p>(</span> <span class=kr>FOR</span> <span class=n>temp</span> <span class=kr>IN</span> <span class=n>usersByAge</span> <span class=kr>RETURN</span> <span class=n>temp</span><span class=p>.</span><span class=n>u</span><span class=p>.</span><span class=n>name</span> <span class=p>)</span></span></span></code></pre></div><h2 id=grouping-by-multiple-criteria>Grouping by multiple criteria <a href=/3.11/aql/examples-and-query-patterns/grouping/#grouping-by-multiple-criteria class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>To group by multiple criteria, we&rsquo;ll use multiple arguments in the <code>COLLECT</code> clause.
For example, to group users by <em>ageGroup</em> (a derived value we need to calculate first)
and then by <em>gender</em>, we&rsquo;ll do:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>active</span> <span class=o>==</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=kr>COLLECT</span> <span class=n>ageGroup</span> <span class=o>=</span> <span class=nf>FLOOR</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>age</span> <span class=o>/</span> <span class=mi>5</span><span class=p>)</span> <span class=o>*</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>gender</span> <span class=o>=</span> <span class=n>u</span><span class=p>.</span><span class=n>gender</span> <span class=kr>INTO</span> <span class=n>group</span>
</span></span><span class=line><span class=cl>    <span class=kr>SORT</span> <span class=n>ageGroup</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ageGroup</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>gender</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;f&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;m&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>30</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;f&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>30</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;m&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>25</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;f&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>25</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;m&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><h2 id=counting-group-values>Counting group values <a href=/3.11/aql/examples-and-query-patterns/grouping/#counting-group-values class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>If the goal is to count the number of values in each group, AQL provides the special
<em>COLLECT WITH COUNT INTO</em> syntax. This is a simple variant for grouping with an additional
group length calculation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>active</span> <span class=o>==</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=kr>COLLECT</span> <span class=n>ageGroup</span> <span class=o>=</span> <span class=nf>FLOOR</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>age</span> <span class=o>/</span> <span class=mi>5</span><span class=p>)</span> <span class=o>*</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>gender</span> <span class=o>=</span> <span class=n>u</span><span class=p>.</span><span class=n>gender</span> <span class=kr>WITH</span> <span class=kp>COUNT</span> <span class=kr>INTO</span> <span class=n>numUsers</span>
</span></span><span class=line><span class=cl>    <span class=kr>SORT</span> <span class=n>ageGroup</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ageGroup</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>gender</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>numUsers</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;f&#34;</span><span class=p>,</span> <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>2</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;m&#34;</span><span class=p>,</span> <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>2</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>30</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;f&#34;</span><span class=p>,</span> <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>4</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>30</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;m&#34;</span><span class=p>,</span> <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>4</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>25</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;f&#34;</span><span class=p>,</span> <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>2</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>25</span><span class=p>,</span> <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;m&#34;</span><span class=p>,</span> <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>2</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><h2 id=aggregation>Aggregation <a href=/3.11/aql/examples-and-query-patterns/grouping/#aggregation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Adding further aggregation is also simple in AQL by using an <code>AGGREGATE</code> clause
in the <code>COLLECT</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>active</span> <span class=o>==</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=kr>COLLECT</span> <span class=n>ageGroup</span> <span class=o>=</span> <span class=nf>FLOOR</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>age</span> <span class=o>/</span> <span class=mi>5</span><span class=p>)</span> <span class=o>*</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>gender</span> <span class=o>=</span> <span class=n>u</span><span class=p>.</span><span class=n>gender</span>
</span></span><span class=line><span class=cl>    <span class=kr>AGGREGATE</span> <span class=n>numUsers</span> <span class=o>=</span> <span class=nf>LENGTH</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>              <span class=n>minAge</span> <span class=o>=</span> <span class=nf>MIN</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>age</span><span class=p>),</span>
</span></span><span class=line><span class=cl>              <span class=n>maxAge</span> <span class=o>=</span> <span class=nf>MAX</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>age</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>SORT</span> <span class=n>ageGroup</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ageGroup</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>gender</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>numUsers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>minAge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>maxAge</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;f&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;minAge&#34;</span><span class=p>:</span> <span class=mi>36</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;maxAge&#34;</span><span class=p>:</span> <span class=mi>39</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;m&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;minAge&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;maxAge&#34;</span><span class=p>:</span> <span class=mi>39</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>We have used the aggregate functions <em>LENGTH</em> here (it returns the length of an array).
This is the equivalent to SQL&rsquo;s <code>SELECT g, COUNT(*) FROM ... GROUP BY g</code>. In addition to
<code>LENGTH</code>, AQL also provides <code>MAX</code>, <code>MIN</code>, <code>SUM</code> and <code>AVERAGE</code>, <code>VARIANCE_POPULATION</code>,
<code>VARIANCE_SAMPLE</code>, <code>STDDEV_POPULATION</code>, <code>STDDEV_SAMPLE</code>, <code>UNIQUE</code>, <code>SORTED_UNIQUE</code> and
<code>COUNT_UNIQUE</code> as basic aggregation functions.</p><p>In AQL all aggregation functions can be run on arrays only. If an aggregation function
is run on anything that is not an array, a warning will be produced and the result will
be <code>null</code>.</p><p>Using an <code>AGGREGATE</code> clause will ensure the aggregation is run while the groups are built
in the collect operation. This is normally more efficient than collecting all group values
for all groups and then doing a post-aggregation.</p><h2 id=post-aggregation>Post-aggregation <a href=/3.11/aql/examples-and-query-patterns/grouping/#post-aggregation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Aggregation can also be performed after a <code>COLLECT</code> operation using other AQL constructs,
though performance-wise this is often inferior to using <code>COLLECT</code> with <code>AGGREGATE</code>.</p><p>The same query as before can be turned into a post-aggregation query as shown below. Note
that this query will build and pass on all group values for all groups inside the variable
<em>g</em>, and perform the aggregation at the latest possible stage:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>active</span> <span class=o>==</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=kr>COLLECT</span> <span class=n>ageGroup</span> <span class=o>=</span> <span class=nf>FLOOR</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>age</span> <span class=o>/</span> <span class=mi>5</span><span class=p>)</span> <span class=o>*</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>gender</span> <span class=o>=</span> <span class=n>u</span><span class=p>.</span><span class=n>gender</span> <span class=kr>INTO</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=kr>SORT</span> <span class=n>ageGroup</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ageGroup</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>gender</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>numUsers</span><span class=o>:</span> <span class=nf>LENGTH</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=o>*</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=n>minAge</span><span class=o>:</span> <span class=nf>MIN</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=o>*</span><span class=p>].</span><span class=n>u</span><span class=p>.</span><span class=n>age</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>maxAge</span><span class=o>:</span> <span class=nf>MAX</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=o>*</span><span class=p>].</span><span class=n>u</span><span class=p>.</span><span class=n>age</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;f&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;minAge&#34;</span><span class=p>:</span> <span class=mi>36</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;maxAge&#34;</span><span class=p>:</span> <span class=mi>39</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;m&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;minAge&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;maxAge&#34;</span><span class=p>:</span> <span class=mi>39</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>This is in contrast to the previous query that used an <code>AGGREGATE</code> clause to perform
the aggregation during the collect operation, at the earliest possible stage.</p><h2 id=post-filtering-aggregated-data>Post-filtering aggregated data <a href=/3.11/aql/examples-and-query-patterns/grouping/#post-filtering-aggregated-data class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>To filter the results of a grouping or aggregation operation (i.e. something
similar to <em>HAVING</em> in SQL), simply add another <code>FILTER</code> clause after the <code>COLLECT</code>
statement.</p><p>For example, to get the 3 <em>ageGroup</em>s with the most users in them:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>active</span> <span class=o>==</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=kr>COLLECT</span> <span class=n>ageGroup</span> <span class=o>=</span> <span class=nf>FLOOR</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>age</span> <span class=o>/</span> <span class=mi>5</span><span class=p>)</span> <span class=o>*</span> <span class=mi>5</span> <span class=kr>INTO</span> <span class=n>group</span>
</span></span><span class=line><span class=cl>    <span class=kd>LET</span> <span class=n>numUsers</span> <span class=o>=</span> <span class=nf>LENGTH</span><span class=p>(</span><span class=n>group</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>numUsers</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=cm>/* group must contain at least 3 users in order to qualify */</span>
</span></span><span class=line><span class=cl>    <span class=kr>SORT</span> <span class=n>numUsers</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>    <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ageGroup&#34;</span><span class=o>:</span> <span class=n>ageGroup</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;numUsers&#34;</span><span class=o>:</span> <span class=n>numUsers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;users&#34;</span><span class=o>:</span> <span class=n>group</span><span class=p>[</span><span class=o>*</span><span class=p>].</span><span class=n>u</span><span class=p>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>30</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Abigail&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Madison&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Anthony&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Alexander&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Isabella&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Chloe&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Daniel&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Michael&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Mary&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Mariah&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Jim&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Diego&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ageGroup&#34;</span><span class=p>:</span> <span class=mi>35</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;numUsers&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Fred&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;John&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Emma&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Sophia&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>To increase readability, the repeated expression <em>LENGTH(group)</em> was put into a variable
<em>numUsers</em>. The <code>FILTER</code> on <em>numUsers</em> is the equivalent an SQL <em>HAVING</em> clause.</p><h2 id=aggregating-data-in-local-time>Aggregating data in local time <a href=/3.11/aql/examples-and-query-patterns/grouping/#aggregating-data-in-local-time class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>If you store datetimes in UTC in your collections and need to group data for
each day in your local timezone, you can use <code>DATE_UTCTOLOCAL()</code> and
<code>DATE_TRUNC()</code> to adjust for that.</p><p>Note: In the timezone <code>Europe/Berlin</code> daylight saving activated on 2020-03-29,
thus 2020-01-31T<strong>23</strong>:00:00Z is 2020-02-01 midnight in Germany and
2020-03-31T<strong>22</strong>:00:00Z is 2020-04-01 midnight in Germany.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>a</span> <span class=kr>IN</span> <span class=nv>@activities</span>
</span></span><span class=line><span class=cl><span class=kr>COLLECT</span>
</span></span><span class=line><span class=cl>  <span class=n>day</span> <span class=o>=</span> <span class=nf>DATE_TRUNC</span><span class=p>(</span><span class=nf>DATE_UTCTOLOCAL</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>startDate</span><span class=p>,</span> <span class=s1>&#39;Europe/Berlin&#39;</span><span class=p>),</span> <span class=s1>&#39;day&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>AGGREGATE</span>
</span></span><span class=line><span class=cl>  <span class=n>hours</span> <span class=o>=</span> <span class=nf>SUM</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>duration</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=n>revenue</span> <span class=o>=</span> <span class=nf>SUM</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>duration</span> <span class=o>*</span> <span class=n>a</span><span class=p>.</span><span class=n>rate</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>SORT</span> <span class=n>day</span> <span class=kr>ASC</span>
</span></span><span class=line><span class=cl><span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>day</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>hours</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>revenue</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><strong>Bind Parameters</strong><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;activities&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;duration&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;endDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-02-01T03:00:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;rate&#34;</span><span class=p>:</span> <span class=mi>250</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;startDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-01-31T23:00:00Z&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;duration&#34;</span><span class=p>:</span> <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;endDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-02-01T17:00:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;rate&#34;</span><span class=p>:</span> <span class=mi>250</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;startDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-02-01T09:00:00Z&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;duration&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;endDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-03-31T22:00:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;rate&#34;</span><span class=p>:</span> <span class=mi>250</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;startDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-03-31T21:00:00Z&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;duration&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;endDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-04-01T03:00:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;rate&#34;</span><span class=p>:</span> <span class=mi>250</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;startDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-03-31T22:00:00Z&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;duration&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;endDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-04-01T16:00:00Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;rate&#34;</span><span class=p>:</span> <span class=mi>250</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;startDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-04-01T13:00:00Z&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;day&#34;</span> <span class=o>:</span> <span class=s2>&#34;2020-02-01T00:00:00.000Z&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hours&#34;</span> <span class=o>:</span> <span class=mi>12</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;revenue&#34;</span> <span class=o>:</span> <span class=mi>3000</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;day&#34;</span> <span class=o>:</span> <span class=s2>&#34;2020-03-31T00:00:00.000Z&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hours&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;revenue&#34;</span> <span class=o>:</span> <span class=mi>250</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;day&#34;</span> <span class=o>:</span> <span class=s2>&#34;2020-04-01T00:00:00.000Z&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hours&#34;</span> <span class=o>:</span> <span class=mi>8</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;revenue&#34;</span> <span class=o>:</span> <span class=mi>2000</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div><br><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.11/aql/examples-and-query-patterns/joins/><i class="fas fa-chevron-left fa-fw"></i><p>Joins</p></a></span><span class=next><a class="nav nav-next link" href=/3.11/aql/examples-and-query-patterns/actors-and-movies-dataset-queries/><p>Actors & Movies Dataset Queries</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.11/aql/examples-and-query-patterns/grouping.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#ensuring-uniqueness>Ensuring uniqueness</a></div><div class=level-2><a href=#fetching-group-values>Fetching group values</a></div><div class=level-2><a href=#variable-expansion>Variable Expansion</a></div><div class=level-2><a href=#grouping-by-multiple-criteria>Grouping by multiple criteria</a></div><div class=level-2><a href=#counting-group-values>Counting group values</a></div><div class=level-2><a href=#aggregation>Aggregation</a></div><div class=level-2><a href=#post-aggregation>Post-aggregation</a></div><div class=level-2><a href=#post-filtering-aggregated-data>Post-filtering aggregated data</a></div><div class=level-2><a href=#aggregating-data-in-local-time>Aggregating data in local time</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>