<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743774193></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="You can query Views and return the most relevant results first based on their ranking score"><meta property="og:url" content="http://localhost/3.11/index-and-search/arangosearch/ranking/"><meta property="og:title" content="Ranking View Query Results"><meta property="og:type" content="website"><meta property="og:description" content="You can query Views and return the most relevant results first based on their ranking score"><meta name=docsearch:version content="3.11"><title>Ranking View Query Results | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743774193 defer></script>
<script src=/js/featherlight.min.js?1743774193 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743774193 defer></script>
<script src=/js/theme.js?1743774193 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.11"><a itemprop=item class=link href=/3.11/><span itemprop=name class=breadcrumb-entry>3.11.13</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Index and Search"><a itemprop=item class=link href=/3.11/index-and-search/><span itemprop=name class=breadcrumb-entry>Index and Search</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="ArangoSearch"><a itemprop=item class=link href=/3.11/index-and-search/arangosearch/><span itemprop=name class=breadcrumb-entry>ArangoSearch</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Ranking"><a itemprop=item class=link href=/3.11/index-and-search/arangosearch/ranking/><span itemprop=name class=breadcrumb-entry>Ranking</span></a></li></ol></nav><article class=default><hgroup><h1>Ranking View Query Results</h1><p class=lead>You can query Views and return the most relevant results first based on their ranking score</p></hgroup><p>ArangoSearch supports the two most popular ranking schemes:</p><ul><li><a href=https://en.wikipedia.org/wiki/Okapi_BM25 target=_blank rel="noopener noreferrer" class=link>Okapi BM25</a>&nbsp;<i class="fas fa-external-link-alt"></i></li><li><a href=https://en.wikipedia.org/wiki/Tf%E2%80%93idf target=_blank rel="noopener noreferrer" class=link>TF-IDF</a>&nbsp;<i class="fas fa-external-link-alt"></i></li></ul><p>Under the hood, both models rely on two main components:</p><ul><li><strong>Term frequency</strong> (TF):
in the simplest case defined as the number of times a term occurs in a document</li><li><strong>Inverse document frequency</strong> (IDF):
a measure of how relevant a term is, i.e. whether the word is common or rare
across all documents</li></ul><p>See <em>Ranking in ArangoSearch</em> in the
<a href="https://www.arangodb.com/learn/search/tutorial/#:~:text=Ranking%20in%20ArangoSearch" target=_blank rel="noopener noreferrer" class=link>ArangoSearch Tutorial</a>&nbsp;<i class="fas fa-external-link-alt"></i>
to learn more about the ranking model.</p><h2 id=basic-ranking>Basic Ranking <a href=/3.11/index-and-search/arangosearch/ranking/#basic-ranking class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>To sort View results from most relevant to least relevant, use a
<a href=/3.11/aql/high-level-operations/sort/ class=link>SORT operation</a> with a call to a
<a href=/3.11/aql/functions/arangosearch/#scoring-functions class=link>Scoring function</a> as
expression and set the order to descending. Scoring functions expect the
document emitted by a <code>FOR … IN</code> loop that iterates over a View as first
argument.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=err>…</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>You can also return the ranking score as part of the result.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=err>…</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=nf>MERGE</span><span class=p>(</span><span class=n>doc</span><span class=p>,</span> <span class=p>{</span> <span class=n>bm25</span><span class=o>:</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>),</span> <span class=n>tfidf</span><span class=o>:</span> <span class=nf>TFIDF</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=p>})</span></span></span></code></pre></div><p>Scoring functions cannot be used outside of <code>SEARCH</code> operations, as the scores
can only be computed in the context of a View, especially because of the
inverse document frequency (IDF).</p><h3 id=dataset>Dataset <a href=/3.11/index-and-search/arangosearch/ranking/#dataset class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><a href=/3.11/index-and-search/arangosearch/example-datasets/#imdb-movie-dataset class=link>IMDB movie dataset</a></p><h3 id=view-definition>View definition <a href=/3.11/index-and-search/arangosearch/ranking/#view-definition class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>imdb_vertices</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;inv-text&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;inverted&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;description&#34;</span><span class=p>,</span> <span class=nx>analyzer</span><span class=o>:</span> <span class=s2>&#34;text_en&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_createView</span><span class=p>(</span><span class=s2>&#34;imdb_alias&#34;</span><span class=p>,</span> <span class=s2>&#34;search-alias&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>indexes</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>collection</span><span class=o>:</span> <span class=s2>&#34;imdb_vertices&#34;</span><span class=p>,</span> <span class=nx>index</span><span class=o>:</span> <span class=s2>&#34;inv-text&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span> <span class=p>});</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;links&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;imdb_vertices&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;analyzers&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;text_en&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div></div></div><h3 id=aql-queries>AQL queries <a href=/3.11/index-and-search/arangosearch/ranking/#aql-queries class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Search for movies with certain keywords in their description and rank the
results using the <a href=/3.11/aql/functions/arangosearch/#bm25 class=link><code>BM25()</code> function</a>:</p><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb_alias</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;amazing action world alien sci-fi science documental galaxy&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span><span class=o>:</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;amazing action world alien sci-fi science documental galaxy&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span><span class=o>:</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div></div></div><table><thead><tr><th style=text-align:left>title</th><th style=text-align:left>description</th><th style=text-align:left>score</th></tr></thead><tbody><tr><td style=text-align:left>AVPR: Aliens vs. Predator - Requiem</td><td style=text-align:left>Prepare for more mayhem as warring <strong>aliens</strong> and predators return … spectacular <strong>action</strong> sequences …</td><td style=text-align:left>35.85710525512695</td></tr><tr><td style=text-align:left>Moon 44</td><td style=text-align:left>… battle a familiar foe and an <strong>alien</strong> enemy. … <strong>sci-fi</strong> thriller from <strong>action</strong> director Roland Emmerich …</td><td style=text-align:left>35.85523223876953</td></tr><tr><td style=text-align:left>Dark Star</td><td style=text-align:left>A low-budget, <strong>sci-fi</strong> satire … battle their <strong>alien</strong> mascot …</td><td style=text-align:left>28.655567169189453</td></tr><tr><td style=text-align:left>Starship Troopers 2: Hero of the Federation</td><td style=text-align:left>In the sequel to Paul Verhoeven&rsquo;s loved/reviled <strong>sci-fi</strong> film … fighting <strong>alien</strong> bugs…</td><td style=text-align:left>28.635963439941406</td></tr><tr><td style=text-align:left>Push</td><td style=text-align:left>The <strong>action</strong> packed <strong>sci-fi</strong> thriller involves a group of young American ex-pats…</td><td style=text-align:left>28.131816864013672</td></tr><tr><td style=text-align:left>Casshern</td><td style=text-align:left>Live-action sci-fi movie based on a 1973 Japanese animé of the same name.</td><td style=text-align:left>28.070863723754883</td></tr><tr><td style=text-align:left>Puzzlehead</td><td style=text-align:left>In a post apocalyptic <strong>world</strong> where technology is outlawed, … The resulting <strong>Sci-Fi</strong> love triangle is a Frankensteinian fable …</td><td style=text-align:left>25.57171630859375</td></tr><tr><td style=text-align:left>Cesta do pravěku</td><td style=text-align:left>Most classical <strong>sci-fi</strong> from K. Zeman. … a wondrous prehistoric <strong>world</strong> …</td><td style=text-align:left>25.57117462158203</td></tr><tr><td style=text-align:left>Interstella 5555: The 5tory of the 5ecret 5tar 5ystem</td><td style=text-align:left>A <strong>sci-fi</strong> japanimation House-musical movie … themes of <strong>sci-fi</strong> celebrity …</td><td style=text-align:left>22.481136322021484</td></tr><tr><td style=text-align:left>Alien Planet</td><td style=text-align:left>The dynamic meeting of solid <strong>science</strong> … <strong>Alien</strong> Planet creates a realistic depiction of creatures on another <strong>world</strong>, …</td><td style=text-align:left>21.493724822998047</td></tr></tbody></table><p>Do the same but with the <a href=/3.11/aql/functions/arangosearch/#tfidf class=link><code>TFIDF()</code> function</a>:</p><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb_alias</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;amazing action world alien sci-fi science documental galaxy&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>TFIDF</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span><span class=o>:</span> <span class=nf>TFIDF</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;amazing action world alien sci-fi science documental galaxy&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>TFIDF</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span><span class=o>:</span> <span class=nf>TFIDF</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div></div></div><table><thead><tr><th style=text-align:left>title</th><th style=text-align:left>description</th><th style=text-align:left>score</th></tr></thead><tbody><tr><td style=text-align:left>AVPR: Aliens vs. Predator - Requiem</td><td style=text-align:left>Prepare for more mayhem as warring <strong>aliens</strong> and predators return … spectacular <strong>action</strong> sequences …</td><td style=text-align:left>25.193025588989258</td></tr><tr><td style=text-align:left>Moon 44</td><td style=text-align:left>… battle a familiar foe and an <strong>alien</strong> enemy. … <strong>sci-fi</strong> thriller from <strong>action</strong> director Roland Emmerich …</td><td style=text-align:left>25.193025588989258</td></tr><tr><td style=text-align:left>Interstella 5555: The 5tory of the 5ecret 5tar 5ystem</td><td style=text-align:left>A <strong>sci-fi</strong> japanimation House-musical movie … themes of <strong>sci-fi</strong> celebrity …</td><td style=text-align:left>20.324928283691406</td></tr><tr><td style=text-align:left>Dark Star</td><td style=text-align:left>A low-budget, <strong>sci-fi</strong> satire … battle their <strong>alien</strong> mascot …</td><td style=text-align:left>19.935544967651367</td></tr><tr><td style=text-align:left>Starship Troopers 2: Hero of the Federation</td><td style=text-align:left>In the sequel to Paul Verhoeven&rsquo;s loved/reviled <strong>sci-fi</strong> film … fighting <strong>alien</strong> bugs…</td><td style=text-align:left>19.935544967651367</td></tr><tr><td style=text-align:left>Casshern</td><td style=text-align:left>Live-action sci-fi movie based on a 1973 Japanese animé of the same name.</td><td style=text-align:left>19.629377365112305</td></tr><tr><td style=text-align:left>Push</td><td style=text-align:left>The <strong>action</strong> packed <strong>sci-fi</strong> thriller involves a group of young American ex-pats…</td><td style=text-align:left>19.629377365112305</td></tr><tr><td style=text-align:left>Puzzlehead</td><td style=text-align:left>In a post apocalyptic <strong>world</strong> where technology is outlawed, … The resulting <strong>Sci-Fi</strong> love triangle is a Frankensteinian fable …</td><td style=text-align:left>18.10955047607422</td></tr><tr><td style=text-align:left>Cesta do pravěku</td><td style=text-align:left>Most classical <strong>sci-fi</strong> from K. Zeman. … a wondrous prehistoric <strong>world</strong> …</td><td style=text-align:left>18.10955047607422</td></tr><tr><td style=text-align:left>The Day the Earth Stood Still</td><td style=text-align:left>An <strong>alien</strong> and a robot land on earth after <strong>World</strong> War II … A classic <strong>science</strong> fiction film …</td><td style=text-align:left>15.719740867614746</td></tr></tbody></table><h2 id=stable-pagination-for-results>Stable pagination for results <a href=/3.11/index-and-search/arangosearch/ranking/#stable-pagination-for-results class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The <code>SORT</code> operation does not guarantee a stable sort if there is no unique value
to sort by. This leads to an undefined order when sorting equal documents.</p><p>If you run a query multiple times with varying <code>LIMIT</code> offsets for pagination,
you can miss results or get duplicate results if the sort order is undefined.
To achieve stable pagination, you must meet the following requirements:</p><ul><li>The dataset should not change between query runs.</li><li>The <code>SORT</code> operation must have at least one field with a unique value to sort by.</li></ul><p>When stable sort is required, you can use a tiebreaker field. If the application
has a preferred field that indicates the order of documents with the same score,
then this field should be used in the <code>SORT</code> operation as a tiebreaker. If there
is no such field, you can use the <code>_id</code> system attribute as it is unique and
present in every document.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=c1>// sort by score and break ties using the unique document identifiers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>_id</span></span></span></code></pre></div><p><strong>Example</strong></p><p>You can use the <a href=/3.11/index-and-search/arangosearch/example-datasets/#imdb-movie-dataset class=link>IMDB movie dataset</a>
and create a <a href=/3.11/index-and-search/arangosearch/full-text-token-search/#view-definition class=link>View</a> for
the <code>imdb_vertices</code> collection and call it <code>imdb</code>. Index the <code>description</code>
attribute with the built-in <code>text-en</code> Analyzer. Then, you can run the following
query to find movies that contain the token <code>ninja</code> in the description, sorted
by best matching according to the Okapi BM25 scoring scheme:</p><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb_alias</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;ninja&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=n>score</span> <span class=p>}</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;ninja&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=n>score</span> <span class=p>}</span></span></span></code></pre></div></div></div></div><p>Note the 5th and 6th result, which both have the same score of <code>6.30634880065918</code>:</p><table><thead><tr><th style=text-align:left>title</th><th style=text-align:left>score</th></tr></thead><tbody><tr><td style=text-align:left>Red Shadow: Akakage</td><td style=text-align:left>8.882122039794922</td></tr><tr><td style=text-align:left>Beverly Hills Ninja</td><td style=text-align:left>7.128915786743164</td></tr><tr><td style=text-align:left>Naruto the Movie: Ninja Clash in the Land of Snow</td><td style=text-align:left>7.041049957275391</td></tr><tr><td style=text-align:left>TMNT</td><td style=text-align:left>7.002012729644775</td></tr><tr><td style=text-align:left>Teenage Mutant Ninja Turtles II: The Secret of the Ooze</td><td style=text-align:left><strong>6.30634880065918</strong></td></tr><tr><td style=text-align:left>Batman Begins</td><td style=text-align:left><strong>6.30634880065918</strong></td></tr><tr><td style=text-align:left>&mldr;</td><td style=text-align:left>&mldr;</td></tr></tbody></table><p>If you add a <code>LIMIT</code> operation for pagination and fetch the first 5 results,
you may get the <strong>Batman movie</strong> as the 5th result:</p><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb_alias</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;ninja&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=n>score</span> <span class=p>}</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;ninja&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=n>score</span> <span class=p>}</span></span></span></code></pre></div></div></div></div><table><thead><tr><th style=text-align:left>title</th><th style=text-align:left>score</th></tr></thead><tbody><tr><td style=text-align:left>Red Shadow: Akakage</td><td style=text-align:left>8.882122039794922</td></tr><tr><td style=text-align:left>Beverly Hills Ninja</td><td style=text-align:left>7.128915786743164</td></tr><tr><td style=text-align:left>Naruto the Movie: Ninja Clash in the Land of Snow</td><td style=text-align:left>7.041049957275391</td></tr><tr><td style=text-align:left>TMNT</td><td style=text-align:left>7.002012729644775</td></tr><tr><td style=text-align:left><strong>Batman Begins</strong></td><td style=text-align:left>6.30634880065918</td></tr></tbody></table><p>If you change the query to <code>LIMIT 5, 5</code> to get the second batch of results, then
you may see the <strong>Batman movie again</strong> (as the 6th result overall) instead of
the <strong>Ninja Turtles movie</strong>:</p><table><thead><tr><th style=text-align:left>title</th><th style=text-align:left>score</th></tr></thead><tbody><tr><td style=text-align:left><strong>Batman Begins</strong></td><td style=text-align:left>6.30634880065918</td></tr><tr><td style=text-align:left>Shogun Assassin</td><td style=text-align:left>5.8539886474609375</td></tr><tr><td style=text-align:left>Scooby-Doo and the Samurai Sword</td><td style=text-align:left>5.736422538757324</td></tr><tr><td style=text-align:left>Revenge of the Ninja</td><td style=text-align:left>5.212964057922363</td></tr><tr><td style=text-align:left>Winners & Sinners 2: My Lucky Stars</td><td style=text-align:left>5.165824890136719</td></tr></tbody></table><p>The problem is the undefined order of results with the same score. There is no
guarantee whether the Batman or the Ninja Turtle movie comes first, and as a
result, both batches may include the same movie and miss the other entirely.
As the order is undefined, you can randomly encounter this problem, even if it
seems to work at first, because it may work some of the time.</p><p>To establish a stable order, you change the query to <code>SORT score DESC, doc._id</code>.
This still ranks movies by the score, but matches with the same score are
consistently sorted by the document identifier to break ties. This guarantees
that either the Batman or the Ninja Turtles movie is included in the first batch
and the other movie in the second batch.</p><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb_alias</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;ninja&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>_id</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>5</span>  <span class=c1>// first batch
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=n>score</span> <span class=p>}</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;ninja&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>_id</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>5</span>  <span class=c1>// first batch
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=n>score</span> <span class=p>}</span></span></span></code></pre></div></div></div></div><table><thead><tr><th style=text-align:left>title</th><th style=text-align:left>score</th></tr></thead><tbody><tr><td style=text-align:left>Red Shadow: Akakage</td><td style=text-align:left>8.882122039794922</td></tr><tr><td style=text-align:left>Beverly Hills Ninja</td><td style=text-align:left>7.128915786743164</td></tr><tr><td style=text-align:left>Naruto the Movie: Ninja Clash in the Land of Snow</td><td style=text-align:left>7.041049957275391</td></tr><tr><td style=text-align:left>TMNT</td><td style=text-align:left>7.002012729644775</td></tr><tr><td style=text-align:left><strong>Teenage Mutant Ninja Turtles II: The Secret of the Ooze</strong></td><td style=text-align:left>6.30634880065918</td></tr></tbody></table><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb_alias</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;ninja&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>_id</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>5</span>  <span class=c1>// second batch
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=n>score</span> <span class=p>}</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;ninja&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>_id</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>5</span>  <span class=c1>// second batch
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=n>score</span> <span class=p>}</span></span></span></code></pre></div></div></div></div><table><thead><tr><th style=text-align:left>title</th><th style=text-align:left>score</th></tr></thead><tbody><tr><td style=text-align:left><strong>Batman Begins</strong></td><td style=text-align:left>6.30634880065918</td></tr><tr><td style=text-align:left>Shogun Assassin</td><td style=text-align:left>5.8539886474609375</td></tr><tr><td style=text-align:left>Scooby-Doo and the Samurai Sword</td><td style=text-align:left>5.736422538757324</td></tr><tr><td style=text-align:left>Revenge of the Ninja</td><td style=text-align:left>5.212964057922363</td></tr><tr><td style=text-align:left>Winners & Sinners 2: My Lucky Stars</td><td style=text-align:left>5.165824890136719</td></tr></tbody></table><h2 id=query-time-relevance-tuning>Query Time Relevance Tuning <a href=/3.11/index-and-search/arangosearch/ranking/#query-time-relevance-tuning class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>You can fine-tune the scores computed by the Okapi BM25 and TF-IDF relevance
models at query time via the <code>BOOST()</code> AQL function and also calculate a custom
score. In addition, the <code>BM25()</code> function lets you adjust the coefficients at
query time.</p><p>The <code>BOOST()</code> function is similar to the <code>ANALYZER()</code> function in that it
accepts any valid <code>SEARCH</code> expression as first argument. You can set the boost
factor for that sub-expression via the second parameter. Documents that match
boosted parts of the search expression will get higher scores.</p><h3 id=dataset-1>Dataset <a href=/3.11/index-and-search/arangosearch/ranking/#dataset-1 class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><a href=/3.11/index-and-search/arangosearch/example-datasets/#imdb-movie-dataset class=link>IMDB movie dataset</a></p><h3 id=view-definition-1>View definition <a href=/3.11/index-and-search/arangosearch/ranking/#view-definition-1 class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>imdb_vertices</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;inv-text&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;inverted&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;description&#34;</span><span class=p>,</span> <span class=nx>analyzer</span><span class=o>:</span> <span class=s2>&#34;text_en&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_createView</span><span class=p>(</span><span class=s2>&#34;imdb_alias&#34;</span><span class=p>,</span> <span class=s2>&#34;search-alias&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>indexes</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>collection</span><span class=o>:</span> <span class=s2>&#34;imdb_vertices&#34;</span><span class=p>,</span> <span class=nx>index</span><span class=o>:</span> <span class=s2>&#34;inv-text&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span> <span class=p>});</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;links&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;imdb_vertices&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;analyzers&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;text_en&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div></div></div><h3 id=aql-queries-1>AQL queries <a href=/3.11/index-and-search/arangosearch/ranking/#aql-queries-1 class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Prefer <code>galaxy</code> over the other keywords:</p><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb_alias</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;amazing action world alien sci-fi science documental&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=kr>OR</span> <span class=nf>BOOST</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;galaxy&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span><span class=o>:</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;amazing action world alien sci-fi science documental&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=kr>OR</span> <span class=nf>BOOST</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;galaxy&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=mi>5</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span><span class=o>:</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div></div></div><table><thead><tr><th style=text-align:left>title</th><th style=text-align:left>description</th><th style=text-align:left>score</th></tr></thead><tbody><tr><td style=text-align:left>Star Trek Collection</td><td style=text-align:left>Star Trek a futuristic <strong>science</strong> fiction franchise. … <strong>galaxies</strong> to explore, and cool skin tight suits to beam up in …</td><td style=text-align:left>64.87849426269531</td></tr><tr><td style=text-align:left>Alien Tracker</td><td style=text-align:left>In a <strong>galaxy</strong> far away, <strong>alien</strong> criminals organize a spectacular prison break. … Cole is the <strong>Alien</strong> Tracker …</td><td style=text-align:left>63.959991455078125</td></tr><tr><td style=text-align:left>Stitch! The Movie</td><td style=text-align:left>… the <strong>galaxy&rsquo;s</strong> most wanted extraterrestrial … Dr. Jumba brought one of his <strong>alien</strong> &ldquo;experiments&rdquo; to Hawaii.</td><td style=text-align:left>63.39030075073242</td></tr><tr><td style=text-align:left>The Hitchhiker&rsquo;s Guide to the Galaxy</td><td style=text-align:left>Mere seconds before the Earth is to be demolished by an <strong>alien</strong> construction crew … a new edition of &ldquo;The Hitchhiker&rsquo;s Guide to the <strong>Galaxy</strong>.&rdquo;</td><td style=text-align:left>63.37282943725586</td></tr><tr><td style=text-align:left>Stargate: The Ark of Truth</td><td style=text-align:left>… it may be in the Ori&rsquo;s own home <strong>galaxy</strong>. … SG-1 travels to the Ori <strong>galaxy</strong> … in a distant <strong>galaxy</strong> fighting two powerful enemies.</td><td style=text-align:left>61.784141540527344</td></tr><tr><td style=text-align:left>The Ice Pirates</td><td style=text-align:left>… the most precious commodity in the <strong>galaxy</strong> is water. … unreachable centre of the <strong>galaxy</strong> … The <strong>galaxy</strong> is ruled by an evil emperor …</td><td style=text-align:left>61.78216552734375</td></tr><tr><td style=text-align:left>Star Wars: Episode III: Revenge of the Sith</td><td style=text-align:left>… leading a massive clone army into a <strong>galaxy</strong>-wide battle against the Separatists. … to rule the <strong>galaxy</strong>, the Republic crumbles …</td><td style=text-align:left>59.79429244995117</td></tr><tr><td style=text-align:left>Star Wars: Episode II - Attack of the Clones</td><td style=text-align:left>… not only has the <strong>galaxy</strong> undergone significant change, but so have Obi-Wan Kenobi, Padmé Amidala, and Anakin Skywalker …</td><td style=text-align:left>55.723636627197266</td></tr><tr><td style=text-align:left>Macross Plus</td><td style=text-align:left>… a new aircraft (Shinsei Industries&rsquo; YF-19 & General <strong>Galaxy&rsquo;s</strong> YF-21) for Project Super Nova, to choose the newest successor to the VF-11</td><td style=text-align:left>55.722259521484375</td></tr><tr><td style=text-align:left>Star Trek</td><td style=text-align:left>The fate of the <strong>galaxy</strong> rests in the hands of bitter rivals. One, James Kirk, is a delinquent, thrill-seeking Iowa farm boy. The other, Spock, a Vulcan, …</td><td style=text-align:left>55.717037200927734</td></tr></tbody></table><p>If you are an information retrieval expert and want to fine-tuning the
weighting schemes at query time, then you can do so. The <code>BM25()</code> function
accepts free coefficients as parameters to turn it into BM15 for instance:</p><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb_alias</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;amazing action world alien sci-fi science documental&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=kr>OR</span> <span class=nf>BOOST</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;galaxy&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>,</span> <span class=mf>1.2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;amazing action world alien sci-fi science documental&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=kr>OR</span> <span class=nf>BOOST</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>description</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;galaxy&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=mi>5</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>,</span> <span class=mf>1.2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>description</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div></div></div><table><thead><tr><th style=text-align:left>title</th><th style=text-align:left>description</th><th style=text-align:left>score</th></tr></thead><tbody><tr><td style=text-align:left>Stargate: The Ark of Truth</td><td style=text-align:left>… it may be in the Ori&rsquo;s own home <strong>galaxy</strong>. … SG-1 travels to the Ori <strong>galaxy</strong> … in a distant <strong>galaxy</strong> fighting two powerful enemies.</td><td style=text-align:left>42.88237380981445</td></tr><tr><td style=text-align:left>The Ice Pirates</td><td style=text-align:left>… the most precious commodity in the <strong>galaxy</strong> is water. … unreachable centre of the <strong>galaxy</strong> … The <strong>galaxy</strong> is ruled by an evil emperor …</td><td style=text-align:left>42.88237380981445</td></tr><tr><td style=text-align:left>Star Wars: Episode III: Revenge of the Sith</td><td style=text-align:left>… leading a massive clone army into a <strong>galaxy</strong>-wide battle against the Separatists. … to rule the <strong>galaxy</strong>, the Republic crumbles …</td><td style=text-align:left>39.27024841308594</td></tr><tr><td style=text-align:left>Alien Tracker</td><td style=text-align:left>In a <strong>galaxy</strong> far away, <strong>alien</strong> criminals organize a spectacular prison break. … Cole is the <strong>Alien</strong> Tracker …</td><td style=text-align:left>38.43224334716797</td></tr><tr><td style=text-align:left>Star Trek Collection</td><td style=text-align:left>Star Trek a futuristic <strong>science</strong> fiction franchise. … <strong>galaxies</strong> to explore, and cool skin tight suits to beam up in …</td><td style=text-align:left>38.42367935180664</td></tr><tr><td style=text-align:left>Stitch! The Movie</td><td style=text-align:left>… the <strong>galaxy&rsquo;s</strong> most wanted extraterrestrial … Dr. Jumba brought one of his <strong>alien</strong> &ldquo;experiments&rdquo; to Hawaii.</td><td style=text-align:left>37.563819885253906</td></tr><tr><td style=text-align:left>The Hitchhiker&rsquo;s Guide to the Galaxy</td><td style=text-align:left>Mere seconds before the Earth is to be demolished by an <strong>alien</strong> construction crew … a new edition of &ldquo;The Hitchhiker&rsquo;s Guide to the <strong>Galaxy</strong>.&rdquo;</td><td style=text-align:left>37.563819885253906</td></tr><tr><td style=text-align:left>Critters 4</td><td style=text-align:left>… he gets a message that it would be illegal to extinguish the race from the <strong>galaxy</strong>. …</td><td style=text-align:left>32.99643325805664</td></tr><tr><td style=text-align:left>Alien Agent</td><td style=text-align:left>A lawman from another <strong>galaxy</strong> must stop an invading force from building a gateway to planet Earth.</td><td style=text-align:left>32.99643325805664</td></tr><tr><td style=text-align:left>Star Trek</td><td style=text-align:left>The fate of the <strong>galaxy</strong> rests in the hands of bitter rivals. One, James Kirk, is a delinquent, thrill-seeking Iowa farm boy. The other, Spock, a Vulcan, …</td><td style=text-align:left>32.99643325805664</td></tr></tbody></table><p>You can also calculate a custom score, taking into account additional fields
of the document.</p><p>Match movies with the (normalized) phrase <code>star war</code> in the title and calculate
a custom score based on BM25 and the movie runtime to favor longer movies:</p><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb_alias</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=s2>&#34;Star Wars&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=o>*</span> <span class=nf>LOG</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>runtime</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>runtime</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>runtime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bm25</span><span class=o>:</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>imdb</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=s2>&#34;Star Wars&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=o>*</span> <span class=nf>LOG</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>runtime</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>runtime</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>runtime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bm25</span><span class=o>:</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div></div></div><table><thead><tr><th style=text-align:left>title</th><th style=text-align:left>runtime</th><th style=text-align:left>bm25</th><th style=text-align:left>score</th></tr></thead><tbody><tr><td style=text-align:left><strong>Star Wars</strong>: Episode II - Attack of the Clones</td><td style=text-align:left>142</td><td style=text-align:left>16.900253295898438</td><td style=text-align:left>83.87333131958185</td></tr><tr><td style=text-align:left><strong>Star Wars</strong>: Episode III: Revenge of the Sith</td><td style=text-align:left>140</td><td style=text-align:left>16.900253295898438</td><td style=text-align:left>83.63529564797363</td></tr><tr><td style=text-align:left><strong>Star Wars</strong>: Episode VI - Return of the Jedi</td><td style=text-align:left>135</td><td style=text-align:left>16.900253295898438</td><td style=text-align:left>83.02511192427228</td></tr><tr><td style=text-align:left><strong>Star Wars</strong>: Episode I - The Phantom Menace</td><td style=text-align:left>133</td><td style=text-align:left>16.81275749206543</td><td style=text-align:left>82.34619279156092</td></tr><tr><td style=text-align:left><strong>Star Wars</strong>: Episode V: The Empire Strikes Back</td><td style=text-align:left>124</td><td style=text-align:left>16.900253295898438</td><td style=text-align:left>81.59972515247492</td></tr><tr><td style=text-align:left><strong>Star Wars</strong>: Episode IV - A New Hope</td><td style=text-align:left>121</td><td style=text-align:left>16.81275749206543</td><td style=text-align:left>80.76884081187906</td></tr><tr><td style=text-align:left>The <strong>Star Wars</strong> Holiday Special</td><td style=text-align:left>97</td><td style=text-align:left>16.569408416748047</td><td style=text-align:left>75.97019873160025</td></tr><tr><td style=text-align:left><strong>Star Wars</strong>: The Clone Wars</td><td style=text-align:left>90</td><td style=text-align:left>16.569408416748047</td><td style=text-align:left>74.74227347404823</td></tr><tr><td style=text-align:left><strong>Star Wars</strong>: Revelations</td><td style=text-align:left>47</td><td style=text-align:left>16.13064956665039</td><td style=text-align:left>62.44498690901793</td></tr><tr><td style=text-align:left><strong>Star Wars</strong> Collection</td><td style=text-align:left>null</td><td style=text-align:left>16.13064956665039</td><td style=text-align:left>0</td></tr></tbody></table><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.11/index-and-search/arangosearch/nested-search/><i class="fas fa-chevron-left fa-fw"></i><p>Nested search</p></a></span><span class=next><a class="nav nav-next link" href=/3.11/index-and-search/arangosearch/performance/><p>Performance</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.11/index-and-search/arangosearch/ranking.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#basic-ranking>Basic Ranking</a></div><div class=level-3><a href=#dataset>Dataset</a></div><div class=level-3><a href=#view-definition>View definition</a></div><div class=level-3><a href=#aql-queries>AQL queries</a></div><div class=level-2><a href=#stable-pagination-for-results>Stable pagination for results</a></div><div class=level-2><a href=#query-time-relevance-tuning>Query Time Relevance Tuning</a></div><div class=level-3><a href=#dataset-1>Dataset</a></div><div class=level-3><a href=#view-definition-1>View definition</a></div><div class=level-3><a href=#aql-queries-1>AQL queries</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>