<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743774193></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="You can search for nested objects in arrays that satisfy multiple conditions each, and define how often these conditions should be fulfilled for the entire array"><meta property="og:url" content="http://localhost/3.12/index-and-search/arangosearch/nested-search/"><meta property="og:title" content="Nested search with ArangoSearch"><meta property="og:type" content="website"><meta property="og:description" content="You can search for nested objects in arrays that satisfy multiple conditions each, and define how often these conditions should be fulfilled for the entire array"><meta name=docsearch:version content="3.12"><title>Nested search with ArangoSearch | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743774193 defer></script>
<script src=/js/featherlight.min.js?1743774193 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743774193 defer></script>
<script src=/js/theme.js?1743774193 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.12"><a itemprop=item class=link href=/3.12/><span itemprop=name class=breadcrumb-entry>3.12.4</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Index and Search"><a itemprop=item class=link href=/3.12/index-and-search/><span itemprop=name class=breadcrumb-entry>Index and Search</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="ArangoSearch"><a itemprop=item class=link href=/3.12/index-and-search/arangosearch/><span itemprop=name class=breadcrumb-entry>ArangoSearch</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Nested search"><a itemprop=item class=link href=/3.12/index-and-search/arangosearch/nested-search/><span itemprop=name class=breadcrumb-entry>Nested search</span></a></li></ol></nav><article class=default><hgroup><h1>Nested search with ArangoSearch</h1><p class=lead>You can search for nested objects in arrays that satisfy multiple conditions each, and define how often these conditions should be fulfilled for the entire array</p></hgroup><p class=labels><span class=label>ArangoDB Enterprise Edition</span>
<span class=label>ArangoGraph</span></p><p>By default, <code>arangosearch</code> Views index arrays as if the parent attribute had
multiple values at once. This is also supported for <code>search-alias</code> Views by enabling
the <code>searchField</code> option. With <code>trackListPositions</code> set to <code>true</code>, every array
element is indexed individually and can be queried separately using the
respective array index. With the nested search feature, you get another
option for indexing arrays, in particular nested objects in arrays.</p><p>You can let the View index the sub-objects in a way that lets you query for
co-occurring values. For example, you can search the sub-objects and all the
conditions need to be met by a single sub-object instead of across all of them.</p><h2 id=using-nested-search>Using nested search <a href=/3.12/index-and-search/arangosearch/nested-search/#using-nested-search class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Consider the following document:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dimensions&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;height&#34;</span><span class=p>,</span> <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>35</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;width&#34;</span><span class=p>,</span> <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>60</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><p>You would normally index the <code>dimensions.type</code> and <code>dimensions.value</code> fields and
with an inverted index and then use it via a <code>search-alias</code> View, in arangosh:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=o>&lt;</span><span class=nx>collection</span><span class=o>&gt;</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;inv-idx&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;inverted&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>searchField</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;dimensions.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;dimensions.value&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_createView</span><span class=p>(</span><span class=s2>&#34;viewName&#34;</span><span class=p>,</span> <span class=s2>&#34;search-alias&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>indexes</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>collection</span><span class=o>:</span> <span class=s2>&#34;&lt;collection&gt;&#34;</span><span class=p>,</span> <span class=nx>index</span><span class=o>:</span> <span class=s2>&#34;inv-idx&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]});</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><p>You would normally index the <code>dimensions</code> field and its sub-fields with an
<code>arangosearch</code> View definition like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;links&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;&lt;collection&gt;&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;dimensions&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div></div></div><p>You might then write a query like the following to find documents where the
height is greater than 40:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>dimensions</span><span class=p>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;height&#34;</span> <span class=kr>AND</span> <span class=n>doc</span><span class=p>.</span><span class=n>dimensions</span><span class=p>.</span><span class=n>value</span> <span class=o>&gt;</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>This query matches the above document despite the height only being 35. The reason is
that each condition is true for at least one of the nested objects. There is no
check whether both conditions are true for the same object, however. You could
add a <code>FILTER</code> statement to remove false-positive matches from the search
results, but it is cumbersome to check the conditions again, for every sub-object:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>dimensions</span><span class=p>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;height&#34;</span> <span class=kr>AND</span> <span class=n>doc</span><span class=p>.</span><span class=n>dimensions</span><span class=p>.</span><span class=n>value</span> <span class=o>&gt;</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>LENGTH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>dimensions</span><span class=p>[</span><span class=o>*</span> <span class=kr>FILTER</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;height&#34;</span> <span class=kr>AND</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>value</span> <span class=o>&gt;</span> <span class=mi>40</span><span class=p>])</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>The nested search feature allows you to condense the query while utilizing the
View index:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>dimensions</span><span class=p>[</span><span class=o>?</span> <span class=kr>FILTER</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;height&#34;</span> <span class=kr>AND</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>value</span> <span class=o>&gt;</span> <span class=mi>40</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><p>The required inverted index definition for using a <code>search-alias</code> View
to perform nested searches needs to index the parent <code>dimensions</code> field, as well
as the nested attributes using the <code>nested</code> property under the <code>fields</code> property:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=o>&lt;</span><span class=nx>collection</span><span class=o>&gt;</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;inv-nest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;inverted&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;dimensions&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>nested</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;type&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;value&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_createView</span><span class=p>(</span><span class=s2>&#34;viewName&#34;</span><span class=p>,</span> <span class=s2>&#34;search-alias&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>indexes</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>collection</span><span class=o>:</span> <span class=s2>&#34;&lt;collection&gt;&#34;</span><span class=p>,</span> <span class=nx>index</span><span class=o>:</span> <span class=s2>&#34;inv-nest&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]});</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><p>The required <code>arangosearch</code> View definition for this to work is as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;links&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;&lt;collection&gt;&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;dimensions&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;nested&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Note the usage of a <code>nested</code> property instead of a <code>fields</code> property.</p></div></div></div><p>This configures the View to index the objects in the <code>dimensions</code> array so that
you can use the <a href=/3.12/aql/operators/#question-mark-operator class=link>Question mark operator</a>
to query the nested objects. The default <code>identity</code> Analyzer is used for the
fields because none is specified explicitly.</p><h2 id=defining-how-often-the-conditions-need-to-be-true>Defining how often the conditions need to be true <a href=/3.12/index-and-search/arangosearch/nested-search/#defining-how-often-the-conditions-need-to-be-true class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>You can optionally specify a quantifier to define how often the conditions need
to be true for the entire array. The following query matches documents that have
one or two nested objects with a height greater than 40:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>dimensions</span><span class=p>[</span><span class=o>?</span> <span class=mf>1</span><span class=o>..</span><span class=mi>2</span> <span class=kr>FILTER</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;height&#34;</span> <span class=kr>AND</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>value</span> <span class=o>&gt;</span> <span class=mi>40</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>If you leave out the quantifier, it defaults to <code>ANY</code>. The conditions need to be
fulfilled by at least one sub-object, but more than one sub-object may meet the
conditions. With a quantity of <code>1</code>, it would need to be one match exactly.
Similarly, ranges require an exact match between the minimum and maximum number,
including the specified boundaries. To require two or more sub-objects to
fulfill the conditions, you can use <code>AT LEAST (2)</code>, and so on.</p><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text><ul><li>To use the question mark operator with the <code>ALL</code> quantifier in <code>SEARCH</code>
queries against <code>arangosearch</code> Views, you need at least ArangoDB v3.10.1 and
set the <code>storeValues</code> property of the View to <code>"id"</code>.</li><li>The expression of the <code>AT LEAST</code> quantifier needs to evaluate to a number
before the search is performed. It can therefore not reference the document
emitted by <code>FOR doc IN viewName</code>, nor the <code>CURRENT</code> pseudo-variable.</li><li>Using the question mark operator without quantifier and filter conditions
(<code>[?]</code>) is possible but cannot utilize indexes.</li></ul></div></div></div></div><h2 id=searching-deeply-nested-data>Searching deeply nested data <a href=/3.12/index-and-search/arangosearch/nested-search/#searching-deeply-nested-data class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>You can index and search for multiple levels of objects in arrays.
Consider the following document:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dimensions&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;part&#34;</span><span class=p>:</span> <span class=s2>&#34;frame&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;measurements&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;height&#34;</span><span class=p>,</span> <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>47</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;width&#34;</span><span class=p>,</span> <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>72</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;comments&#34;</span><span class=p>:</span> <span class=s2>&#34;Slightly damaged at the bottom right corner.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;part&#34;</span><span class=p>:</span> <span class=s2>&#34;canvas&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;measurements&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;height&#34;</span><span class=p>,</span> <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>35</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;width&#34;</span><span class=p>,</span> <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>60</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=view-definition data-tab-item="`search-alias` View" class="tab-nav-button selected" onclick='switchTab("view-definition","`search-alias` View",event)'>
<span><code>search-alias</code> View</span></button>
<button data-tab-group=view-definition data-tab-item="`arangosearch` View" class=tab-nav-button onclick='switchTab("view-definition","`arangosearch` View",event)'>
<span><code>arangosearch</code> View</span></button></div><div data-tab-item="`search-alias` View" data-tab-group=view-definition class="tab-item
selected"><p>To index the array of dimension objects and the nested array of measurement
objects, you can use an inverted index and <code>search-view</code> View definition like
the following, using arangosh:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=o>&lt;</span><span class=nx>collection</span><span class=o>&gt;</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;inv-nest-deep&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;inverted&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;dimensions&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>nested</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;measurements&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>nested</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;type&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;value&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;part&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;comments&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>analyzer</span><span class=o>:</span> <span class=s2>&#34;text_en&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_createView</span><span class=p>(</span><span class=s2>&#34;viewName&#34;</span><span class=p>,</span> <span class=s2>&#34;search-alias&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>indexes</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>collection</span><span class=o>:</span> <span class=s2>&#34;&lt;collection&gt;&#34;</span><span class=p>,</span> <span class=nx>index</span><span class=o>:</span> <span class=s2>&#34;inv-nest-deep&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]});</span></span></span></code></pre></div></div><div data-tab-item="`arangosearch` View" data-tab-group=view-definition class=tab-item><p>To index the array of dimension objects and the nested array of measurement
objects, you can use an <code>arangosearch</code> View definition like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;links&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;&lt;collection&gt;&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;fields&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;dimensions&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;nested&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;measurements&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;nested&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;part&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;comments&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;analyzers&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;text_en&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div></div></div><p>The default <code>identity</code> Analyzer is used for the <code>type</code>, <code>value</code>, and <code>part</code>
attributes, and the built-in <code>text_en</code> is used for the <code>comments</code>.</p><p>A possible query is to search for frames with damaged corners that are not wider
than 80, using a question mark operator to check the <code>part</code> and <code>comments</code>, and
a nested question mark operator to check the <code>type</code> and <code>value</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>dimensions</span><span class=p>[</span><span class=o>?</span> <span class=kr>FILTER</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>part</span> <span class=o>==</span> <span class=s2>&#34;frame&#34;</span> <span class=kr>AND</span>
</span></span><span class=line><span class=cl>         <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;corner damage&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>ALL</span> <span class=o>==</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>comments</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>AND</span>
</span></span><span class=line><span class=cl>         <span class=bp>CURRENT</span><span class=p>.</span><span class=n>measurements</span><span class=p>[</span><span class=o>?</span> <span class=kr>FILTER</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;width&#34;</span> <span class=kr>AND</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>value</span> <span class=o>&lt;=</span> <span class=mi>80</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>The conditions of the inner question mark operator need to be satisfied by a
single measurement object. The conditions of the outer question mark operator
need to be satisfied by a single dimension object, including the measurement
conditions of the inner operator. The example document does match these
conditions.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.12/index-and-search/arangosearch/search-highlighting/><i class="fas fa-chevron-left fa-fw"></i><p>Search highlighting</p></a></span><span class=next><a class="nav nav-next link" href=/3.12/index-and-search/arangosearch/ranking/><p>Ranking</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.12/index-and-search/arangosearch/nested-search.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#using-nested-search>Using nested search</a></div><div class=level-2><a href=#defining-how-often-the-conditions-need-to-be-true>Defining how often the conditions need to be true</a></div><div class=level-2><a href=#searching-deeply-nested-data>Searching deeply nested data</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>