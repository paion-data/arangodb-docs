<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1747031427></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="The storage engine is responsible for persisting data on disk, holding copies in memory, providing indexes and caches to speed up queries"><meta property="og:url" content="http://localhost/3.12/components/arangodb-server/storage-engine/"><meta property="og:title" content="Storage Engine"><meta property="og:type" content="website"><meta property="og:description" content="The storage engine is responsible for persisting data on disk, holding copies in memory, providing indexes and caches to speed up queries"><meta name=docsearch:version content="3.12"><title>Storage Engine | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1747031427 defer></script>
<script src=/js/featherlight.min.js?1747031427 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1747031427 defer></script>
<script src=/js/theme.js?1747031427 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.12"><a itemprop=item class=link href=/3.12/><span itemprop=name class=breadcrumb-entry>3.12.4</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Components"><a itemprop=item class=link href=/3.12/components/><span itemprop=name class=breadcrumb-entry>Components</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="ArangoDB Server"><a itemprop=item class=link href=/3.12/components/arangodb-server/><span itemprop=name class=breadcrumb-entry>ArangoDB Server</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Storage Engine"><a itemprop=item class=link href=/3.12/components/arangodb-server/storage-engine/><span itemprop=name class=breadcrumb-entry>Storage Engine</span></a></li></ol></nav><article class=default><hgroup><h1>Storage Engine</h1><p class=lead>The storage engine is responsible for persisting data on disk, holding copies in memory, providing indexes and caches to speed up queries</p></hgroup><p>ArangoDB&rsquo;s storage engine is based on Facebook&rsquo;s <strong>RocksDB</strong> and the only
storage engine available in ArangoDB 3.7 and above. It is the bottom layer of
the database system.</p><h2 id=rocksdb>RocksDB <a href=/3.12/components/arangodb-server/storage-engine/#rocksdb class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>RocksDB is an embeddable persistent key-value store. It is a log
structure database and is optimized for fast storage.</p><p>The RocksDB engine is optimized for large data-sets and allows for a
steady insert performance even if the data-set is much larger than the
main memory. Indexes are always stored on disk but caches are used to
speed up performance. RocksDB uses document-level locks allowing for
concurrent writes. Writes do not block reads. Reads do not block writes.</p><h3 id=advantages>Advantages <a href=/3.12/components/arangodb-server/storage-engine/#advantages class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>RocksDB is a very flexible engine that can be configured for various use cases.</p><p>The main advantages of RocksDB are:</p><ul><li>document-level locks</li><li>support for large data-sets</li><li>persistent indexes</li></ul><h3 id=caveats>Caveats <a href=/3.12/components/arangodb-server/storage-engine/#caveats class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>RocksDB allows concurrent writes. However, when touching the same document at
the same time, a write conflict is raised. It is possible to exclusively lock
collections when executing AQL. This avoids write conflicts, but also inhibits
concurrent writes.</p><p>ArangoDB uses RocksDB transactions to implement the transaction handling for
standalone AQL queries (outside of JavaScript Transactions and Stream Transactions).</p><p>RocksDB imposes a limit on the transaction size. It is optimized to handle small
transactions very efficiently, but is effectively limiting the total size of
transactions. If you have an AQL query that modifies a lot of documents, it is
necessary to commit data in-between. Transactions that get too big (in terms of
number of operations involved or the total size of data modified by the transaction)
are committed automatically. Effectively, this means that big user transactions
are split into multiple smaller RocksDB transactions that are committed individually.
The entire user transaction does not necessarily have ACID properties in this case.</p><p>The threshold values for transaction sizes can be configured globally as well as
overridden per transaction. See
<a href=/3.12/aql/fundamentals/limitations/#storage-engine-properties class=link>Known limitations for AQL queries</a>.</p><h3 id=write-ahead-log>Write-ahead log <a href=/3.12/components/arangodb-server/storage-engine/#write-ahead-log class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Write-ahead logging is used for data recovery after a server crash and for
replication.</p><p>ArangoDB&rsquo;s RocksDB storage engine stores all data-modification operation in a
write-ahead log (WAL). The WAL is sequence of append-only files containing
all the write operations that were executed on the server.
It is used to run data recovery after a server crash, and can also be used in
a replication setup when Followers need to replay the same sequence of operations as
on the Leader.</p><p>The individual RocksDB WAL files are per default about 64 MiB big.
The size is always proportionally sized to the value specified via
<code>--rocksdb.write-buffer-size</code>. The value specifies the amount of data to build
up in memory (backed by the unsorted WAL on disk) before converting it to a
sorted on-disk file.</p><p>Larger values can increase performance, especially during bulk loads.
Up to <code>--rocksdb.max-write-buffer-number</code> write buffers may be held in memory
at the same time, so you may wish to adjust this parameter to control memory
usage. A larger write buffer results in a longer recovery time the next
time the database is opened.</p><p>The RocksDB WAL only contains committed transactions. This means you never
see partial transactions in the replication log, but it also means transactions
are tracked completely in-memory. In practice this causes RocksDB transaction
sizes to be limited, for more information see the
<a href=/3.12/components/arangodb-server/options/#rocksdb class=link>RocksDB Configuration</a></p><h3 id=performance>Performance <a href=/3.12/components/arangodb-server/storage-engine/#performance class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>RocksDB is based on a log-structured merge tree. A good introduction can be
found in:</p><ul><li><a href=http://www.benstopford.com/2015/02/14/log-structured-merge-trees/ target=_blank rel="noopener noreferrer" class=link>www.benstopford.com/2015/02/14/log-structured-merge-trees/</a>&nbsp;<i class="fas fa-external-link-alt"></i></li><li><a href=https://blog.acolyer.org/2014/11/26/the-log-structured-merge-tree-lsm-tree/ target=_blank rel="noopener noreferrer" class=link>blog.acolyer.org/2014/11/26/the-log-structured-merge-tree-lsm-tree/</a>&nbsp;<i class="fas fa-external-link-alt"></i></li></ul><p>The basic idea is that data is organized in levels were each level is a factor
larger than the previous. New data resides in smaller levels while old data
is moved down to the larger levels. This allows to support high rate of inserts
over an extended period. In principle it is possible that the different levels
reside on different storage media. The smaller ones on fast SSD, the larger ones
on bigger spinning disks.</p><p>RocksDB itself provides a lot of different knobs to fine tune the storage
engine according to your use-case. ArangoDB supports the most common ones
using the options below.</p><p>Performance reports for the storage engine can be found here:</p><ul><li><a href=https://github.com/facebook/rocksdb/wiki/performance-benchmarks target=_blank rel="noopener noreferrer" class=link>github.com/facebook/rocksdb/wiki/performance-benchmarks</a>&nbsp;<i class="fas fa-external-link-alt"></i></li><li><a href=https://github.com/facebook/rocksdb/wiki/RocksDB-Tuning-Guide target=_blank rel="noopener noreferrer" class=link>github.com/facebook/rocksdb/wiki/RocksDB-Tuning-Guide</a>&nbsp;<i class="fas fa-external-link-alt"></i></li></ul><h3 id=compression>Compression <a href=/3.12/components/arangodb-server/storage-engine/#compression class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>RocksDB can compress the content it stores to save disk space and improve the
I/O performance at the cost of an increased CPU utilization. It is controlled
by the <code>--rocksdb.compression-type</code> startup option of the ArangoDB server.</p><p>ArangoDB has compression enabled by default using the LZ4 algorithm. It is
optimized for compressing and decompressing with a low CPU overhead instead of a
high compression ratio but can still achieve a 1:6 ratio for lexical content.
The Snappy compression algorithm has similar characteristics but is slower at
decompression.</p><p>No compression is used for the lowest levels of the RocksDB LSM tree as this
data gets rewritten into the higher levels quickly. By default, only level 2
and higher use compression. This is configurable via the
<code>--rocksdb.num-uncompressed-levels</code> startup option.</p><h3 id=arangodb-options>ArangoDB options <a href=/3.12/components/arangodb-server/storage-engine/#arangodb-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>ArangoDB has a cache for the persistent indexes in RocksDB. The total size
of this cache is controlled by the option</p><pre tabindex=0><code>--cache.size
</code></pre><p>RocksDB also has a cache for the blocks stored on disk. The size of
this cache is controlled by the option</p><pre tabindex=0><code>--rocksdb.block-cache-size
</code></pre><p>ArangoDB distributes the available memory equally between the two
caches by default.</p><p>ArangoDB chooses a size for the various levels in RocksDB that is
suitable for general purpose applications.</p><p>RocksDB log structured data levels have increasing size</p><pre tabindex=0><code>MEM: --
L0:  --
L1:  -- --
L2:  -- -- -- --
...
</code></pre><p>New or updated Documents are first stored in memory. If this memtable
reaches the limit given by</p><pre tabindex=0><code>--rocksdb.write-buffer-size
</code></pre><p>it is converted to an SST file and inserted at level 0.</p><p>The following option controls the size of each level and the depth:</p><pre tabindex=0><code>--rocksdb.num-levels N
</code></pre><p>It limits the number of levels to <code>N</code>. By default, it is <code>7</code> and there is
seldom a reason to change this. A new level is only opened if there is
too much data in the previous one.</p><pre tabindex=0><code>--rocksdb.max-bytes-for-level-base B
</code></pre><p>L0 holds at most <code>B</code> bytes.</p><pre tabindex=0><code>--rocksdb.max-bytes-for-level-multiplier M
</code></pre><p>Each level is at most <code>M</code> times as much bytes as the previous
one. Therefore the maximum number of bytes-for-level <code>L</code> can be
calculated as follows:</p><pre tabindex=0><code>max-bytes-for-level-base * (max-bytes-for-level-multiplier ^ (L-1))
</code></pre><p>Also see <a href=/3.12/operations/administration/reduce-memory-footprint/ class=link>Reducing the Memory Footprint of ArangoDB servers</a>
and <a href=/3.12/components/arangodb-server/options/#rocksdb class=link>ArangoDB Server Options</a> for descriptions of RocksDB options.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.12/components/arangodb-server/environment-variables/><i class="fas fa-chevron-left fa-fw"></i><p>Environment variables</p></a></span><span class=next><a class="nav nav-next link" href=/3.12/components/web-interface/><p>Web Interface</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.12/components/arangodb-server/storage-engine.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#rocksdb>RocksDB</a></div><div class=level-3><a href=#advantages>Advantages</a></div><div class=level-3><a href=#caveats>Caveats</a></div><div class=level-3><a href=#write-ahead-log>Write-ahead log</a></div><div class=level-3><a href=#performance>Performance</a></div><div class=level-3><a href=#compression>Compression</a></div><div class=level-3><a href=#arangodb-options>ArangoDB options</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>