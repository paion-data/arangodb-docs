<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743774193></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="Check the following list of potential breaking changes before upgrading to this ArangoDB version and adjust any client applications if necessary"><meta property="og:url" content="http://localhost/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/"><meta property="og:title" content="Incompatible changes in ArangoDB 3.12"><meta property="og:type" content="website"><meta property="og:description" content="Check the following list of potential breaking changes before upgrading to this ArangoDB version and adjust any client applications if necessary"><meta name=docsearch:version content="3.12"><title>Incompatible changes in ArangoDB 3.12 | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743774193 defer></script>
<script src=/js/featherlight.min.js?1743774193 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743774193 defer></script>
<script src=/js/theme.js?1743774193 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.12"><a itemprop=item class=link href=/3.12/><span itemprop=name class=breadcrumb-entry>3.12.4</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Release Notes"><a itemprop=item class=link href=/3.12/release-notes/><span itemprop=name class=breadcrumb-entry>Release Notes</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Version 3.12"><a itemprop=item class=link href=/3.12/release-notes/version-3.12/><span itemprop=name class=breadcrumb-entry>Version 3.12</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Incompatible changes in 3.12"><a itemprop=item class=link href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/><span itemprop=name class=breadcrumb-entry>Incompatible changes in 3.12</span></a></li></ol></nav><article class=default><hgroup><h1>Incompatible changes in ArangoDB 3.12</h1><p class=lead>Check the following list of potential breaking changes <strong>before</strong> upgrading to this ArangoDB version and adjust any client applications if necessary</p></hgroup><h2 id=license-change>License change <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#license-change class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>ArangoDB changes the licensing model for the ArangoDB source code and the
Community Edition, starting with version 3.12.</p><p>The Apache 2.0 license is replaced by the source-available
Business Source License 1.1 (BUSL-1.1). The full license text is available on
GitHub: <a href=https://github.com/arangodb/arangodb/blob/devel/LICENSE target=_blank rel="noopener noreferrer" class=link>https://github.com/arangodb/arangodb/blob/devel/LICENSE</a>&nbsp;<i class="fas fa-external-link-alt"></i></p><p>The official, prepackaged ArangoDB Community Edition binaries are now governed
by a new ArangoDB Community License, which limits deployments to a 100 GB on
dataset size in production and you cannot use it for any commercial purposes,
only internal business purposes.</p><p>For details, see the <a href=https://arangodb.com/community-license/ target=_blank rel="noopener noreferrer" class=link>ArangoDB Community License</a>&nbsp;<i class="fas fa-external-link-alt"></i>.</p><h2 id=upgrading-312-kubernetes-deployments>Upgrading 3.12 Kubernetes deployments <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#upgrading-312-kubernetes-deployments class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>To avoid potential issues when upgrading Kubernetes-managed ArangoDB deployments
from version 3.12.2 or 3.12.3 to 3.12.4, make sure to use the
ArangoDB Kubernetes Operator (<code>kube-arangodb</code>) version 1.2.47 or later for any
deployment that was previously on version 3.11.</p><h2 id=resolving-known-issues-with-versions-prior-to-3124>Resolving known issues with versions prior to 3.12.4 <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#resolving-known-issues-with-versions-prior-to-3124 class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Due to issues with the versions 3.12.0 through 3.12.3 and prior to 3.11.11,
please read the information below and follow the linked procedures to avoid a
potential problem. Not following these procedures can cause your deployment to
become read-only in rare cases.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>If you are a paying customer with a self-hosted deployment, contact the
ArangoDB support for direct assistance.
ArangoGraph customers do not need to take any action.</div></div></div></div><p><strong>Two issues have been discovered that require action:</strong></p><ul><li><a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes class=link>Issues with the comparison of large indexed numbers</a></li><li><a href=#corrected-sorting-order-for-strings-in-velocypack-indexes class=link>Issues with the sorting order of certain strings</a></li></ul><p><strong>Who should check for a potential issue:</strong></p><ul><li>Deployments created with a version prior to 3.12.4</li></ul><p><strong>Deployments not impacted:</strong></p><ul><li>Deployments created with 3.12.4 or later</li></ul><p><strong>Overview of impact</strong></p><p>There is a risk of the RocksDB storage engine entering a state where no write operations are
possible anymore, should it discover index entries that are in an unexpected order.</p><p>This can occur at any time, even if a previous check reported no affected indexes,
as there is no protection against storing and indexing data that may cause issues.
To prevent RocksDB from becoming read-only at some point in the future, it is
essential to follow the linked procedures.</p><div class="box notices cstyle tip"><div class=box-content-container><div class=box-content><i class="fas fa-check"></i><div class=box-text>It is recommended to schedule a maintenance time window for taking the ArangoDB
deployment offline to perform the upgrade procedure in the safest possible manner.</div></div></div></div><p><strong>Paths to resolution:</strong></p><table><thead><tr><th>Current version</th><th>Resolved version</th><th>Steps to take</th></tr></thead><tbody><tr><td>3.11.10 (or older)</td><td>3.11.11 (or newer 3.11.x)</td><td>Create a backup, upgrade normally (following the standard <a href=/3.12/operations/upgrading/#upgrade-paths class=link>Upgrade path</a> all the way to the latest 3.11.x version), then check for <a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes class=link>affected numbers in indexes</a> and fix them.</td></tr><tr><td>3.11.11 (or newer 3.11.x)</td><td>3.12.4 (or newer)</td><td><strong>Do not upgrade to version 3.12.0, 3.12.1, 3.12.2, or 3.12.3</strong>. Create a backup, upgrade to the latest 3.11.x version first, then check for <a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes class=link>affected numbers in indexes</a>, fix them (if you haven&rsquo;t done so already or created the deployment with 3.11.11 or a later 3.11.x version), and finally upgrade to version 3.12.4 or later.</td></tr><tr><td>3.12.0 or 3.12.1</td><td>3.12.4 (or newer)</td><td><strong>Do not upgrade to version 3.12.1, 3.12.2, or 3.12.3</strong>. Create a backup, then upgrade to version 3.12.4 or later. Check for <a href=#corrected-sorting-order-for-strings-in-velocypack-indexes class=link>affected strings in indexes</a>. If affected, create a new deployment using 3.12.4 or later and restore the backup.</td></tr><tr><td>3.12.2 or 3.12.3</td><td>3.12.4 (or newer)</td><td>Create a backup, then check for <a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes class=link>affected numbers in indexes</a> and fix them. Restore a backup to a <strong>test deployment</strong>, upgrade it to version 3.12.4 (or later), and check for <a href=#corrected-sorting-order-for-strings-in-velocypack-indexes class=link>affected strings in indexes</a>. Drop affected indexes in the <strong>production deployment</strong> before you upgrade it. See the link for details.</td></tr></tbody></table><h2 id=native-windows-and-macos-support-removed>Native Windows and macOS support removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#native-windows-and-macos-support-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The native platform support for the Windows and macOS operating systems has been
removed and ArangoDB packages for Windows (installers, ZIP archives) and macOS
(<em>DMG</em> packages, <em>tar.gz</em> archives) are not provided anymore.</p><p>You can use the official <a href=https://hub.docker.com/_/arangodb/ target=_blank rel="noopener noreferrer" class=link>Docker images</a>&nbsp;<i class="fas fa-external-link-alt"></i>
instead, to run ArangoDB in Linux containers, with
<a href=https://www.docker.com/products/docker-desktop/ target=_blank rel="noopener noreferrer" class=link>Docker Desktop</a>&nbsp;<i class="fas fa-external-link-alt"></i>, for instance.</p><p>The following Windows-specific startup options have been removed from <em>arangod</em>:</p><ul><li><code>--start-service</code></li><li><code>--install-service</code></li><li><code>--uninstall-service</code></li><li><code>--servicectl-start</code></li><li><code>--servicectl-start-wait</code></li><li><code>--servicectl-stop</code></li><li><code>--servicectl-stop-wait</code></li></ul><p>Furthermore, the following <em>arangosh</em> startup option has been removed:</p><ul><li><code>--console.code-page</code></li></ul><p>The deprecated setting <code>5</code> (WinCrypt) for the <code>--random.generator</code> startup option
in the server and client tools has now been removed.</p><h2 id=active-failover-deployment-mode-removed>Active Failover deployment mode removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#active-failover-deployment-mode-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Running a single server with asynchronous replication to one or more passive
single servers for automatic failover is no longer supported from v3.12 onward.</p><p>You can use <a href=/3.12/deploy/cluster/ class=link>cluster deployments</a> instead, which
offer better resilience and synchronous replication. Also see the
<a href=/3.12/deploy/oneshard/ class=link>OneShard</a> feature.</p><p>See <a href=/3.12/deploy/single-instance-vs-cluster/ class=link>Single instance vs. Cluster deployments</a>
for details about how a cluster deployment differs and how to migrate to it.</p><h2 id=datacenter-to-datacenter-replication-dc2dc-removed>Datacenter-to-Datacenter Replication (DC2DC) removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#datacenter-to-datacenter-replication-dc2dc-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The <em>Datacenter-to-Datacenter Replication</em> (DC2DC) for clusters including the
<em>arangosync</em> tool is no longer supported from v3.12 onward.</p><h2 id=pregel-removed>Pregel removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#pregel-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The distributed iterative graph processing (Pregel) system is no longer supported
from v3.12 onward.</p><p>In detail, the following functionalities have been removed:</p><ul><li>All Pregel graph algorithms</li><li>The <code>PREGEL_RESULT()</code> AQL function</li><li>The <code>@arangodb/pregel</code> JavaScript API module</li><li>The Pregel HTTP API (<code>/_api/control_pregel/*</code>)</li><li>All <code>arangodb_pregel_*</code> metrics</li><li>The <code>pregel</code> log topic</li><li>The <code>--pregel.max-parallelism</code>, <code>--pregel.min-parallelism</code>, and
<code>--pregel.parallelism</code> startup options</li></ul><h2 id=ldap-authentication-support-removed>LDAP authentication support removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#ldap-authentication-support-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Support for ArangoDB user authentication with an LDAP server in the
Enterprise Edition has been removed.</p><ul><li>All <code>--ldap.*</code> and <code>--ldap2.*</code> startup options have been removed</li><li>The <code>--server.local-authentication</code> startup option has been obsoleted and
will be fully removed in a future version</li><li>The <code>--server.authentication-timeout</code> startup option that mainly controlled
the caching for LDAP authentication now only controls the cluster-internal
authentication caching and shouldn&rsquo;t be touched</li><li>The <code>ldap</code> log topic is no longer available and specifying it in the
<code>--log.level</code> startup option raises a warning</li><li>The <code>ERROR_LDAP_*</code> error codes with the numbers in the range from <code>1800</code>
through <code>1820</code> have been removed</li></ul><h2 id=little-endian-on-disk-key-format-for-the-rocksdb-storage-engine-unsupported>Little-endian on-disk key format for the RocksDB storage engine unsupported <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#little-endian-on-disk-key-format-for-the-rocksdb-storage-engine-unsupported class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>ArangoDB 3.12 does not support the little-endian on-disk key for the RocksDB
storage engine anymore.</p><p>The little-endian on-disk key format was used for deployments that were created
with either ArangoDB 3.2 or 3.3 when using the RocksDB storage engine.
Since ArangoDB 3.4, a big-endian on-disk key format is used for the RocksDB
storage engine, which is more performant than the little-endian format.</p><p>Deployments that were set up with the RocksDB storage engine using ArangoDB 3.2
or 3.3 and that have been upgraded since then still use the old format.
This should not affect many users because the default storage engine in ArangoDB
3.2 and 3.3 was the MMFiles storage engine.
Furthermore, deployments that have been recreated from a dump using arangodump
since ArangoDB 3.4 are not affected because restoring a dump into a fresh
deployment also makes ArangoDB use the big-endian on-disk format.</p><p>ArangoDB 3.11 logs a warning message during startup when the little-endian
on-disk format is in use, but it still supports using the little-endian key format
for almost all operations, with the following exceptions:</p><ul><li>Parallel index creation is disabled when the little-endian key format is used.
Indexes are always created using a single thread.</li><li>The experimental version of arangodump (invocable via the <code>--use-experimental-dump</code>
startup option) does not work. You can still use the traditional
arangodump version, which is the default anyway.</li></ul><p>ArangoDB 3.12 and later refuse to start when detecting that the little-endian
on-disk is in use, so users that still use this format
<strong>must migrate to the big-endian on-disk key format before upgrading to 3.12</strong>.</p><p>The migration can be performed as follows:</p><ol><li>Create a full logical backup of the database using <a href=/3.12/components/tools/arangodump/ class=link>arangodump</a></li><li>Stop the database servers in the deployment</li><li>Wipe the existing database directories</li><li>Restart the servers in the deployment</li><li>Restore the logical dump into the deployment using arangodump</li></ol><p>It is not sufficient to take a hot backup of a little-endian deployment and
restore it because when restoring a hot backup, the original database format is
restored as it was at time of the backup.</p><h2 id=velocystream-protocol-removed>VelocyStream protocol removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#velocystream-protocol-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>ArangoDB&rsquo;s own bi-directional asynchronous binary protocol VelocyStream is no
longer supported.</p><p>The server immediately closes the connection if you attempt to use the
VelocyStream protocol. If you specify any scheme starting with <code>vst</code> in the
<code>--server.endpoint</code> startup option of a client tool, the HTTP protocol is used
instead.</p><p>The following metrics related to VelocyStream have been removed:</p><ul><li><code>arangodb_request_body_size_vst</code></li><li><code>arangodb_vst_connections_total</code></li></ul><p>VelocyPack remains as ArangoDB&rsquo;s binary storage format and you can continue to
use it in transport over the HTTP protocol, as well as use JSON over the
HTTP protocol.</p><h2 id=incompatibilities-due-to-switch-to-glibc>Incompatibilities due to switch to glibc <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#incompatibilities-due-to-switch-to-glibc class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>From version 3.11.10 onward, ArangoDB uses the glibc C standard library
implementation instead of libmusl. Even though glibc is statically linked into
the ArangoDB server and client tool executables, it may load additional modules
at runtime that are installed on your system. Under rare circumstances, it is
possible that ArangoDB crashes when performing host name or address lookups.
This is only the case if all of the following conditions are true:</p><ul><li>You either use ArangoDB version 3.11.10 (non-hotfix) or 3.12.0, or you use a
3.11 version from 3.11.10-1 onward respectively 3.12.1 or any later version
with the <code>--honor-nsswitch</code> startup option enabled.</li><li>You use an ArangoDB package on bare metal (not a Docker container)</li><li>Your operating system uses glibc (like Ubuntu, Debian, RedHat, Centos, or
most other Linux distributions, but not Alpine for instance)</li><li>The glibc version of your system is different than the one used by ArangoDB,
in particular if the system glibc is older than version 2.35</li><li>The <code>libnss-*</code> dynamic libraries are installed</li><li>The <code>/etc/nsswitch.conf</code> configuration file contains settings other than for
<code>files</code> and <code>dns</code> in the <code>hosts:</code> line, or the <code>passwd:</code> and <code>group:</code> lines
contain something other than <code>files</code></li></ul><p>If you are affected, consider using Docker containers, <code>chroot</code>, or change
<code>nsswitch.conf</code>.</p><h2 id=javascript-transactions-deprecated>JavaScript Transactions deprecated <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#javascript-transactions-deprecated class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Server-side transactions written in JavaScript and executed via the
<code>db._executeTransaction()</code> method of the JavaScript API or the
<code>POST /_api/transaction</code> endpoint of the HTTP API are deprecated from v3.12.0
onward and will be removed in a future version.</p><p>You can use <a href=/3.12/develop/transactions/stream-transactions/ class=link>Stream Transactions</a>
instead in most cases, and in some cases AQL can be sufficient.</p><h2 id=default-server-language-changed>Default server language changed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#default-server-language-changed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>ArangoDB initializes its storage (the so called database directory) when running
for the first time, typically when creating a new deployment. You can specify
a locale for the initialization with the <code>--icu-language</code> startup option (or with
the deprecated <code>--default-language</code> startup option). The server language that
you set this way affects the sorting and comparison behavior for text globally,
with a few exceptions like the <a href=/3.12/index-and-search/analyzers/#collation class=link><code>collation</code> Analyzer</a>.</p><p>If you don&rsquo;t specify a language using a startup option, the <code>LANG</code> environment
variable is checked. If it&rsquo;s not set or has an invalid value, the effective
fallback locale used to be <code>en_US</code> in ArangoDB v3.11 and older versions.
From v3.12.0 onward, the default is <code>en_US_POSIX</code> (also known as the C locale).
It has a slightly different sorting behavior compared to <code>en_US</code>.</p><p>When upgrading existing deployments to v3.12, the database directory is already
initialized and has the server language locked in. If the locale is <code>en_US</code>
before the upgrade, it is also <code>en_US</code> after the upgrade. Therefore, the sorting
behavior remains unchanged. However, new deployments use the <code>en_US_POSIX</code> locale
by default. If you, for instance, restore a v3.11 dump into a new v3.12 instance,
the sorting behavior may change. You may want to set a server language explicitly
when initializing the v3.12 instance to retain a specific sorting behavior.</p><h2 id=incompatibilities-with-unicode-text-between-core-and-javascript>Incompatibilities with Unicode text between core and JavaScript <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#incompatibilities-with-unicode-text-between-core-and-javascript class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>ArangoDB 3.12 uses the ICU library for Unicode handling in version 64 for its core
(ArangoSearch, AQL, RocksDB) but version 73 in <a href=/3.12/develop/javascript-api/ class=link>JavaScript contexts</a>.
If you compare or sort string values with JavaScript and with the core, the values
may not match between the two or have a different order. This is due to changes
in the Unicode standard and the binary representation of strings for comparisons.</p><p>You can be affected if you use JavaScript-based features like Foxx microservices
or user-defined AQL functions (UDFs), compare or sort strings in them, and
Unicode characters for which the standard has changed between the two ICU versions
are involved.</p><h2 id=stricter-option-validation-when-creating-collections>Stricter option validation when creating collections <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#stricter-option-validation-when-creating-collections class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Some invalid attributes and values that you can specify in the HTTP API when
creating collections are no longer allowed. Previous versions ignored these
invalid options. See <a href=/3.12/release-notes/version-3.12/api-changes-in-3-12/#collection-api class=link>API Changes in ArangoDB 3.12</a>
for details.</p><h2 id=control-character-escaping-in-audit-log>Control character escaping in audit log <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#control-character-escaping-in-audit-log class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The audit log feature of the Enterprise Edition previously logged query strings
verbatim. Control characters, in particular line breaks, can cause issues with
parsing the audit log. They are now escaped for query strings which often contain
line breaks.</p><h2 id=higher-reported-memory-usage-for-aql-queries>Higher reported memory usage for AQL queries <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#higher-reported-memory-usage-for-aql-queries class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Due to the <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#improved-memory-accounting-and-usage class=link>improved memory accounting in v3.12</a>,
certain AQL queries may now get aborted because they exceed the defined
memory limit but didn&rsquo;t get killed in previous versions. This is because of the
more accurate memory tracking that reports a higher (actual) usage now. It allows
ArangoDB to more reliably detect and kill queries that go over the per-query and
global query memory limit, potentially preventing out-of-memory crashes of
<em>arangod</em> processes.</p><p>In particular, AQL queries that perform write operations now report a
significantly higher <code>peakMemoryUsage</code> than before. This is also
reflected in the <code>arangodb_aql_global_memory_usage</code> metric. Memory used for
ArangoSearch <code>SEARCH</code> operations is now also accounted for in the metric.</p><p>You may need to adjust affected queries to use less memory or increase the
per-query limit with the <a href=/3.12/aql/how-to-invoke-aql/with-arangosh/#memorylimit class=link><code>memoryLimit</code> query option</a>
or its default using the <code>--query.memory-limit</code> startup option. You can adjust
the global limit with the <code>--query.global-memory-limit</code> startup option.</p><h2 id=adjustable-stream-transaction-size>Adjustable Stream Transaction size <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#adjustable-stream-transaction-size class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><a href=/3.12/develop/transactions/stream-transactions/ class=link>Stream Transactions</a> may
now be limited to smaller transaction sizes because the maximum transaction size
can now be configured with the <code>--transaction.streaming-max-transaction-size</code>
startup option. The default value remains 128 MiB (up to v3.12.3) but configuring
a lower limit can cause previously working Stream Transactions to fail.
From v3.12.4 onward, the default value is 512 MiB.</p><h2 id=exit-code-adjustments>Exit code adjustments <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#exit-code-adjustments class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.10.13, v3.11.7</small></p><p>For some fatal errors like a required database upgrade or a failed version check,
<em>arangod</em> set the generic exit code of <code>1</code>. It now returns a different, more
specific exit code in these cases.</p><h2 id=validation-of-smartgraphattribute-in-smartgraphs>Validation of <code>smartGraphAttribute</code> in SmartGraphs <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#validation-of-smartgraphattribute-in-smartgraphs class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.10.13, v3.11.7</small></p><p>The attribute defined by the <code>smartGraphAttribute</code> graph property is not allowed to be
changed in the documents of SmartGraph vertex collections. This is now strictly enforced.
See <a href=/3.12/release-notes/version-3.12/api-changes-in-3-12/#validation-of-smartgraphattribute-in-smartgraphs class=link>API Changes in ArangoDB 3.12</a>
for details and instructions on how to repair affected attributes.</p><h2 id=dropping-graph-collections-disallowed>Dropping graph collections disallowed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#dropping-graph-collections-disallowed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Dropping a collection now strictly enforces that graph definitions remain intact.
Previously, it was allowed to drop collections that were part of an existing graph.
Trying to do so now results in the error <code>ERROR_GRAPH_MUST_NOT_DROP_COLLECTION</code>
with the number <code>1942</code>.</p><p>This may require changes in the client application code that drops individual
collections from graphs for clean-up purposes. You can drop an entire graph
and its collections along with it, as long as they aren&rsquo;t used in another graph.
To remove individual collections, update or remove edge definitions first to not
include the desired collections anymore. In case of vertex collections, they
become orphan collections that you need to remove from the graph definition as
well to drop the collections.</p><h2 id=short-circuiting-subquery-evaluation>Short-circuiting subquery evaluation <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#short-circuiting-subquery-evaluation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.12.1</small></p><p>Subqueries you use in ternary expressions are no longer executed unconditionally
before the condition is evaluated. Only the subquery of the branch that is taken
effectively executes.</p><p>Similarly, when you use subqueries as sub-expressions that are combined with
logical <code>AND</code> or <code>OR</code>, the subqueries are now evaluated lazily.</p><p>If you rely on the previous behavior of v3.12.0 or older, you need to rewrite
affected AQL queries so that the subqueries are executed first.</p><p>For example, the following query with a subquery in the false branch of a ternary
operator only creates a new document if the condition evaluates to false from
v3.12.1 onward:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>RETURN</span> <span class=nf>RAND</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mf>0.5</span> <span class=o>?</span> <span class=s2>&#34;yes&#34;</span> <span class=o>:</span> <span class=p>(</span><span class=kr>INSERT</span> <span class=p>{}</span> <span class=kr>INTO</span> <span class=n>coll</span> <span class=kr>RETURN</span> <span class=s2>&#34;no&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span></span></span></code></pre></div><p>To restore the behavior of v3.12.0 and older where the subquery is always executed,
pull the subquery out of the ternary operator expression and save the result to
a variable, then use this variable where the subquery used to be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>tmp</span> <span class=o>=</span> <span class=p>(</span><span class=kr>INSERT</span> <span class=p>{}</span> <span class=kr>INTO</span> <span class=n>coll</span> <span class=kr>RETURN</span> <span class=s2>&#34;no&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=kr>RETURN</span> <span class=nf>RAND</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mf>0.5</span> <span class=o>?</span> <span class=s2>&#34;yes&#34;</span> <span class=o>:</span> <span class=n>tmp</span></span></span></code></pre></div><p>This also applies to expressions that are combined with logical <code>AND</code> or <code>OR</code>.
A subquery to the right-hand side of an <code>AND</code> is effectively only executed if
the expression to the left-hand side is truthy, and with an <code>OR</code>, the
right-hand side is effectively only executed if the left-hand side is falsy
from v3.12.1 onward.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>RETURN</span> <span class=nf>RAND</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mf>0.5</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=kr>INSERT</span> <span class=p>{}</span> <span class=kr>INTO</span> <span class=n>coll</span> <span class=kr>RETURN</span> <span class=mi>42</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span></span></span></code></pre></div><p>To execute the subquery regardless of the left-hand side expression, execute
the subquery first:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>tmp</span> <span class=o>=</span> <span class=p>(</span><span class=kr>INSERT</span> <span class=p>{}</span> <span class=kr>INTO</span> <span class=n>coll</span> <span class=kr>RETURN</span> <span class=mi>42</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=kr>RETURN</span> <span class=nf>RAND</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mf>0.5</span> <span class=o>&amp;&amp;</span> <span class=n>tmp</span></span></span></code></pre></div><p>Also see <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#short-circuiting-subquery-evaluation class=link>What&rsquo;s New in 3.12</a>
and <a href=/3.12/aql/fundamentals/subqueries/#evaluation-of-subqueries class=link>Evaluation of subqueries</a>
for more information.</p><h2 id=corrected-sorting-order-for-numbers-in-velocypack-indexes>Corrected sorting order for numbers in VelocyPack indexes <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#corrected-sorting-order-for-numbers-in-velocypack-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.11.11, v3.12.2</small></p><ul><li><a href=#issues-with-the-comparison-of-large-indexed-numbers class=link>Issues with the comparison of large indexed numbers</a></li><li><a href=#check-if-you-are-affected class=link>Check if you are affected</a></li><li><a href=#if-the-deployment-is-not-affected class=link>If the deployment is NOT affected</a></li><li><a href=#if-the-deployment-is-affected class=link>If the deployment is affected</a></li></ul><h3 id=issues-with-the-comparison-of-large-indexed-numbers>Issues with the comparison of large indexed numbers <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#issues-with-the-comparison-of-large-indexed-numbers class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>If you store very large numeric values in ArangoDB – greater than/equal to
2<sup>53</sup> (9,007,199,254,740,992) or less than/equal to
-2<sup>53</sup> (-9,007,199,254,740,992) – and index them with an affected
index type, the values may not be in the correct order. This is due to how the
comparison is executed in versions before v3.11.11 and v3.12.2. If the numbers
are represented using different VelocyPack types internally, they are converted
to doubles and then compared. This conversion is lossy for integers with a very
large absolute value, resulting in an incorrect ordering of the values.</p><p>The possibly affected index types are the following that allow storing
VelocyPack data in them:</p><ul><li><code>persistent</code> (including vertex-centric indexes)</li><li><code>mdi-prefixed</code> (but not <code>mdi</code> indexes; only available from v3.12.0 onward)</li><li><code>hash</code> (legacy alias for persistent indexes)</li><li><code>skiplist</code> (legacy alias for persistent indexes)</li></ul><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>The incorrect sort order in an index can lead to the RocksDB storage engine
discovering out-of-order keys and then refusing further write operations with
errors and warnings.</div></div></div></div><p>To prevent ArangoDB deployments from entering a read-only mode due to this issue,
please follow the below procedures to check if your deployment is affected and
how to correct it if necessary.</p><h3 id=check-if-you-are-affected>Check if you are affected <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#check-if-you-are-affected class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following procedure is recommended for every deployment unless it has been
created with v3.11.11, v3.12.2, or any later version.</p><ol><li><p>Create a backup as a precaution. If you run the Enterprise Edition, you can
create a Hot Backup. Otherwise, create a full dump with <em>arangodump</em>
(including all databases and system collections).</p></li><li><p>If your deployment is on a 3.11.x version older than 3.11.11, upgrade to
the latest 3.11 version that is available.</p><p>If your deployment is on version 3.12.0 or 3.12.1, upgrade to the latest
3.12 version that is available but be sure to also read about the string
sorting issue in <a href=#resolving-known-issues-with-versions-prior-to-3124 class=link>Resolving known issues with versions prior to 3.12.4</a>
and the linked upgrade procedures.</p></li><li><p>Call the <code>GET /_admin/cluster/vpackSortMigration/check</code> endpoint to let
ArangoDB check all indexes. As it can take a while for large deployments,
it is recommended to run this operation as an asynchronous job
(<code>x-arango-async: store</code> header) so that you can check the result later.</p><p>The endpoint is available for all deployment modes, not only in clusters.
In case of a cluster, send the request to one of the Coordinators.
Example with ArangoDB running locally on the default port:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl --dump-header - -H <span class=s2>&#34;x-arango-async: store&#34;</span> http://localhost:8529/_admin/cluster/vpackSortMigration/check
</span></span></code></pre></div></li><li><p>Inspect the response to find the job ID in the <code>X-Arango-Async-Id</code> HTTP header.
The job ID is <code>12345</code> in the following example:</p><pre tabindex=0><code>HTTP/1.1 202 Accepted
X-Arango-Queue-Time-Seconds: 0.000000
Strict-Transport-Security: max-age=31536000 ; includeSubDomains
Expires: 0
Pragma: no-cache
Cache-Control: no-cache, no-store, must-revalidate, pre-check=0, post-check=0, max-age=0, s-maxage=0
Content-Security-Policy: frame-ancestors &#39;self&#39;; form-action &#39;self&#39;;
X-Content-Type-Options: nosniff
X-Arango-Async-Id: 12345
Server: ArangoDB
Connection: Keep-Alive
Content-Type: text/plain; charset=utf-8
Content-Length: 0
</code></pre></li><li><p>Call the <code>PUT /_api/job/12345</code> endpoint, substituting <code>12345</code> with your
actual job ID. It returns nothing if the job is still ongoing. You can repeat
this call every once in a while to check again.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl -XPUT http://localhost:8529/_api/job/12345
</span></span></code></pre></div></li><li><p>If there are no issues with your deployment, the check result reports an
empty list of affected indexes and an according message.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;affected&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorCode&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorMessage&#34;</span><span class=p>:</span> <span class=s2>&#34;all good with sorting order&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If this is the case, continue with
<a href=#if-the-deployment-is-not-affected class=link>If the deployment is NOT affected</a>.</p><p>If affected indexes are found, the check result looks similar to this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;affected&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;database&#34;</span><span class=p>:</span> <span class=s2>&#34;_system&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;collection&#34;</span><span class=p>:</span> <span class=s2>&#34;coll&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indexId&#34;</span><span class=p>:</span> <span class=mi>195</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indexName&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_1806192152446763008&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorCode&#34;</span><span class=p>:</span> <span class=mi>1242</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorMessage&#34;</span><span class=p>:</span> <span class=s2>&#34;some indexes have legacy sorted keys&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If this is the case, continue with
<a href=#if-the-deployment-is-affected class=link>If the deployment is affected</a>.</p></li></ol><h3 id=if-the-deployment-is-not-affected>If the deployment is NOT affected <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#if-the-deployment-is-not-affected class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><ol><li><p>Make sure that no problematic values are written to or removed from an index
between checking for affected indexes and completing the procedure.
To be safe, you may want to stop all writes to the database system.</p></li><li><p>You can perform a regular in-place upgrade and mark the deployment as correct
using a special HTTP API endpoint in the next step.</p><p>That is, create a backup and upgrade your deployment to the
latest bugfix version with the same major and minor version (e.g. from 3.11.x
to at least 3.11.11 or from 3.12.x to at least 3.12.2).</p></li><li><p>Call the <code>PUT /_admin/cluster/vpackSortMigration/migrate</code> endpoint to mark
the deployment as having the correct sorting order. This requires
<a href=/3.12/develop/http-api/authentication/#jwt-superuser-tokens class=link>superuser permissions</a>
unless authentication is disabled.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl -H <span class=s2>&#34;Authorization: bearer &lt;superuser-token&gt;&#34;</span> -XPUT http://localhost:8529/_admin/cluster/vpackSortMigration/migrate
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorCode&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorMessage&#34;</span><span class=p>:</span> <span class=s2>&#34;VPack sorting migration done.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li><li><p>For the corrected sorting order to take effect, restart the ArangoDB server,
respectively restart the DB-Servers of the cluster.</p></li><li><p>Complete the procedure by resuming writes to the database systems.</p></li></ol><h3 id=if-the-deployment-is-affected>If the deployment is affected <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#if-the-deployment-is-affected class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>If you are a customer, please contact the ArangoDB support to assist you with
the following steps.</div></div></div></div><ol><li><p>This step depends on the deployment mode:</p><ul><li><p><strong>Single server</strong>: Create a new server. Then create a full dump with
<a href=/3.12/components/tools/arangodump/ class=link>arangodump</a> of the old server,
using the <code>--all-databases</code> and <code>--include-system-collections</code> startup options
and a user account with administrate access to the <code>_system</code> database and
at least read access to all other databases to ensure all data including
the <code>_users</code> system collection are dumped.</p><p>Restore the dump to the new single server using at least v3.11.11 or v3.12.4
(v3.12.2 only addresses this but not <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#corrected-sorting-order-for-strings-in-velocypack-indexes class=link>another issue</a>).
You need to use a new database directory.</p></li><li><p><strong>Cluster</strong>: Replace the DB-Server nodes until they all run at least
v3.11.11 or v3.12.4 (rolling upgrade). Syncing new nodes writes the data in
the correct order. This deployment mode and approach avoids downtimes.</p><p>For each DB-Server, add a new DB-Server node to the cluster. Wait until all
new DB-Servers are in sync, then clean out the old DB-Server nodes.</p></li></ul></li><li><p>New instances using the fixed versions initialize the database directory
with the sorting order marked as correct and also restore data from dumps
correctly. There is no need to call the <code>.../vpackSortMigration/migrate</code>
HTTP API endpoint like in the unaffected case.</p></li><li><p>If you revert to an older state with affected indexes by restoring a
Hot Backup, you need to repeat the procedure.</p></li></ol><h2 id=changed-json-serialization-and-velocypack-format-for-replication>Changed JSON serialization and VelocyPack format for replication <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#changed-json-serialization-and-velocypack-format-for-replication class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.11.12, v3.12.3</small></p><p>While there is only one number type in JSON, the VelocyPack format that ArangoDB
uses supports different numeric data types. When converting between VelocyPack
and JSON, it was previously possible for precision loss to occur in edge cases.
This also affected creating and restoring dumps with arangodump and arangorestore.</p><p>A double (64-bit floating-point) value <code>1152921504606846976.0</code> (2<sup>60</sup>)
used to be serialized to <code>1152921504606847000</code> in JSON, which deserializes back
to <code>1152921504606846976</code> when using a double. However, the serialized value got
parsed as an unsigned integer, resulting in an incorrect value of
<code>1152921504606847000</code>.</p><p>Numbers with an absolute value greater or equal to 2<sup>53</sup> and less than
2<sup>64</sup> (which always represents an integer) are now serialized faithfully
to JSON using an integer conversion routine and then <code>.0</code> is appended (e.g.
<code>1152921504606846976.0</code>) to ensure that they get parsed back to the exact same
double value. All other values are serialized as before, e.g. small integral
values don&rsquo;t get <code>.0</code> appended, and they get parsed back to integers with the
same numerical value.</p><p>Moreover, replication-related APIs such as the <code>/_api/wal/tail</code> endpoint now
support the VelocyPack format. The cluster replication has been changed to use
VelocyPack instead of JSON to avoid unnecessary conversions and avoiding any
risk of deviations due to the serialization.</p><h2 id=corrected-sorting-order-for-strings-in-velocypack-indexes>Corrected sorting order for strings in VelocyPack indexes <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#corrected-sorting-order-for-strings-in-velocypack-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><small>Introduced in: v3.12.4</small></p><ul><li><a href=#issues-with-the-sorting-order-of-certain-strings class=link>Issues with the sorting order of certain strings</a></li><li><a href=#before-the-upgrade class=link>Before the upgrade</a></li><li><a href=#upgrade-an-enterprise-edition-deployment class=link>Upgrade an Enterprise Edition deployment</a></li><li><a href=#upgrade-a-community-edition-deployment class=link>Upgrade a Community Edition deployment</a></li><li><a href=#if-the-deployment-is-in-read-only-mode class=link>If the deployment is in read-only mode</a></li></ul><h3 id=issues-with-the-sorting-order-of-certain-strings>Issues with the sorting order of certain strings <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#issues-with-the-sorting-order-of-certain-strings class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>If you store certain non-ASCII characters in ArangoDB and index them with an affected
index type, the values may not be in the correct order. This is due to differences
in the sorting order between different versions of the Unicode standard and how
it is implemented in ArangoDB with the ICU library.</p><p>From ArangoDB version 3.12.1 onward, a legacy version of ICU is included for
compatibility so that you can upgrade from 3.11 or older to 3.12 and maintain
the same sorting order. However, it has been found that the order can differ
between 3.11 and 3.12 in certain edge cases. This has been corrected in 3.12.4,
but it is necessary to check existing indexes for entries in an invalid order
and follow a procedure for fixing the indexes.</p><p>The possibly affected index types are the following that allow storing
VelocyPack data in them:</p><ul><li><code>persistent</code> (including vertex-centric indexes)</li><li><code>mdi-prefixed</code> (but not <code>mdi</code> indexes)</li><li><code>hash</code> (legacy alias for persistent indexes)</li><li><code>skiplist</code> (legacy alias for persistent indexes)</li></ul><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>The incorrect sort order in an index can lead to the RocksDB storage engine
discovering out-of-order keys and then refusing further write operations with
errors and warnings. See <a href=#if-the-deployment-is-in-read-only-mode class=link>If the deployment is in read-only mode</a>
if you are in this situation.</div></div></div></div><p>To prevent ArangoDB deployments from entering a read-only mode due to this issue,
please follow the below procedures. It is necessary to check if your deployment
is affected twice, before and after upgrading, and you may need to drop indexes
before the upgrade.</p><h3 id=before-the-upgrade>Before the upgrade <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#before-the-upgrade class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following procedure is recommended for every deployment unless it has been
created with v3.12.4 or any later version.</p><ol><li><p>Create a backup as a precaution. If you run the Enterprise Edition, you can
create a Hot Backup. Otherwise, create a full dump with <em>arangodump</em>
(including all databases and system collections).</p></li><li><p>If your deployment is on a 3.11.x version, do not upgrade to 3.12.0, 3.12.1,
3.12.2, or 3.12.3. See <a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes class=link>Corrected sorting order for numbers in VelocyPack indexes</a>
to address another issue, but upgrade to 3.12.4 or later.
You are not affected by the string sorting issue with this upgrade path.</p><p>If your deployment is on 3.12.0 or 3.12.1, you should upgrade to 3.12.4,
see <a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes class=link>Corrected sorting order for numbers in VelocyPack indexes</a>,
and continue with the next step.</p><p>If your deployment is on 3.12.2 or 3.12.3, see
<a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes class=link>Corrected sorting order for numbers in VelocyPack indexes</a>
unless you created it with either of these versions.
Continue with the next step either way.
Do not upgrade to 3.12.4 in the meantime.</p></li><li><p>Call the <code>GET /_admin/cluster/vpackSortMigration/check</code> endpoint to let
ArangoDB check all indexes. As it can take a while for large deployments,
it is recommended to run this operation as an asynchronous job
(<code>x-arango-async: store</code> header) so that you can check the result later.</p><p>The endpoint is available for all deployment modes, not only in clusters.
In case of a cluster, send the request to one of the Coordinators.
Example with ArangoDB running locally on the default port:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl --dump-header - -H <span class=s2>&#34;x-arango-async: store&#34;</span> http://localhost:8529/_admin/cluster/vpackSortMigration/check
</span></span></code></pre></div></li><li><p>Inspect the response to find the job ID in the <code>X-Arango-Async-Id</code> HTTP header.
The job ID is <code>12345</code> in the following example:</p><pre tabindex=0><code>HTTP/1.1 202 Accepted
X-Arango-Queue-Time-Seconds: 0.000000
Strict-Transport-Security: max-age=31536000 ; includeSubDomains
Expires: 0
Pragma: no-cache
Cache-Control: no-cache, no-store, must-revalidate, pre-check=0, post-check=0, max-age=0, s-maxage=0
Content-Security-Policy: frame-ancestors &#39;self&#39;; form-action &#39;self&#39;;
X-Content-Type-Options: nosniff
X-Arango-Async-Id: 12345
Server: ArangoDB
Connection: Keep-Alive
Content-Type: text/plain; charset=utf-8
Content-Length: 0
</code></pre></li><li><p>Call the <code>PUT /_api/job/12345</code> endpoint, substituting <code>12345</code> with your
actual job ID. It returns nothing if the job is still ongoing. You can repeat
this call every once in a while to check again.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl -XPUT http://localhost:8529/_api/job/12345
</span></span></code></pre></div></li><li><p>The check result may report an empty list of affected indexes and an
according message. You may still be affected, however.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;affected&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorCode&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorMessage&#34;</span><span class=p>:</span> <span class=s2>&#34;all good with sorting order&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It may also find affected indexes, with the check result looking similar to this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;affected&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;database&#34;</span><span class=p>:</span> <span class=s2>&#34;_system&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;collection&#34;</span><span class=p>:</span> <span class=s2>&#34;coll&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indexId&#34;</span><span class=p>:</span> <span class=mi>195</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;indexName&#34;</span><span class=p>:</span> <span class=s2>&#34;idx_1806192152446763008&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorCode&#34;</span><span class=p>:</span> <span class=mi>1242</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;errorMessage&#34;</span><span class=p>:</span> <span class=s2>&#34;some indexes have legacy sorted keys&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li><li><p>Continue with the applicable procedure:</p><ul><li><a href=#upgrade-an-enterprise-edition-deployment class=link>Upgrade an Enterprise Edition deployment</a></li><li><a href=#upgrade-a-community-edition-deployment class=link>Upgrade a Community Edition deployment</a></li></ul></li></ol><h3 id=upgrade-an-enterprise-edition-deployment>Upgrade an Enterprise Edition deployment <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#upgrade-an-enterprise-edition-deployment class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><ol><li><p>Create a Hot Backup if you haven&rsquo;t done so already.</p></li><li><p>If the check result shows affected indexes, contact the ArangoDB support
immediately. Do not continue and refrain from upgrading.</p></li><li><p>If no affected indexes are reported, restore the Hot Backup to a new
deployment using version 3.12.4 (or later). This deployment is for testing.</p></li><li><p>Call the <code>GET /_admin/cluster/vpackSortMigration/check</code> endpoint of the
<strong>test deployment</strong> to let ArangoDB check all indexes in the new version.</p><p>Example with the new ArangoDB running locally on port 9529:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl --dump-header - -H <span class=s2>&#34;x-arango-async: store&#34;</span> http://localhost:9529/_admin/cluster/vpackSortMigration/check
</span></span></code></pre></div></li><li><p>If no affected indexes are found, you can upgrade your <strong>production deployment</strong>
and shut the test deployment down.</p><p>If there are affected indexes, continue with the next step.</p></li><li><p>Drop the affected indexes in your <strong>production deployment</strong>, then trigger a full
compaction using the <a href=/3.12/develop/http-api/administration/#compact-all-databases class=link>HTTP API</a>,
setting the <code>compactBottomMostLevel</code> option to <code>true</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl --dump-header - -H <span class=s2>&#34;x-arango-async: store&#34;</span> -XPUT -d <span class=s1>&#39;{&#34;compactBottomMostLevel&#34;:true}&#39;</span> http://localhost:8529/_admin/compact
</span></span></code></pre></div><p>Using an asynchronous job is recommended because rewriting the data can take a while.</p></li><li><p>Inspect the response to find the job ID in the <code>X-Arango-Async-Id</code> HTTP header.</p><p>Call the <code>PUT /_api/job/23456</code> endpoint, substituting <code>23456</code> with your
actual job ID. It returns <code>HTTP/1.1 204 No Content</code> if the job is still ongoing.
You can repeat this call every once in a while to check again.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl --dump-header - -XPUT http://localhost:8529/_api/job/12345
</span></span></code></pre></div></li><li><p>When the compaction is done, you see <code>HTTP/1.1 200 OK</code> and <code>{}</code> as the payload.</p></li><li><p>Verify that you dropped all affected indexes by creating a new Hot Backup,
restoring it to another <strong>test deployment</strong> using version 3.12.4 (or later),
and calling the <code>GET /_admin/cluster/vpackSortMigration/check</code> endpoint of
this test deployment like you did before.</p><p>If no affected indexes are reported, you can upgrade your
<strong>production deployment</strong> to 3.12.4 (or later) and then recreate the indexes
you dropped once the deployment is on the new version.</p><p>If there are still affected indexes, contact the ArangoDB support.</p></li></ol><h3 id=upgrade-a-community-edition-deployment>Upgrade a Community Edition deployment <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#upgrade-a-community-edition-deployment class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><ol><li><p>Create a full dump with <em>arangodump</em> if you haven&rsquo;t done so already.</p></li><li><p>If the check result shows affected indexes, create a new deployment using
version 3.12.4 (or later) and restore the dump.
Make the new deployment your production deployment.</p></li><li><p>If there are no affected indexes, upgrade to version 3.12.4 (or later) and
call the <code>GET /_admin/cluster/vpackSortMigration/check</code> endpoint again.</p></li><li><p>If affected indexes are reported after the upgrade, create a new deployment
using version 3.12.4 (or later) and restore the dump.
Make the new deployment your production deployment.</p></li><li><p>If there are no affected indexes, you can keep the existing deployment.</p></li></ol><h3 id=if-the-deployment-is-in-read-only-mode>If the deployment is in read-only mode <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#if-the-deployment-is-in-read-only-mode class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>If you are a customer, please contact the ArangoDB support to assist you with
the following steps.</div></div></div></div><ol><li><p>If you encounter the RocksDB &ldquo;out-of-order keys&rdquo; error and your deployment
is thus in read-only mode, do not try to upgrade or replace servers of the
deployment. In particular, do not restart DB-Servers of a cluster deployment
with their volumes removed.</p></li><li><p>Create a full dump with <em>arangodump</em> (including all databases and
system collections) if you haven&rsquo;t done so already.</p></li><li><p>Create a new deployment using version 3.12.4 or later.</p></li><li><p>Restore the dump to the new deployment. You can directly move from any
3.11 or 3.12 version to 3.12.4 (or later) this way.</p></li></ol><h2 id=http-restful-api>HTTP RESTful API <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#http-restful-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=javascript-based-traversal-using-_apitraversal-removed>JavaScript-based traversal using <code>/_api/traversal</code> removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#javascript-based-traversal-using-_apitraversal-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The long-deprecated JavaScript-based traversal functionality has been removed
in v3.12.0, including the REST API endpoint <code>/_api/traversal</code>.</p><p>The functionality provided by this API was deprecated and unmaintained since
v3.4.0. JavaScript-based traversals have been replaced with AQL traversals in
v2.8.0. Additionally, the JavaScript-based traversal REST API could not handle
larger amounts of data and was thus very limited.</p><p>Users of the <code>/_api/traversal</code> REST API should use
<a href=/3.12/aql/graphs/traversals/ class=link>AQL traversal queries</a> instead.</p><h3 id=http-server-behavior>HTTP server behavior <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#http-server-behavior class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following long-deprecated features have been removed from ArangoDB&rsquo;s HTTP
server:</p><ul><li><p>overriding the HTTP method by setting one of the HTTP headers:</p><ul><li><code>x-http-method</code></li><li><code>x-http-method-override</code></li><li><code>x-method-override</code></li></ul><p>This functionality posed a potential security risk and was thus removed.
Previously, it was only enabled when explicitly starting the
server with the <code>--http.allow-method-override</code> startup option.
The functionality has now been removed and setting the startup option does
nothing.</p></li><li><p>optionally hiding ArangoDB&rsquo;s <code>server</code> response header. This functionality
could optionally be enabled by starting the server with the startup option
<code>--http.hide-product-header</code>.
The functionality has now been removed and setting the startup option does
nothing.</p></li></ul><h3 id=graph-api-gharial-behavior>Graph API (Gharial) behavior <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#graph-api-gharial-behavior class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><ul><li><p>The <code>PATCH /_api/gharial/{graph}/edge/{collection}/{edge}</code> endpoint to update
edges in named graphs now validates the referenced vertex when modifying either
the <code>_from</code> or <code>_to</code> edge attribute. Previously, the validation only occurred if
both were set in the request.</p></li><li><p>A new error code <code>1949</code> with the name <code>TRI_ERROR_GRAPH_VERTEX_COLLECTION_NOT_USED</code>
has been added is now returned instead of <code>TRI_ERROR_GRAPH_REFERENCED_VERTEX_COLLECTION_NOT_USED</code>
with the code <code>1947</code> if you attempt to read from or write to a vertex collection
through the graph API but the collection is not part of the graph definition.</p></li><li><p>The error code <code>1947</code> with the name <code>TRI_ERROR_GRAPH_REFERENCED_VERTEX_COLLECTION_NOT_USED</code>
has been renamed to <code>ERROR_GRAPH_REFERENCED_VERTEX_COLLECTION_NOT_PART_OF_THE_GRAPH</code>.
This error is (now only) raised if you attempt to reference a document in the
<code>_from</code> or <code>_to</code> attribute of an edge but the document&rsquo;s collection is not
part of the graph definition.</p></li></ul><h3 id=batch-request-endpoint-removed>Batch request endpoint removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#batch-request-endpoint-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Removed in: v3.12.3</small></p><p>The <code>/_api/batch</code> endpoints that let you send multiple operations in a single
HTTP request was deprecated in v3.8.0 and has now been removed.</p><p>To send multiple documents at once to an ArangoDB instance, please use the
<a href=/3.12/develop/http-api/documents/#multiple-document-operations class=link>HTTP interface for documents</a>
that can insert, update, replace, or remove arrays of documents.</p><h2 id=javascript-api>JavaScript API <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#javascript-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=arangodbgraphtraversal-module-removed><code>@arangodb/graph/traversal</code> module removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#arangodbgraphtraversal-module-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The long-deprecated JavaScript-based traversal functionality has been removed in
v3.12.0, including the bundled <code>@arangodb/graph/traversal</code> JavaScript module.</p><p>The functionality provided by this traversal module was deprecated and
unmaintained since v3.4.0. JavaScript-based traversals have been replaced with
AQL traversals in v2.8.0. Additionally, the JavaScript-based traversals could
not handle larger amounts of data and were thus very limited.</p><p>Users of the JavaScript-based traversal API should use
<a href=/3.12/aql/graphs/traversals/ class=link>AQL traversal queries</a> instead.</p><h3 id=graph-compatibility-functions-removed>Graph compatibility functions removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#graph-compatibility-functions-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following long-deprecated compatibility graph functions have been removed
in ArangoDB 3.12. These functions were implemented as JavaScript user-defined
AQL functions since ArangoDB 3.0:</p><ul><li><code>arangodb::GRAPH_EDGES(...)</code></li><li><code>arangodb::GRAPH_VERTICES(...)</code></li><li><code>arangodb::GRAPH_NEIGHBORS(...)</code></li><li><code>arangodb::GRAPH_COMMON_NEIGHBORS(...)</code></li><li><code>arangodb::GRAPH_COMMON_PROPERTIES(...)</code></li><li><code>arangodb::GRAPH_PATHS(...)</code></li><li><code>arangodb::GRAPH_SHORTEST_PATH(...)</code></li><li><code>arangodb::GRAPH_DISTANCE_TO(...)</code></li><li><code>arangodb::GRAPH_ABSOLUTE_ECCENTRICTIY(...)</code></li><li><code>arangodb::GRAPH_ECCENTRICTIY(...)</code></li><li><code>arangodb::GRAPH_ABSOLUTE_CLOSENESS(...)</code></li><li><code>arangodb::GRAPH_CLOSENESS(...)</code></li><li><code>arangodb::GRAPH_ABSOLUTE_BETWEENNESS(...)</code></li><li><code>arangodb::GRAPH_BETWEENNESS(...)</code></li><li><code>arangodb::GRAPH_RADIUS(...)</code></li><li><code>arangodb::GRAPH_DIAMETER(...)</code></li></ul><p>These functions were only available previously after explicitly calling the
<code>_registerCompatibilityFunctions()</code> function from any of the JavaScript graph
modules.
The <code>_registerCompatibilityFunctions()</code> exports have also been removed from
the JavaScript graph modules.</p><h2 id=startup-options>Startup options <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#startup-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=--databaseextended-names-enabled-by-default><code>--database.extended-names</code> enabled by default <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#--databaseextended-names-enabled-by-default class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>--database.extended-names</code> startup option is now enabled by default.
This allows you to use Unicode characters inside database names, collection names,
view names and index names by default, unless you explicitly turn off the
functionality.</p><p>Note that once a server in your deployment has been started with the flag set to
<code>true</code>, it stores this setting permanently. Switching the startup option back to
<code>false</code> raises a warning about the option change at startup, but it is not
blockig the startup.</p><p>Existing databases, collections, views and indexes with extended names can still
be used even with the option set back to <code>false</code>, but no new database objects
with extended names can be created with the option disabled. This state is only
meant to facilitate downgrading or reverting the option change. When the option
is set to <code>false</code>, all database objects with extended names that were created
in the meantime should be removed manually.</p><h3 id=changed-ttl-index-removal-default>Changed TTL index removal default <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#changed-ttl-index-removal-default class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The default value of the <code>--ttl.max-collection-removes</code> startup option has been
lowered from 1 million to 100,000. The background thread for time-to-live indexes
now removes fewer documents from a collection in each iteration to give other
collections a chance of being cleaned up as well.</p><h3 id=increased-rocksdb-block-cache-usage>Increased RocksDB block cache usage <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#increased-rocksdb-block-cache-usage class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following startup options are now enabled by default:</p><ul><li><code>--rocksdb.reserve-table-builder-memory</code></li><li><code>--rocksdb.reserve-table-reader-memory</code></li><li><code>--rocksdb.reserve-file-metadata-memory</code></li></ul><p>This makes the memory accounting for RocksDB more accurate and helps to not
allocate more memory than is configured by tracking the memory use for
table building, tabling reading, file metadata, flushes and compactions and
including it in the existing <code>rocksdb_block_cache_usage</code> metric.</p><p>This slightly decreases performance due to using the block cache for additional
things, and you may need to allow ArangoDB to use more memory for the RocksDB
block cache than before with the <code>--rocksdb.block-cache-size</code> startup option.</p><h4 id=mmap-log-topic-removed><code>mmap</code> log topic removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#mmap-log-topic-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.12.1</small></p><p>The <code>mmap</code> log topic for logging information related to memory mapping has been
unused since v3.12.0 and has now been removed. Attempts to set the log level for
this topic logs a warning, for example, using a startup option like
<code>--log.level mmap=trace</code>.</p><h2 id=client-tools>Client tools <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#client-tools class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=arangodump>arangodump <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#arangodump class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>This following startup options of arangodump are obsolete from ArangoDB 3.12 on:</p><h4 id=obsolete-envelope-and-tick-startup-options>Obsolete envelope and tick startup options <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#obsolete-envelope-and-tick-startup-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><ul><li><code>--envelope</code>: setting this option to <code>true</code> previously wrapped every dumped
document into a <code>{data, type}</code> envelope.
This was useful for the MMFiles storage engine, where dumps could also include
document removals. With the RocksDB storage engine, the envelope only caused
overhead and increased the size of the dumps. The default value of <code>--envelope</code>
was changed to false in ArangoDB 3.9 already, so by default all arangodump
invocations since then created non-envelope dumps. With the option being removed
now, all arangodump invocations will unconditionally create non-envelope dumps.</li><li><code>--tick-start</code>: setting this option allowed to restrict the dumped data to some
time range with the MMFiles storage engine. It had no effect for the RocksDB
storage engine and so it is removed now.</li><li><code>--tick-end</code>: setting this option allowed to restrict the dumped data to some
time range with the MMFiles storage engine. It had no effect for the RocksDB
storage engine and so it is removed now.</li></ul><h3 id=arangoimport>arangoimport <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#arangoimport class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><h4 id=maximum-number-of-import-errors>Maximum number of import errors <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#maximum-number-of-import-errors class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The new <code>--max-errors</code> startup option limits the amount of errors displayed by
<em>arangoimport</em>, and the import is stopped when this value is reached.
The default value is <code>20</code>.</p><p>Previously, the import would continue even when there were many errors. To
achieve a similar behavior with the new version, set the value of <code>--max-errors</code>
to a high value.</p><h4 id=automatic-file-format-detection>Automatic file format detection <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#automatic-file-format-detection class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><em>arangoimport</em> now automatically detects the type of the import file based on
the file extension. The default value of the <code>--type</code> startup option has been
changed from <code>json</code> to <code>auto</code>. You might need to explicitly specify the <code>--type</code>
in exceptional cases now whereas it was not necessary to do so previously.</p><h4 id=decreased-default-batch-size>Decreased default batch size <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#decreased-default-batch-size class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.12.4</small></p><p>The default value of the <code>--batch-size</code> startup option has been lowered from
8 MiB to 4 MiB to avoid potential resource limits, in particular when importing
to smart edge collections.</p><h3 id=jslint-feature-in-arangosh-removed>jslint feature in arangosh removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#jslint-feature-in-arangosh-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>--jslint</code> startup option and all of the underlying functionality has been
removed from arangosh. The feature was mainly for internal purposes.</p><h3 id=arangobench>arangobench <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#arangobench class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><h4 id=batch-size-option-removed>Batch size option removed <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#batch-size-option-removed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Removed in: v3.12.3</small></p><p>The <code>--batch-size</code> startup option is now ignored by arangobench and no longer
has an effect. It allowed you to specify the number of operations to issue in
one batch but the batch request API has been removed on the server-side.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.12/release-notes/version-3.12/known-issues-in-3-12/><i class="fas fa-chevron-left fa-fw"></i><p>Known Issues in 3.12</p></a></span><span class=next><a class="nav nav-next link" href=/3.12/release-notes/version-3.12/api-changes-in-3-12/><p>API changes in 3.12</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.12/release-notes/version-3.12/incompatible-changes-in-3-12.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#license-change>License change</a></div><div class=level-2><a href=#upgrading-312-kubernetes-deployments>Upgrading 3.12 Kubernetes deployments</a></div><div class=level-2><a href=#resolving-known-issues-with-versions-prior-to-3124>Resolving known issues with versions prior to 3.12.4</a></div><div class=level-2><a href=#native-windows-and-macos-support-removed>Native Windows and macOS support removed</a></div><div class=level-2><a href=#active-failover-deployment-mode-removed>Active Failover deployment mode removed</a></div><div class=level-2><a href=#datacenter-to-datacenter-replication-dc2dc-removed>Datacenter-to-Datacenter Replication (DC2DC) removed</a></div><div class=level-2><a href=#pregel-removed>Pregel removed</a></div><div class=level-2><a href=#ldap-authentication-support-removed>LDAP authentication support removed</a></div><div class=level-2><a href=#little-endian-on-disk-key-format-for-the-rocksdb-storage-engine-unsupported>Little-endian on-disk key format for the RocksDB storage engine unsupported</a></div><div class=level-2><a href=#velocystream-protocol-removed>VelocyStream protocol removed</a></div><div class=level-2><a href=#incompatibilities-due-to-switch-to-glibc>Incompatibilities due to switch to glibc</a></div><div class=level-2><a href=#javascript-transactions-deprecated>JavaScript Transactions deprecated</a></div><div class=level-2><a href=#default-server-language-changed>Default server language changed</a></div><div class=level-2><a href=#incompatibilities-with-unicode-text-between-core-and-javascript>Incompatibilities with Unicode text between core and JavaScript</a></div><div class=level-2><a href=#stricter-option-validation-when-creating-collections>Stricter option validation when creating collections</a></div><div class=level-2><a href=#control-character-escaping-in-audit-log>Control character escaping in audit log</a></div><div class=level-2><a href=#higher-reported-memory-usage-for-aql-queries>Higher reported memory usage for AQL queries</a></div><div class=level-2><a href=#adjustable-stream-transaction-size>Adjustable Stream Transaction size</a></div><div class=level-2><a href=#exit-code-adjustments>Exit code adjustments</a></div><div class=level-2><a href=#validation-of-smartgraphattribute-in-smartgraphs>Validation of <code>smartGraphAttribute</code> in SmartGraphs</a></div><div class=level-2><a href=#dropping-graph-collections-disallowed>Dropping graph collections disallowed</a></div><div class=level-2><a href=#short-circuiting-subquery-evaluation>Short-circuiting subquery evaluation</a></div><div class=level-2><a href=#corrected-sorting-order-for-numbers-in-velocypack-indexes>Corrected sorting order for numbers in VelocyPack indexes</a></div><div class=level-3><a href=#issues-with-the-comparison-of-large-indexed-numbers>Issues with the comparison of large indexed numbers</a></div><div class=level-3><a href=#check-if-you-are-affected>Check if you are affected</a></div><div class=level-3><a href=#if-the-deployment-is-not-affected>If the deployment is NOT affected</a></div><div class=level-3><a href=#if-the-deployment-is-affected>If the deployment is affected</a></div><div class=level-2><a href=#changed-json-serialization-and-velocypack-format-for-replication>Changed JSON serialization and VelocyPack format for replication</a></div><div class=level-2><a href=#corrected-sorting-order-for-strings-in-velocypack-indexes>Corrected sorting order for strings in VelocyPack indexes</a></div><div class=level-3><a href=#issues-with-the-sorting-order-of-certain-strings>Issues with the sorting order of certain strings</a></div><div class=level-3><a href=#before-the-upgrade>Before the upgrade</a></div><div class=level-3><a href=#upgrade-an-enterprise-edition-deployment>Upgrade an Enterprise Edition deployment</a></div><div class=level-3><a href=#upgrade-a-community-edition-deployment>Upgrade a Community Edition deployment</a></div><div class=level-3><a href=#if-the-deployment-is-in-read-only-mode>If the deployment is in read-only mode</a></div><div class=level-2><a href=#http-restful-api>HTTP RESTful API</a></div><div class=level-3><a href=#javascript-based-traversal-using-_apitraversal-removed>JavaScript-based traversal using <code>/_api/traversal</code> removed</a></div><div class=level-3><a href=#http-server-behavior>HTTP server behavior</a></div><div class=level-3><a href=#graph-api-gharial-behavior>Graph API (Gharial) behavior</a></div><div class=level-3><a href=#batch-request-endpoint-removed>Batch request endpoint removed</a></div><div class=level-2><a href=#javascript-api>JavaScript API</a></div><div class=level-3><a href=#arangodbgraphtraversal-module-removed><code>@arangodb/graph/traversal</code> module removed</a></div><div class=level-3><a href=#graph-compatibility-functions-removed>Graph compatibility functions removed</a></div><div class=level-2><a href=#startup-options>Startup options</a></div><div class=level-3><a href=#--databaseextended-names-enabled-by-default><code>--database.extended-names</code> enabled by default</a></div><div class=level-3><a href=#changed-ttl-index-removal-default>Changed TTL index removal default</a></div><div class=level-3><a href=#increased-rocksdb-block-cache-usage>Increased RocksDB block cache usage</a></div><div class=level-4><a href=#mmap-log-topic-removed><code>mmap</code> log topic removed</a></div><div class=level-2><a href=#client-tools>Client tools</a></div><div class=level-3><a href=#arangodump>arangodump</a></div><div class=level-4><a href=#obsolete-envelope-and-tick-startup-options>Obsolete envelope and tick startup options</a></div><div class=level-3><a href=#arangoimport>arangoimport</a></div><div class=level-4><a href=#maximum-number-of-import-errors>Maximum number of import errors</a></div><div class=level-4><a href=#automatic-file-format-detection>Automatic file format detection</a></div><div class=level-4><a href=#decreased-default-batch-size>Decreased default batch size</a></div><div class=level-3><a href=#jslint-feature-in-arangosh-removed>jslint feature in arangosh removed</a></div><div class=level-3><a href=#arangobench>arangobench</a></div><div class=level-4><a href=#batch-size-option-removed>Batch size option removed</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>