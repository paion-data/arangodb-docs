<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743775370></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="Improved memory accounting, wildcard search, and dump performance, multi-dimensional indexes, external versioning, and transparent compression"><meta property="og:url" content="http://localhost/3.12/release-notes/version-3.12/whats-new-in-3-12/"><meta property="og:title" content="Features and Improvements in ArangoDB 3.12"><meta property="og:type" content="website"><meta property="og:description" content="Improved memory accounting, wildcard search, and dump performance, multi-dimensional indexes, external versioning, and transparent compression"><meta name=docsearch:version content="3.12"><title>Features and Improvements in ArangoDB 3.12 | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743775370 defer></script>
<script src=/js/featherlight.min.js?1743775370 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743775370 defer></script>
<script src=/js/theme.js?1743775370 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.12"><a itemprop=item class=link href=/3.12/><span itemprop=name class=breadcrumb-entry>3.12.4</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Release Notes"><a itemprop=item class=link href=/3.12/release-notes/><span itemprop=name class=breadcrumb-entry>Release Notes</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Version 3.12"><a itemprop=item class=link href=/3.12/release-notes/version-3.12/><span itemprop=name class=breadcrumb-entry>Version 3.12</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="What&rsquo;s New in 3.12"><a itemprop=item class=link href=/3.12/release-notes/version-3.12/whats-new-in-3-12/><span itemprop=name class=breadcrumb-entry>What&rsquo;s New in 3.12</span></a></li></ol></nav><article class=default><hgroup><h1>Features and Improvements in ArangoDB 3.12</h1><p class=lead>Improved memory accounting, wildcard search, and dump performance, multi-dimensional indexes, external versioning, and transparent compression</p></hgroup><p>The following list shows in detail which features have been added or improved in
ArangoDB 3.12. ArangoDB 3.12 also contains several bug fixes that are not listed
here.</p><h2 id=arangosearch>ArangoSearch <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#arangosearch class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=wand-optimization-enterprise-edition>WAND optimization (Enterprise Edition) <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#wand-optimization-enterprise-edition class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>For <code>arangosearch</code> Views and inverted indexes (and by extension <code>search-alias</code>
Views), you can define a list of sort expressions that you want to optimize.
This is also known as <em>WAND optimization</em>.</p><p>If you query a View with the <code>SEARCH</code> operation in combination with a
<code>SORT</code> and <code>LIMIT</code> operation, search results can be retrieved faster if the
<code>SORT</code> expression matches one of the optimized expressions.</p><p>Only sorting by highest rank is supported, that is, sorting by the result
of a scoring function in descending order (<code>DESC</code>).</p><p>See <a href=/3.12/index-and-search/arangosearch/performance/#wand-optimization class=link>Optimizing View and inverted index query performance</a>
for examples.</p><p>This feature is only available in the Enterprise Edition.</p><h3 id=search-parallelization><code>SEARCH</code> parallelization <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#search-parallelization class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>In search queries against Views, you can set the new <code>parallelism</code> option for
<code>SEARCH</code> operations to optionally process index segments in parallel using
multiple threads. This can speed up search queries.</p><p>The default value for the <code>parallelism</code> option is defined by the new
<code>--arangosearch.default-parallelism</code> startup option that defaults to <code>1</code>.</p><p>The new <code>--arangosearch.execution-threads-limit</code> startup option controls how
many threads can be used in total for search queries. The new
<code>arangodb_search_execution_threads_demand</code> metric reports the number of threads
that queries request. If it is below the configured thread limit, it coincides
with the number of active threads. If it exceeds the limit, some queries cannot
currently get the threads as requested and may have to use a single thread until
more become available.</p><p>See <a href=/3.12/aql/high-level-operations/search/#parallelism class=link><code>SEARCH</code> operation in AQL</a>
for details.</p><h2 id=analyzers>Analyzers <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#analyzers class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=wildcard-analyzer><code>wildcard</code> Analyzer <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#wildcard-analyzer class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>You can use the new <code>wildcard</code> Analyzer in combination with an inverted index or
View to accelerate wildcard searches, especially if you want to find non-prefix
partial matches in long strings.</p><p>The Analyzer can apply another Analyzer of your choice before creating <em>n</em>-grams
that are then used in <code>LIKE</code> searches with <code>_</code> and <code>%</code> wildcards.</p><p>See <a href=/3.12/index-and-search/analyzers/#wildcard class=link>Transforming data with Analyzers</a>
for details.</p><h3 id=multi_delimiter-analyzer><code>multi_delimiter</code> Analyzer <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#multi_delimiter-analyzer class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The new <code>multi_delimiter</code> Analyzer type accepts an array of strings to define
multiple delimiters to split the input at. Each string is considered as one
delimiter that can be one or multiple characters long.</p><p>Unlike with the <code>delimiter</code> Analyzer, the <code>multi_delimiter</code> Analyzer does not
support quoting fields.</p><p>If you want to split text using multiple delimiters and don&rsquo;t require CSV-like
quoting, use the <code>multi_delimiter</code> Analyzer instead of chaining multiple
<code>delimiter</code> Analyzers in a <code>pipeline</code> Analyzer.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>analyzers</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/analyzers&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>a</span> <span class=o>=</span> <span class=nx>analyzers</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=s2>&#34;delimiter_multiple&#34;</span><span class=p>,</span> <span class=s2>&#34;multi_delimiter&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>delimiters</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;,&#34;</span><span class=p>,</span> <span class=s2>&#34;;&#34;</span><span class=p>,</span> <span class=s2>&#34;||&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span><span class=sb>`RETURN TOKENS(&#34;differently,delimited;words||one|token&#34;, &#34;delimiter_multiple&#34;)`</span><span class=p>).</span><span class=nx>toArray</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// [ [&#34;differently&#34;, &#34;delimited&#34;, &#34;words&#34;, &#34;one|token&#34;] ]
</span></span></span></code></pre></div><p>See <a href=/3.12/index-and-search/analyzers/#multi_delimiter class=link>Analyzers</a> for details.</p><h2 id=improved-memory-accounting-and-usage>Improved memory accounting and usage <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#improved-memory-accounting-and-usage class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Version 3.12 features multiple improvements to the observability of ArangoDB
deployments. Memory usage is more accurately tracked and additional metrics have
been added for monitoring the memory consumption.</p><p>AQL queries may now report a higher memory usage and thus run into memory limits
sooner, see <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#higher-reported-memory-usage-for-aql-queries class=link>Higher reported memory usage for AQL queries</a>.</p><p>The RocksDB block cache metric <code>rocksdb_block_cache_usage</code> now also includes the
memory used for table building, table reading, file metadata, flushing and
compactions by default.</p><p>Furthermore, the memory usage of some subsystems has been optimized. When
dropping a database, all contained collections are now marked as dropped
immediately. Ongoing operations on these collections can be stopped earlier, and
memory for the underlying collections and indexes can be reclaimed sooner.
Memory used for index selectively estimates is now also released early.
ArangoSearch has a smaller memory footprint for removal operations now.</p><p>The following new metrics have been added for memory observability:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>arangodb_agency_node_memory_usage</code></td><td style=text-align:left>Memory used by Agency store/cache.</td></tr><tr><td style=text-align:left><code>arangodb_aql_cursors_memory_usage</code></td><td style=text-align:left>Total memory usage of active AQL query result cursors.</td></tr><tr><td style=text-align:left><code>arangodb_index_estimates_memory_usage</code></td><td style=text-align:left>Total memory usage of all index selectivity estimates.</td></tr><tr><td style=text-align:left><code>arangodb_internal_cluster_info_memory_usage</code></td><td style=text-align:left>Amount of memory spent in ClusterInfo.</td></tr><tr><td style=text-align:left><code>arangodb_requests_memory_usage</code></td><td style=text-align:left>Memory consumed by incoming, queued, and currently processed requests.</td></tr><tr><td style=text-align:left><code>arangodb_revision_tree_buffered_memory_usage</code></td><td style=text-align:left>Total memory usage of buffered updates for all revision trees.</td></tr><tr><td style=text-align:left><code>arangodb_scheduler_queue_memory_usage</code></td><td style=text-align:left>Number of bytes allocated for tasks in the scheduler queue.</td></tr><tr><td style=text-align:left><code>arangodb_scheduler_stack_memory_usage</code></td><td style=text-align:left>Approximate stack memory usage of worker threads.</td></tr><tr><td style=text-align:left><code>arangodb_search_consolidations_memory_usage</code></td><td style=text-align:left>Amount of memory in bytes that is used for consolidating an ArangoSearch index.</td></tr><tr><td style=text-align:left><code>arangodb_search_mapped_memory</code></td><td style=text-align:left>Amount of memory in bytes that is mapped for an ArangoSearch index.</td></tr><tr><td style=text-align:left><code>arangodb_search_readers_memory_usage</code></td><td style=text-align:left>Amount of memory in bytes that is used for reading from an ArangoSearch index.</td></tr><tr><td style=text-align:left><code>arangodb_search_writers_memory_usage</code></td><td style=text-align:left>Amount of memory in bytes that is used for writing to an ArangoSearch index.</td></tr><tr><td style=text-align:left><code>arangodb_transactions_internal_memory_usage</code></td><td style=text-align:left>Total memory usage of internal transactions.</td></tr><tr><td style=text-align:left><code>arangodb_transactions_rest_memory_usage</code></td><td style=text-align:left>Total memory usage of user transactions (excluding top-level AQL queries).</td></tr></tbody></table><h2 id=web-interface>Web interface <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#web-interface class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=shard-rebalancing>Shard rebalancing <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#shard-rebalancing class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The feature for rebalancing shards in cluster deployments has been moved from
the <strong>Rebalance Shards</strong> tab in the <strong>Nodes</strong> section to the <strong>Distribution</strong>
tab in the <strong>Cluster</strong> section of the web interface.</p><p>The updated interface now offers the following options:</p><ul><li><strong>Move Leaders</strong></li><li><strong>Move Followers</strong></li><li><strong>Include System Collections</strong></li></ul><h3 id=unified-list-view>Unified list view <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#unified-list-view class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>ArangoDB 3.12 brings a significant enhancement to the display of collections,
Views, graphs, users, services, and databases in the web interface.
The previous tile format has been replaced with a user-friendly tabular
layout, providing a consistent and intuitive experience that is visually
aligned across all components. The existing tabular views have also been
reworked to ensure a seamless transition.</p><p>The new tabular format includes the following features:</p><ul><li><strong>Dynamic filters on columns</strong>: Each column now has a dynamic filter box,
allowing you to efficiently search and filter based on keywords. This makes
it easy to locate specific items within the list.</li><li><strong>Dynamic sorting on columns</strong>: Sort elements easily based on column data
such as name, date, or size. This functionality provides a flexible way to
organize and view your data.</li></ul><h3 id=options--optimizer-rules-management-in-the-query-editor>Options & optimizer rules management in the Query Editor <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#options--optimizer-rules-management-in-the-query-editor class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>You can now specify extra options for your queries via the query editor.
You can find all available options in the new <strong>Options</strong> tab in the
right-hand pane of the editor view, positioned alongside the <strong>Bind Variables</strong>
tab.</p><p>In the new <strong>Options</strong> tab, you also have access to the
<a href=/3.12/aql/execution-and-performance/query-optimization/#optimizer-rules class=link>optimizer rules</a>.
This section allows you to selectively disable multiple optimizer rules, giving
you more control over query optimization according to your specific requirements.</p><h3 id=swagger-ui>Swagger UI <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#swagger-ui class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The interactive tool for exploring HTTP APIs has been updated to version 5.4.1.
You can find it in the web interface in the <strong>Rest API</strong> tab of the <strong>Support</strong>
section, as well as in the <strong>API</strong> tab of Foxx services and Foxx routes that use
<code>module.context.createDocumentationRouter()</code>.</p><p>The new version adds support for OpenAPI 3.x specifications in addition to
Swagger 2.x compatibility.</p><h2 id=external-versioning-support>External versioning support <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#external-versioning-support class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Document operations that update or replace documents now support a <code>versionAttribute</code> option.
If set, the attribute with the name specified by the option is looked up in the
stored document and the attribute value is compared numerically to the value of
the versioning attribute in the supplied document that is supposed to update/replace it.
The document is only changed if the new number is higher.</p><p>This simple versioning can help to avoid overwriting existing data with older
versions in case data is transferred from an external system into ArangoDB
and the copies are currently not in sync.</p><p>This new feature is supported in AQL, the JavaScript API, and the HTTP API for
the respective operations to update and replace documents, including the insert
operations when used to update/replace a document with <code>overwriteMode: "update"</code>
or <code>overwriteMode: "replace"</code>.</p><p><strong>Examples:</strong></p><p>Insert a new document normally using <em>arangosh</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;123&#34;</span><span class=p>,</span> <span class=nx>externalVersion</span><span class=o>:</span> <span class=mi>1</span> <span class=p>});</span></span></span></code></pre></div><p>Update the document if the versioning attribute is higher in the new document,
which is true in this case:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=s2>&#34;123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>externalVersion</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span> <span class=nx>anotherAttribute</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>versionAttribute</span><span class=o>:</span> <span class=s2>&#34;externalVersion&#34;</span> <span class=p>});</span></span></span></code></pre></div><p>Updating the document is skipped if the versioning attribute is lower or equal
in the supplied document compared to what is currently stored in ArangoDB:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=s2>&#34;123&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>externalVersion</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span> <span class=nx>anotherAttribute</span><span class=o>:</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>versionAttribute</span><span class=o>:</span> <span class=s2>&#34;externalVersion&#34;</span> <span class=p>});</span></span></span></code></pre></div><p>You can also make use of the <code>versionAttribute</code> option in an insert-update
operation for the update case, including in AQL:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>_key</span><span class=o>:</span> <span class=s2>&#34;123&#34;</span><span class=p>,</span> <span class=nx>externalVersion</span><span class=o>:</span> <span class=mi>6</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=s2>&#34;foo&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>overwriteMode</span><span class=o>:</span> <span class=s2>&#34;update&#34;</span><span class=p>,</span> <span class=nx>versionAttribute</span><span class=o>:</span> <span class=s2>&#34;externalVersion&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span><span class=sb>`UPDATE { _key: &#34;123&#34;, externalVersion: 7, value: &#34;bar&#34; } IN collection 
</span></span></span><span class=line><span class=cl><span class=sb>  OPTIONS { versionAttribute: &#34;externalVersion&#34;}`</span><span class=p>);</span></span></span></code></pre></div><p>External versioning is opt-in and no version checking is performed for
operations for which the <code>versionAttribute</code> option isn&rsquo;t set. Document removal
operations do not support external versioning. Removal operations are always
carried out normally.</p><p>Note that version checking is performed only if both the existing version of
the document in the database and the new document version contain the version
attribute with numeric values of <code>0</code> or greater. If neither the existing document
in the database nor the new document contains the version attribute, or if the
version attribute in any of the two is not a number inside the valid range, the
update/replace operations behave as if no version checking was requested.
This may overwrite the versioning attribute in the database.</p><p>Also see:</p><ul><li>The AQL <a href=/3.12/aql/high-level-operations/insert/#versionattribute class=link>INSERT</a>,
<a href=/3.12/aql/high-level-operations/update/#versionattribute class=link>UPDATE</a> and
<a href=/3.12/aql/high-level-operations/update/#versionattribute class=link>REPLACE</a> operations</li><li>The <code>insert()</code>, <code>update()</code>, <code>replace()</code> methods of the
<a href=/3.12/develop/javascript-api/@arangodb/collection-object/#collectioninsertdata--options class=link><em>collection</em> object</a>
in the JavaScript API</li><li>The endpoints to create, update, and replace a single or multiple documents
in the <a href=/3.12/develop/javascript-api/@arangodb/collection-object/#collectioninsertdata--options class=link>HTTP API</a></li></ul><h2 id=aql>AQL <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#aql class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=improved-joins>Improved joins <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#improved-joins class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The AQL optimizer now automatically recognizes whether a better strategy for
joining collections can be used, using the new <code>join-index-nodes</code> optimizer rule.</p><p>If two or more collections are joined using nested <code>FOR</code> loops and the
attributes you join on are indexed by primary indexes or persistent indexes,
then a merge join can be performed because they are sorted.</p><p>Note that returning document attributes from the outer loop is limited to
attributes covered by the index, or the improved join strategy cannot be used.</p><p>The following example query shows an inner join between orders and users on
user ID. Each document in the <code>orders</code> collection references a <code>user</code>, and the
<code>users</code> collection stores the user ID in the <code>_key</code> attribute. The query returns
the <code>total</code> attribute of every order along with the user information:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>o</span> <span class=kr>IN</span> <span class=n>orders</span>
</span></span><span class=line><span class=cl>  <span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>o</span><span class=p>.</span><span class=n>user</span> <span class=o>==</span> <span class=n>u</span><span class=p>.</span><span class=n>_key</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>orderTotal</span><span class=o>:</span> <span class=n>o</span><span class=p>.</span><span class=n>total</span><span class=p>,</span> <span class=n>user</span><span class=o>:</span> <span class=n>u</span> <span class=p>}</span></span></span></code></pre></div><p>The <code>_key</code> attribute is covered by the primary index of the <code>users</code> collection.
If the <code>orders</code> collection has a persistent index defined over the <code>user</code>
attribute and additionally includes the <code>total</code> attribute in
<a href=/3.12/index-and-search/indexing/working-with-indexes/persistent-indexes/#storing-additional-values-in-indexes class=link><code>storedValues</code></a>,
then the query is eligible for a merge join.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Par</span>     <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>                <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>JoinNode</span>            <span class=err>✓</span>   <span class=mi>500000</span>     <span class=o>-</span> <span class=n>JOIN</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>JoinNode</span>                <span class=mi>500000</span>       <span class=o>-</span> <span class=kr>FOR</span> <span class=n>o</span> <span class=kr>IN</span> <span class=n>orders</span>   <span class=kd>LET</span> <span class=nl>#8</span> <span class=o>=</span> <span class=n>o</span><span class=p>.</span><span class=n>`total`</span>   <span class=cm>/* index scan (projections: `total`) */</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>JoinNode</span>                     <span class=mi>1</span>       <span class=o>-</span> <span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>   <span class=cm>/* index scan + document lookup */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>CalculationNode</span>     <span class=err>✓</span>   <span class=mi>500000</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#4</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;orderTotal&#34;</span> <span class=o>:</span> <span class=nl>#8</span><span class=p>,</span> <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=n>u</span> <span class=p>}</span>   <span class=cm>/* simple expression */</span>   <span class=cm>/* collections used: u : users */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>ReturnNode</span>              <span class=mi>500000</span>     <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>         <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>       <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>idx_1784521139132825600</span>   <span class=n>persistent</span>   <span class=n>orders</span>       <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>      <span class=mi>10</span><span class=mf>0.00</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`user`</span> <span class=p>]</span>   <span class=p>[</span> <span class=n>`total`</span> <span class=p>]</span>     <span class=o>*</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>primary</span>                   <span class=n>primary</span>      <span class=n>users</span>        <span class=kc>true</span>     <span class=kc>false</span>    <span class=kc>false</span>      <span class=mi>10</span><span class=mf>0.00</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`_key`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>`user`</span> <span class=o>==</span> <span class=n>u</span><span class=p>.</span><span class=n>`_key`</span><span class=p>)</span></span></span></code></pre></div><h3 id=filter-matching-syntax-for-upsert-operations>Filter matching syntax for <code>UPSERT</code> operations <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#filter-matching-syntax-for-upsert-operations class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Version 3.12 introduces an alternative syntax for
<a href=/3.12/aql/high-level-operations/upsert/ class=link><code>UPSERT</code> operations</a> that allows
you to use more flexible filter conditions to look up documents. Previously,
the expression used to look up a document had to be an object literal, and this
is now called the &ldquo;exact-value matching&rdquo; syntax.</p><p>The new &ldquo;filter matching&rdquo; syntax lets you use a <code>FILTER</code> statement for the
<code>UPSERT</code> operation. The filter condition for the lookup can make use of the
<code>CURRENT</code> pseudo-variable to access the lookup document.</p><div class=tab-panel><div class=tab-content><div class=tab-nav><button data-tab-group=upsert-syntax data-tab-item="Filter matching" class="tab-nav-button selected" onclick='switchTab("upsert-syntax","Filter matching",event)'>
<span>Filter matching</span></button>
<button data-tab-group=upsert-syntax data-tab-item="Exact-value matching" class=tab-nav-button onclick='switchTab("upsert-syntax","Exact-value matching",event)'>
<span>Exact-value matching</span></button></div><div data-tab-item="Filter matching" data-tab-group=upsert-syntax class="tab-item
selected"><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>UPSERT</span> <span class=kr>FILTER</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>name</span> <span class=o>==</span> <span class=s1>&#39;superuser&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>INSERT</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=s1>&#39;superuser&#39;</span><span class=p>,</span> <span class=n>logins</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>dateCreated</span><span class=o>:</span> <span class=nf>DATE_NOW</span><span class=p>()</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>UPDATE</span> <span class=p>{</span> <span class=n>logins</span><span class=o>:</span> <span class=bp>OLD</span><span class=p>.</span><span class=n>logins</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div></div><div data-tab-item="Exact-value matching" data-tab-group=upsert-syntax class=tab-item><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>UPSERT</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=s1>&#39;superuser&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>INSERT</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=s1>&#39;superuser&#39;</span><span class=p>,</span> <span class=n>logins</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>dateCreated</span><span class=o>:</span> <span class=nf>DATE_NOW</span><span class=p>()</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>UPDATE</span> <span class=p>{</span> <span class=n>logins</span><span class=o>:</span> <span class=bp>OLD</span><span class=p>.</span><span class=n>logins</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div></div></div></div><p>The <code>FILTER</code> expression can contain operators such as <code>AND</code> and <code>OR</code> to create
complex filter conditions, and you can apply more filters on the <code>CURRENT</code>
pseudo-variable than just equality matches.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>UPSERT</span> <span class=kr>FILTER</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>age</span> <span class=o>&lt;</span> <span class=mi>30</span> <span class=kr>AND</span> <span class=p>(</span><span class=nf>STARTS_WITH</span><span class=p>(</span><span class=bp>CURRENT</span><span class=p>.</span><span class=n>name</span><span class=p>,</span> <span class=s2>&#34;Jo&#34;</span><span class=p>)</span> <span class=kr>OR</span> <span class=bp>CURRENT</span><span class=p>.</span><span class=n>gender</span> <span class=kr>IN</span> <span class=p>[</span><span class=s2>&#34;f&#34;</span><span class=p>,</span> <span class=s2>&#34;x&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=kr>INSERT</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=s1>&#39;Jordan&#39;</span><span class=p>,</span> <span class=n>age</span><span class=o>:</span> <span class=mi>29</span><span class=p>,</span> <span class=n>logins</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>dateCreated</span><span class=o>:</span> <span class=nf>DATE_NOW</span><span class=p>()</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>UPDATE</span> <span class=p>{</span> <span class=n>logins</span><span class=o>:</span> <span class=bp>OLD</span><span class=p>.</span><span class=n>logins</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><p>Read more about <a href=/3.12/aql/high-level-operations/upsert/ class=link><code>UPSERT</code> operations</a> in AQL.</p><h3 id=readownwrites-option-for-upsert-operations><code>readOwnWrites</code> option for <code>UPSERT</code> operations <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#readownwrites-option-for-upsert-operations class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>A <code>readOwnWrites</code> option has been added for <code>UPSERT</code> operations. The default
value is <code>true</code> and the behavior is identical to previous versions of ArangoDB that
do not have this option. When enabled, an <code>UPSERT</code> operation processes its
inputs one by one. This way, the operation can observe its own writes and can
handle modifying the same target document multiple times in the same query.</p><p>When the option is set to <code>false</code>, an <code>UPSERT</code> operation processes its inputs
in batches. Normally, a batch has 1000 inputs, which can lead to a faster execution.
However, when using batches, the <code>UPSERT</code> operation cannot observe its own writes.
Therefore, you should only set the <code>readOwnWrites</code> option to <code>false</code> if you can
guarantee that the input of the <code>UPSERT</code> leads to disjoint documents being
inserted, updated, or replaced.</p><h3 id=parallel-execution-within-an-aql-query>Parallel execution within an AQL query <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#parallel-execution-within-an-aql-query class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The new <code>async-prefetch</code> optimizer rule allows certain operations of a query to
asynchronously prefetch the next batch of data while processing the current batch,
allowing parts of the query to run in parallel. This can lead to performance
improvements if there is still reserve (scheduler) capacity.</p><p>The new <code>Par</code> column in a query explain output shows which nodes of a query are
eligible for asynchronous prefetching. Write queries, graph execution nodes,
nodes inside subqueries, <code>LIMIT</code> nodes and their dependencies above, as well as
all query parts that include a <code>RemoteNode</code> are not eligible.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>                  <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>                      <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>EnumerateCollectionNode</span>     <span class=err>✓</span>     <span class=mi>18</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>places</span>   <span class=cm>/* full collection scan  */</span>   <span class=kr>FILTER</span> <span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>`label`</span> <span class=kr>IN</span> <span class=p>[</span> <span class=s2>&#34;Glasgow&#34;</span><span class=p>,</span> <span class=s2>&#34;Aberdeen&#34;</span> <span class=p>])</span>   <span class=cm>/* early pruning */</span>
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>CalculationNode</span>             <span class=err>✓</span>     <span class=mi>18</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#2</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`label`</span>   <span class=cm>/* attribute expression */</span>   <span class=cm>/* collections used: doc : places */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>SortNode</span>                    <span class=err>✓</span>     <span class=mi>18</span>       <span class=o>-</span> <span class=kr>SORT</span> <span class=nl>#2</span> <span class=kr>ASC</span>   <span class=cm>/* sorting strategy: standard */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>ReturnNode</span>                        <span class=mi>18</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>The profiling output for queries includes a new <code>Par</code> column as well, but it
shows the number of successful parallel asynchronous prefetch calls.</p><p>To not overwhelm the server, async prefetching is restricted and the limits are adjustable.
See <a href=#configurable-async-prefetch-limits class=link>Configurable async prefetch limits</a>.</p><h3 id=added-aql-functions>Added AQL functions <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#added-aql-functions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The new <code>PARSE_COLLECTION()</code> and <code>PARSE_KEY()</code> functions let you extract the
collection name respectively the document key from a document identifier with
less overhead.</p><p>See <a href=/3.12/aql/functions/document-object/#parse_collection class=link>Document and object functions in AQL</a>.</p><p>The new <code>REPEAT()</code> function repeats the input value a given number of times,
optionally with a separator between repetitions, and returns the resulting string.
The new <code>TO_CHAR()</code> functions lets you specify a numeric Unicode codepoint and
returns the corresponding character as a string.</p><p>See <a href=/3.12/aql/functions/string/#repeat class=link>String functions in AQL</a>.</p><p>A numeric function <code>RANDOM()</code> has been added as an alias for the existing <code>RAND()</code>.</p><hr><p><small>Introduced in: v3.12.1</small></p><p>The new <code>ENTRIES()</code> functions returns the top-level attributes of an object in
pairs of attribute keys and values.</p><p>See <a href=/3.12/aql/functions/document-object/#entries class=link>Document and object functions in AQL</a>.</p><h3 id=timezone-parameter-for-date-functions>Timezone parameter for date functions <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#timezone-parameter-for-date-functions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following AQL date functions now accept an optional timezone argument to
perform date and time calculations in certain timezones:</p><ul><li><code>DATE_DAYOFWEEK(date, timezone)</code></li><li><code>DATE_YEAR(date, timezone)</code></li><li><code>DATE_MONTH(date, timezone)</code></li><li><code>DATE_DAY(date, timezone)</code></li><li><code>DATE_HOUR(date, timezone)</code></li><li><code>DATE_MINUTE(date, timezone)</code></li><li><code>DATE_DAYOFYEAR(date, timezone)</code></li><li><code>DATE_ISOWEEK(date, timezone)</code></li><li><code>DATE_ISOWEEKYEAR(date, timezone)</code></li><li><code>DATE_LEAPYEAR(date, timezone)</code></li><li><code>DATE_QUARTER(date, timezone)</code></li><li><code>DATE_DAYS_IN_MONTH(date, timezone)</code></li><li><code>DATE_TRUNC(date, unit, timezone)</code></li><li><code>DATE_ROUND(date, amount, unit, timezone)</code></li><li><code>DATE_FORMAT(date, format, timezone)</code></li><li><code>DATE_ADD(date, amount, unit, timezone)</code></li><li><code>DATE_SUBTRACT(date, amount, unit, timezone)</code></li></ul><p>The following two functions accept up to two timezone arguments. If you only
specify the first, then both input dates are assumed to be in this one timezone.
If you specify two timezones, then the first date is assumed to be in the first
timezone, and the second date in the second timezone:</p><ul><li><code>DATE_DIFF(date1, date2, unit, asFloat, timezone1, timezone2)</code> (<code>asFloat</code> can be left out)</li><li><code>DATE_COMPARE(date1, date2, unitRangeStart, unitRangeEnd, timezone1, timezone2)</code></li></ul><p>See <a href=/3.12/aql/functions/date/#date_dayofweek class=link>Date functions in AQL</a></p><h3 id=improved-move-filters-into-enumerate-optimizer-rule>Improved <code>move-filters-into-enumerate</code> optimizer rule <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#improved-move-filters-into-enumerate-optimizer-rule class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>move-filters-into-enumerate</code> optimizer rule can now also move filters into
<code>EnumerateListNodes</code> for early pruning. This can significantly improve the
performance of queries that do a lot of filtering on longer lists of
non-collection data.</p><h3 id=improved-late-document-materialization>Improved late document materialization <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#improved-late-document-materialization class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>When <code>FILTER</code> operations can be covered by <code>primary</code>, <code>edge</code>, or <code>persistent</code>
indexes, ArangoDB utilizes the index information to only request documents from
the storage engine that fulfill the criteria. This late document materialization
has been improved to load documents in batches for efficiency. It now also
supports projections to fetch subsets of the documents if only a few attributes
are accessed in an AQL query.</p><p>For example, a query like below can use late materialization if there is a
<code>persistent</code> index over the <code>x</code> attribute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>x</span> <span class=o>&gt;</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>[</span><span class=n>doc</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>z</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>a</span><span class=p>]</span></span></span></code></pre></div><p>If the <code>y</code>, <code>z</code>, and <code>a</code> attributes are not covered by the index (e.g. <code>storedValues</code>),
then they need to be fetched from the storage engine. This no longer requires to
load the full documents, as indicated by the <code>/* (projections: … ) /*</code> comment
on the <code>MaterializeNode</code> due to an improved <code>reduce-extraction-to-projection</code>
optimizer rule. The loading is performed in batches due to the new
<code>batch-materialize-documents</code> optimization.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>              <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>IndexNode</span>           <span class=err>✓</span>   <span class=mi>1000</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* persistent index scan, index scan + document lookup */</span>    <span class=cm>/* with late materialization */</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>MaterializeNode</span>         <span class=mi>1000</span>       <span class=o>-</span> <span class=n>MATERIALIZE</span> <span class=n>doc</span> <span class=cm>/* (projections: `a`, `y`, `z`) */</span>
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>CalculationNode</span>     <span class=err>✓</span>   <span class=mi>1000</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#2</span> <span class=o>=</span> <span class=p>[</span> <span class=n>doc</span><span class=p>.</span><span class=n>`y`</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>`z`</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>`a`</span> <span class=p>]</span>   <span class=cm>/* simple expression */</span>   <span class=cm>/* collections used: doc : coll */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>ReturnNode</span>              <span class=mi>1000</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>         <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>    <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>idx_1788354556957032448</span>   <span class=n>persistent</span>   <span class=n>coll</span>         <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>      <span class=mi>10</span><span class=mf>0.00</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`x`</span> <span class=p>]</span>   <span class=p>[</span> <span class=n>`b`</span> <span class=p>]</span>         <span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>`x`</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Optimization</span> <span class=n>rules</span> <span class=n>applied</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                                 <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                                 <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                        
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>move</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=n>up</span>                       <span class=mi>5</span>   <span class=n>use</span><span class=o>-</span><span class=n>indexes</span>                                <span class=mi>9</span>   <span class=n>batch</span><span class=o>-</span><span class=n>materialize</span><span class=o>-</span><span class=n>documents</span>      
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>move</span><span class=o>-</span><span class=n>filters</span><span class=o>-</span><span class=n>up</span>                            <span class=mi>6</span>   <span class=kr>remove</span><span class=o>-</span><span class=kr>filter</span><span class=o>-</span><span class=n>covered</span><span class=o>-</span><span class=n>by</span><span class=o>-</span><span class=n>index</span>            <span class=mi>10</span>   <span class=n>async</span><span class=o>-</span><span class=n>prefetch</span>                   
</span></span><span class=line><span class=cl>  <span class=mi>3</span>   <span class=n>move</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=n>up</span><span class=o>-</span><span class=mi>2</span>                     <span class=mi>7</span>   <span class=kr>remove</span><span class=o>-</span><span class=n>unnecessary</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=mi>4</span>   <span class=n>move</span><span class=o>-</span><span class=n>filters</span><span class=o>-</span><span class=n>up</span><span class=o>-</span><span class=mi>2</span>                          <span class=mi>8</span>   <span class=n>reduce</span><span class=o>-</span><span class=n>extraction</span><span class=o>-</span><span class=kp>to</span><span class=o>-</span><span class=n>projection</span>  
</span></span></code></pre></div><p>The number of document lookups caused by late materialization is now reported
under <code>extra.stats.documentLookups</code> by the Cursor HTTP API and shown in a column
of the query profile output:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Query</span> <span class=n>Statistics</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Writes</span> <span class=n>Exec</span>      <span class=n>Writes</span> <span class=n>Ign</span>      <span class=n>Doc</span><span class=p>.</span> <span class=n>Lookups</span>      <span class=n>Scan</span> <span class=n>Full</span>      <span class=n>Scan</span> <span class=n>Index</span>      <span class=n>Cache</span> <span class=n>Hits</span><span class=o>/</span><span class=n>Misses</span>      <span class=n>Filtered</span>      <span class=n>Peak</span> <span class=n>Mem</span> <span class=p>[</span><span class=n>b</span><span class=p>]</span>      <span class=n>Exec</span> <span class=n>Time</span> <span class=p>[</span><span class=n>s</span><span class=p>]</span>
</span></span><span class=line><span class=cl>           <span class=mi>0</span>               <span class=mi>0</span>               <span class=mi>290</span>              <span class=mi>0</span>            <span class=mi>3708</span>                  <span class=mi>0</span> <span class=o>/</span> <span class=mi>0</span>          <span class=mi>3418</span>             <span class=mi>32768</span>            <span class=mf>0.01247</span></span></span></code></pre></div><hr><p><small>Introduced in: v3.12.1</small></p><p>The late materialization has been further improved via two new optimizer rules:</p><ul><li><code>push-down-late-materialization</code></li><li><code>materialize-into-separate-variable</code></li></ul><p>Loading documents is deferred in more cases, namely when attributes accessed in
<code>FILTER</code> and <code>SORT</code> operations are covered by an index.</p><p>For example, if you have a collection <code>coll</code> with a <code>persistent</code> index over the
attribute <code>x</code> and additionally the attribute <code>b</code> in <code>storedValues</code>, then the
materialization would previously occur before the <code>SORT</code> operation of the
following query:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>x</span> <span class=o>&gt;</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>doc</span><span class=p>.</span><span class=n>b</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>              <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>IndexNode</span>           <span class=err>✓</span>    <span class=mi>120</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* persistent index scan, scan only */</span>    <span class=cm>/* with late materialization */</span>
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>MaterializeNode</span>          <span class=mi>120</span>       <span class=o>-</span> <span class=n>MATERIALIZE</span> <span class=n>doc</span> <span class=kr>INTO</span> <span class=nl>#4</span>
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>CalculationNode</span>     <span class=err>✓</span>    <span class=mi>120</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#2</span> <span class=o>=</span> <span class=nl>#4</span><span class=p>.</span><span class=n>`b`</span>   <span class=cm>/* attribute expression */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>SortNode</span>            <span class=err>✓</span>    <span class=mi>120</span>       <span class=o>-</span> <span class=kr>SORT</span> <span class=nl>#2</span> <span class=kr>ASC</span>   <span class=cm>/* sorting strategy: standard */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>ReturnNode</span>               <span class=mi>120</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>         <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>    <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>idx_1799108758565027840</span>   <span class=n>persistent</span>   <span class=n>coll</span>         <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>       <span class=mi>8</span><span class=mf>3.33</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`x`</span> <span class=p>]</span>   <span class=p>[</span> <span class=n>`b`</span> <span class=p>]</span>         <span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>`x`</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>)</span></span></span></code></pre></div><p>The <code>push-down-late-materialization</code> rule moves the materialization down in the
execution plan, below the <code>SORT</code> operation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>              <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>IndexNode</span>           <span class=err>✓</span>    <span class=mi>120</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* persistent index scan, index only (projections: `b`) */</span>    <span class=kd>LET</span> <span class=nl>#5</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`b`</span>   <span class=cm>/* with late materialization */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>SortNode</span>            <span class=err>✓</span>    <span class=mi>120</span>       <span class=o>-</span> <span class=kr>SORT</span> <span class=nl>#5</span> <span class=kr>ASC</span>   <span class=cm>/* sorting strategy: standard */</span>
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>MaterializeNode</span>          <span class=mi>120</span>       <span class=o>-</span> <span class=n>MATERIALIZE</span> <span class=n>doc</span> <span class=kr>INTO</span> <span class=nl>#4</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>ReturnNode</span>               <span class=mi>120</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>         <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>    <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>idx_1799108758565027840</span>   <span class=n>persistent</span>   <span class=n>coll</span>         <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>       <span class=mi>8</span><span class=mf>3.33</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`x`</span> <span class=p>]</span>   <span class=p>[</span> <span class=n>`b`</span> <span class=p>]</span>         <span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>`x`</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>)</span></span></span></code></pre></div><p>The rule can also push the materialization past <code>FOR</code> loops in case they are
optimized to a merge join (<code>JoinNode</code>, see <a href=#improved-joins class=link>Improved joins</a>).</p><p>The <code>materialize-into-separate-variable</code> rule optimizes how projections of
materializations are managed. Using separate internal variables for projected
attributes avoids the creation of temporary objects and having to look up the
attributes by key in these objects, which is faster. Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>x</span> <span class=o>&gt;</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>[</span><span class=n>doc</span><span class=p>.</span><span class=n>a</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>b</span><span class=p>]</span></span></span></code></pre></div><p>In previous versions, the execution plan looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>        <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>IndexNode</span>          <span class=mi>100</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* persistent index scan, index scan + document lookup (projections: `a`, `b`) */</span>    
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>CalculationNode</span>    <span class=mi>100</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#3</span> <span class=o>=</span> <span class=p>[</span> <span class=n>doc</span><span class=p>.</span><span class=n>`a`</span><span class=p>,</span> <span class=n>doc</span><span class=p>.</span><span class=n>`b`</span> <span class=p>]</span>   <span class=cm>/* simple expression */</span>   <span class=cm>/* collections used: doc : coll */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>ReturnNode</span>         <span class=mi>100</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#3</span></span></span></code></pre></div><p>While not directly visible, the extracted document attributes <code>a</code> and <code>b</code> are
internally stored in a temporary object with only these two attributes.
The attributes need to be looked up in the object for constructing the result.</p><p>From v3.12.1 onward, the execution plan indicates the use of separate internal
variables and that no attribute access is needed to construct the result:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>              <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>IndexNode</span>           <span class=err>✓</span>    <span class=mi>100</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* persistent index scan, scan only */</span>    <span class=cm>/* with late materialization */</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>MaterializeNode</span>          <span class=mi>100</span>       <span class=o>-</span> <span class=n>MATERIALIZE</span> <span class=n>doc</span> <span class=kr>INTO</span> <span class=nl>#4</span> <span class=cm>/* (projections: `a`, `b`) */</span>   <span class=kd>LET</span> <span class=nl>#5</span> <span class=o>=</span> <span class=nl>#4</span><span class=p>.</span><span class=n>`a`</span><span class=p>,</span> <span class=nl>#6</span> <span class=o>=</span> <span class=nl>#4</span><span class=p>.</span><span class=n>`b`</span>
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>CalculationNode</span>     <span class=err>✓</span>    <span class=mi>100</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#2</span> <span class=o>=</span> <span class=p>[</span> <span class=nl>#5</span><span class=p>,</span> <span class=nl>#6</span> <span class=p>]</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>ReturnNode</span>               <span class=mi>100</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#2</span></span></span></code></pre></div><h3 id=short-circuiting-subquery-evaluation>Short-circuiting subquery evaluation <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#short-circuiting-subquery-evaluation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.1</small></p><p>A ternary operator generally evaluates a condition to decide whether to execute
the true branch or the false branch. For example, <code>count &lt; 5 ? "few" : "many"</code>
evaluates to the string <code>"few"</code> if the <code>count</code> variable is less than five,
or to the string <code>"many"</code> otherwise.</p><p>In AQL, the branches are not limited to simple expressions but they can also be
subqueries. Up until ArangoDB v3.12.0, the catch is that subqueries are pulled
out by the query optimizer into separate <code>LET</code> operations that are executed
before the condition is evaluated. Regardless of which branch is taken,
the subquery code is always executed.</p><p>Similarly, when you use subqueries as sub-expressions that are combined with
logical <code>AND</code> or <code>OR</code>, the subqueries are executed unconditionally. This is
typically not what you want and can lead to logical errors.</p><p>Ternary operator example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>doc</span> <span class=o>=</span> <span class=nf>FIRST</span><span class=p>(</span><span class=kr>FOR</span> <span class=n>d</span> <span class=kr>IN</span> <span class=n>coll</span> <span class=kr>FILTER</span> <span class=n>d</span><span class=p>.</span><span class=n>_key</span> <span class=o>==</span> <span class=s2>&#34;A&#34;</span> <span class=kr>RETURN</span> <span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>RETURN</span> <span class=n>doc</span> <span class=o>?:</span> <span class=nf>FIRST</span><span class=p>(</span><span class=kr>INSERT</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=s2>&#34;A&#34;</span> <span class=p>}</span> <span class=kr>INTO</span> <span class=n>coll</span> <span class=kr>RETURN</span> <span class=bp>NEW</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// doc ?: FIRST(...) is a shorthand for doc ? doc : FIRST(...)
</span></span></span></code></pre></div><p>The above query looks up a document with the key <code>A</code> in a collection called <code>coll</code>.
If it exists (the <code>doc</code> variable is truthy), then it is returned. Otherwise, the
document is supposed to be created. However, the false branch is a subquery that
gets executed unconditionally. If the document with key <code>A</code> already exists, an
attempt to create this document is still made (but fails because of a key conflict).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>            <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>          <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>CalculationNode</span>        <span class=mi>1</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#9</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;_key&#34;</span> <span class=o>:</span> <span class=s2>&#34;A&#34;</span> <span class=p>}</span>   <span class=cm>/* json expression */</span>   <span class=cm>/* const assignment */</span>
</span></span><span class=line><span class=cl> <span class=mi>20</span>   <span class=n>SubqueryStartNode</span>      <span class=mi>1</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#5</span> <span class=o>=</span> <span class=p>(</span> <span class=cm>/* subquery begin */</span>
</span></span><span class=line><span class=cl> <span class=mi>11</span>   <span class=n>InsertNode</span>             <span class=mi>1</span>       <span class=o>-</span> <span class=kr>INSERT</span> <span class=nl>#9</span> <span class=kr>IN</span> <span class=n>coll</span> 
</span></span><span class=line><span class=cl> <span class=mi>21</span>   <span class=n>SubqueryEndNode</span>        <span class=mi>1</span>       <span class=o>-</span> <span class=kr>RETURN</span>  <span class=n>$NEW</span> <span class=p>)</span> <span class=cm>/* subquery end */</span>
</span></span><span class=line><span class=cl> <span class=mi>18</span>   <span class=n>SubqueryStartNode</span>      <span class=mi>1</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#1</span> <span class=o>=</span> <span class=p>(</span> <span class=cm>/* subquery begin */</span>
</span></span><span class=line><span class=cl> <span class=mi>17</span>   <span class=n>IndexNode</span>              <span class=mi>1</span>       <span class=o>-</span> <span class=kr>FOR</span> <span class=n>d</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* primary index scan, index scan + document lookup */</span>    
</span></span><span class=line><span class=cl> <span class=mi>16</span>   <span class=n>LimitNode</span>              <span class=mi>1</span>         <span class=o>-</span> <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=mi>19</span>   <span class=n>SubqueryEndNode</span>        <span class=mi>1</span>         <span class=o>-</span> <span class=kr>RETURN</span>  <span class=n>d</span> <span class=p>)</span> <span class=cm>/* subquery end */</span>
</span></span><span class=line><span class=cl> <span class=mi>14</span>   <span class=n>CalculationNode</span>        <span class=mi>1</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#11</span> <span class=o>=</span> <span class=p>(</span><span class=nf>FIRST</span><span class=p>(</span><span class=nl>#1</span><span class=p>)</span> <span class=o>?:</span> <span class=nl>#5</span><span class=p>)</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl> <span class=mi>15</span>   <span class=n>ReturnNode</span>             <span class=mi>1</span>     <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#11</span></span></span></code></pre></div><p>As you can see, the false branch execution starts at node <code>18</code>, and the
evaluation of the ternary operator happens afterwards in node <code>14</code>.</p><p>From v3.12.1 onward, the evaluation behavior is changed so that only the
applicable branch of a ternary operator is executed and subqueries that are used
as sub-expressions are effectively evaluated lazily. For example, you can observe
the query optimizer rewriting ternary operators differently to support
short-circuiting when using subqueries:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>            <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>                <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl> <span class=mi>22</span>   <span class=n>SubqueryStartNode</span>            <span class=mi>1</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#1</span> <span class=o>=</span> <span class=p>(</span> <span class=cm>/* subquery begin */</span>
</span></span><span class=line><span class=cl> <span class=mi>19</span>   <span class=n>IndexNode</span>                    <span class=mi>1</span>       <span class=o>-</span> <span class=kr>FOR</span> <span class=n>d</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* primary index scan, index scan + document lookup */</span>    
</span></span><span class=line><span class=cl> <span class=mi>18</span>   <span class=n>LimitNode</span>                    <span class=mi>1</span>         <span class=o>-</span> <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=mi>23</span>   <span class=n>SubqueryEndNode</span>              <span class=mi>1</span>         <span class=o>-</span> <span class=kr>RETURN</span>  <span class=n>d</span> <span class=p>)</span> <span class=cm>/* subquery end */</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>CalculationNode</span>              <span class=mi>1</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=n>doc</span> <span class=o>=</span> <span class=nf>FIRST</span><span class=p>(</span><span class=nl>#1</span><span class=p>)</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl> <span class=mi>20</span>   <span class=n>SubqueryStartNode</span>            <span class=mi>1</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#6</span> <span class=o>=</span> <span class=p>(</span> <span class=cm>/* subquery begin */</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>CalculationNode</span>              <span class=mi>1</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#9</span> <span class=o>=</span> <span class=o>!</span> <span class=n>doc</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl> <span class=mi>11</span>   <span class=n>FilterNode</span>                   <span class=mi>1</span>       <span class=o>-</span> <span class=kr>FILTER</span> <span class=nl>#9</span>
</span></span><span class=line><span class=cl> <span class=mi>12</span>   <span class=n>CalculationNode</span>              <span class=mi>1</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#10</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;_key&#34;</span> <span class=o>:</span> <span class=s2>&#34;A&#34;</span> <span class=p>}</span>   <span class=cm>/* json expression */</span>   <span class=cm>/* const assignment */</span>
</span></span><span class=line><span class=cl> <span class=mi>13</span>   <span class=n>InsertNode</span>                   <span class=mi>1</span>       <span class=o>-</span> <span class=kr>INSERT</span> <span class=nl>#10</span> <span class=kr>IN</span> <span class=n>coll</span> 
</span></span><span class=line><span class=cl> <span class=mi>21</span>   <span class=n>SubqueryEndNode</span>              <span class=mi>1</span>       <span class=o>-</span> <span class=kr>RETURN</span>  <span class=n>$NEW</span> <span class=p>)</span> <span class=cm>/* subquery end */</span>
</span></span><span class=line><span class=cl> <span class=mi>16</span>   <span class=n>CalculationNode</span>              <span class=mi>1</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#11</span> <span class=o>=</span> <span class=p>(</span><span class=n>doc</span> <span class=o>?:</span> <span class=nf>FIRST</span><span class=p>(</span><span class=nl>#6</span><span class=p>))</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl> <span class=mi>17</span>   <span class=n>ReturnNode</span>                   <span class=mi>1</span>     <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#11</span></span></span></code></pre></div><p>The false branch subquery starts at node <code>20</code>, still before the evaluation of
the ternary operator at node <code>16</code>. However, the subquery has a <code>FILTER</code> operation
using the negated condition. This prevents the <code>INSERT</code> operation from running
when the <code>doc</code> variable is truthy because the opposite is false and
<code>FILTER false</code> leaves nothing to process.</p><p>Also see <a href=/3.12/aql/fundamentals/subqueries/#evaluation-of-subqueries class=link>Evaluation of subqueries</a>.</p><h3 id=index-hints-for-traversals>Index hints for traversals <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#index-hints-for-traversals class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.1</small></p><p>For graph traversals, you can now specify index hints in AQL.</p><p>If vertex-centric indexes are known to perform better than the edge index but
aren&rsquo;t chosen automatically, you can make the optimizer prefer the indexes you
specify. This can be done per edge collection, direction, and level/depth:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>v</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>p</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>4</span> <span class=kr>OUTBOUND</span> <span class=n>startVertex</span> <span class=n>edgeCollection</span>
</span></span><span class=line><span class=cl><span class=kp>OPTIONS</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>indexHint</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;edgeCollection&#34;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;outbound&#34;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;base&#34;</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;edge&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;1&#34;</span><span class=o>:</span> <span class=s2>&#34;myIndex1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;2&#34;</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;myIndex2&#34;</span><span class=p>,</span> <span class=s2>&#34;myIndex1&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;3&#34;</span><span class=o>:</span> <span class=s2>&#34;myIndex3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>p</span><span class=p>.</span><span class=n>edges</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=n>foo</span> <span class=o>==</span> <span class=s2>&#34;bar&#34;</span> <span class=kr>AND</span>
</span></span><span class=line><span class=cl>       <span class=n>p</span><span class=p>.</span><span class=n>edges</span><span class=p>[</span><span class=mi>2</span><span class=p>].</span><span class=n>foo</span> <span class=o>==</span> <span class=s2>&#34;bar&#34;</span> <span class=kr>AND</span>
</span></span><span class=line><span class=cl>       <span class=n>p</span><span class=p>.</span><span class=n>edges</span><span class=p>[</span><span class=mi>2</span><span class=p>].</span><span class=n>baz</span> <span class=o>==</span> <span class=s2>&#34;qux&#34;</span></span></span></code></pre></div><p>See the <a href=/3.12/aql/graphs/traversals/#traversal-options class=link>Traversal options</a>
for details.</p><h3 id=query-logging>Query logging <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#query-logging class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.2</small></p><p>A new feature for logging metadata of past AQL queries has been added.</p><p>You can optionally let ArangoDB store information such as run time, memory usage,
and failure reasons to the <code>_queries</code> system collection in the <code>_system</code> database
with a configurable sampling probability and retention period. This allows you
to analyze the metadata directly in the database system to debug query issues
and understand usage patterns.</p><p>See <a href=/3.12/aql/execution-and-performance/query-logging/ class=link>Query logging</a> for details.</p><h3 id=bypass-edge-cache-for-graph-operations>Bypass edge cache for graph operations <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#bypass-edge-cache-for-graph-operations class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.2</small></p><p>The <code>useCache</code> option is now supported for graph traversals and path searches.</p><p>You can set this option to <code>false</code> to not make a large graph operation pollute
the edge cache.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>v</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>p</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>5</span> <span class=kr>OUTBOUND</span> <span class=s2>&#34;vertices/123&#34;</span> <span class=n>edges</span>
</span></span><span class=line><span class=cl>  <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>useCache</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=o>..</span><span class=p>.</span></span></span></code></pre></div><h3 id=push-limit-into-index-optimization>Push limit into index optimization <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#push-limit-into-index-optimization class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.2</small></p><p>A new <code>push-limit-into-index</code> optimizer rule has been added to better utilize
<code>persistent</code> indexes over multiple fields when there are a subsequent <code>SORT</code> and
<code>LIMIT</code> operation. The following conditions need to be met for the rule to be
applied:</p><ul><li>The index must be a compound index</li><li>The index condition must use the <code>IN</code> comparison operator</li><li>The attributes used for the <code>IN</code> comparison must be the ones used by the index</li><li>There must not be an outer loop and there must not be post-filtering</li><li>The attributes to sort by must be the same ones as in index and in the same
order, and they must all be in the same direction (all <code>ASC</code> or all <code>DESC</code>).</li></ul><p>Under these circumstances, fetching all the data to sort it is unnecessary
because it is already sorted in the index. This makes it possible to get results
from the index in batches. This can greatly improve the performance of certain
queries.</p><p>Example query:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>x</span> <span class=kr>IN</span> <span class=p>[</span><span class=s2>&#34;foo&#34;</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>doc</span><span class=p>.</span><span class=n>y</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>With a persistent index over <code>x</code> and <code>y</code> but without the optimization, the
query explain output looks as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>              <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span> 
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>IndexNode</span>                <span class=mi>500</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* persistent index scan, index only (projections: `y`) */</span>    <span class=kd>LET</span> <span class=nl>#5</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`y`</span>   <span class=cm>/* with late materialization */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>SortNode</span>                 <span class=mi>500</span>       <span class=o>-</span> <span class=kr>SORT</span> <span class=nl>#5</span> <span class=kr>ASC</span>   <span class=cm>/* sorting strategy: constrained heap */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>LimitNode</span>                 <span class=mi>10</span>       <span class=o>-</span> <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>MaterializeNode</span>           <span class=mi>10</span>       <span class=o>-</span> <span class=n>MATERIALIZE</span> <span class=n>doc</span> <span class=kr>INTO</span> <span class=nl>#4</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>ReturnNode</span>                <span class=mi>10</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>         <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>         <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>idx_1806008994935865344</span>   <span class=n>persistent</span>   <span class=n>coll</span>         <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>      <span class=mi>10</span><span class=mf>0.00</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`x`</span><span class=p>,</span> <span class=n>`y`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>`x`</span> <span class=kr>IN</span> <span class=p>[</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span> <span class=s2>&#34;foo&#34;</span> <span class=p>])</span></span></span></code></pre></div><p>With the optimization, the <code>LIMIT 10</code> is pushed into the index node with the
comment <code>/* early reducing results */</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>              <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span> 
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>IndexNode</span>                <span class=mi>500</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* persistent index scan, index only (projections: `y`) */</span>    <span class=kd>LET</span> <span class=nl>#5</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`y`</span>   <span class=kr>LIMIT</span> <span class=mi>10</span> <span class=cm>/* early reducing results */</span>   <span class=cm>/* with late materialization */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>SortNode</span>                 <span class=mi>500</span>       <span class=o>-</span> <span class=kr>SORT</span> <span class=nl>#5</span> <span class=kr>ASC</span>   <span class=cm>/* sorting strategy: constrained heap */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>LimitNode</span>                 <span class=mi>10</span>       <span class=o>-</span> <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>MaterializeNode</span>           <span class=mi>10</span>       <span class=o>-</span> <span class=n>MATERIALIZE</span> <span class=n>doc</span> <span class=kr>INTO</span> <span class=nl>#4</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>ReturnNode</span>                <span class=mi>10</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>         <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>         <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>idx_1806008994935865344</span>   <span class=n>persistent</span>   <span class=n>coll</span>         <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>      <span class=mi>10</span><span class=mf>0.00</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`x`</span><span class=p>,</span> <span class=n>`y`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>`x`</span> <span class=kr>IN</span> <span class=p>[</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span> <span class=s2>&#34;foo&#34;</span> <span class=p>])</span></span></span></code></pre></div><h3 id=array-and-object-destructuring>Array and object destructuring <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#array-and-object-destructuring class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.2</small></p><p>Destructuring lets you assign array values and object attributes to one or
multiple variables with a single <code>LET</code> operation and as part of regular <code>FOR</code>
loops. This can be convenient to extract a subset of values and name them in a
concise manner.</p><p>Array values are assigned by position and you can skip elements by leaving out
variable names.</p><p>Object attributes are assigned by name but you can also map them to different
variable names.</p><p>You can mix both array and object destructuring.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=p>[</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>   <span class=c1>// Assign 1 to variable x and 2 to y
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>LET</span> <span class=p>[,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span> <span class=c1>// Assign 2 to variable y and 3 to z
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Assign &#34;Luna Miller&#34; to variable name and 39 to age
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>LET</span> <span class=p>{</span> <span class=n>name</span><span class=p>,</span> <span class=n>age</span> <span class=p>}</span> <span class=o>=</span> <span class=p>{</span> <span class=n>vip</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=n>age</span><span class=o>:</span> <span class=mi>39</span><span class=p>,</span> <span class=n>name</span><span class=o>:</span> <span class=s2>&#34;Luna Miller&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Assign the vip attribute value to variable status
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>LET</span> <span class=p>{</span> <span class=n>vip</span><span class=o>:</span> <span class=n>status</span> <span class=p>}</span> <span class=o>=</span> <span class=p>{</span> <span class=n>vip</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=n>age</span><span class=o>:</span> <span class=mi>39</span><span class=p>,</span> <span class=n>name</span><span class=o>:</span> <span class=s2>&#34;Luna Miller&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Assign 1 to variable x, 2 to y, and 3 to z
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>LET</span> <span class=p>{</span> <span class=n>obj</span><span class=o>:</span> <span class=p>[</span><span class=n>x</span><span class=p>,</span> <span class=p>[</span><span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>]]</span> <span class=p>}</span> <span class=o>=</span> <span class=p>{</span> <span class=n>obj</span><span class=o>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Iterate over array of objects and extract the firstName attribute
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>LET</span> <span class=n>names</span> <span class=o>=</span> <span class=p>[</span> <span class=p>{</span> <span class=n>firstName</span><span class=o>:</span> <span class=s2>&#34;Luna&#34;</span><span class=p>},</span> <span class=p>{</span> <span class=n>firstName</span><span class=o>:</span> <span class=s2>&#34;Sam&#34;</span> <span class=p>}</span> <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=p>{</span> <span class=n>firstName</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>names</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>firstName</span></span></span></code></pre></div><p>See <a href=/3.12/aql/operators/#array-destructuring class=link>Array destructuring</a> and
<a href=/3.12/aql/operators/#object-destructuring class=link>Object destructuring</a> for details.</p><h3 id=improved-utilization-of-sorting-order-for-collect>Improved utilization of sorting order for <code>COLLECT</code> <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#improved-utilization-of-sorting-order-for-collect class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.3</small></p><p>The query optimizer now automatically recognizes additional cases that allow
using the faster sorted method for a <code>COLLECT</code> operation. For example, the
following query previously created a query plan with two <code>SORT</code> operations and
used the hash method for <code>COLLECT</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>doc</span><span class=p>.</span><span class=n>value</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>COLLECT</span> <span class=n>val</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>val</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>                  <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>                      <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span> 
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>EnumerateCollectionNode</span>     <span class=err>✓</span>     <span class=mi>36</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* full collection scan (projections: `value`)  */</span>   <span class=kd>LET</span> <span class=nl>#4</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`value`</span>
</span></span><span class=line><span class=cl>  <span class=mi>4</span>   <span class=n>SortNode</span>                    <span class=err>✓</span>     <span class=mi>36</span>       <span class=o>-</span> <span class=kr>SORT</span> <span class=nl>#4</span> <span class=kr>DESC</span>   <span class=cm>/* sorting strategy: standard */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>CollectNode</span>                 <span class=err>✓</span>     <span class=mi>28</span>       <span class=o>-</span> <span class=kr>COLLECT</span> <span class=n>val</span> <span class=o>=</span> <span class=nl>#4</span>   <span class=cm>/* hash */</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>SortNode</span>                    <span class=err>✓</span>     <span class=mi>28</span>       <span class=o>-</span> <span class=kr>SORT</span> <span class=n>val</span> <span class=kr>ASC</span>   <span class=cm>/* sorting strategy: standard */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>ReturnNode</span>                        <span class=mi>28</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=n>val</span></span></span></code></pre></div><p>Now, the optimizer checks whether all grouping values are covered by the
user-requested <code>SORT</code>, ignoring the direction, and doesn&rsquo;t create an additional
<code>SORT</code> node in that case. A sort in descending order can thus now be utilized
for grouping using the sorted method, and possibly even utilize an index.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>                  <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>                      <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span> 
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>EnumerateCollectionNode</span>     <span class=err>✓</span>     <span class=mi>36</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* full collection scan (projections: `value`)  */</span>   <span class=kd>LET</span> <span class=nl>#5</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`value`</span>
</span></span><span class=line><span class=cl>  <span class=mi>4</span>   <span class=n>SortNode</span>                    <span class=err>✓</span>     <span class=mi>36</span>       <span class=o>-</span> <span class=kr>SORT</span> <span class=nl>#5</span> <span class=kr>DESC</span>   <span class=cm>/* sorting strategy: standard */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>CollectNode</span>                 <span class=err>✓</span>     <span class=mi>28</span>       <span class=o>-</span> <span class=kr>COLLECT</span> <span class=n>val</span> <span class=o>=</span> <span class=nl>#5</span>   <span class=cm>/* sorted */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>ReturnNode</span>                        <span class=mi>28</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=n>val</span></span></span></code></pre></div><h3 id=fast-object-enumeration-with-entries>Fast object enumeration with <code>ENTRIES()</code> <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#fast-object-enumeration-with-entries class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.3</small></p><p>A new optimization has been implemented to improve the efficiency of the
<a href=/3.12/aql/functions/document-object/#entries class=link><code>ENTRIES()</code> function</a> in AQL.</p><p>The new <code>replace-entries-with-object-iteration</code> optimizer rule can recognize a
query pattern like <code>FOR obj IN source FOR [key, value] IN ENTRIES(obj) ...</code>
and use a faster code path for iterating over the object that avoids copying a
lot of key/value pairs and storing intermediate results.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>source</span> <span class=o>=</span> <span class=p>[</span> <span class=p>{</span> <span class=n>a</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>b</span><span class=o>:</span> <span class=mi>2</span> <span class=p>},</span> <span class=p>{</span> <span class=n>c</span><span class=o>:</span> <span class=mi>3</span> <span class=p>}</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>source</span> <span class=c1>// collection or array of objects
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>FOR</span> <span class=p>[</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>]</span> <span class=kr>IN</span> <span class=n>ENTRIES</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span></span></span></code></pre></div><p>Without the optimization, the node with ID <code>6</code> uses a regular list iteration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>            <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>                <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>CalculationNode</span>       <span class=err>✓</span>      <span class=mi>1</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=n>source</span> <span class=o>=</span> <span class=p>[</span> <span class=p>{</span> <span class=s2>&#34;a&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span> <span class=o>:</span> <span class=mi>2</span> <span class=p>},</span> <span class=p>{</span> <span class=s2>&#34;c&#34;</span> <span class=o>:</span> <span class=mi>3</span> <span class=p>}</span> <span class=p>]</span>   <span class=cm>/* json expression */</span>   <span class=cm>/* const assignment */</span>
</span></span><span class=line><span class=cl>  <span class=mi>4</span>   <span class=n>EnumerateListNode</span>     <span class=err>✓</span>      <span class=mi>2</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>source</span>   <span class=cm>/* list iteration */</span>
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>CalculationNode</span>       <span class=err>✓</span>      <span class=mi>2</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#7</span> <span class=o>=</span> <span class=n>ENTRIES</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>EnumerateListNode</span>     <span class=err>✓</span>    <span class=mi>200</span>       <span class=o>-</span> <span class=kr>FOR</span> <span class=nl>#4</span> <span class=kr>IN</span> <span class=nl>#7</span>   <span class=cm>/* list iteration */</span>
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>CalculationNode</span>       <span class=err>✓</span>    <span class=mi>200</span>         <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#8</span> <span class=o>=</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=nl>#4</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nl>#4</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>ReturnNode</span>                 <span class=mi>200</span>         <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#8</span></span></span></code></pre></div><p>With the optimization applied, the faster object iteration is used:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>            <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>                <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>CalculationNode</span>       <span class=err>✓</span>      <span class=mi>1</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=n>source</span> <span class=o>=</span> <span class=p>[</span> <span class=p>{</span> <span class=s2>&#34;a&#34;</span> <span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span> <span class=o>:</span> <span class=mi>2</span> <span class=p>},</span> <span class=p>{</span> <span class=s2>&#34;c&#34;</span> <span class=o>:</span> <span class=mi>3</span> <span class=p>}</span> <span class=p>]</span>   <span class=cm>/* json expression */</span>   <span class=cm>/* const assignment */</span>
</span></span><span class=line><span class=cl>  <span class=mi>4</span>   <span class=n>EnumerateListNode</span>     <span class=err>✓</span>      <span class=mi>2</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>source</span>   <span class=cm>/* list iteration */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>EnumerateListNode</span>     <span class=err>✓</span>    <span class=mi>200</span>       <span class=o>-</span> <span class=kr>FOR</span> <span class=p>[</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>]</span> <span class=n>OF</span> <span class=n>doc</span>   <span class=cm>/* object iteration */</span>
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>CalculationNode</span>       <span class=err>✓</span>    <span class=mi>200</span>         <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#8</span> <span class=o>=</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>ReturnNode</span>                 <span class=mi>200</span>         <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#8</span></span></span></code></pre></div><h3 id=improved-graph-path-searches>Improved graph path searches <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#improved-graph-path-searches class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.3</small></p><p>Due to a refactoring in version 3.11, the performance of certain graph queries
regressed while others improved. In particular shortest path queries like
<code>K_SHORTEST_PATHS</code> queries became slower for certain datasets compared to
version 3.10. The performance should now be similar again due to a switch from
a Dijkstra-like algorithm back to Yen&rsquo;s algorithm and by re-enabling caching
of neighbor vertices in one case.</p><p>In addition, shortest path searches may finish earlier now due to some
optimizations to disregard candidate paths for which better candidates have been
found already.</p><h3 id=cache-for-query-execution-plans-experimental>Cache for query execution plans (experimental) <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#cache-for-query-execution-plans-experimental class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.4</small></p><p>An optional execution plan cache for AQL queries has been added to let you skip query
planning and optimization when running the same queries repeatedly. This can
significantly reduce the total time for running particular queries where a lot
of time is spent on the query planning and optimization passes in proportion to
the actual execution.</p><p>Query plans are not cached by default. You need to set the new <code>usePlanCache</code>
query option to <code>true</code> to utilize cached plans as well as to add plans to the
cache. Otherwise, the plan cache is bypassed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span><span class=s2>&#34;FOR doc IN coll FILTER doc.attr == @val RETURN doc&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>val</span><span class=o>:</span> <span class=s2>&#34;foo&#34;</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>usePlanCache</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span></span></span></code></pre></div><p>Not all AQL queries are eligible for plan caching. You can generally not cache
plans of queries where bind variables affect the structure of the execution plan
or the index utilization.
See <a href=/3.12/aql/execution-and-performance/caching-query-plans/#cache-eligibility class=link>Cache eligibility</a>
for details.</p><p>HTTP API endpoints and a JavaScript API module have been added for clearing the
contents of the query plan cache and for retrieving the current plan cache entries.
See <a href=/3.12/aql/execution-and-performance/caching-query-plans/#interfaces class=link>The execution plan cache for AQL queries</a>
for details.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/plan-cache&#34;</span><span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;hash&#34;</span> <span class=p>:</span> <span class=s2>&#34;2757239675060883499&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;query&#34;</span> <span class=p>:</span> <span class=s2>&#34;FOR doc IN coll FILTER doc.attr == @val RETURN doc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;queryHash&#34;</span> <span class=p>:</span> <span class=mi>11382508862770890000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;bindVars&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;fullCount&#34;</span> <span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dataSources&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;coll&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;created&#34;</span> <span class=p>:</span> <span class=s2>&#34;2024-11-20T17:21:34Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;hits&#34;</span> <span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;memoryUsage&#34;</span> <span class=p>:</span> <span class=mi>3070</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>The following startup options have been added to let you configure the plan cache:</p><ul><li><code>--query.plan-cache-max-entries</code>: The maximum number of plans in the
query plan cache per database. The default value is <code>128</code>.</li><li><code>--query.plan-cache-max-memory-usage</code>: The maximum total memory usage for the
query plan cache in each database. The default value is <code>8MB</code>.</li><li><code>--query.plan-cache-max-entry-size</code>: The maximum size of an individual entry
in the query plan cache in each database. The default value is <code>2MB</code>.</li><li><code>--query.plan-cache-invalidation-time</code>: The time in seconds after which a
query plan is invalidated in the query plan cache.</li></ul><p>The following metrics have been added to monitor the query plan cache:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>arangodb_aql_query_plan_cache_hits_total</code></td><td style=text-align:left>Total number of lookup hits in the AQL query plan cache.</td></tr><tr><td style=text-align:left><code>arangodb_aql_query_plan_cache_memory_usage</code></td><td style=text-align:left>Total memory usage of all query plan caches across all databases.</td></tr><tr><td style=text-align:left><code>arangodb_aql_query_plan_cache_misses_total</code></td><td style=text-align:left>Total number of lookup misses in the AQL query plan cache.</td></tr></tbody></table><h3 id=push-function-available-for-aggregations><code>PUSH()</code> function available for aggregations <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#push-function-available-for-aggregations class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.4</small></p><p>The <code>COLLECT</code> and <code>WINDOW</code> operations now support the <code>PUSH()</code> function in
<code>AGGREGATE</code> expressions.</p><p>For grouping data with <code>COLLECT</code>, it means that you can rewrite a
<code>COLLECT ... INTO var = &lt;projectionExpression></code> construct to
<code>COLLECT ... AGGREGATE var = PUSH(&lt;projectionExpression>)</code>, for instance.
You can add more assignments to the <code>AGGREGATE</code> clause to perform additional
calculations in one go, making it more powerful than <code>COLLECT ... INTO</code>.</p><p>For sliding window calculations with <code>WINDOW</code>, the <code>PUSH()</code> function can be handy
when developing queries to understand what values are in the sliding window:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>t</span> <span class=kr>IN</span> <span class=n>observations</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>t</span><span class=p>.</span><span class=n>time</span>
</span></span><span class=line><span class=cl>  <span class=kr>WINDOW</span> <span class=p>{</span> <span class=n>preceding</span><span class=o>:</span> <span class=s2>&#34;unbounded&#34;</span><span class=p>,</span> <span class=n>following</span><span class=o>:</span> <span class=mi>0</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>AGGREGATE</span> <span class=n>sum</span> <span class=o>=</span> <span class=nf>SUM</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>),</span> <span class=n>values</span> <span class=o>=</span> <span class=nf>PUSH</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>sum</span><span class=p>,</span> <span class=n>values</span> <span class=p>}</span></span></span></code></pre></div><table><thead><tr><th style=text-align:right>sum</th><th style=text-align:left>values</th></tr></thead><tbody><tr><td style=text-align:right>10</td><td style=text-align:left>[10]</td></tr><tr><td style=text-align:right>10</td><td style=text-align:left>[10,0]</td></tr><tr><td style=text-align:right>19</td><td style=text-align:left>[10,0,9]</td></tr><tr><td style=text-align:right>29</td><td style=text-align:left>[10,0,9,10]</td></tr><tr><td style=text-align:right>54</td><td style=text-align:left>[10,0,9,10,25]</td></tr><tr><td style=text-align:right>59</td><td style=text-align:left>[10,0,9,10,25,5]</td></tr><tr><td style=text-align:right>79</td><td style=text-align:left>[10,0,9,10,25,5,20]</td></tr><tr><td style=text-align:right>109</td><td style=text-align:left>[10,0,9,10,25,5,20,30]</td></tr><tr><td style=text-align:right>134</td><td style=text-align:left>[10,0,9,10,25,5,20,30,25]</td></tr></tbody></table><p>See the <a href=/3.12/aql/high-level-operations/collect/#aggregation class=link><code>COLLECT</code> operation</a>
and the <a href=/3.12/aql/high-level-operations/window/ class=link><code>WINDOW</code> operation</a> for details.</p><h3 id=improved-index-utilization-for-sort>Improved index utilization for <code>SORT</code> <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#improved-index-utilization-for-sort class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.4</small></p><p>The existing <code>use-index-for-sort</code> optimizer rule has been extended to take
advantage of persistent indexes for sorting in more cases, namely when only a
prefix of the indexed fields are used to sort by.</p><p>Persistent indexes are sorted and could already be utilized to optimize <code>SORT</code>
operations away if the attributes you sort by match the attributes the index is
over. Now, the sortedness can be further exploited if there is a persistent index
(e.g. over <code>["a", "b"]</code>) that starts with the same fields as the <code>SORT</code> operation
(e.g. <code>a</code>), but you sort by additional attributes not covered by the index (e.g. <code>c</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=p>{</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>a</span><span class=p>,</span> <span class=n>c</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span> <span class=p>}</span></span></span></code></pre></div><p>The data is already sorted in the index by the first attributes (here: <code>a</code>) and
each group of values only needs to be sorted by the remaining attributes (here: <code>c</code>).
This reduces the amount of work necessary to establish the total sorting order.</p><p>The grouped sorting strategy that is applied in such cases is indicated in the
query explain output:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>              <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span> 
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>IndexNode</span>           <span class=err>✓</span>    <span class=mi>100</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=nl>#3</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* persistent index scan, index only (projections: `a`) */</span>    <span class=kd>LET</span> <span class=nl>#10</span> <span class=o>=</span> <span class=nl>#3</span><span class=p>.</span><span class=n>`a`</span>   <span class=cm>/* with late materialization */</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>MaterializeNode</span>          <span class=mi>100</span>       <span class=o>-</span> <span class=n>MATERIALIZE</span> <span class=nl>#3</span> <span class=kr>INTO</span> <span class=nl>#7</span> <span class=cm>/* (projections: `b`, `c`) */</span>   <span class=kd>LET</span> <span class=nl>#8</span> <span class=o>=</span> <span class=nl>#7</span><span class=p>.</span><span class=n>`b`</span><span class=p>,</span> <span class=nl>#9</span> <span class=o>=</span> <span class=nl>#7</span><span class=p>.</span><span class=n>`c`</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>SortNode</span>            <span class=err>✓</span>    <span class=mi>100</span>       <span class=o>-</span> <span class=kr>SORT</span> <span class=nl>#9</span> <span class=kr>ASC</span><span class=err>;</span> <span class=n>GROUPED</span> <span class=n>BY</span> <span class=nl>#10</span>   <span class=cm>/* sorting strategy: grouped */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>CalculationNode</span>     <span class=err>✓</span>    <span class=mi>100</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#5</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;a&#34;</span> <span class=o>:</span> <span class=nl>#10</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span> <span class=o>:</span> <span class=nl>#8</span><span class=p>,</span> <span class=s2>&#34;c&#34;</span> <span class=o>:</span> <span class=nl>#9</span> <span class=p>}</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span>   <span class=n>ReturnNode</span>               <span class=mi>100</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>         <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>         <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>idx_1821511732613349376</span>   <span class=n>persistent</span>   <span class=n>coll</span>         <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>      <span class=mi>10</span><span class=mf>0.00</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`a`</span><span class=p>,</span> <span class=n>`b`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Optimization</span> <span class=n>rules</span> <span class=n>applied</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                                  <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                                  <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                         
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>move</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=n>up</span>                        <span class=mi>6</span>   <span class=n>move</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=n>down</span>                     <span class=mi>11</span>   <span class=n>optimize</span><span class=o>-</span><span class=n>projections</span>              
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=kr>remove</span><span class=o>-</span><span class=n>unnecessary</span><span class=o>-</span><span class=n>calculations</span>             <span class=mi>7</span>   <span class=n>reduce</span><span class=o>-</span><span class=n>extraction</span><span class=o>-</span><span class=kp>to</span><span class=o>-</span><span class=n>projection</span>            <span class=mi>12</span>   <span class=kr>remove</span><span class=o>-</span><span class=n>unnecessary</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=mi>4</span> 
</span></span><span class=line><span class=cl>  <span class=mi>3</span>   <span class=n>move</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=n>up</span><span class=o>-</span><span class=mi>2</span>                      <span class=mi>8</span>   <span class=n>batch</span><span class=o>-</span><span class=n>materialize</span><span class=o>-</span><span class=n>documents</span>                <span class=mi>13</span>   <span class=n>async</span><span class=o>-</span><span class=n>prefetch</span>                    
</span></span><span class=line><span class=cl>  <span class=mi>4</span>   <span class=n>use</span><span class=o>-</span><span class=n>indexes</span>                                 <span class=mi>9</span>   <span class=n>push</span><span class=o>-</span><span class=n>down</span><span class=o>-</span><span class=n>late</span><span class=o>-</span><span class=n>materialization</span>    
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>use</span><span class=o>-</span><span class=n>index</span><span class=o>-</span><span class=kr>for</span><span class=o>-</span><span class=kr>sort</span>                         <span class=mi>10</span>   <span class=n>materialize</span><span class=o>-</span><span class=kr>into</span><span class=o>-</span><span class=n>separate</span><span class=o>-</span><span class=n>variable</span></span></span></code></pre></div><h3 id=improved-index-utilization-for-collect>Improved index utilization for <code>COLLECT</code> <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#improved-index-utilization-for-collect class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.4</small></p><p>When grouping data with <code>COLLECT</code> to determine distinct values, such operations
can now benefit from persistent indexes. The new <code>use-index-for-collect</code>
optimizer rule speeds up the scanning for distinct values up to orders of
magnitude if the selectivity is low, i.e. if there are few different values.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>COLLECT</span> <span class=n>a</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>b</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=p>}</span></span></span></code></pre></div><p>If there is a persistent index over the attributes <code>a</code> and <code>b</code>, then the query
explain output looks like this with the optimization applied:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>           <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>               <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span> 
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>IndexCollectNode</span>          <span class=mi>100</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span> <span class=kr>COLLECT</span> <span class=n>a</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`a`</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`b`</span> <span class=cm>/* distinct value index scan */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>CalculationNode</span>      <span class=err>✓</span>    <span class=mi>100</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#5</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;a&#34;</span> <span class=o>:</span> <span class=n>a</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span> <span class=o>:</span> <span class=n>b</span> <span class=p>}</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>ReturnNode</span>                <span class=mi>100</span>     <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>         <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>         <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>idx_1821499964373598208</span>   <span class=n>persistent</span>   <span class=n>coll</span>         <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>       <span class=mi>1</span><span class=mf>0.00</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`a`</span><span class=p>,</span> <span class=n>`b`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Optimization</span> <span class=n>rules</span> <span class=n>applied</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                               <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                               <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                      
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>move</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=n>up</span>                     <span class=mi>4</span>   <span class=n>use</span><span class=o>-</span><span class=n>index</span><span class=o>-</span><span class=kr>for</span><span class=o>-</span><span class=kr>sort</span>                       <span class=mi>7</span>   <span class=n>async</span><span class=o>-</span><span class=n>prefetch</span>                 
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>move</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=n>up</span><span class=o>-</span><span class=mi>2</span>                   <span class=mi>5</span>   <span class=n>reduce</span><span class=o>-</span><span class=n>extraction</span><span class=o>-</span><span class=kp>to</span><span class=o>-</span><span class=n>projection</span>
</span></span><span class=line><span class=cl>  <span class=mi>3</span>   <span class=n>use</span><span class=o>-</span><span class=n>indexes</span>                              <span class=mi>6</span>   <span class=n>use</span><span class=o>-</span><span class=n>index</span><span class=o>-</span><span class=kr>for</span><span class=o>-</span><span class=kr>collect</span>   
</span></span></code></pre></div><p>You can disable the optimization for individual <code>COLLECT</code> operations by setting
the new <code>disableIndex</code> option to <code>true</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>COLLECT</span> <span class=n>a</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>b</span> <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>disableIndex</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=p>}</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>              <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span> 
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>IndexNode</span>           <span class=err>✓</span>   <span class=mi>1000</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* persistent index scan, index only (projections: `a`, `b`) */</span>    <span class=kd>LET</span> <span class=nl>#8</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`a`</span><span class=p>,</span> <span class=nl>#9</span> <span class=o>=</span> <span class=n>doc</span><span class=p>.</span><span class=n>`b`</span>   
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>CollectNode</span>         <span class=err>✓</span>    <span class=mi>800</span>       <span class=o>-</span> <span class=kr>COLLECT</span> <span class=n>a</span> <span class=o>=</span> <span class=nl>#8</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=nl>#9</span>   <span class=cm>/* sorted */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>CalculationNode</span>     <span class=err>✓</span>    <span class=mi>800</span>       <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#5</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;a&#34;</span> <span class=o>:</span> <span class=n>a</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span> <span class=o>:</span> <span class=n>b</span> <span class=p>}</span>   <span class=cm>/* simple expression */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>ReturnNode</span>               <span class=mi>800</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>         <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>         <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>9</span>   <span class=n>idx_1821499964373598208</span>   <span class=n>persistent</span>   <span class=n>coll</span>         <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>       <span class=mi>1</span><span class=mf>0.00</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`a`</span><span class=p>,</span> <span class=n>`b`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Optimization</span> <span class=n>rules</span> <span class=n>applied</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                                 <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                                 <span class=n>Id</span>   <span class=n>Rule</span> <span class=n>Name</span>                        
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>move</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=n>up</span>                       <span class=mi>4</span>   <span class=n>use</span><span class=o>-</span><span class=n>index</span><span class=o>-</span><span class=kr>for</span><span class=o>-</span><span class=kr>sort</span>                         <span class=mi>7</span>   <span class=kr>remove</span><span class=o>-</span><span class=n>unnecessary</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>move</span><span class=o>-</span><span class=n>calculations</span><span class=o>-</span><span class=n>up</span><span class=o>-</span><span class=mi>2</span>                     <span class=mi>5</span>   <span class=n>reduce</span><span class=o>-</span><span class=n>extraction</span><span class=o>-</span><span class=kp>to</span><span class=o>-</span><span class=n>projection</span>            <span class=mi>8</span>   <span class=n>async</span><span class=o>-</span><span class=n>prefetch</span>                   
</span></span><span class=line><span class=cl>  <span class=mi>3</span>   <span class=n>use</span><span class=o>-</span><span class=n>indexes</span>                                <span class=mi>6</span>   <span class=n>optimize</span><span class=o>-</span><span class=n>projections</span>         
</span></span></code></pre></div><p>The optimization is automatically disabled if the selectivity is high, i.e.
there are many different values, or if there is filtering or an <code>INTO</code> or
<code>AGGREGATE</code> clause. Other optimizations may still be able to utilize the index
to some extent.</p><p>See the <a href=/3.12/aql/high-level-operations/collect/#disableindex class=link><code>COLLECT</code> operation</a>
for details.</p><h2 id=indexing>Indexing <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#indexing class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=multi-dimensional-indexes>Multi-dimensional indexes <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#multi-dimensional-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The previously experimental <code>zkd</code> index type is now stable and has been renamed
to <code>mdi</code>. Existing indexes keep the <code>zkd</code> type.</p><p>Multi-dimensional indexes can now be declared as <code>sparse</code> to exclude documents
from the index that do not have the defined attributes or are explicitly set to
<code>null</code> values. If a value other than <code>null</code> is set, it still needs to be numeric.</p><p>Multi-dimensional indexes now support <code>storedValues</code> to cover queries for better
performance.</p><p>An additional <code>mdi-prefixed</code> index variant has been added that lets you specify
additional attributes for the index to narrow down the search space using
equality checks. It can be used as a vertex-centric index for graph traversals
if created on an edge collection with the first attribute in <code>prefixFields</code> set
to <code>_from</code> or <code>_to</code>.</p><p>See <a href=/3.12/index-and-search/indexing/working-with-indexes/multi-dimensional-indexes/ class=link>Multi-dimensional indexes</a>
for details.</p><h4 id=native-strict-ranges>Native strict ranges <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#native-strict-ranges class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.12.3</small></p><p>Multi-dimensional indexes no longer require post-filtering when using strict
ranges like in the following query:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>d</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=mi>0</span> <span class=o>&lt;</span> <span class=n>d</span><span class=p>.</span><span class=n>x</span> <span class=o>&amp;&amp;</span> <span class=n>d</span><span class=p>.</span><span class=n>x</span> <span class=o>&lt;</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>d</span><span class=p>.</span><span class=n>x</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>        <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>            <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>IndexNode</span>         <span class=err>✓</span>     <span class=mi>71</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>d</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* mdi index scan, index scan + document lookup (filter projections: `x`) (projections: `x`) */</span>    <span class=kd>LET</span> <span class=nl>#3</span> <span class=o>=</span> <span class=n>d</span><span class=p>.</span><span class=n>`x`</span>   <span class=kr>FILTER</span> <span class=p>((</span><span class=n>d</span><span class=p>.</span><span class=n>`x`</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>`x`</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>))</span>   <span class=cm>/* early pruning */</span>   
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>ReturnNode</span>              <span class=mi>71</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>   <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>         <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>idx_1812443690233233408</span>   <span class=n>mdi</span>    <span class=n>coll</span>         <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>           <span class=n>n</span><span class=o>/</span><span class=n>a</span>   <span class=p>[</span> <span class=n>`x`</span><span class=p>,</span> <span class=n>`y`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=p>((</span><span class=n>d</span><span class=p>.</span><span class=n>`x`</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>`x`</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>))</span></span></span></code></pre></div><p>Native support for strict ranges removes a potential bottleneck when working
with large datasets.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>        <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>            <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span> 
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>IndexNode</span>         <span class=err>✓</span>     <span class=mi>71</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>d</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* mdi index scan, index scan + document lookup (projections: `x`) */</span>    <span class=kd>LET</span> <span class=nl>#3</span> <span class=o>=</span> <span class=n>d</span><span class=p>.</span><span class=n>`x`</span>   
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>ReturnNode</span>              <span class=mi>71</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>   <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>         <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>idx_1812443856099082240</span>   <span class=n>mdi</span>    <span class=n>coll</span>         <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>           <span class=n>n</span><span class=o>/</span><span class=n>a</span>   <span class=p>[</span> <span class=n>`x`</span><span class=p>,</span> <span class=n>`y`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=p>((</span><span class=n>d</span><span class=p>.</span><span class=n>`x`</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>`x`</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>))</span></span></span></code></pre></div><h4 id=extended-utilization-of-sparse-indexes>Extended utilization of sparse indexes <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#extended-utilization-of-sparse-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.12.3</small></p><p>The <code>null</code> value is less than all other values in AQL. Therefore, range queries
without a lower bound need to include <code>null</code> but sparse indexes do not include
<code>null</code> values. However, if you explicitly exclude <code>null</code> in range queries,
sparse indexes can be utilized after all. This was not previously supported for
multi-dimensional indexes. Even with a sparse <code>mdi</code> index over the fields <code>x</code>
and <code>y</code> and the exclusion of <code>null</code>, the following example query cannot take
advantage of the index up to v3.12.2:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>d</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>d</span><span class=p>.</span><span class=n>x</span> <span class=o>&lt;</span> <span class=mi>10</span> <span class=o>&amp;&amp;</span> <span class=n>d</span><span class=p>.</span><span class=n>x</span> <span class=o>!=</span> <span class=kc>null</span> <span class=kr>RETURN</span> <span class=n>d</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>                  <span class=n>Par</span>   <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>                      <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=n>EnumerateCollectionNode</span>     <span class=err>✓</span>    <span class=mi>100</span>     <span class=o>-</span> <span class=kr>FOR</span> <span class=n>d</span> <span class=kr>IN</span> <span class=n>coll</span>   <span class=cm>/* full collection scan  */</span>   <span class=kr>FILTER</span> <span class=p>((</span><span class=n>d</span><span class=p>.</span><span class=n>`x`</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>`x`</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>))</span>   <span class=cm>/* early pruning */</span>
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=n>ReturnNode</span>                       <span class=mi>100</span>       <span class=o>-</span> <span class=kr>RETURN</span> <span class=n>d</span></span></span></code></pre></div><p>From v3.13.3 onward, such a query gets optimized to utilize the sparse
multi-dimensional index and the condition for excluding <code>null</code> is removed from
the query plan because it is unnecessary – a sparse index contains values other
than <code>null</code> only:</p><p>Execution plan:
Id NodeType Par Est. Comment
1 SingletonNode 1 * ROOT
6 IndexNode ✓ 71 - FOR d IN coll /* mdi index scan, index scan + document lookup */<br>5 ReturnNode 71 - RETURN d</p><p>Indexes used:
By Name Type Collection Unique Sparse Cache Selectivity Fields Stored values Ranges
6 idx_1812445012396343296 mdi coll false true false n/a [ <code>x</code>, <code>y</code> ] [ ] (d.<code>x</code> &lt; 10)</p><h3 id=stored-values-can-contain-the-_id-attribute>Stored values can contain the <code>_id</code> attribute <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#stored-values-can-contain-the-_id-attribute class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The usage of the <code>_id</code> system attribute was previously disallowed for
<code>persistent</code> indexes inside of <code>storedValues</code>. This is now allowed in v3.12.</p><p>Note that it is still forbidden to use <code>_id</code> as a top-level attribute or
sub-attribute in <code>fields</code> of persistent indexes. On the other hand, inverted
indexes have been allowing to index and store the <code>_id</code> system attribute.</p><h3 id=vector-indexes-experimental>Vector indexes (experimental) <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#vector-indexes-experimental class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.4</small></p><p>A new <code>vector</code> index type has been added as an experimental feature that enables
you to find items with similar properties by comparing vector embeddings, which
are numerical representations generated by machine learning models.</p><p>To try out this feature, start an ArangoDB server (<code>arangod</code>) with the
<code>--experimental-vector-index</code> startup option and follow the guide in this
blog post:
<a href=https://arangodb.com/2024/11/vector-search-in-arangodb-practical-insights-and-hands-on-examples/ target=_blank rel="noopener noreferrer" class=link>Vector Search in ArangoDB: Practical Insights and Hands-On Examples</a>&nbsp;<i class="fas fa-external-link-alt"></i></p><p>If the vector index type is enabled, the following new AQL functions are
available:</p><ul><li><code>APPROX_NEAR_COSINE()</code></li><li><code>APPROX_NEAR_L2()</code></li></ul><p>Two startup options for the storage engine related to vector indexes
have been added:</p><ul><li><code>--rocksdb.max-write-buffer-number-vector</code></li><li><code>--rocksdb.partition-files-for-vector-index</code></li></ul><p>The new <code>use-vector-index</code> AQL optimizer ruler is responsible for
utilizing vector indexes in queries.</p><p>Furthermore, a new error code <code>ERROR_QUERY_VECTOR_SEARCH_NOT_APPLIED</code> (1554)
has been added.</p><h2 id=server-options>Server options <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#server-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=effective-and-available-startup-options>Effective and available startup options <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#effective-and-available-startup-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The new <code>GET /_admin/options</code> and <code>GET /_admin/options-description</code> HTTP API
endpoints allow you to return the effective configuration and the available
startup options of the queried <em>arangod</em> instance.</p><p>Previously, it was only possible to fetch the current configuration on
single servers and Coordinators using a JavaScript Transaction, and to list
the available startup options with <code>--dump-options</code>.</p><p>See the <a href=/3.12/develop/http-api/administration/#startup-options class=link>HTTP interface for administration</a>
for details.</p><h3 id=protocol-aliases-for-endpoints>Protocol aliases for endpoints <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#protocol-aliases-for-endpoints class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>You can now use <code>http://</code> and <code>https://</code> as aliases for <code>tcp://</code> and <code>ssl://</code>
in the <code>--server.endpoint</code> startup option of the server.</p><h3 id=adjustable-stream-transaction-size>Adjustable Stream Transaction size <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#adjustable-stream-transaction-size class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The previously fixed limit of 128 MiB for <a href=/3.12/develop/transactions/stream-transactions/ class=link>Stream Transactions</a>
can now be configured with the new <code>--transaction.streaming-max-transaction-size</code>
startup option. The default value remains 128 MiB up to v3.12.3.
From v3.12.4 onward, the default value is 512 MiB.</p><h3 id=transparent-compression-of-requests-and-responses-between-arangodb-servers-and-client-tools>Transparent compression of requests and responses between ArangoDB servers and client tools <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#transparent-compression-of-requests-and-responses-between-arangodb-servers-and-client-tools class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following startup options have been added to all
<a href=/3.12/components/tools/ class=link>client tools</a> (except the ArangoDB Starter)
and can be used to enable transparent compression of the data that is sent
between a client tool and an ArangoDB server:</p><ul><li><code>--compress-transfer</code></li><li><code>--compress-request-threshold</code></li></ul><p>If the <code>--compress-transfer</code> option is set to <code>true</code>, the client tool adds an
extra <code>Accept-Encoding: deflate</code> HTTP header to all requests made to the server.
This allows the server to compress its responses before sending them back to the
client tool.</p><p>The client also transparently compresses its own requests to the server if the
size of the request body (in bytes) is at least the value of the
<code>--compress-request-threshold</code> startup option. The default value is <code>0</code>, which
disables the compression of the request bodies in the client tool. To opt in to
sending compressed data, set the option to a value greater than <code>0</code>.
The client tool adds a <code>Content-Encoding: deflate</code> HTTP header to the request
if the request body is compressed using the deflate compression algorithm.</p><p>The following options have been added to the ArangoDB server:</p><ul><li><code>--http.compress-response-threshold</code></li><li><code>--http.handle-content-encoding-for-unauthenticated-requests</code></li></ul><p>The value of the <code>--http.compress-response-threshold</code> startup option specifies
the threshold value (in bytes) from which on response bodies are sent out
compressed by the server. The default value is <code>0</code>, which disables sending out
compressed response bodies. To enable compression, the option should be set to a
value greater than <code>0</code>. The selected value should be large enough to justify the
compression overhead. Regardless of the value of this option, the client has to
signal that it expects a compressed response body by sending an
<code>Accept-Encoding: gzip</code> or <code>Accept-Encoding: deflate</code> HTTP header with its request.
If that header is missing, no response compression is performed by the server.</p><p>If the <code>--http.handle-content-encoding-for-unauthenticated-requests</code>
startup option is set to <code>true</code>, the ArangoDB server automatically decompresses
incoming HTTP requests with <code>Content-Encodings: gzip</code> or
<code>Content-Encoding: deflate</code> HTTP header even if the request is not authenticated.
If the option is set to <code>false</code>, any unauthenticated request that has a
<code>Content-Encoding</code> header set is rejected. This is the default setting.</p><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text><p>As compression uses CPU cycles, it should be activated only when the network
communication between the server and clients is slow and there is enough CPU
capacity left for the extra compression/decompression work.</p><p>Furthermore, requests and responses should only be compressed when they exceed a
certain minimum size, e.g. 250 bytes.</p></div></div></div></div><h3 id=lz4-compression-for-values-in-the-in-memory-edge-cache>LZ4 compression for values in the in-memory edge cache <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#lz4-compression-for-values-in-the-in-memory-edge-cache class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.11.2</small></p><p>LZ4 compression of edge index cache values allows to store more data in main
memory than without compression, so the available memory can be used more
efficiently. The compression is transparent and does not require any change to
queries or applications.
The compression can add CPU overhead for compressing values when storing them
in the cache, and for decompressing values when fetching them from the cache.</p><p>The new startup option <code>--cache.min-value-size-for-edge-compression</code> can be
used to set a threshold value size for compression edge index cache payload
values. The default value is <code>1GB</code>, which effectively turns compression
off. Setting the option to a lower value (i.e. <code>100</code>) turns on the
compression for any payloads whose size exceeds this value.</p><p>The new startup option <code>--cache.acceleration-factor-for-edge-compression</code> can
be used to fine-tune the compression. The default value is <code>1</code>.
Higher values typically mean less compression but faster speeds.</p><p>The following new metrics can be used to determine the usefulness of
compression:</p><ul><li><code>rocksdb_cache_edge_inserts_effective_entries_size_total</code>: returns the total
number of bytes of all entries that were stored in the in-memory edge cache,
after compression was attempted/applied. This metric is populated regardless
of whether compression is used or not.</li><li><code>rocksdb_cache_edge_inserts_uncompressed_entries_size_total</code>: returns the total
number of bytes of all entries that were ever stored in the in-memory edge
cache, before compression was applied. This metric is populated regardless of
whether compression is used or not.</li><li><code>rocksdb_cache_edge_compression_ratio</code>: returns the effective
compression ratio for all edge cache entries ever stored in the cache.</li></ul><p>Note that these metrics are increased upon every insertion into the edge
cache, but not decreased when data gets evicted from the cache.</p><h3 id=limit-the-number-of-databases-in-a-deployment>Limit the number of databases in a deployment <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#limit-the-number-of-databases-in-a-deployment class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.10.10, v3.11.2</small></p><p>The <code>--database.max-databases</code> startup option allows you to limit the
number of databases that can exist in parallel in a deployment. You can use this
option to limit the resources used by database objects. If the option is used
and there are already as many databases as configured by this option, any
attempt to create an additional database fails with error
<code>32</code> (<code>ERROR_RESOURCE_LIMIT</code>). Additional databases can then only be created
if other databases are dropped first. The default value for this option is
unlimited, so an arbitrary amount of databases can be created.</p><h3 id=--databaseextended-names-enabled-by-default><code>--database.extended-names</code> enabled by default <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#--databaseextended-names-enabled-by-default class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>--database.extended-names</code> startup option is now enabled by default.
This allows you to use Unicode characters inside database names, collection names,
view names and index names by default, unless you explicitly turn off the
functionality.</p><p>Note that once a server in your deployment has been started with the flag set to
<code>true</code>, it stores this setting permanently. Switching the startup option back to
<code>false</code> raises a warning about the option change at startup, but it is not
blockig the startup.</p><p>Existing databases, collections, views and indexes with extended names can still
be used even with the option set back to <code>false</code>, but no new database objects
with extended names can be created with the option disabled. This state is only
meant to facilitate downgrading or reverting the option change. When the option
is set to <code>false</code>, all database objects with extended names that were created
in the meantime should be removed manually.</p><h3 id=cluster-internal-connectivity-checks>Cluster-internal connectivity checks <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#cluster-internal-connectivity-checks class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.11.5</small></p><p>This feature makes Coordinators and DB-Servers in a cluster periodically send
check requests to each other, in order to see if all nodes can connect to
each other.
If a cluster-internal connection to another Coordinator or DB-Server cannot
be established within 10 seconds, a warning is now logged.</p><p>The new <code>--cluster.connectivity-check-interval</code> startup option can be used
to control the frequency of the connectivity check, in seconds.
If set to a value greater than zero, the initial connectivity check is
performed approximately 15 seconds after the instance start, and subsequent
connectivity checks are executed with the specified frequency.
If set to <code>0</code>, connectivity checks are disabled.</p><p>You can also use the following metrics to monitor and detect temporary or
permanent connectivity issues:</p><ul><li><code>arangodb_network_connectivity_failures_coordinators</code>: Number of failed
connectivity check requests sent by this instance to Coordinators.</li><li><code>arangodb_network_connectivity_failures_dbservers_total</code>: Number of failed
connectivity check requests sent to DB-Servers.</li></ul><h3 id=configurable-maximum-for-queued-log-entries>Configurable maximum for queued log entries <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#configurable-maximum-for-queued-log-entries class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.10.12, v3.11.5</small></p><p>The new <code>--log.max-queued-entries</code> startup option lets you configure how many
log entries are queued in a background thread.</p><p>Log entries are pushed on a queue for asynchronous writing unless you enable the
<code>--log.force-direct</code> startup option. If you use a slow log output (e.g. syslog),
the queue might grow and eventually overflow.</p><p>You can configure the upper bound of the queue with this option. If the queue is
full, log entries are written synchronously until the queue has space again.</p><h3 id=configurable-maximal-size-for-cache-entries>Configurable maximal size for cache entries <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#configurable-maximal-size-for-cache-entries class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.1</small></p><p>A new <code>--cache.max-cache-value-size</code> startup option has been added to limit the
maximum size of individual values stored in the in-memory cache. The cache is
used for edge indexes, persistent indexes with caching enabled, and collections
with document caches enabled.</p><p>The startup option defaults to 4 MiB, meaning that no individual values larger
than this are stored in the in-memory cache. It avoids storing very large values
in the cache for huge documents or for all the connections of super nodes, and
thus leaves more memory for other purposes.</p><h3 id=configurable-async-prefetch-limits>Configurable async prefetch limits <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#configurable-async-prefetch-limits class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.1</small></p><p>While <a href=#parallel-execution-within-an-aql-query class=link>async prefetching</a> is normally
beneficial for query performance, the async prefetch operations may cause
congestion in the ArangoDB scheduler and interfere with other operations.
The amount of prefetch operations is limited and you adjust these limits with
he following startup options:</p><ul><li><code>--query.max-total-async-prefetch-slots</code>:
The maximum total number of slots available for asynchronous prefetching,
across all AQL queries. Default: <code>256</code></li><li><code>--query.max-query-async-prefetch-slots</code>:
The maximum per-query number of slots available for asynchronous prefetching
inside any AQL query. Default: <code>32</code></li></ul><p>The total number of concurrent prefetch operations across all AQL queries can be
limited using the first option, and the maximum number of prefetch operations in
every single AQL query can be capped with the second option.</p><p>These options prevent that running a lot of AQL queries with async
prefetching fully congests the scheduler queue, and also they prevent large
AQL queries to use up all async prefetching capacity on their own.</p><h3 id=new-server-scheduler-type>New server scheduler type <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#new-server-scheduler-type class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.1</small></p><p>A new <code>--server.scheduler</code> startup option has been added to let you select the
scheduler type. The scheduler currently used by ArangoDB has the value
<code>supervised</code>. A new work-stealing scheduler is being implemented and can be
selected using the value <code>threadpools</code>. This new scheduler is experimental and
should not be used in production.</p><h3 id=query-logging-options>Query logging options <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#query-logging-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.2</small></p><p>The following startup options related to the <a href=#query-logging class=link>Query logging</a>
feature have been added:</p><ul><li><code>--query.collection-logger-enabled</code>:
Whether to enable the logging of metadata for past AQL queries</li><li><code>--query.collection-logger-include-system-database</code>:
Whether to log queries that run in the <code>_system</code> database</li><li><code>--query.collection-logger-probability</code>:
The sampling probability for logging queries (in percent)</li><li><code>--query.collection-logger-all-slow-queries</code>:
Whether to always log slow queries regardless of whether they are selected for
sampling or not</li><li><code>--query.collection-logger-retention-time</code>:
The retention period for entries in the <code>_queries</code> system collection (in seconds)</li><li><code>--query.collection-logger-cleanup-interval</code>:
The interval for running the cleanup process for the retention configuration
(in milliseconds)</li><li><code>--query.collection-logger-push-interval</code>:
How long to buffer query log entries in memory before they are actually
written to the system collection (in milliseconds)</li><li><code>--query.collection-logger-max-buffered-queries</code>:
The number of query log entries to buffer in memory before they are flushed to
the system collection, discarding additional query metadata if the logging
thread cannot keep up</li></ul><h3 id=cluster-management-options>Cluster management options <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#cluster-management-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.4</small></p><p>The following startup options for cluster deployments have been added:</p><ul><li><p><code>--agency.supervision-expired-servers-grace-period</code>:
The supervision time after which a server is removed from the Agency if it
does no longer send heartbeats (in seconds).</p></li><li><p><code>--cluster.no-heartbeat-delay-before-shutdown</code>:
The delay (in seconds) before shutting down a Coordinator if no heartbeat can
be sent. Set to <code>0</code> to deactivate this shutdown.</p></li></ul><h2 id=miscellaneous-changes>Miscellaneous changes <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#miscellaneous-changes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=v8-and-icu-library-upgrades>V8 and ICU library upgrades <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#v8-and-icu-library-upgrades class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The bundled V8 JavaScript engine has been upgraded from version 7.9.317 to
12.1.165. As part of this upgrade, the Unicode character handling library
ICU has been upgraded as well, from version 64.2 to 73.1 (but only for
JavaScript contexts, see <a href=/3.12/release-notes/version-3.12/incompatible-changes-in-3-12/#incompatibilities-with-unicode-text-between-core-and-javascript class=link>Incompatible changes in ArangoDB 3.12</a>).</p><p>Note that ArangoDB&rsquo;s build of V8 has pointer compression disabled to allow for
more than 4 GB of heap memory.</p><p>The V8 upgrade brings various language features to JavaScript contexts in
ArangoDB, like arangosh and Foxx. These features are part of the ECMAScript
specifications ES2020 through ES2024. The following list is non-exhaustive:</p><ul><li><p>Optional chaining, like <code>obj.foo?.bar?.length</code> to easily access an object
property or call a function but stop evaluating the expression as soon as the
value is <code>undefined</code> or <code>null</code> and return <code>undefined</code> instead of throwing an error</p></li><li><p>Nullish coalescing operator, like <code>foo ?? bar</code> to evaluate to the value of <code>bar</code>
if <code>foo</code> is <code>null</code> or <code>undefined</code>, otherwise to the value of <code>foo</code></p></li><li><p>Return the array element at the given index, allowing positive as well as
negative integer values, like <code>[1,2,3].at(-1)</code></p></li><li><p>Copying versions of the array methods <code>reverse()</code>, <code>sort()</code>, and <code>splice()</code>
that perform in-place operations, and a copying version of the bracket notation
for changing the value at a given index</p><ul><li>Return a new array with the elements in reverse order, like <code>[1,2,3].toReversed()</code></li><li>Return a new array with the elements sorted in ascending order, like <code>[2,3,1].toSorted()</code></li><li>Return a new array with elements removed and optionally inserted at a given
index, like <code>[1,2,3,4].toSpliced(1,2,"new", "items")</code></li><li>Return a new array with one element replaced at a given index, allowing
positive and negative integer values, like <code>[1,2,3,4].with(-2, "three")</code></li></ul></li><li><p>Find array elements from the end with <code>findLast()</code> and <code>findLastIndex()</code>, like
<code>[1,2,3,4].findLast(v => v % 2 == 1)</code></p></li><li><p>Return a new string with all matches of a pattern replaced with a provided value,
not requiring a regular expression, like <code>"foo bar foo".replaceAll("foo", "baz")</code></p></li><li><p>If the <code>matchAll()</code> method of a string is used with a regular expression that
misses the global <code>g</code> flag, an error is thrown</p></li><li><p>A new regular expression flag <code>d</code> to include capture group start and end indices,
like <code>/f(o+)/d.exec("foobar").indices[1]</code></p></li><li><p>A new regular expression flag <code>v</code> to enable the Unicode sets mode, like
<code>/^\p{RGI_Emoji}$/v.test("👨🏾‍⚕️")</code> or <code>/[\p{Script_Extensions=Greek}--[α-γ]]/v.test('β')</code></p></li><li><p>A static method to check whether an object directly defines a property, like
<code>Object.hasOwn({ foo: 42 }, "toString")</code>, superseding
<code>Object.prototype.hasOwnProperty.call(…)</code></p></li><li><p><code>Object.groupBy()</code> and <code>Map.groupBy()</code> to group the elements of an iterable
according to the string values returned by a provided callback function</p></li><li><p>Logical assignment operators <code>&&=</code>, <code>||=</code>, <code>??=</code></p></li><li><p>Private properties that cannot be referenced outside of the class,
like <code>class P { #privField = 42; #privMethod() { } }</code></p></li><li><p>Static initialization blocks in classes that run when the class itself is
evaluated, like <code>class S { static { console.log("init block") } }</code></p></li><li><p><code>WeakRef</code> to hold a weak reference to another object, without preventing that
object from getting garbage-collected</p></li><li><p>A <code>cause</code> property for Error instances to indicate the original cause of the error</p></li><li><p>Extended internationalization APIs. Examples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>egyptLocale</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Intl</span><span class=p>.</span><span class=nx>Locale</span><span class=p>(</span><span class=s2>&#34;ar-EG&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>egyptLocale</span><span class=p>.</span><span class=nx>numberingSystems</span> <span class=c1>// [ &#34;arab&#34; ]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>egyptLocale</span><span class=p>.</span><span class=nx>calendars</span>  <span class=c1>// [ &#34;gregory&#34;, &#34;coptic&#34;, &#34;islamic&#34;, &#34;islamic-civil&#34;, &#34;islamic-tbla&#34; ]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>egyptLocale</span><span class=p>.</span><span class=nx>hourCycles</span> <span class=c1>// [ &#34;hc12&#34; ]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>egyptLocale</span><span class=p>.</span><span class=nx>timeZones</span>  <span class=c1>// [ &#34;Africa/Cairo&#34; ]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>egyptLocale</span><span class=p>.</span><span class=nx>textInfo</span>   <span class=c1>// { &#34;direction&#34;: &#34;rtl&#34; }
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>egyptLocale</span><span class=p>.</span><span class=nx>weekInfo</span>   <span class=c1>// { &#34;firstDay&#34;: 6, &#34;weekend&#34; : [5, 6], &#34;minimalDays&#34;: 1 }
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>Intl</span><span class=p>.</span><span class=nx>supportedValuesOf</span><span class=p>(</span><span class=s2>&#34;collation&#34;</span><span class=p>);</span> <span class=c1>// [ &#34;compat&#34;, &#34;emoji&#34;, &#34;eor&#34;, &#34;phonebk&#34;, ... ]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Intl</span><span class=p>.</span><span class=nx>supportedValuesOf</span><span class=p>(</span><span class=s2>&#34;calendar&#34;</span><span class=p>);</span> <span class=c1>// [ &#34;buddhist&#34;, &#34;chinese&#34;, &#34;coptic&#34;, &#34;dangi&#34;, ... ]
</span></span></span><span class=line><span class=cl><span class=c1>// Other supported values: &#34;currency&#34;, &#34;numberingSystem&#34;, &#34;timeZone&#34;, &#34;unit&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>germanLocale</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Intl</span><span class=p>.</span><span class=nx>Locale</span><span class=p>(</span><span class=s2>&#34;de&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>germanLocale</span><span class=p>.</span><span class=nx>collations</span> <span class=c1>// [ &#34;emoji&#34;, &#34;eor&#34;, &#34;phonebk&#34; ]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>germanLocale</span><span class=p>.</span><span class=nx>weekInfo</span>   <span class=c1>// { &#34;firstDay&#34;: 1, &#34;weekend&#34; : [6, 7], &#34;minimalDays&#34;: 4 }
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>ukrainianCalendarNames</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Intl</span><span class=p>.</span><span class=nx>DisplayNames</span><span class=p>([</span><span class=s2>&#34;uk&#34;</span><span class=p>],</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;calendar&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>ukrainianCalendarNames</span><span class=p>.</span><span class=k>of</span><span class=p>(</span><span class=s2>&#34;buddhist&#34;</span><span class=p>)</span> <span class=c1>// &#34;буддійський календар&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>frenchDateTimeFieldNames</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Intl</span><span class=p>.</span><span class=nx>DisplayNames</span><span class=p>([</span><span class=s2>&#34;fr&#34;</span><span class=p>],</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;dateTimeField&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>frenchDateTimeFieldNames</span><span class=p>.</span><span class=k>of</span><span class=p>(</span><span class=s2>&#34;day&#34;</span><span class=p>)</span> <span class=c1>// &#34;jour&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>japaneseDialectLangNames</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Intl</span><span class=p>.</span><span class=nx>DisplayNames</span><span class=p>([</span><span class=s2>&#34;ja&#34;</span><span class=p>],</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;language&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>japaneseStandardLangNames</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Intl</span><span class=p>.</span><span class=nx>DisplayNames</span><span class=p>([</span><span class=s2>&#34;ja&#34;</span><span class=p>],</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;language&#34;</span><span class=p>,</span> <span class=nx>languageDisplay</span><span class=o>:</span> <span class=s2>&#34;standard&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>japaneseDialectLangNames</span><span class=p>.</span><span class=k>of</span><span class=p>(</span><span class=s1>&#39;en-US&#39;</span><span class=p>)</span>  <span class=c1>// &#34;アメリカ英語&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>japaneseDialectLangNames</span><span class=p>.</span><span class=k>of</span><span class=p>(</span><span class=s1>&#39;en-GB&#39;</span><span class=p>)</span>  <span class=c1>// &#34;イギリス英語&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>japaneseStandardLangNames</span><span class=p>.</span><span class=k>of</span><span class=p>(</span><span class=s1>&#39;en-US&#39;</span><span class=p>)</span> <span class=c1>// &#34;英語 (アメリカ合衆国)&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>japaneseStandardLangNames</span><span class=p>.</span><span class=k>of</span><span class=p>(</span><span class=s1>&#39;en-GB&#39;</span><span class=p>)</span> <span class=c1>// &#34;英語 (イギリス)&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>americanDateTimeFormat</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Intl</span><span class=p>.</span><span class=nx>DateTimeFormat</span><span class=p>(</span><span class=s2>&#34;en-US&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>timeZoneName</span><span class=o>:</span> <span class=s2>&#34;longGeneric&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>americanDateTimeFormat</span><span class=p>.</span><span class=nx>formatRange</span><span class=p>(</span><span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>())</span> <span class=c1>// e.g. with a German local time:
</span></span></span><span class=line><span class=cl><span class=c1>// &#34;1/1/1970, Central European Standard Time – 1/16/2024, Central European Time&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>swedishCurrencyNames</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Intl</span><span class=p>.</span><span class=nx>DisplayNames</span><span class=p>([</span><span class=s2>&#34;sv&#34;</span><span class=p>],</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;currency&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>swedishCurrencyNames</span><span class=p>.</span><span class=k>of</span><span class=p>(</span><span class=s2>&#34;TZS&#34;</span><span class=p>)</span> <span class=c1>// &#34;tanzanisk shilling&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>americanNumberFormat</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Intl</span><span class=p>.</span><span class=nx>NumberFormat</span><span class=p>(</span><span class=s2>&#34;en-US&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>style</span><span class=o>:</span> <span class=s2>&#34;currency&#34;</span><span class=p>,</span> <span class=nx>currency</span><span class=o>:</span> <span class=s2>&#34;EUR&#34;</span><span class=p>,</span> <span class=nx>maximumFractionDigits</span><span class=o>:</span> <span class=mi>0</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>americanNumberFormat</span><span class=p>.</span><span class=nx>formatRange</span><span class=p>(</span><span class=mf>1.5</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=c1>// &#34;€2 – €10&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>welshPluralRules</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Intl</span><span class=p>.</span><span class=nx>PluralRules</span><span class=p>(</span><span class=s2>&#34;cy&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>welshPluralRules</span><span class=p>.</span><span class=nx>selectRange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=c1>// &#34;few&#34;
</span></span></span></code></pre></div></li></ul><h3 id=active-aql-query-cursors-metric>Active AQL query cursors metric <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#active-aql-query-cursors-metric class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>arangodb_aql_cursors_active</code> metric has been added and shows the number
of active AQL query cursors.</p><p>AQL query cursors are created for queries that produce more results than
specified in the <code>batchSize</code> query option (default value: <code>1000</code>). Such results
can be fetched incrementally by client operations in chunks.
As it is unclear if and when a client will fetch any remaining data from a
cursor, every cursor has a server-side timeout value (TTL) after which it is
considered inactive and garbage-collected.</p><h3 id=per-collection-compaction-in-cluster>Per-collection compaction in cluster <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#per-collection-compaction-in-cluster class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>PUT /_api/collection/{collection-name}/compact</code> endpoint of the HTTP API
can now be used to start the compaction for a specific collection in cluster
deployments. This feature was previously available for single servers only.</p><h3 id=rocksdb-sst-file-partitioning-experimental>RocksDB .sst file partitioning (experimental) <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#rocksdb-sst-file-partitioning-experimental class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following experimental startup options for RockDB .sst file partitioning
have been added:</p><ul><li><code>--rocksdb.partition-files-for-documents</code></li><li><code>--rocksdb.partition-files-for-primary-index</code></li><li><code>--rocksdb.partition-files-for-edge-index</code></li><li><code>--rocksdb.partition-files-for-persistent-index</code></li></ul><p>Enabling any of these options makes RocksDB&rsquo;s compaction write the
data for different collections/shards/indexes into different .sst files.
Otherwise, the document data from different collections/shards/indexes
can be mixed and written into the same .sst files.</p><p>When these options are enabled, the RocksDB compaction is more efficient since
a lot of different collections/shards/indexes are written to in parallel.
The disadvantage of enabling these options is that there can be more .sst
files than when the option is turned off, and the disk space used by
these .sst files can be higher.
In particular, on deployments with many collections/shards/indexes
this can lead to a very high number of .sst files, with the potential
of outgrowing the maximum number of file descriptors the ArangoDB process
can open. Thus, these options should only be enabled on deployments with a
limited number of collections/shards/indexes.</p><h3 id=arangosearch-file-descriptor-metric>ArangoSearch file descriptor metric <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#arangosearch-file-descriptor-metric class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following metric has been added:</p><ul><li><code>arangodb_search_file_descriptors</code>:
Current count of opened file descriptors for an ArangoSearch index.</li></ul><h3 id=more-instant-hot-backups>More instant Hot Backups <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#more-instant-hot-backups class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.10.10, v3.11.3</small></p><p>Cluster deployments no longer wait for all in-progress transactions to get
committed when a user requests a Hot Backup. The waiting could cause deadlocks
and thus Hot Backups to fail, in particular in ArangoGraph. Now, Hot Backups are
created immediately and commits have to wait until the backup process is done.</p><h3 id=in-memory-edge-cache-startup-options-and-metrics>In-memory edge cache startup options and metrics <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#in-memory-edge-cache-startup-options-and-metrics class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.11.4</small></p><p>The following startup options have been added:</p><ul><li><p><code>--cache.max-spare-memory-usage</code>: the maximum memory usage for spare tables
in the in-memory cache.</p></li><li><p><code>--cache.high-water-multiplier</code>: controls the cache&rsquo;s effective memory usage
limit. The user-defined memory limit (i.e. <code>--cache.size</code>) is multiplied with
this value to create the effective memory limit, from which on the cache tries
to free up memory by evicting the oldest entries. The default value is <code>0.56</code>,
matching the previously hardcoded 56% for the cache subsystem.</p><p>You can increase the multiplier to make the cache subsystem use more memory, but
this may overcommit memory because the cache memory reclamation procedure is
asynchronous and can run in parallel to other tasks that insert new data.
In case a deployment&rsquo;s memory usage is already close to the maximum, increasing
the multiplier can lead to out-of-memory (OOM) kills.</p></li></ul><p>The following metrics have been added:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>rocksdb_cache_edge_compressed_inserts_total</code></td><td style=text-align:left>Total number of compressed inserts into the in-memory edge cache.</td></tr><tr><td style=text-align:left><code>rocksdb_cache_edge_empty_inserts_total</code></td><td style=text-align:left>Total number of insertions into the in-memory edge cache for non-connected edges.</td></tr><tr><td style=text-align:left><code>rocksdb_cache_edge_inserts_total</code></td><td style=text-align:left>Total number of insertions into the in-memory edge cache.</td></tr></tbody></table><h3 id=observability-of-in-memory-cache-subsystem>Observability of in-memory cache subsystem <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#observability-of-in-memory-cache-subsystem class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.10.11, v3.11.4</small></p><p>The following metrics have been added to improve the observability of the in-memory
cache subsystem:</p><ul><li><code>rocksdb_cache_free_memory_tasks_total</code>: Total number of free memory tasks
that were scheduled by the in-memory edge cache subsystem. This metric will
be increased whenever the cache subsystem schedules a task to free up memory
in one of the managed in-memory caches. It is expected to see this metric
rising when the cache subsystem hits its global memory budget.</li><li><code>rocksdb_cache_free_memory_tasks_duration_total</code>: Total amount of time spent
inside the free memory tasks of the in-memory cache subsystem. Free memory
tasks are scheduled by the cache subsystem to free up memory in existing cache
hash tables.</li><li><code>rocksdb_cache_migrate_tasks_total</code>: Total number of migrate tasks that were
scheduled by the in-memory edge cache subsystem. This metric will be increased
whenever the cache subsystem schedules a task to migrate an existing cache hash
table to a bigger or smaller size.</li><li><code>rocksdb_cache_migrate_tasks_duration_total</code>: Total amount of time spent inside
the migrate tasks of the in-memory cache subsystem. Migrate tasks are scheduled
by the cache subsystem to migrate existing cache hash tables to a bigger or
smaller table.</li></ul><h3 id=detached-scheduler-threads>Detached scheduler threads <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#detached-scheduler-threads class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.10.13, v3.11.5</small></p><p>A scheduler thread now has the capability to detach itself from the scheduler
if it observes the need to perform a potentially long running task, like waiting
for a lock. This allows a new scheduler thread to be started and prevents
scenarios where all threads are blocked waiting for a lock, which has previously
led to deadlock situations. From v3.12.1 onward, coroutines are used instead of
detaching threads as the underlying mechanism.</p><p>Threads waiting for more than 1 second on a collection lock will detach
themselves.</p><p>The following startup option has been added:</p><ul><li><code>--server.max-number-detached-threads</code>: The maximum number of detached scheduler
threads. Note that this startup option is <strong>deprecated</strong> from v3.12.1 onward
because a different mechanism than detaching is used, obsoleting the option
and no longer having an effect.</li></ul><p>The following metric as been added:</p><ul><li><code>arangodb_scheduler_num_detached_threads</code>: The number of worker threads
currently started and detached from the scheduler.</li></ul><h3 id=monitoring-per-collectiondatabaseuser>Monitoring per collection/database/user <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#monitoring-per-collectiondatabaseuser class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.10.13, v3.11.7</small></p><p>The following metrics have been introduced to track per-shard requests on
DB-Servers:</p><ul><li><code>arangodb_collection_leader_reads_total</code>: The number of read requests on
leaders, per shard, and optionally also split by user.</li><li><code>arangodb_collection_leader_writes_total</code>: The number of write requests on
leaders, per shard, and optionally also split by user.</li><li><code>arangodb_collection_requests_bytes_read_total</code>: The number of bytes read in
read requests on leaders.</li><li><code>arangodb_collection_requests_bytes_written_total</code>: The number of bytes written
in write requests on leaders and followers.</li></ul><p>To opt into these metrics, you can use the new <code>--server.export-shard-usage-metrics</code>
startup option. It can be set to one of the following values on DB-Servers:</p><ul><li><code>disabled</code>: No shard usage metrics are recorded nor exported. This is the
default value.</li><li><code>enabled-per-shard</code>: This makes DB-Servers collect per-shard usage metrics.</li><li><code>enabled-per-shard-per-user</code>: This makes DB-Servers collect per-shard
and per-user metrics. This is more granular than <code>enabled-per-shard</code> but
can produce a lot of metrics.</li></ul><p>Whenever a shard is accessed in read or write mode by one of the following
operations, the metrics are populated dynamically, either with a per-user
label or not, depending on the above setting.
The metrics are retained in memory on DB-Servers. Removing databases,
collections, or users that are already included in the metrics won&rsquo;t remove
the metrics until the DB-Server is restarted.</p><p>The following operations increase the metrics:</p><ul><li>AQL queries: an AQL query increases the read or write counters exactly
once for each involved shard. For shards that are accessed in read/write
mode, only the write counter is increased.</li><li>Single-document insert, update, replace, and remove operations: for each
such operation, the write counter is increased once for the affected
shard.</li><li>Multi-document insert, update, replace, and remove operations: for each
such operation, the write counter is increased once for each shard
that is affected by the operation. Note that this includes collection
truncate operations.</li><li>Single and multi-document read operations: for each such operation, the
read counter is increased once for each shard that is affected by the
operation.</li></ul><p>The metrics are increased when any of the above operations start, and they
are not decreased should an operation abort or if an operation does not
lead to any actual reads or writes.</p><p>As there can be many of these dynamic metrics based on the number of shards
and/or users in the deployment, these metrics are turned off by default.
When turned on, the metrics are exposed only via the new
<code>GET /_admin/usage-metrics</code> endpoint. They are not exposed via the existing
metrics <code>GET /_admin/metrics</code> endpoint.</p><p>Note that internal operations, such as internal queries executed for statistics
gathering, internal garbage collection, and TTL index cleanup are not counted in
these metrics. Additionally, all requests that are using the superuser JWT for
authentication and that do not have a specific user set are not counted.</p><p>Enabling these metrics can likely result in a small latency overhead of a few
percent for write operations. The exact overhead depends on
several factors, such as the type of operation (single or multi-document operation),
replication factor, network latency, etc.</p><h3 id=compression-for-cluster-internal-traffic>Compression for cluster-internal traffic <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#compression-for-cluster-internal-traffic class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following startup options have been added to optionally compress relevant
cluster-internal traffic:</p><ul><li><code>--network.compression-method</code>: The compression method used for cluster-internal
requests.</li><li><code>--network.compress-request-threshold</code>: The HTTP request body size from which on
cluster-internal requests are transparently compressed.</li></ul><p>If the <code>--network.compression-method</code> startup option is set to <code>none</code> (default), then no
compression is performed. To enable compression for cluster-internal requests,
you can set this option to either <code>deflate</code>, <code>gzip</code>, <code>lz4</code>, or <code>auto</code>.</p><p>The <code>deflate</code> and <code>gzip</code> compression methods are general purpose but can
have significant CPU overhead for performing the compression work.
The <code>lz4</code> compression method compresses slightly worse but has a lot lower
CPU overhead for performing the compression.
The <code>auto</code> compression method uses <code>deflate</code> by default and <code>lz4</code> for
requests that have a size that is at least 3 times the configured threshold
size.</p><p>The compression method only matters if <code>--network.compress-request-threshold</code>
is set to a value greater than zero. This option configures a threshold value
from which on the outgoing requests will be compressed. If the threshold is
set to a value of 0, then no compression is performed. If the threshold
is set to a value greater than 0, then the size of the request body is
compared against the threshold value, and compression happens if the
uncompressed request body size exceeds the threshold value.
The threshold can thus be used to avoid futile compression attempts for too
small requests.</p><p>Compression for all Agency traffic is disabled regardless of the settings
of these options.</p><h3 id=read-only-shards-metric>Read-only shards metric <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#read-only-shards-metric class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.1</small></p><p>The following cluster health metric has been added:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>arangodb_vocbase_shards_read_only_by_write_concern</code></td><td style=text-align:left>Number of shards that are read-only due to an undercut of the write concern.</td></tr></tbody></table><h3 id=log-queue-overwhelm-metric>Log queue overwhelm metric <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#log-queue-overwhelm-metric class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.1</small></p><p>The following metric has been added, indicating whether the log queue is
overwhelmed:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>arangodb_logger_messages_dropped_total</code></td><td style=text-align:left>Total number of dropped log messages.</td></tr></tbody></table><p>The related startup option for controlling the size of the log queue has a
default of <code>16384</code> instead of <code>10000</code> now.</p><h3 id=scheduler-dequeue-time-metrics>Scheduler dequeue time metrics <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#scheduler-dequeue-time-metrics class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.1</small></p><p>The following scheduler metrics have been added, reporting how long it takes to
pick items from different job queues.</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>arangodb_scheduler_high_prio_dequeue_hist</code></td><td style=text-align:left>Time required to take an item from the high priority queue.</td></tr><tr><td style=text-align:left><code>arangodb_scheduler_medium_prio_dequeue_hist</code></td><td style=text-align:left>Time required to take an item from the medium priority queue.</td></tr><tr><td style=text-align:left><code>arangodb_scheduler_low_prio_dequeue_hist</code></td><td style=text-align:left>Time required to take an item from the low priority queue.</td></tr><tr><td style=text-align:left><code>arangodb_scheduler_maintenance_prio_dequeue_hist</code></td><td style=text-align:left>Time required to take an item from the maintenance priority queue.</td></tr></tbody></table><h3 id=option-to-skip-fast-lock-round-for-stream-transactions>Option to skip fast lock round for Stream Transactions <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#option-to-skip-fast-lock-round-for-stream-transactions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.1</small></p><p>A <code>skipFastLockRound</code> option has been added to let you disable the fast lock
round for Stream Transactions. The option defaults to <code>false</code> so that
fast locking is tried.</p><p>Disabling the fast lock round is not necessary unless there are many concurrent
Stream Transactions queued that all try to lock the same collection exclusively.
In this case, the fast locking is subpar because exclusive locks will prevent it
from succeeding. Skipping the fast locking makes each actual locking operation
take longer than with fast locking but it guarantees a deterministic locking order.
This avoids deadlocking and retrying which can occur with the fast locking.
Overall, skipping the fast lock round can be faster in this scenario.</p><p>The fast lock round should not be skipped for read-only Stream Transactions as
it degrades performance if there are no concurrent transactions that use
exclusive locks on the same collection.</p><p>See the <a href=/3.12/develop/transactions/stream-transactions/#javascript-api class=link>JavaScript API</a>
and the <a href=/3.12/develop/http-api/transactions/stream-transactions/#begin-a-stream-transaction class=link>HTTP API</a>
for details.</p><h3 id=individual-log-levels-per-log-output>Individual log levels per log output <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#individual-log-levels-per-log-output class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.2</small></p><p>You can now configure the log level for each log topic per log output. You can
use this feature to log verbosely to a file but print less information in the
command-line, for instance.</p><p>The repeatable <code>--log.level</code> startup option lets you set the log levels for
log topics as before. You can now additionally specify the levels for individual
topics in <code>--log.output</code> by appending a semicolon and a comma-separated mapping
of log topics and levels after the destination to override the <code>--log.level</code>
configuration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>--log.level <span class=nv>memory</span><span class=o>=</span>warning
</span></span><span class=line><span class=cl>--log.output <span class=s2>&#34;file:///path/to/file;queries=trace,requests=info&#34;</span>
</span></span><span class=line><span class=cl>--log.output <span class=s2>&#34;-;all=error&#34;</span>
</span></span></code></pre></div><p>This sets the log level to <code>warning</code> for the <code>memory</code> topic, which applies to
all outputs unless overridden. The first output is a file with verbose <code>trace</code>
logging for the <code>queries</code> topic, <code>info</code>-level logging for <code>requests</code>,
<code>warning</code>-level logging for <code>memory</code>, and default levels for all other topics.
The second output is to the standard output (command-line), using the <code>all</code>
pseudo-topic to set the log levels to <code>error</code> for all topics.</p><p>Furthermore, the <a href=/3.12/develop/http-api/monitoring/logs/#get-the-server-log-levels class=link>HTTP API</a>
has been extended to let you query and set the log levels for individual outputs
at runtime.</p><h3 id=lost-subordinate-transactions-metric>Lost subordinate transactions metric <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#lost-subordinate-transactions-metric class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.12.4</small></p><p>The following metric about partially committed or aborted transactions on
DB-Servers in a cluster has been added:</p><table><thead><tr><th style=text-align:left>Label</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><code>arangodb_vocbase_transactions_lost_subordinates_total</code></td><td style=text-align:left>Counts the number of lost subordinate transactions on database servers.</td></tr></tbody></table><h2 id=client-tools>Client tools <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#client-tools class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=protocol-aliases-for-endpoints-1>Protocol aliases for endpoints <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#protocol-aliases-for-endpoints-1 class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>You can now use <code>http://</code> and <code>https://</code> as aliases for <code>tcp://</code> and <code>ssl://</code>
in the <code>--server.endpoint</code> startup option with all client tools.</p><h3 id=arangodump>arangodump <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#arangodump class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><h4 id=--ignore-collection-startup-option><code>--ignore-collection</code> startup option <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#--ignore-collection-startup-option class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><em>arangodump</em> now supports a <code>--ignore-collection</code> startup option that you can
specify multiple times to exclude the specified collections from a dump.</p><p>It cannot be used together with the existing <code>--collection</code> option for specifying
collections to include.</p><h4 id=improved-dump-performance-and-size>Improved dump performance and size <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#improved-dump-performance-and-size class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><em>arangodump</em> has extended parallelization capabilities
to work not only at the collection level, but also at the shard level.
In combination with the newly added support for the VelocyPack format that
ArangoDB uses internally, database dumps can now be created and restored more
quickly and occupy less disk space. This major performance boost makes dumps and
restores up to several times faster, which is extremely useful when dealing
with large shards.</p><ul><li><p>Whether the new parallel dump variant is used is controlled by the newly added
<code>--use-parallel-dump</code> startup option. The default value is <code>true</code>.</p></li><li><p>To achieve the best dump performance and the smallest data dumps in terms of
size, you can additionally use the <code>--dump-vpack</code> option. The resulting dump data
is then stored in the more compact but binary VelocyPack format instead of the
text-based JSON format. The output file size can be less even compared to
compressed JSON. It can also lead to faster dumps because there is less data to
transfer and no conversion from the server-internal format (VelocyPack) to JSON
is needed. Note, however, that this option is <strong>experimental</strong> and disabled by
default.</p></li><li><p>Optionally, you can make <em>arangodump</em> write multiple output files per
collection/shard. The file splitting allows for better parallelization when
writing the results to disk, which in case of non-split files must be serialized.
You can enable it by setting the <code>--split-files</code> option to <code>true</code>. This option
is disabled by default because dumps created with this option enabled cannot
be restored into previous versions of ArangoDB.</p></li><li><p>You can enable the new <code>--compress-transfer</code> startup option for compressing the
dump data on the server for a faster transfer. This is helpful especially if
the network is slow or its capacity is maxed out. The data is decompressed on
the client side and recompressed if you enable the <code>--compress-output</code> option.</p></li></ul><h4 id=server-side-resource-usage-limits-and-metrics>Server-side resource usage limits and metrics <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#server-side-resource-usage-limits-and-metrics class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The following <code>arangod</code> startup options can be used to limit
the resource usage of parallel <em>arangodump</em> invocations:</p><ul><li><code>--dump.max-memory-usage</code>: Maximum memory usage (in bytes) to be
used by the server-side parts of all ongoing <em>arangodump</em> invocations.
This option can be used to limit the amount of memory for prefetching
and keeping results on the server side when <em>arangodump</em> is invoked
with the <code>--parallel-dump</code> option. It does not have an effect for
<em>arangodump</em> invocations that did not use the <code>--parallel-dump</code> option.
Note that the memory usage limit is not exact and that it can be
slightly exceeded in some situations to guarantee progress.</li><li>-<code>-dump.max-docs-per-batch</code>: Maximum number of documents per batch
that can be used in a dump. If an <em>arangodump</em> invocation requests
higher values than configured here, the value is automatically
capped to this value. Will only be followed for <em>arangodump</em> invocations
that use the <code>--parallel-dump</code> option.</li><li><code>--dump.max-batch-size</code>: Maximum batch size value (in bytes) that
can be used in a dump. If an <em>arangodump</em> invocation requests larger
batch sizes than configured here, the actual batch sizes is capped
to this value. Will only be followed for <em>arangodump</em> invocations that
use the -<code>-parallel-dump</code> option.</li><li><code>--dump.max-parallelism</code>: Maximum parallelism (number of server-side
threads) that can be used in a dump. If an <em>arangodump</em> invocation requests
a higher number of prefetch threads than configured here, the actual
number of server-side prefetch threads is capped to this value.
Will only be followed for <em>arangodump</em> invocations that use the
<code>--parallel-dump</code> option.</li></ul><p>The following metrics have been added to observe the behavior of parallel
<em>arangodump</em> operations on the server:</p><ul><li><code>arangodb_dump_memory_usage</code>: Current memory usage of all ongoing
<em>arangodump</em> operations on the server.</li><li><code>arangodb_dump_ongoing</code>: Number of currently ongoing <em>arangodump</em>
operations on the server.</li><li><code>arangodb_dump_threads_blocked_total</code>: Number of times a server-side
dump thread was blocked because it honored the server-side memory
limit for dumps.</li></ul><h4 id=automatic-retries>Automatic retries <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#automatic-retries class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><small>Introduced in: v3.12.1</small></p><p><em>arangodump</em> retries dump requests to the server in more cases: read, write and
connection errors. This makes the creation of dumps more likely to succeed
despite any temporary errors that can occur.</p><h3 id=arangorestore>arangorestore <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#arangorestore class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The following startup option has been added that allows <em>arangorestore</em> to override
the <code>writeConcern</code> value specified in a database dump when creating new
collections:</p><ul><li><code>--write-concern</code>: Override the <code>writeConcern</code> value for collections.
Can be specified multiple times, e.g. <code>--write-concern 2 --write-concern myCollection=3</code>
to set the write concern for the collection called <code>myCollection</code> to 3 and
for all other collections to 2.</li></ul><h3 id=arangoimport>arangoimport <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#arangoimport class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><h4 id=maximum-number-of-import-errors>Maximum number of import errors <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#maximum-number-of-import-errors class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The following startup option has been added to <em>arangoimport</em>:</p><ul><li><code>--max-errors</code>: The maximum number of errors after which the import is stopped.
The default value is <code>20</code>.</li></ul><p>You can use this option to limit the amount of errors displayed by <em>arangoimport</em>,
and to abort the import after this value has been reached.</p><h4 id=automatic-file-format-detection>Automatic file format detection <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#automatic-file-format-detection class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The default value for the <code>--type</code> startup option has been changed from <code>json</code>
to <code>auto</code>. <em>arangoimport</em> now automatically detects the type of the import file
based on the file extension.</p><p>The following file extensions are automatically detected:</p><ul><li><code>.json</code></li><li><code>.jsonl</code></li><li><code>.csv</code></li><li><code>.tsv</code></li></ul><p>If the file extension doesn&rsquo;t correspond to any of the mentioned types, the
import defaults to the <code>json</code> format.</p><h3 id=transparent-compression-of-requests-and-responses>Transparent compression of requests and responses <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#transparent-compression-of-requests-and-responses class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Startup options to enable transparent compression of the data that is sent
between a client tool and the ArangoDB server have been added. See the
<a href=#transparent-compression-of-requests-and-responses-between-arangodb-servers-and-client-tools class=link>Server options</a>
section above that includes a description of the added client tool options.</p><h2 id=internal-changes>Internal changes <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#internal-changes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=upgraded-bundled-library-versions>Upgraded bundled library versions <a href=/3.12/release-notes/version-3.12/whats-new-in-3-12/#upgraded-bundled-library-versions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>For ArangoDB 3.12, the bundled version of rclone is 1.65.2. Check if your
rclone configuration files require changes.</p><p>The bundled version of the OpenSSL library has been upgraded to 3.2.1.</p><p>From version 3.11.10 onward, ArangoDB uses the glibc C standard library
implementation with an LGPL-3.0 license instead of libmusl. Notably, it features
string functions that are better optimized for common CPUs.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.12/release-notes/version-3.12/><i class="fas fa-chevron-left fa-fw"></i><p>Version 3.12</p></a></span><span class=next><a class="nav nav-next link" href=/3.12/release-notes/version-3.12/known-issues-in-3-12/><p>Known Issues in 3.12</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.12/release-notes/version-3.12/whats-new-in-3-12.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#arangosearch>ArangoSearch</a></div><div class=level-3><a href=#wand-optimization-enterprise-edition>WAND optimization (Enterprise Edition)</a></div><div class=level-3><a href=#search-parallelization><code>SEARCH</code> parallelization</a></div><div class=level-2><a href=#analyzers>Analyzers</a></div><div class=level-3><a href=#wildcard-analyzer><code>wildcard</code> Analyzer</a></div><div class=level-3><a href=#multi_delimiter-analyzer><code>multi_delimiter</code> Analyzer</a></div><div class=level-2><a href=#improved-memory-accounting-and-usage>Improved memory accounting and usage</a></div><div class=level-2><a href=#web-interface>Web interface</a></div><div class=level-3><a href=#shard-rebalancing>Shard rebalancing</a></div><div class=level-3><a href=#unified-list-view>Unified list view</a></div><div class=level-3><a href=#options--optimizer-rules-management-in-the-query-editor>Options & optimizer rules management in the Query Editor</a></div><div class=level-3><a href=#swagger-ui>Swagger UI</a></div><div class=level-2><a href=#external-versioning-support>External versioning support</a></div><div class=level-2><a href=#aql>AQL</a></div><div class=level-3><a href=#improved-joins>Improved joins</a></div><div class=level-3><a href=#filter-matching-syntax-for-upsert-operations>Filter matching syntax for <code>UPSERT</code> operations</a></div><div class=level-3><a href=#readownwrites-option-for-upsert-operations><code>readOwnWrites</code> option for <code>UPSERT</code> operations</a></div><div class=level-3><a href=#parallel-execution-within-an-aql-query>Parallel execution within an AQL query</a></div><div class=level-3><a href=#added-aql-functions>Added AQL functions</a></div><div class=level-3><a href=#timezone-parameter-for-date-functions>Timezone parameter for date functions</a></div><div class=level-3><a href=#improved-move-filters-into-enumerate-optimizer-rule>Improved <code>move-filters-into-enumerate</code> optimizer rule</a></div><div class=level-3><a href=#improved-late-document-materialization>Improved late document materialization</a></div><div class=level-3><a href=#short-circuiting-subquery-evaluation>Short-circuiting subquery evaluation</a></div><div class=level-3><a href=#index-hints-for-traversals>Index hints for traversals</a></div><div class=level-3><a href=#query-logging>Query logging</a></div><div class=level-3><a href=#bypass-edge-cache-for-graph-operations>Bypass edge cache for graph operations</a></div><div class=level-3><a href=#push-limit-into-index-optimization>Push limit into index optimization</a></div><div class=level-3><a href=#array-and-object-destructuring>Array and object destructuring</a></div><div class=level-3><a href=#improved-utilization-of-sorting-order-for-collect>Improved utilization of sorting order for <code>COLLECT</code></a></div><div class=level-3><a href=#fast-object-enumeration-with-entries>Fast object enumeration with <code>ENTRIES()</code></a></div><div class=level-3><a href=#improved-graph-path-searches>Improved graph path searches</a></div><div class=level-3><a href=#cache-for-query-execution-plans-experimental>Cache for query execution plans (experimental)</a></div><div class=level-3><a href=#push-function-available-for-aggregations><code>PUSH()</code> function available for aggregations</a></div><div class=level-3><a href=#improved-index-utilization-for-sort>Improved index utilization for <code>SORT</code></a></div><div class=level-3><a href=#improved-index-utilization-for-collect>Improved index utilization for <code>COLLECT</code></a></div><div class=level-2><a href=#indexing>Indexing</a></div><div class=level-3><a href=#multi-dimensional-indexes>Multi-dimensional indexes</a></div><div class=level-4><a href=#native-strict-ranges>Native strict ranges</a></div><div class=level-4><a href=#extended-utilization-of-sparse-indexes>Extended utilization of sparse indexes</a></div><div class=level-3><a href=#stored-values-can-contain-the-_id-attribute>Stored values can contain the <code>_id</code> attribute</a></div><div class=level-3><a href=#vector-indexes-experimental>Vector indexes (experimental)</a></div><div class=level-2><a href=#server-options>Server options</a></div><div class=level-3><a href=#effective-and-available-startup-options>Effective and available startup options</a></div><div class=level-3><a href=#protocol-aliases-for-endpoints>Protocol aliases for endpoints</a></div><div class=level-3><a href=#adjustable-stream-transaction-size>Adjustable Stream Transaction size</a></div><div class=level-3><a href=#transparent-compression-of-requests-and-responses-between-arangodb-servers-and-client-tools>Transparent compression of requests and responses between ArangoDB servers and client tools</a></div><div class=level-3><a href=#lz4-compression-for-values-in-the-in-memory-edge-cache>LZ4 compression for values in the in-memory edge cache</a></div><div class=level-3><a href=#limit-the-number-of-databases-in-a-deployment>Limit the number of databases in a deployment</a></div><div class=level-3><a href=#--databaseextended-names-enabled-by-default><code>--database.extended-names</code> enabled by default</a></div><div class=level-3><a href=#cluster-internal-connectivity-checks>Cluster-internal connectivity checks</a></div><div class=level-3><a href=#configurable-maximum-for-queued-log-entries>Configurable maximum for queued log entries</a></div><div class=level-3><a href=#configurable-maximal-size-for-cache-entries>Configurable maximal size for cache entries</a></div><div class=level-3><a href=#configurable-async-prefetch-limits>Configurable async prefetch limits</a></div><div class=level-3><a href=#new-server-scheduler-type>New server scheduler type</a></div><div class=level-3><a href=#query-logging-options>Query logging options</a></div><div class=level-3><a href=#cluster-management-options>Cluster management options</a></div><div class=level-2><a href=#miscellaneous-changes>Miscellaneous changes</a></div><div class=level-3><a href=#v8-and-icu-library-upgrades>V8 and ICU library upgrades</a></div><div class=level-3><a href=#active-aql-query-cursors-metric>Active AQL query cursors metric</a></div><div class=level-3><a href=#per-collection-compaction-in-cluster>Per-collection compaction in cluster</a></div><div class=level-3><a href=#rocksdb-sst-file-partitioning-experimental>RocksDB .sst file partitioning (experimental)</a></div><div class=level-3><a href=#arangosearch-file-descriptor-metric>ArangoSearch file descriptor metric</a></div><div class=level-3><a href=#more-instant-hot-backups>More instant Hot Backups</a></div><div class=level-3><a href=#in-memory-edge-cache-startup-options-and-metrics>In-memory edge cache startup options and metrics</a></div><div class=level-3><a href=#observability-of-in-memory-cache-subsystem>Observability of in-memory cache subsystem</a></div><div class=level-3><a href=#detached-scheduler-threads>Detached scheduler threads</a></div><div class=level-3><a href=#monitoring-per-collectiondatabaseuser>Monitoring per collection/database/user</a></div><div class=level-3><a href=#compression-for-cluster-internal-traffic>Compression for cluster-internal traffic</a></div><div class=level-3><a href=#read-only-shards-metric>Read-only shards metric</a></div><div class=level-3><a href=#log-queue-overwhelm-metric>Log queue overwhelm metric</a></div><div class=level-3><a href=#scheduler-dequeue-time-metrics>Scheduler dequeue time metrics</a></div><div class=level-3><a href=#option-to-skip-fast-lock-round-for-stream-transactions>Option to skip fast lock round for Stream Transactions</a></div><div class=level-3><a href=#individual-log-levels-per-log-output>Individual log levels per log output</a></div><div class=level-3><a href=#lost-subordinate-transactions-metric>Lost subordinate transactions metric</a></div><div class=level-2><a href=#client-tools>Client tools</a></div><div class=level-3><a href=#protocol-aliases-for-endpoints-1>Protocol aliases for endpoints</a></div><div class=level-3><a href=#arangodump>arangodump</a></div><div class=level-4><a href=#--ignore-collection-startup-option><code>--ignore-collection</code> startup option</a></div><div class=level-4><a href=#improved-dump-performance-and-size>Improved dump performance and size</a></div><div class=level-4><a href=#server-side-resource-usage-limits-and-metrics>Server-side resource usage limits and metrics</a></div><div class=level-4><a href=#automatic-retries>Automatic retries</a></div><div class=level-3><a href=#arangorestore>arangorestore</a></div><div class=level-3><a href=#arangoimport>arangoimport</a></div><div class=level-4><a href=#maximum-number-of-import-errors>Maximum number of import errors</a></div><div class=level-4><a href=#automatic-file-format-detection>Automatic file format detection</a></div><div class=level-3><a href=#transparent-compression-of-requests-and-responses>Transparent compression of requests and responses</a></div><div class=level-2><a href=#internal-changes>Internal changes</a></div><div class=level-3><a href=#upgraded-bundled-library-versions>Upgraded bundled library versions</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>