<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743775370></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="You can write UDFs in JavaScript to extend AQL or to simplify queries"><meta property="og:url" content="http://localhost/3.12/aql/user-defined-functions/"><meta property="og:title" content="Extending AQL with user-defined functions"><meta property="og:type" content="website"><meta property="og:description" content="You can write UDFs in JavaScript to extend AQL or to simplify queries"><meta name=docsearch:version content="3.12"><title>Extending AQL with user-defined functions | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743775370 defer></script>
<script src=/js/featherlight.min.js?1743775370 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743775370 defer></script>
<script src=/js/theme.js?1743775370 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.12"><a itemprop=item class=link href=/3.12/><span itemprop=name class=breadcrumb-entry>3.12.4</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="AQL"><a itemprop=item class=link href=/3.12/aql/><span itemprop=name class=breadcrumb-entry>AQL</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="User-defined Functions"><a itemprop=item class=link href=/3.12/aql/user-defined-functions/><span itemprop=name class=breadcrumb-entry>User-defined Functions</span></a></li></ol></nav><article class=default><hgroup><h1>Extending AQL with user-defined functions</h1><p class=lead>You can write UDFs in JavaScript to extend AQL or to simplify queries</p></hgroup><p>AQL comes with a <a href=/3.12/aql/functions/ class=link>built-in set of functions</a>, but it is
not a fully-featured programming language. To add missing functionality or to
simplify queries, you may write your own user-defined functions (<strong>UDFs</strong>) in
JavaScript and make them available in AQL.</p><h2 id=known-limitations>Known Limitations <a href=/3.12/aql/user-defined-functions/#known-limitations class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>UDFs can have serious effects on the performance of your queries and the resource
usage in ArangoDB. Especially in cluster setups they should not be used against
much data, because this data will need to be sent over the network back and forth
between <em>DB-Servers</em> and <em>Coordinators</em>, potentially adding a lot of latency.
This can be mitigated by very selective <code>FILTER</code>s before calls to UDFs.</div></div></div></div><p>Since the optimizer doesn&rsquo;t know anything about the nature of your function,
<strong>the optimizer can&rsquo;t use indexes for UDFs</strong>. So you should never lean on a UDF
as the primary criterion for a <code>FILTER</code> statement to reduce your query result set.
Instead, put a another <code>FILTER</code> statement in front of it. You should make sure
that this <a href=/3.12/aql/execution-and-performance/query-optimization/ class=link><strong><code>FILTER</code> statement</strong> is effective</a>
to reduce the query result before passing it to your UDF.</p><p>Rule of thumb is, the closer the UDF is to your final <code>RETURN</code> statement
(or maybe even inside it), the better.</p><p>When used in clusters, UDFs are always executed on a
<a href=/3.12/deploy/cluster/ class=link>Coordinator</a>.
It is not possible to execute UDFs on DB-Servers, as no JavaScript execution
engine is available on DB-Servers. Queries that would push UDF execution to
DB-Servers are aborted with a parse error. This includes using UDFs in traversal
<code>PRUNE</code> conditions, as well as <code>FILTER</code> conditions that can be moved into the
traversal execution on a DB-Server. These limitations also apply to the
single server deployment mode to keep the differences to cluster deployments minimal.</p><p>As UDFs are written in JavaScript, each query that executes a UDF will acquire
one V8 context to execute the UDFs in it. V8 contexts can be re-used across subsequent
queries, but when UDF-invoking queries run in parallel, they will each require a
dedicated V8 context.</p><p>Because UDFs use the V8 JavaScript engine, the engine&rsquo;s default memory limit of 512 MB is applied.</p><p>Using UDFs in clusters may thus result in a higher resource allocation
in terms of used V8 contexts and server threads. If you run out
of these resources, your query may abort with a
<a href=/3.12/develop/error-codes-and-meanings/ class=link><strong>cluster backend unavailable</strong></a> error.</p><p>To overcome these mentioned limitations, you may want to increase the
<a href=/3.12/components/arangodb-server/options/#--javascriptv8-contexts class=link>number of available V8 contexts</a>
(at the expense of increased memory usage), and the
<a href=/3.12/components/arangodb-server/options/#--servermaximal-threads class=link>number of available server threads</a>.</p><p>In addition, modification of global JavaScript variables from inside UDFs is
unsupported, as is reading or changing the data of any collection or running
queries from inside an AQL user function.</p><h2 id=naming>Naming <a href=/3.12/aql/user-defined-functions/#naming class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>AQL functions that are implemented with JavaScript are always in a namespace.
To register a user-defined AQL function, you need to give it a name with a
namespace. The <code>::</code> symbol is used as the namespace separator, for example,
<code>MYGROUP::MYFUNC</code>. You can use one or multiple levels of namespaces to create
meaningful function groups.</p><p>The names of user-defined functions are case-insensitive, like all function
names in AQL.</p><p>To refer to and call user-defined functions in AQL queries, you need to use the
fully qualified name with the namespaces:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=nf>MYGROUP::MYFUNC</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nf>MYFUNCTIONS::MATH::RANDOM</span><span class=p>()</span></span></span></code></pre></div><p>ArangoDB&rsquo;s built-in AQL functions are all implemented in C++ and are not in a
namespace, except for the internal <code>V8()</code> function, which resides in the <code>_aql</code>
namespace. It is the default namespace, which means that you can use the
unqualified name of the function (without <code>_aql::</code>) to refer to it. Note that
you cannot add own functions to this namespace.</p><h2 id=variables-and-side-effects>Variables and side effects <a href=/3.12/aql/user-defined-functions/#variables-and-side-effects class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>User functions can take any number of input arguments and should
provide one result via a <code>return</code> statement. User functions should be kept
purely functional and thus free of side effects and state, and state modification.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>Modification of global variables is unsupported, as is reading or changing
the data of any collection or running queries from inside an AQL user function.</div></div></div></div><p>User function code is late-bound, and may thus not rely on any variables
that existed at the time of declaration. If user function code requires
access to any external data, it must take care to set up the data by
itself.</p><p>All AQL user function-specific variables should be introduced with the <code>var</code>,
<code>let</code>, or <code>const</code> keywords in order to not accidentally access already defined
variables from outer scopes. Not using a declaration keyword for own variables
may cause side effects when executing the function.</p><p>Here is an example that may modify outer scope variables <code>i</code> and <code>name</code>,
making the function <strong>not</strong> side-effect free:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=p>(</span><span class=nx>values</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>values</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=o>++</span><span class=nx>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span> <span class=o>=</span> <span class=nx>values</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>name</span> <span class=o>===</span> <span class=s2>&#34;foo&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The above function can be made free of side effects by using the <code>var</code>, <code>let</code>,
or <code>const</code> keywords, so the variables become function-local variables:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=p>(</span><span class=nx>values</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>values</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=o>++</span><span class=nx>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>values</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>name</span> <span class=o>===</span> <span class=s2>&#34;foo&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><h2 id=input-parameters>Input parameters <a href=/3.12/aql/user-defined-functions/#input-parameters class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>In order to return a result, a user function should use a <code>return</code> instruction
rather than modifying its input parameters.</p><p>AQL user functions are allowed to modify their input parameters for input
parameters that are null, boolean, numeric or string values. Modifying these
input parameter types inside a user function should be free of side effects.
However, user functions should not modify input parameters if the parameters are
arrays or objects and as such passed by reference, as that may modify variables
and state outside of the user function itself.</p><h2 id=return-values>Return values <a href=/3.12/aql/user-defined-functions/#return-values class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>User functions must only return primitive types (i.e. <code>null</code>, boolean
values, numeric values, string values) or aggregate types (arrays or
objects) composed of these types.
Returning any other JavaScript object type (Function, Date, RegExp etc.) from
a user function may lead to undefined behavior and should be avoided.</p><h2 id=enforcing-strict-mode>Enforcing strict mode <a href=/3.12/aql/user-defined-functions/#enforcing-strict-mode class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>By default, any user function code is executed in <em>sloppy mode</em>. In order to
make a user function run in strict mode, use <code>"use strict"</code> explicitly inside
the user function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=p>(</span><span class=nx>values</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;use strict&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>values</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=o>++</span><span class=nx>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>values</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>name</span> <span class=o>===</span> <span class=s2>&#34;foo&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Any violation of the strict mode triggers a runtime error.</p><h2 id=registering-and-unregistering-user-functions>Registering and unregistering user functions <a href=/3.12/aql/user-defined-functions/#registering-and-unregistering-user-functions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>User-defined functions (UDFs) can be registered in the selected database
using the <code>@arangodb/aql/functions</code> module as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>aqlfunctions</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/functions&#34;</span><span class=p>);</span></span></span></code></pre></div><p>To register a function, the fully qualified function name plus the
function code must be specified. This can easily be done in
<a href=/3.12/components/tools/arangodb-shell/ class=link>arangosh</a>. The
<a href=/3.12/develop/http-api/queries/user-defined-aql-functions/ class=link>HTTP Interface</a> also offers
User Functions management.</p><p>In a cluster setup, make sure to connect to a Coordinator to manage the UDFs.</p><p>Documents in the <code>_aqlfunctions</code> collection (or any other system collection)
should not be accessed directly, but only via the dedicated interfaces.
Otherwise you might see caching issues or accidentally break something.
The interfaces ensure the correct format of the documents and invalidate
the UDF cache.</p><h3 id=registering-an-aql-user-function>Registering an AQL user function <a href=/3.12/aql/user-defined-functions/#registering-an-aql-user-function class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>For testing, it may be sufficient to directly type the function code in the shell.
To manage more complex code, you may write it in the code editor of your choice
and save it as file. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/* path/to/file.js */</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;use strict&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>greeting</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>name</span> <span class=o>===</span> <span class=kc>undefined</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span> <span class=o>=</span> <span class=s2>&#34;World&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=sb>`Hello </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>!`</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>greeting</span><span class=p>;</span></span></span></code></pre></div><p>Then require it in the shell in order to register a user-defined function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=kd>var</span> <span class=nx>func</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;path/to/file.js&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>aqlfunctions</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s2>&#34;HUMAN::GREETING&#34;</span><span class=p>,</span> <span class=nx>func</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span></span></span></code></pre></div><p>Note that a return value of <code>false</code> means that the function <code>HUMAN::GREETING</code>
was newly created, and not that it failed to register. <code>true</code> is returned
if a function of that name existed before and was just updated.</p><p><code>aqlfunctions.register(name, code, isDeterministic)</code></p><p>Registers an AQL user function, identified by a fully qualified function
name. The function code in <code>code</code> must be specified as a JavaScript
function or a string representation of a JavaScript function.
If the function code in <code>code</code> is passed as a string, it is required that
the string evaluates to a JavaScript function definition.</p><p>If a function identified by <code>name</code> already exists, the previous function
definition is updated. Please also make sure that the function code
does not violate the conventions for AQL functions, in particular with regards
to the <a href=#naming class=link>naming</a> and <a href=#variables-and-side-effects class=link>side-effects</a>.</p><p>The <code>isDeterministic</code> attribute can be used to specify whether the
function results are fully deterministic (i.e. depend solely on the input
and are the same for repeated calls with the same input values). It is not
used at the moment but may be used for optimizations later.</p><p>The registered function is stored in the selected database&rsquo;s system
collection <code>_aqlfunctions</code>.</p><p>The function returns <code>true</code> when it updates/replaces an existing AQL
function of the same name, and <code>false</code> otherwise. It throws an exception
if it detects syntactically invalid function code.</p><p><strong>Examples</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/functions&#34;</span><span class=p>).</span><span class=nx>register</span><span class=p>(</span><span class=s2>&#34;MYFUNCTIONS::TEMPERATURE::CELSIUSTOFAHRENHEIT&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=p>(</span><span class=nx>celsius</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>celsius</span> <span class=o>*</span> <span class=mf>1.8</span> <span class=o>+</span> <span class=mi>32</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>The function code is not executed in <em>strict mode</em> or <em>strong mode</em> by
default. In order to make a user function being run in strict mode, use
<code>use strict</code> explicitly, e.g.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/functions&#34;</span><span class=p>).</span><span class=nx>register</span><span class=p>(</span><span class=s2>&#34;MYFUNCTIONS::TEMPERATURE::CELSIUSTOFAHRENHEIT&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=p>(</span><span class=nx>celsius</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;use strict&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>celsius</span> <span class=o>*</span> <span class=mf>1.8</span> <span class=o>+</span> <span class=mi>32</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>You can access the name under which the AQL function is registered by accessing
the <code>name</code> property of <code>this</code> inside the JavaScript code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/functions&#34;</span><span class=p>).</span><span class=nx>register</span><span class=p>(</span><span class=s2>&#34;MYFUNCTIONS::TEMPERATURE::CELSIUSTOFAHRENHEIT&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=p>(</span><span class=nx>celsius</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;use strict&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>celsius</span> <span class=o>===</span> <span class=s2>&#34;undefined&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>error</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb&#34;</span><span class=p>).</span><span class=nx>errors</span><span class=p>.</span><span class=nx>ERROR_QUERY_FUNCTION_ARGUMENT_NUMBER_MISMATCH</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>AQL_WARNING</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span><span class=p>,</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;util&#34;</span><span class=p>).</span><span class=nx>format</span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>celsius</span> <span class=o>*</span> <span class=mf>1.8</span> <span class=o>+</span> <span class=mi>32</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p><code>AQL_WARNING()</code> is automatically available to the code of user-defined
functions. The error code and message is retrieved via <code>@arangodb</code> module.
The <em>argument number mismatch</em> message has placeholders, which we can substitute
using <a href=http://nodejs.org/api/util.html target=_blank rel="noopener noreferrer" class=link>format()</a>&nbsp;<i class="fas fa-external-link-alt"></i>:</p><pre tabindex=0><code>invalid number of arguments for function &#39;%s()&#39;, expected number of arguments: minimum: %d, maximum: %d
</code></pre><p>In the example above, <code>%s</code> is replaced by <code>this.name</code> (the AQL function name),
and both <code>%d</code> placeholders by <code>1</code> (number of expected arguments). If you call
the function without an argument, you see this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span><span class=s2>&#34;RETURN MYFUNCTIONS::TEMPERATURE::CELSIUSTOFAHRENHEIT()&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>object</span> <span class=nx>ArangoQueryCursor</span><span class=p>,</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>hasMore</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>warning</span><span class=o>:</span> <span class=mi>1541</span> <span class=o>-</span> <span class=nx>invalid</span>
</span></span><span class=line><span class=cl><span class=nx>number</span> <span class=k>of</span> <span class=nx>arguments</span> <span class=k>for</span> <span class=kd>function</span> <span class=s1>&#39;MYFUNCTIONS::TEMPERATURE::CELSIUSTOFAHRENHEIT()&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=nx>expected</span> <span class=nx>number</span> <span class=k>of</span> <span class=nx>arguments</span><span class=o>:</span> <span class=nx>minimum</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>maximum</span><span class=o>:</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=kc>null</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div><h3 id=deleting-an-existing-aql-user-function>Deleting an existing AQL user function <a href=/3.12/aql/user-defined-functions/#deleting-an-existing-aql-user-function class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>aqlfunctions.unregister(name)</code></p><p>Unregisters an existing AQL user function, identified by the fully qualified
function name.</p><p>Trying to unregister a function that does not exist results in an
exception.</p><p><strong>Examples</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/functions&#34;</span><span class=p>).</span><span class=nx>unregister</span><span class=p>(</span><span class=s2>&#34;MYFUNCTIONS::TEMPERATURE::CELSIUSTOFAHRENHEIT&#34;</span><span class=p>);</span></span></span></code></pre></div><h3 id=unregister-group>Unregister group <a href=/3.12/aql/user-defined-functions/#unregister-group class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Delete a group of AQL user functions:</p><p><code>aqlfunctions.unregisterGroup(prefix)</code></p><p>Unregisters a group of AQL user function, identified by a common function
group prefix.</p><p>This returns the number of functions unregistered.</p><p><strong>Examples</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/functions&#34;</span><span class=p>).</span><span class=nx>unregisterGroup</span><span class=p>(</span><span class=s2>&#34;MYFUNCTIONS::TEMPERATURE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/functions&#34;</span><span class=p>).</span><span class=nx>unregisterGroup</span><span class=p>(</span><span class=s2>&#34;MYFUNCTIONS&#34;</span><span class=p>);</span></span></span></code></pre></div><h3 id=listing-all-aql-user-functions>Listing all AQL user functions <a href=/3.12/aql/user-defined-functions/#listing-all-aql-user-functions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>aqlfunctions.toArray()</code></p><p>Returns all previously registered AQL user functions, with their fully
qualified names and function code.</p><hr><p><code>aqlfunctions.toArray(prefix)</code></p><p>Returns all previously registered AQL user functions, restricted to a specified
group of functions by specifying a group prefix.</p><p><strong>Examples</strong></p><p>To list all available user functions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/functions&#34;</span><span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><p>To list all available user functions in the <em>MYFUNCTIONS</em> namespace:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/functions&#34;</span><span class=p>).</span><span class=nx>toArray</span><span class=p>(</span><span class=s2>&#34;MYFUNCTIONS&#34;</span><span class=p>);</span></span></span></code></pre></div><p>To list all available user functions in the <em>MYFUNCTIONS::TEMPERATURE</em> namespace:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@arangodb/aql/functions&#34;</span><span class=p>).</span><span class=nx>toArray</span><span class=p>(</span><span class=s2>&#34;MYFUNCTIONS::TEMPERATURE&#34;</span><span class=p>);</span></span></span></code></pre></div><h2 id=deployment-details>Deployment Details <a href=/3.12/aql/user-defined-functions/#deployment-details class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Internally, UDFs are stored in a system collection named <code>_aqlfunctions</code>
of the selected database. When an AQL statement refers to such a UDF,
it is loaded from that collection. The UDFs will be exclusively
available for queries in that particular database.</p><p>Since the Coordinator doesn&rsquo;t have own local collections, the <code>_aqlfunctions</code>
collection is sharded across the cluster. Therefore (as usual), it has to be
accessed through a Coordinator - you mustn&rsquo;t talk to the shards directly.
Once it is in the <code>_aqlfunctions</code> collection, it is available on all
Coordinators without additional effort.</p><p>Keep in mind that system collections are excluded from dumps created with
<a href=/3.12/components/tools/arangodump/ class=link>arangodump</a> by default.
To include AQL UDF in a dump, the dump needs to be started with
the option <em>--include-system-collections true</em>.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.12/aql/examples-and-query-patterns/><i class="fas fa-chevron-left fa-fw"></i><p>Examples & Query Patterns</p></a></span><span class=next><a class="nav nav-next link" href=/3.12/aql/execution-and-performance/><p>Execution and Performance</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.12/aql/user-defined-functions.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#known-limitations>Known Limitations</a></div><div class=level-2><a href=#naming>Naming</a></div><div class=level-2><a href=#variables-and-side-effects>Variables and side effects</a></div><div class=level-2><a href=#input-parameters>Input parameters</a></div><div class=level-2><a href=#return-values>Return values</a></div><div class=level-2><a href=#enforcing-strict-mode>Enforcing strict mode</a></div><div class=level-2><a href=#registering-and-unregistering-user-functions>Registering and unregistering user functions</a></div><div class=level-3><a href=#registering-an-aql-user-function>Registering an AQL user function</a></div><div class=level-3><a href=#deleting-an-existing-aql-user-function>Deleting an existing AQL user function</a></div><div class=level-3><a href=#unregister-group>Unregister group</a></div><div class=level-3><a href=#listing-all-aql-user-functions>Listing all AQL user functions</a></div><div class=level-2><a href=#deployment-details>Deployment Details</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>