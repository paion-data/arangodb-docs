<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743774193></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="ArangoDB is a scalable graph database system with native support for other data models and a built-in search engine, for the cloud and on-premises"><meta property="og:url" content="http://localhost/3.10/develop/foxx-microservices/reference/related-modules/queues/"><meta property="og:title" content="Foxx queues"><meta property="og:type" content="website"><meta property="og:description" content="ArangoDB is a scalable graph database system with native support for other data models and a built-in search engine, for the cloud and on-premises"><meta name=docsearch:version content="3.10"><title>Foxx queues | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743774193 defer></script>
<script src=/js/featherlight.min.js?1743774193 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743774193 defer></script>
<script src=/js/theme.js?1743774193 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.10"><a itemprop=item class=link href=/3.10/><span itemprop=name class=breadcrumb-entry>3.10.14</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Develop"><a itemprop=item class=link href=/3.10/develop/><span itemprop=name class=breadcrumb-entry>Develop</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Foxx Microservices"><a itemprop=item class=link href=/3.10/develop/foxx-microservices/><span itemprop=name class=breadcrumb-entry>Foxx Microservices</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Reference"><a itemprop=item class=link href=/3.10/develop/foxx-microservices/reference/><span itemprop=name class=breadcrumb-entry>Reference</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Related modules"><a itemprop=item class=link href=/3.10/develop/foxx-microservices/reference/related-modules/><span itemprop=name class=breadcrumb-entry>Related modules</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Queues"><a itemprop=item class=link href=/3.10/develop/foxx-microservices/reference/related-modules/queues/><span itemprop=name class=breadcrumb-entry>Queues</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.10 reached End of Life (EOL) and is no longer supported.</p><p>This documentation is outdated. Please see the most recent <a href=/3.12/develop/foxx-microservices/reference/related-modules/queues/ class=link>stable version</a>.</p></div></div></div></div><hgroup><h1>Foxx queues</h1></hgroup><p><code>const queues = require('@arangodb/foxx/queues')</code></p><p>Foxx allows defining job queues that let you perform slow or expensive actions
asynchronously. These queues can be used to send e-mails, call external APIs or
perform other actions that you do not want to perform directly or want to retry
on failure.</p><p>Foxx queue jobs can be any <a href=/3.10/develop/foxx-microservices/guides/scripts-and-scheduling/ class=link>script</a> named in the
<a href=/3.10/develop/foxx-microservices/reference/service-manifest/ class=link>manifest</a> of a service in the same database.</p><p>Please note that Foxx queues are database-specific. Queues and jobs are always
relative to the database in which they are created or accessed.</p><p>For disabling the Foxx queues feature or adjusting the polling interval see the
<a href=/3.10/components/arangodb-server/options/#foxx class=link><code>foxx.queues</code> and <code>foxx.queues-poll-interval</code> options</a>.</p><p>For the low-level functionality see the chapter on the
<a href=/3.10/develop/javascript-api/tasks/ class=link>task management module</a>.</p><h2 id=managing-queues>Managing queues <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#managing-queues class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=queuescreate>queues.create <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queuescreate class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queues.create(name, [maxWorkers]): Queue</code></p><p>Returns the queue for the given name. If the queue does not exist, a new queue
with the given name is created. If a queue with the given name already exists
and <code>maxWorkers</code> is set, the queue&rsquo;s maximum number of workers is updated.
The queue is created in the current database.</p><p><strong>Arguments</strong></p><ul><li><p><strong>name</strong>: <code>string</code></p><p>Name of the queue to create.</p></li><li><p><strong>maxWorkers</strong>: <code>number</code> (Default: <code>1</code>)</p><p>The maximum number of workers.</p></li></ul><p><strong>Examples</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Create a queue with the default number of workers (i.e. one)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>queue1</span> <span class=o>=</span> <span class=nx>queues</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s2>&#34;my-queue&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Create a queue with a given number of workers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>queue2</span> <span class=o>=</span> <span class=nx>queues</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s2>&#34;another-queue&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Update the number of workers of an existing queue
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>queue3</span> <span class=o>=</span> <span class=nx>queues</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s2>&#34;my-queue&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// queue1 and queue3 refer to the same queue
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>assertEqual</span><span class=p>(</span><span class=nx>queue1</span><span class=p>,</span> <span class=nx>queue3</span><span class=p>);</span></span></span></code></pre></div><h3 id=queuesget>queues.get <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queuesget class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queues.get(name): Queue</code></p><p>Returns the queue for the given name. If the queue does not exist an exception
is thrown instead.</p><p>The queue is looked up in the current database.</p><p><strong>Arguments</strong></p><ul><li><p><strong>name</strong>: <code>string</code></p><p>Name of the queue to fetch.</p></li></ul><p><strong>Examples</strong></p><p>If the queue does not yet exist an exception is thrown:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>queues</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;some-queue&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Error: Queue does not exist: some-queue
</span></span></span><span class=line><span class=cl><span class=c1>//     at ...
</span></span></span></code></pre></div><p>Otherwise, the queue is returned:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queue1</span> <span class=o>=</span> <span class=nx>queues</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s2>&#34;some-queue&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queue2</span> <span class=o>=</span> <span class=nx>queues</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;some-queue&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>assertEqual</span><span class=p>(</span><span class=nx>queue1</span><span class=p>,</span> <span class=nx>queue2</span><span class=p>);</span></span></span></code></pre></div><h3 id=queuesdelete>queues.delete <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queuesdelete class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queues.delete(name): boolean</code></p><p>Returns <code>true</code> if the queue was deleted successfully.
If the queue did not exist, it returns <code>false</code> instead.
The queue is looked up and deleted in the current database.</p><p>When a queue is deleted, jobs on that queue are no longer executed.</p><p>Deleting a queue does not delete any jobs on that queue.</p><p><strong>Arguments</strong></p><ul><li><p><strong>name</strong>: <code>string</code></p><p>Name of the queue to delete.</p></li></ul><p><strong>Examples</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queue</span> <span class=o>=</span> <span class=nx>queues</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s2>&#34;my-queue&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>queues</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=s2>&#34;my-queue&#34;</span><span class=p>);</span> <span class=c1>// true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>queues</span><span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=s2>&#34;my-queue&#34;</span><span class=p>);</span> <span class=c1>// false
</span></span></span></code></pre></div><h2 id=queue-api>Queue API <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queue-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=queuepush>queue.push <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queuepush class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queue.push(script, data, [opts]): string</code></p><p>The job is added to the specified queue in the current database.</p><p>Returns the job id.</p><p><strong>Arguments</strong></p><ul><li><p><strong>script</strong>: <code>object</code></p><p>A job type definition, consisting of an object with the following properties:</p><ul><li><p><strong>name</strong>: <code>string</code></p><p>Name of the script to invoke.</p></li><li><p><strong>mount</strong>: <code>string</code></p><p>Mount path of the service that defines the script.</p></li><li><p><strong>backOff</strong>: <code>Function | number</code> (Default: <code>1000</code>)</p><p>Either a function that takes the number of times the job has failed before
as input and returns the number of milliseconds to wait before trying the
job again, or the delay to be used to calculate an
<a href=https://en.wikipedia.org/wiki/Exponential_backoff target=_blank rel="noopener noreferrer" class=link>exponential back-off</a>&nbsp;<i class="fas fa-external-link-alt"></i>,
or <code>0</code> for no delay.</p></li><li><p><strong>maxFailures</strong>: <code>number | Infinity</code> (Default: <code>0</code>):</p><p>Number of times a single run of a job will be re-tried before it is marked
as <code>"failed"</code>. A negative value or <code>Infinity</code> means that the job is
re-tried on failure indefinitely.</p></li><li><p><strong>schema</strong>: <code>Schema</code> (optional)</p><p>Schema to validate a job&rsquo;s data against before enqueuing the job.</p></li><li><p><strong>preprocess</strong>: <code>Function</code> (optional)</p><p>Function to pre-process a job&rsquo;s (validated) data before serializing it in the queue.</p></li></ul></li><li><p><strong>data</strong>: <code>any</code></p><p>Job data of the job; must be serializable to JSON.</p></li><li><p><strong>opts</strong>: <code>object</code> (optional)</p><p>Object with any of the following properties:</p><ul><li><p><strong>success</strong>: <code>Function</code> (optional)</p><p>Function to be called after the job has been completed successfully.</p></li><li><p><strong>failure</strong>: <code>Function</code> (optional)</p><p>Function to be called after the job has failed too many times.</p></li><li><p><strong>delayUntil</strong>: <code>number | Date</code> (Default: <code>Date.now()</code>)</p><p>Timestamp in milliseconds (or <code>Date</code> instance) until which the execution of
the job should be delayed.</p></li><li><p><strong>backOff</strong>: <code>Function | number</code> (Default: <code>1000</code>)</p><p>See <code>script.backOff</code>.</p></li><li><p><strong>maxFailures</strong>: <code>number | Infinity</code> (Default: <code>0</code>):</p><p>See <code>script.maxFailures</code>.</p></li><li><p><strong>repeatTimes</strong>: <code>number</code> (Default: <code>0</code>)</p><p>If set to a positive number, the job is repeated this many times
(not counting recovery when using <code>maxFailures</code>).
If set to a negative number or <code>Infinity</code>, the job is repeated
indefinitely. If set to <code>0</code>, the job is not repeated.</p></li><li><p><strong>repeatUntil</strong>: <code>number | Date</code> (optional)</p><p>If the job is set to automatically repeat, this can be set to a timestamp
in milliseconds (or <code>Date</code> instance) after which the job no longer repeats.
Setting this value to zero, a negative value or <code>Infinity</code> has no effect.</p></li><li><p><strong>repeatDelay</strong>: <code>number</code> (Default: <code>0</code>)</p><p>If the job is set to automatically repeat, this can be set to a non-negative
value to set the number of milliseconds for which the job is delayed
before it is started again.</p></li></ul></li></ul><p>Note that if you pass a function for the <code>backOff</code> calculation, <code>success</code>
callback, or <code>failure</code> callback options, the function is serialized to
the database as a string, and therefore must not rely on any external scope
or external variables.</p><p>When the job is set to automatically repeat, the <code>failure</code> callback is only
executed when a run of the job has failed more than <code>maxFailures</code> times.
Note that if the job fails and <code>maxFailures</code> is set, it is rescheduled
according to the <code>backOff</code> until it has either failed too many times or
completed successfully before being scheduled according to the <code>repeatDelay</code>
again. Recovery attempts by <code>maxFailures</code> do not count towards <code>repeatTimes</code>.</p><p>The <code>success</code> and <code>failure</code> callbacks receive the following arguments:</p><ul><li><p><strong>result</strong>: <code>any</code></p><p>The return value of the script for the current run of the job.</p></li><li><p><strong>jobData</strong>: <code>any</code></p><p>The data passed to this method.</p></li><li><p><strong>job</strong>: <code>object</code></p><p>ArangoDB document representing the job&rsquo;s current state.</p></li></ul><p><strong>Examples</strong></p><p>Let&rsquo;s say we have an service mounted at <code>/mailer</code> that provides a script called <code>send-mail</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=s1>&#39;use strict&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queues</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@arangodb/foxx/queues&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queue</span> <span class=o>=</span> <span class=nx>queues</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;my-queue&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>queue</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>mount</span><span class=o>:</span> <span class=s1>&#39;/mailer&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;send-mail&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>to</span><span class=o>:</span> <span class=s1>&#39;hello@example.com&#39;</span><span class=p>,</span> <span class=nx>body</span><span class=o>:</span> <span class=s1>&#39;Hello world&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>);</span></span></span></code></pre></div><p>This does <em>not</em> work, because <code>log</code> is defined outside the callback function
(the callback must be serializable to a string):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// WARNING: THIS DOES NOT WORK!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s1>&#39;use strict&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queues</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@arangodb/foxx/queues&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queue</span> <span class=o>=</span> <span class=nx>queues</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;my-queue&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>log</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;console&#39;</span><span class=p>).</span><span class=nx>log</span><span class=p>;</span> <span class=c1>// outside the callback&#39;s function scope
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>queue</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>mount</span><span class=o>:</span> <span class=s1>&#39;/mailer&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;send-mail&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>to</span><span class=o>:</span> <span class=s1>&#39;hello@example.com&#39;</span><span class=p>,</span> <span class=nx>body</span><span class=o>:</span> <span class=s1>&#39;Hello world&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>success</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Yay!&#39;</span><span class=p>);</span> <span class=c1>// throws &#39;log is not defined&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}}</span>
</span></span><span class=line><span class=cl><span class=p>);</span></span></span></code></pre></div><p>Here&rsquo;s an example of a job that is executed every 5 seconds until tomorrow:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=s1>&#39;use strict&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queues</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@arangodb/foxx&#39;</span><span class=p>).</span><span class=nx>queues</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>queue</span> <span class=o>=</span> <span class=nx>queues</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s1>&#39;my-queue&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>queue</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>mount</span><span class=o>:</span> <span class=s1>&#39;/mailer&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;send-mail&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>to</span><span class=o>:</span> <span class=s1>&#39;hello@example.com&#39;</span><span class=p>,</span> <span class=nx>body</span><span class=o>:</span> <span class=s1>&#39;Hello world&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>repeatTimes</span><span class=o>:</span> <span class=kc>Infinity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>repeatUntil</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>+</span> <span class=p>(</span><span class=mi>24</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>repeatDelay</span><span class=o>:</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>);</span></span></span></code></pre></div><h3 id=queueget>queue.get <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queueget class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queue.get(jobId): Job</code></p><p>Creates a proxy object representing a job with the given job id.</p><p>The job is looked up in the specified queue in the current database.</p><p>Returns the job for the given jobId. Properties of the job object are
fetched whenever they are referenced and cannot be modified.</p><p><strong>Arguments</strong></p><ul><li><p><strong>jobId</strong>: <code>string</code></p><p>The id of the job to create a proxy object for.</p></li></ul><p><strong>Examples</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>jobId</span> <span class=o>=</span> <span class=nx>queue</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span><span class=nx>mount</span><span class=o>:</span> <span class=s1>&#39;/logger&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;log&#39;</span><span class=p>},</span> <span class=s1>&#39;Hello World!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>job</span> <span class=o>=</span> <span class=nx>queue</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>jobId</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>assertEqual</span><span class=p>(</span><span class=nx>job</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>jobId</span><span class=p>);</span></span></span></code></pre></div><h3 id=queuedelete>queue.delete <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queuedelete class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queue.delete(jobId): boolean</code></p><p>Deletes a job with the given job id.
The job is looked up and deleted in the specified queue in the current database.</p><p><strong>Arguments</strong></p><ul><li><p><strong>jobId</strong>: <code>string</code></p><p>The id of the job to delete.</p></li></ul><p>Returns <code>true</code> if the job was deleted successfully. If the job did not exist
it returns <code>false</code> instead.</p><h3 id=queuepending>queue.pending <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queuepending class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queue.pending([script]): Array&lt;string></code></p><p>Returns an array of job ids of jobs in the given queue with the status
<code>"pending"</code>, optionally filtered by the given job type.
The jobs will be looked up in the specified queue in the current database.</p><p><strong>Arguments</strong></p><ul><li><p><strong>script</strong>: <code>object</code> (optional)</p><p>An object with the following properties:</p></li><li><p><strong>name</strong>: <code>string</code></p></li></ul><p>Name of the script.</p><ul><li><strong>mount</strong>: <code>string</code></li></ul><p>Mount path of the service defining the script.</p><p><strong>Examples</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>logScript</span> <span class=o>=</span> <span class=p>{</span><span class=nx>mount</span><span class=o>:</span> <span class=s1>&#39;/logger&#39;</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;log&#39;</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nx>queue</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>logScript</span><span class=p>,</span> <span class=s1>&#39;Hello World!&#39;</span><span class=p>,</span> <span class=p>{</span><span class=nx>delayUntil</span><span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>+</span> <span class=mi>50</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>assertEqual</span><span class=p>(</span><span class=nx>queue</span><span class=p>.</span><span class=nx>pending</span><span class=p>(</span><span class=nx>logScript</span><span class=p>).</span><span class=nx>length</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 50 ms later...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>assertEqual</span><span class=p>(</span><span class=nx>queue</span><span class=p>.</span><span class=nx>pending</span><span class=p>(</span><span class=nx>logScript</span><span class=p>).</span><span class=nx>length</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>assertEqual</span><span class=p>(</span><span class=nx>queue</span><span class=p>.</span><span class=nx>progress</span><span class=p>(</span><span class=nx>logScript</span><span class=p>).</span><span class=nx>length</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// even later...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>assertEqual</span><span class=p>(</span><span class=nx>queue</span><span class=p>.</span><span class=nx>progress</span><span class=p>(</span><span class=nx>logScript</span><span class=p>).</span><span class=nx>length</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>assertEqual</span><span class=p>(</span><span class=nx>queue</span><span class=p>.</span><span class=nx>complete</span><span class=p>(</span><span class=nx>logScript</span><span class=p>).</span><span class=nx>length</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span></span></span></code></pre></div><h3 id=queueprogress>queue.progress <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queueprogress class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queue.progress([script])</code></p><p>Returns an array of job ids of jobs in the given queue with the status
<code>"progress"</code>, optionally filtered by the given job type.
The jobs are looked up in the specified queue in the current database.</p><p><strong>Arguments</strong></p><ul><li><p><strong>script</strong>: <code>object</code> (optional)</p><p>An object with the following properties:</p></li><li><p><strong>name</strong>: <code>string</code></p></li></ul><p>Name of the script.</p><ul><li><strong>mount</strong>: <code>string</code></li></ul><p>Mount path of the service defining the script.</p><h3 id=queuecomplete>queue.complete <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queuecomplete class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queue.complete([script]): Array&lt;string></code></p><p>Returns an array of job ids of jobs in the given queue with the status
<code>"complete"</code>, optionally filtered by the given job type.
The jobs are looked up in the specified queue in the current database.</p><p><strong>Arguments</strong></p><ul><li><p><strong>script</strong>: <code>object</code> (optional)</p><p>An object with the following properties:</p></li><li><p><strong>name</strong>: <code>string</code></p></li></ul><p>Name of the script.</p><ul><li><strong>mount</strong>: <code>string</code></li></ul><p>Mount path of the service defining the script.</p><h3 id=queuefailed>queue.failed <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queuefailed class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queue.failed([script]): Array&lt;string></code></p><p>Returns an array of job ids of jobs in the given queue with the status
<code>"failed"</code>, optionally filtered by the given job type.
The jobs are looked up in the specified queue in the current database.</p><p><strong>Arguments</strong></p><ul><li><p><strong>script</strong>: <code>object</code> (optional)</p><p>An object with the following properties:</p></li><li><p><strong>name</strong>: <code>string</code></p></li></ul><p>Name of the script.</p><ul><li><strong>mount</strong>: <code>string</code></li></ul><p>Mount path of the service defining the script.</p><h3 id=queueall>queue.all <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#queueall class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>queue.all([script]): Array&lt;string></code></p><p>Returns an array of job ids of all jobs in the given queue,
optionally filtered by the given job type.
The jobs are looked up in the specified queue in the current database.</p><p><strong>Arguments</strong></p><ul><li><p><strong>script</strong>: <code>object</code> (optional)</p><p>An object with the following properties:</p></li><li><p><strong>name</strong>: <code>string</code></p></li></ul><p>Name of the script.</p><ul><li><strong>mount</strong>: <code>string</code></li></ul><p>Mount path of the service defining the script.</p><h2 id=job-api>Job API <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#job-api class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=jobabort>job.abort <a href=/3.10/develop/foxx-microservices/reference/related-modules/queues/#jobabort class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>job.abort(): void</code></p><p>Aborts a non-completed job.</p><p>Sets a job&rsquo;s status to <code>"failed"</code> if it is not already <code>"complete"</code>,
without calling the job&rsquo;s <code>onFailure</code> callback.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.10/develop/foxx-microservices/reference/related-modules/graphql/><i class="fas fa-chevron-left fa-fw"></i><p>GraphQL</p></a></span><span class=next></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.10/develop/foxx-microservices/reference/related-modules/queues.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#managing-queues>Managing queues</a></div><div class=level-3><a href=#queuescreate>queues.create</a></div><div class=level-3><a href=#queuesget>queues.get</a></div><div class=level-3><a href=#queuesdelete>queues.delete</a></div><div class=level-2><a href=#queue-api>Queue API</a></div><div class=level-3><a href=#queuepush>queue.push</a></div><div class=level-3><a href=#queueget>queue.get</a></div><div class=level-3><a href=#queuedelete>queue.delete</a></div><div class=level-3><a href=#queuepending>queue.pending</a></div><div class=level-3><a href=#queueprogress>queue.progress</a></div><div class=level-3><a href=#queuecomplete>queue.complete</a></div><div class=level-3><a href=#queuefailed>queue.failed</a></div><div class=level-3><a href=#queueall>queue.all</a></div><div class=level-2><a href=#job-api>Job API</a></div><div class=level-3><a href=#jobabort>job.abort</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>