<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1747031427></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="The server binaries need to be upgraded, requiring a restart of the arangod processes and optionally using the supervision maintenance mode"><meta property="og:url" content="http://localhost/3.10/operations/upgrading/manual-deployments/active-failover/"><meta property="og:title" content="Manually Upgrading an Active Failover Deployment"><meta property="og:type" content="website"><meta property="og:description" content="The server binaries need to be upgraded, requiring a restart of the arangod processes and optionally using the supervision maintenance mode"><meta name=docsearch:version content="3.10"><title>Manually Upgrading an Active Failover Deployment | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1747031427 defer></script>
<script src=/js/featherlight.min.js?1747031427 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1747031427 defer></script>
<script src=/js/theme.js?1747031427 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.10"><a itemprop=item class=link href=/3.10/><span itemprop=name class=breadcrumb-entry>3.10.14</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Operations"><a itemprop=item class=link href=/3.10/operations/><span itemprop=name class=breadcrumb-entry>Operations</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Upgrading"><a itemprop=item class=link href=/3.10/operations/upgrading/><span itemprop=name class=breadcrumb-entry>Upgrading</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Manual Deployments"><a itemprop=item class=link href=/3.10/operations/upgrading/manual-deployments/><span itemprop=name class=breadcrumb-entry>Manual Deployments</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Active Failover"><a itemprop=item class=link href=/3.10/operations/upgrading/manual-deployments/active-failover/><span itemprop=name class=breadcrumb-entry>Active Failover</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.10 reached End of Life (EOL) and is no longer supported.</p><p>This documentation is outdated. Please see the most recent <a href=/3.12/ class=link>stable version</a>.</p></div></div></div></div><hgroup><h1>Manually Upgrading an <em>Active Failover</em> Deployment</h1><p class=lead>The server binaries need to be upgraded, requiring a restart of the <code>arangod</code> processes and optionally using the supervision maintenance mode</p></hgroup><p>To manually upgrade an <a href=/3.10/deploy/active-failover/ class=link><em>Active Failover</em></a>
setup, the different nodes can be upgraded one at a time without incurring a
prolonged downtime of the entire system. The downtimes of the individual nodes
should also stay fairly low.</p><p>The manual upgrade procedure described in this section can be used to upgrade
to a new hotfix version, or to perform an upgrade to a new minor version of ArangoDB.
Please refer to the <a href=/3.10/operations/upgrading/#upgrade-paths class=link>Upgrade paths</a> section
for detailed information.</p><h2 id=preparations>Preparations <a href=/3.10/operations/upgrading/manual-deployments/active-failover/#preparations class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The ArangoDB installation packages (e.g. for Debian or Ubuntu) set up a
convenient standalone instance of <code>arangod</code>. During installation, this instance&rsquo;s
database will be upgraded (see <a href=/3.10/components/arangodb-server/options/#--databaseauto-upgrade class=link><code>--database.auto-upgrade</code></a>)
and the service will be (re)started.</p><p>You have to make sure that your <em>Active Failover</em> deployment is independent of this
standalone instance. Specifically, make sure that the database directory as
well as the socket used by the standalone instance provided by the package are
separate from the ones in your <em>Active Failover</em> configuration. Also, check that you haven&rsquo;t
modified the init script or systemd unit file for the standalone instance in a way
that it would start or stop your <em>Active Failover</em> instance instead.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>It is highly recommended to take a backup of your data before upgrading ArangoDB
using <a href=/3.10/components/tools/arangodump/ class=link><em>arangodump</em></a>.</div></div></div></div><h3 id=install-the-new-arangodb-version-binary>Install the new ArangoDB version binary <a href=/3.10/operations/upgrading/manual-deployments/active-failover/#install-the-new-arangodb-version-binary class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The first step is to install the new ArangoDB package.</p><p><strong>Note:</strong> you do not have to stop the <em>Active Failover</em> (<em>arangod</em>) processes before upgrading it.</p><p>For example, if you want to upgrade to <code>3.7.13</code> on Debian or Ubuntu, either call</p><pre tabindex=0><code>$ apt install arangodb=3.7.13-1
</code></pre><p>(<code>apt-get</code> on older versions) if you have added the ArangoDB repository. Or
install a specific package using</p><pre tabindex=0><code>$ dpkg -i arangodb3-3.7.13-1_amd64.deb
</code></pre><p>after you have downloaded the corresponding file from
<a href=https://download.arangodb.com/ target=_blank rel="noopener noreferrer" class=link>download.arangodb.com</a>&nbsp;<i class="fas fa-external-link-alt"></i>.</p><h4 id=stop-the-standalone-instance>Stop the Standalone Instance <a href=/3.10/operations/upgrading/manual-deployments/active-failover/#stop-the-standalone-instance class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>As the package will automatically start the standalone instance, you might want to
stop that instance now, as otherwise it can create some confusion later. As you are
starting the <em>Active Failover</em> processes manually
you will not need the automatically installed and started standalone instance,
and you should hence stop it via:</p><pre tabindex=0><code>$ service arangodb3 stop
</code></pre><p>Also, you might want to remove the standalone instance from the default
<em>runlevels</em> to prevent it from starting on the next reboots of your machine. How this
is done depends on your distribution and <em>init</em> system. For example, on older Debian
and Ubuntu systems using a SystemV-compatible <em>init</em>, you can use:</p><pre tabindex=0><code>$ update-rc.d -f arangodb3 remove
</code></pre><h2 id=set-supervision-into-maintenance-mode>Set supervision into maintenance mode <a href=/3.10/operations/upgrading/manual-deployments/active-failover/#set-supervision-into-maintenance-mode class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>You have two main choices when performing an upgrade of the <em>Active Failover</em> setup:</p><ul><li>Upgrade while incurring a leader-to-follower switch (with reduced downtime)</li><li>An upgrade with no leader-to-follower switch.</li></ul><p>Turning the maintenance mode <em>on</em> will enable the latter case. You might have a short
downtime during the <em>leader</em> upgrade, but there will be no potential loss of <em>acknowledged</em> operations.</p><p>To enable the maintenance mode means to essentially disable the Agency supervision for a limited amount
of time during the upgrade procedure. The following API calls will
activate and deactivate the maintenance mode of the supervision job. You might use <em>curl</em> to send the API calls.
The following examples assume there is an <em>Active Failover</em> node running on <code>localhost</code> on port 7002.</p><h3 id=activate-maintenance-mode>Activate Maintenance mode <a href=/3.10/operations/upgrading/manual-deployments/active-failover/#activate-maintenance-mode class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>curl -u username:password &lt;single-server>/_admin/cluster/maintenance -XPUT -d'"on"'</code></p><p>For example:</p><pre tabindex=0><code>curl -u &#34;root:&#34; http://localhost:7002/_admin/cluster/maintenance -XPUT -d&#39;&#34;on&#34;&#39;

{&#34;error&#34;:false,&#34;warning&#34;:&#34;Cluster supervision deactivated. 
It will be reactivated automatically in 60 minutes unless this call is repeated until then.&#34;}
</code></pre><p><strong>Note:</strong> In case the manual upgrade takes longer than 60 minutes, the API call has to be resent.</p><h3 id=deactivate-maintenance-mode>Deactivate Maintenance mode <a href=/3.10/operations/upgrading/manual-deployments/active-failover/#deactivate-maintenance-mode class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <em>cluster</em> supervision resumes automatically 60 minutes after disabling it.
It can be manually reactivated earlier at any point using the following API call:</p><p><code>curl -u username:password &lt;single-server>/_admin/cluster/maintenance -XPUT -d'"off"'</code></p><p>For example:</p><pre tabindex=0><code>curl -u &#34;root:&#34; http://localhost:7002/_admin/cluster/maintenance -XPUT -d&#39;&#34;off&#34;&#39;

{&#34;error&#34;:false,&#34;warning&#34;:&#34;Cluster supervision reactivated.&#34;}
</code></pre><h2 id=upgrade-the-active-failover-processes>Upgrade the <em>Active Failover</em> processes <a href=/3.10/operations/upgrading/manual-deployments/active-failover/#upgrade-the-active-failover-processes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Now all the <em>Active Failover</em> (<em>Agents</em>, <em>Single-Server</em>) processes (<em>arangod</em>) have to be
upgraded on each node.</p><p><strong>Note:</strong> Please read the section regarding the maintenance mode above.</p><p>In order to stop an <em>arangod</em> process we will need to use a command like <code>kill -15</code>:</p><pre tabindex=0><code>kill -15 &lt;pid-of-arangod-process&gt;
</code></pre><p>The <em>pid</em> associated to your <em>Active Failover setup</em> can be checked using a command like <em>ps</em>:</p><pre tabindex=0><code>ps -C arangod -fww
</code></pre><p>The output of the command above does not only show the process ids of all <em>arangod</em>
processes but also the used commands, which is useful for the following
restarts of all <em>arangod</em> processes.</p><p>The output below is from a test machine where three <em>Agents</em> and two <em>Single-Servers</em>
were running locally. In a more production-like scenario, you will find only one instance of each
type running per machine:</p><pre tabindex=0><code>ps -C arangod -fww
UID        PID  PPID  C STIME TTY          TIME CMD
max      29075  8072  0 13:50 pts/2    00:00:42 arangod --server.endpoint tcp://0.0.0.0:5001 --agency.my-address=tcp://127.0.0.1:5001 --server.authentication false --agency.activate true --agency.size 3 --agency.endpoint tcp://127.0.0.1:5001 --agency.supervision true --log.file a1 --javascript.app-path /tmp --database.directory agent1
max      29208  8072  2 13:51 pts/2    00:02:08 arangod --server.endpoint tcp://0.0.0.0:5002 --agency.my-address=tcp://127.0.0.1:5002 --server.authentication false --agency.activate true --agency.size 3 --agency.endpoint tcp://127.0.0.1:5001 --agency.supervision true --log.file a2 --javascript.app-path /tmp --database.directory agent2
max      29329 16224  0 13:51 pts/3    00:00:42 arangod --server.endpoint tcp://0.0.0.0:5003 --agency.my-address=tcp://127.0.0.1:5003 --server.authentication false --agency.activate true --agency.size 3 --agency.endpoint tcp://127.0.0.1:5001 --agency.supervision true --log.file a3 --javascript.app-path /tmp --database.directory agent3
max      29824 16224  1 13:55 pts/3    00:01:53 arangod --server.authentication=false --server.endpoint tcp://0.0.0.0:7001 --cluster.my-address tcp://127.0.0.1:7001 --cluster.my-role SINGLE --cluster.agency-endpoint tcp://127.0.0.1:5001 --cluster.agency-endpoint tcp://127.0.0.1:5002 --cluster.agency-endpoint tcp://127.0.0.1:5003 --log.file c1 --javascript.app-path /tmp --database.directory single1
max      29938 16224  2 13:56 pts/3    00:02:13 arangod --server.authentication=false --server.endpoint tcp://0.0.0.0:7002 --cluster.my-address tcp://127.0.0.1:7002 --cluster.my-role SINGLE --cluster.agency-endpoint tcp://127.0.0.1:5001 --cluster.agency-endpoint tcp://127.0.0.1:5002 --cluster.agency-endpoint tcp://127.0.0.1:5003 --log.file c2 --javascript.app-path /tmp --database.directory single2
</code></pre><p><strong>Note:</strong> The start commands of <em>Agent</em> and <em>Single Server</em> are required for restarting the processes later.</p><p>The recommended procedure for upgrading an <em>Active Failover</em> setup is to stop, upgrade
and restart the <em>arangod</em> instances one by one on all participating servers,
starting first with all <em>Agent</em> instances, and then following with the <em>Active Failover</em>
instances themselves. When upgrading the <em>Active Failover</em> instances, the followers should
be upgraded first.</p><p>To figure out the node containing the followers you can consult the cluster endpoints API:</p><pre tabindex=0><code>curl http://&lt;single-server&gt;:7002/_api/cluster/endpoints
</code></pre><p>This will yield a list of endpoints, the <em>first</em> of which is always the leader node.</p><h3 id=stopping-upgrading-and-restarting-an-instance>Stopping, upgrading and restarting an instance <a href=/3.10/operations/upgrading/manual-deployments/active-failover/#stopping-upgrading-and-restarting-an-instance class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>To stop an instance, the currently running process has to be identified using the <code>ps</code>
command above.</p><p>Let&rsquo;s assume we are about to upgrade an <em>Agent</em> instance, so we have to look in the <code>ps</code>
output for an Agent instance first, and note its process id (pid) and start command.</p><p>The process can then be stopped using the following command:</p><pre tabindex=0><code>kill -15 &lt;pid-of-agent&gt;
</code></pre><p>The instance then has to be upgraded using the same command that was used before (in the <code>ps</code> output),
but with the additional option:</p><pre tabindex=0><code>--database.auto-upgrade=true
</code></pre><p>After the upgrade procedure has finishing successfully, the instance will remain stopped.
So it has to be restarted using the command from the <code>ps</code> output before
(this time without the <code>--database.auto-upgrade</code> option).</p><p>Once an <em>Agent</em> was upgraded and restarted successfully, repeat the procedure for the
other <em>Agent</em> instances in the setup and then repeat the procedure for the <em>Active Failover</em>
instances, there starting with the followers.</p><h3 id=final-words>Final words <a href=/3.10/operations/upgrading/manual-deployments/active-failover/#final-words class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <em>Agency</em> supervision then needs to be reactivated by issuing the following API call
to the leader:</p><p><code>curl -u username:password &lt;single-server>/_admin/cluster/maintenance -XPUT -d'"off"'</code></p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.10/operations/upgrading/manual-deployments/><i class="fas fa-chevron-left fa-fw"></i><p>Manual Deployments</p></a></span><span class=next><a class="nav nav-next link" href=/3.10/operations/upgrading/manual-deployments/cluster/><p>Cluster</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.10/operations/upgrading/manual-deployments/active-failover.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#preparations>Preparations</a></div><div class=level-3><a href=#install-the-new-arangodb-version-binary>Install the new ArangoDB version binary</a></div><div class=level-4><a href=#stop-the-standalone-instance>Stop the Standalone Instance</a></div><div class=level-2><a href=#set-supervision-into-maintenance-mode>Set supervision into maintenance mode</a></div><div class=level-3><a href=#activate-maintenance-mode>Activate Maintenance mode</a></div><div class=level-3><a href=#deactivate-maintenance-mode>Deactivate Maintenance mode</a></div><div class=level-2><a href=#upgrade-the-active-failover-processes>Upgrade the <em>Active Failover</em> processes</a></div><div class=level-3><a href=#stopping-upgrading-and-restarting-an-instance>Stopping, upgrading and restarting an instance</a></div><div class=level-3><a href=#final-words>Final words</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>