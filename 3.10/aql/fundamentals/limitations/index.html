<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743775370></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="AQL has restrictions with regards to the complexity of queries and the data they operate on, as well as design limitations to be aware of"><meta property="og:url" content="http://localhost/3.10/aql/fundamentals/limitations/"><meta property="og:title" content="Known limitations for AQL queries"><meta property="og:type" content="website"><meta property="og:description" content="AQL has restrictions with regards to the complexity of queries and the data they operate on, as well as design limitations to be aware of"><meta name=docsearch:version content="3.10"><title>Known limitations for AQL queries | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743775370 defer></script>
<script src=/js/featherlight.min.js?1743775370 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743775370 defer></script>
<script src=/js/theme.js?1743775370 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.10"><a itemprop=item class=link href=/3.10/><span itemprop=name class=breadcrumb-entry>3.10.14</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="AQL"><a itemprop=item class=link href=/3.10/aql/><span itemprop=name class=breadcrumb-entry>AQL</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Fundamentals"><a itemprop=item class=link href=/3.10/aql/fundamentals/><span itemprop=name class=breadcrumb-entry>Fundamentals</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Limitations"><a itemprop=item class=link href=/3.10/aql/fundamentals/limitations/><span itemprop=name class=breadcrumb-entry>Limitations</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.10 reached End of Life (EOL) and is no longer supported.</p><p>This documentation is outdated. Please see the most recent <a href=/3.12/aql/fundamentals/limitations/ class=link>stable version</a>.</p></div></div></div></div><hgroup><h1>Known limitations for AQL queries</h1><p class=lead>AQL has restrictions with regards to the complexity of queries and the data they operate on, as well as design limitations to be aware of</p></hgroup><h2 id=complexity-limitations>Complexity limitations <a href=/3.10/aql/fundamentals/limitations/#complexity-limitations class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The following hard-coded limitations exist for AQL queries:</p><ul><li>An AQL query cannot use more than <em>1000</em> result registers.
One result register is needed for every named query variable and for
internal/anonymous query variables, e.g. for intermediate results.
Subqueries also require result registers.</li><li>An AQL query cannot have more than <em>4000</em> execution nodes in its initial
query execution plan. This number includes all execution nodes of the
initial execution plan, even if some of them could be
optimized away later by the query optimizer during plan optimization.</li><li>An AQL query cannot use more than <em>2048</em> collections/shards.<div class="box notices cstyle tip"><div class=box-content-container><div class=box-content><i class="fas fa-check"></i><div class=box-text>From version 3.10.7 onward, this limit is configurable via the
<code>--query.max-collections-per-query</code> startup option.</div></div></div></div></li><li>Expressions in AQL queries cannot have a nesting of more than <em>500</em> levels.
As an example, the expression <code>1 + 2 + 3 + 4</code> is 3 levels deep
(because it is interpreted and executed as <code>1 + (2 + (3 + 4))</code>).</li><li>When reading any data from JSON or VelocyPack input or when serializing
any data to JSON or VelocyPack, there is a maximum recursion depth for
nested arrays and objects, which is slightly below 200. Arrays or objects
with higher nesting than this cause <code>Too deep nesting in Array/Object</code>
exceptions.</li></ul><p>Please note that even queries that are still below these limits may not
yield good performance, especially when they have to put together data from lots
of different collections. Please also consider that large queries (in terms of
intermediate result size or final result size) can use considerable amounts of
memory and may hit the configurable memory limits for AQL queries.</p><h2 id=design-limitations>Design limitations <a href=/3.10/aql/fundamentals/limitations/#design-limitations class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The following design limitations are known for AQL queries:</p><ul><li>Subqueries that are used inside expressions are pulled out of these
expressions and executed beforehand. That means that subqueries do not
participate in lazy evaluation of operands, for example in the
<a href=/3.10/aql/operators/#ternary-operator class=link>ternary operator</a>. Also see
<a href=/3.10/aql/fundamentals/subqueries/#evaluation-of-subqueries class=link>evaluation of subqueries</a>.</li><li>It is not possible to use a collection in a read operation after
it was used for a write operation in the same AQL query.</li><li>In the cluster, all collections that are accessed <strong>dynamically</strong> by
<a href=/3.10/aql/graphs/traversals/#working-with-collection-sets class=link>traversals working with collection sets</a>
(instead of named graphs) must be stated in the query&rsquo;s initial
<a href=/3.10/aql/high-level-operations/with/ class=link><code>WITH</code> statement</a>. To make the <code>WITH</code> statement
required in single server as well (e.g. for testing a migration to cluster),
please start the server with the option <code>--query.require-with</code>.</li></ul><h2 id=storage-engine-properties>Storage engine properties <a href=/3.10/aql/fundamentals/limitations/#storage-engine-properties class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>The following restrictions and limitations do not apply to JavaScript Transactions
and Stream Transactions, including AQL queries that run inside such transactions.
Their intended use case is for smaller transactions with full transactional
guarantees. So the following only applies to standalone AQL queries.</div></div></div></div><p>Data of ongoing transactions is stored in RAM. Transactions that get too big
(in terms of number of operations involved or the total size of data created or
modified by the transaction) are committed automatically. Effectively, this
means that big user transactions are split into multiple smaller RocksDB
transactions that are committed individually. The entire user transaction does
not necessarily have ACID properties in this case.</p><p>The following startup options can be used to control the RAM usage and automatic
intermediate commits for the RocksDB engine:</p><ul><li><p><code>--rocksdb.max-transaction-size</code></p><p>Transaction size limit (in bytes). Transactions store all keys and values in
RAM, so large transactions run the risk of causing out-of-memory situations.
This setting allows you to ensure that does not happen by limiting the size of
any individual transaction. Transactions whose operations would consume more
RAM than this threshold value will abort automatically with error 32 (&ldquo;resource
limit exceeded&rdquo;).</p></li><li><p><code>--rocksdb.intermediate-commit-size</code></p><p>If the size of all operations in a transaction reaches this threshold, the transaction
is committed automatically and a new transaction is started. The value is specified in bytes.</p></li><li><p><code>--rocksdb.intermediate-commit-count</code></p><p>If the number of operations in a transaction reaches this value, the transaction is
committed automatically and a new transaction is started.</p></li></ul><p>The above values can also be adjusted per query, for example, by setting the
following attributes in the call to <code>db._query()</code> in the JavaScript API:</p><ul><li><code>maxTransactionSize</code>: transaction size limit in bytes</li><li><code>intermediateCommitSize</code>: maximum total size of operations after which an intermediate
commit is performed automatically</li><li><code>intermediateCommitCount</code>: maximum number of operations after which an intermediate
commit is performed automatically</li></ul><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.10/aql/fundamentals/query-errors/><i class="fas fa-chevron-left fa-fw"></i><p>Query Errors</p></a></span><span class=next><a class="nav nav-next link" href=/3.10/aql/operators/><p>Operators</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.10/aql/fundamentals/limitations.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#complexity-limitations>Complexity limitations</a></div><div class=level-2><a href=#design-limitations>Design limitations</a></div><div class=level-2><a href=#storage-engine-properties>Storage engine properties</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>