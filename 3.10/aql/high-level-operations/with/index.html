<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743775370></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="An AQL query can start with a WITH operation, listing collections that a query implicitly reads from"><meta property="og:url" content="http://localhost/3.10/aql/high-level-operations/with/"><meta property="og:title" content="WITH operation in AQL"><meta property="og:type" content="website"><meta property="og:description" content="An AQL query can start with a WITH operation, listing collections that a query implicitly reads from"><meta name=docsearch:version content="3.10"><title>WITH operation in AQL | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743775370 defer></script>
<script src=/js/featherlight.min.js?1743775370 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743775370 defer></script>
<script src=/js/theme.js?1743775370 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.10"><a itemprop=item class=link href=/3.10/><span itemprop=name class=breadcrumb-entry>3.10.14</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="AQL"><a itemprop=item class=link href=/3.10/aql/><span itemprop=name class=breadcrumb-entry>AQL</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="High-level Operations"><a itemprop=item class=link href=/3.10/aql/high-level-operations/><span itemprop=name class=breadcrumb-entry>High-level Operations</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="WITH"><a itemprop=item class=link href=/3.10/aql/high-level-operations/with/><span itemprop=name class=breadcrumb-entry>WITH</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.10 reached End of Life (EOL) and is no longer supported.</p><p>This documentation is outdated. Please see the most recent <a href=/3.12/aql/high-level-operations/with/ class=link>stable version</a>.</p></div></div></div></div><hgroup><h1><code>WITH</code> operation in AQL</h1><p class=lead>An AQL query can start with a <code>WITH</code> operation, listing collections that a query implicitly reads from</p></hgroup><p>Reading implicitly from a collections means that the collections are not
specified explicitly in language constructs like the following:</p><ul><li><code>FOR ... IN collection</code></li><li><code>INSERT ... INTO collection</code></li><li><code>UPDATE ... IN collection</code></li><li><code>GRAPH "graph-name"</code> (via the graph definition)</li></ul><p>Instead, the collections are only known at runtime of the query. Such dynamic
collection access is invisible to the AQL query parser at query compile time.
Dynamic access is possible via the <code>DOCUMENT()</code> function as well as with
graph traversals (in particular the variant using collection sets), because
edges may point to arbitrary vertex collections. Additionally, if you specify
the start vertex of a traversal using a string, its collection needs to be
declared as well.</p><p>Collections that are explicitly used in a query are automatically detected by
the AQL query parser. Any additional collections that will be involved in the
query but cannot be detected automatically by the query parser can be manually
specified using a <code>WITH</code> statement. It is recommended to declare all collections
that the <code>DOCUMENT()</code> function or graph traversals using collection sets might
possibly access to avoid occasional query failures.</p><h2 id=syntax>Syntax <a href=/3.10/aql/high-level-operations/with/#syntax class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><pre><code>WITH <em>collection1</em> [, <em>collection2</em> [, ... <em>collectionN</em> ] ]</code></pre><p><code>WITH</code> is also a keyword that is used in other contexts, for example in <code>UPDATE</code>
statements. To declare additional collections, you must place the <code>WITH</code> keyword
at the very start of the query.</p><h2 id=usage>Usage <a href=/3.10/aql/high-level-operations/with/#usage class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The <code>WITH</code> operation is only required if you use a cluster deployment and only
for AQL queries that dynamically read from vertex collections as part of
graph traversals.</p><p>You can enable the <code>--query.require-with</code> startup option to make single server
instances require <code>WITH</code> declarations like cluster deployments to ease development,
see <a href=/3.10/components/arangodb-server/options/#--queryrequire-with class=link>Requiring <code>WITH</code> statements</a>.</p><p>Dynamic access via the <code>DOCUMENT()</code> function does not require you to list the
involved collections. Using named graphs in traversals (<code>GRAPH "graph-name"</code>)
does not require it either, assuming that all vertices are in collections that
are part of the graph, as enforced by the <a href=/3.10/develop/http-api/graphs/named-graphs/ class=link>Graph API</a>.
That means, it is only necessary for traversals using anonymous graphs /
<a href=/3.10/aql/graphs/traversals/#working-with-collection-sets class=link>collection sets</a>.</p><p>The following example query specifies an edge collection <code>usersHaveManagers</code>
to perform a graph traversal. It is the only explicitly specified collection in
the query. It does not need to be declared using the <code>WITH</code> operation.</p><p>However, the involved vertex collections need to be declared. In this example,
the start vertex is specified as a string and it is stored in the <code>users</code>
collections. Furthermore, the edges of the edge collection reference vertices of
a collection called <code>managers</code>. Both collections are declared at the beginning
of the query using the <code>WITH</code> operation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>WITH</span> <span class=n>users</span><span class=p>,</span> <span class=n>managers</span>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>v</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>p</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>2</span> <span class=kr>OUTBOUND</span> <span class=s1>&#39;users/1&#39;</span> <span class=n>usersHaveManagers</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>v</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>p</span> <span class=p>}</span></span></span></code></pre></div><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.10/aql/high-level-operations/upsert/><i class="fas fa-chevron-left fa-fw"></i><p>UPSERT</p></a></span><span class=next><a class="nav nav-next link" href=/3.10/aql/functions/><p>Functions</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.10/aql/high-level-operations/with.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#syntax>Syntax</a></div><div class=level-2><a href=#usage>Usage</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>