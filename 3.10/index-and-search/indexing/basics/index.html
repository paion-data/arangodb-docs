<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1747031427></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="Indexes allow fast access to documents by maintaining special data structures to accelerate queries that use indexed attributes"><meta property="og:url" content="http://localhost/3.10/index-and-search/indexing/basics/"><meta property="og:title" content="Index basics"><meta property="og:type" content="website"><meta property="og:description" content="Indexes allow fast access to documents by maintaining special data structures to accelerate queries that use indexed attributes"><meta name=docsearch:version content="3.10"><title>Index basics | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1747031427 defer></script>
<script src=/js/featherlight.min.js?1747031427 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1747031427 defer></script>
<script src=/js/theme.js?1747031427 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.10"><a itemprop=item class=link href=/3.10/><span itemprop=name class=breadcrumb-entry>3.10.14</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Index and Search"><a itemprop=item class=link href=/3.10/index-and-search/><span itemprop=name class=breadcrumb-entry>Index and Search</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Indexing"><a itemprop=item class=link href=/3.10/index-and-search/indexing/><span itemprop=name class=breadcrumb-entry>Indexing</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Index Basics"><a itemprop=item class=link href=/3.10/index-and-search/indexing/basics/><span itemprop=name class=breadcrumb-entry>Index Basics</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.10 reached End of Life (EOL) and is no longer supported.</p><p>This documentation is outdated. Please see the most recent <a href=/3.12/index-and-search/indexing/basics/ class=link>stable version</a>.</p></div></div></div></div><hgroup><h1>Index basics</h1><p class=lead>Indexes allow fast access to documents by maintaining special data structures to accelerate queries that use indexed attributes</p></hgroup><p>ArangoDB automatically indexes some system attributes but you are free to create
additional indexes on other attributes of documents. You generally need to strike
a balance between creating indexes for often-used attributes to improve the
performance of read queries and the cost that indexes incur during writes to
maintain them.</p><p>User-defined indexes can be created on collection level. Most user-defined indexes
can be created by specifying the names of the index attributes.
Some index types allow indexing just one attribute (e.g. a <code>ttl</code> index) whereas
other index types allow indexing multiple attributes at the same time.</p><p>The system attributes <code>_id</code>, <code>_key</code>, <code>_from</code> and <code>_to</code> are automatically indexed
by ArangoDB, without the user being required to create extra indexes for them.
<code>_id</code> and <code>_key</code> are covered by a collection&rsquo;s primary key, and <code>_from</code> and <code>_to</code>
are covered by an edge collection&rsquo;s edge index automatically.</p><p>You cannot use the <code>_id</code> system attribute, nor sub-attributes with this name, in
user-defined indexes (except the inverted index type). This applies to the
<code>fields</code> the index is defined over, as well as additional attributes you can
store in a persistent index using <code>storedValues</code>. However, indexing and storing
the <code>_key</code>, <code>_rev</code>, <code>_from</code>, and <code>_to</code> system attributes is possible.</p><p>You cannot index fields that contain <code>.</code> in their attribute names because dots
are interpreted as paths of nested attributes. For example, <code>fields: ["foo.bar"]</code>
indexes the value of the nested attribute <code>bar</code> under the top-level attribute
<code>foo</code> (<code>{ "foo": { "bar": "value" } }</code>) and not a top-level attribute
<code>foo.bar</code> (<code>{ "foo.bar": "value" }</code>).</p><p>You can also not index fields whose names either start or end with <code>:</code>, for
example, <code>fields: ["foo:"]</code>. This notation is reserved for internal use.</p><p>Creating new indexes is by default done under an exclusive collection lock. The collection is not
available while the index is being created. This &ldquo;foreground&rdquo; index creation can be undesirable,
if you have to perform it on a live system without a dedicated maintenance window.</p><p>For potentially long running index creation operations, creating indexes in the
&ldquo;background&rdquo; is supported. The collection remains (mostly) available during the index creation,
see the section <a href=#creating-indexes-in-background class=link>Creating Indexes in Background</a> for more information.</p><h2 id=primary-index>Primary Index <a href=/3.10/index-and-search/indexing/basics/#primary-index class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>For each collection there will always be a <em>primary index</em> which is a persistent index
for the <a href=/3.10/concepts/data-structure/documents/#document-keys class=link>document keys</a> (<code>_key</code> attribute)
of all documents in the collection. The primary index allows quick selection
of documents in the collection using either the <code>_key</code> or <code>_id</code> attributes. It will
be used from within AQL queries automatically when performing equality lookups on
<code>_key</code> or <code>_id</code>.</p><p>There are also dedicated functions to find a document given its <code>_key</code> or <code>_id</code>
that will always make use of the primary index:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nb>document</span><span class=p>(</span><span class=s2>&#34;&lt;document-key&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_document</span><span class=p>(</span><span class=s2>&#34;&lt;document-id&gt;&#34;</span><span class=p>);</span></span></span></code></pre></div><p>The primary index can be used for range queries and sorting as persistent
indexes are sorted.</p><p>The primary index of a collection cannot be dropped or changed, and there is no
mechanism to create user-defined primary indexes.</p><h2 id=edge-index>Edge Index <a href=/3.10/index-and-search/indexing/basics/#edge-index class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Every <a href=/3.10/concepts/data-models/#graph-model class=link>edge collection</a> also has an
automatically created <em>edge index</em>. The edge index provides quick access to
documents by either their <code>_from</code> or <code>_to</code> attributes. It can therefore be
used to quickly find connections between vertex documents and is invoked when
the connecting edges of a vertex are queried.</p><p>Edge indexes are used from within AQL when performing equality lookups on <code>_from</code>
or <code>_to</code> values in an edge collections. There are also dedicated functions to
find edges given their <code>_from</code> or <code>_to</code> values that will always make use of the
edge index:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>edges</span><span class=p>(</span><span class=s2>&#34;&lt;from-value&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>edges</span><span class=p>(</span><span class=s2>&#34;&lt;to-value&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>outEdges</span><span class=p>(</span><span class=s2>&#34;&lt;from-value&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>outEdges</span><span class=p>(</span><span class=s2>&#34;&lt;to-value&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>inEdges</span><span class=p>(</span><span class=s2>&#34;&lt;from-value&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>inEdges</span><span class=p>(</span><span class=s2>&#34;&lt;to-value&gt;&#34;</span><span class=p>);</span></span></span></code></pre></div><p>The edge index stores the union of all <code>_from</code> and <code>_to</code> attributes.
It can be used for equality lookups, but not for range queries or for sorting.
Edge indexes are automatically created for edge collections.</p><p>It is not possible to create user-defined edge indexes.
However, it is possible to freely use the <code>_from</code> and <code>_to</code> attributes in
user-defined indexes.</p><p>An edge index cannot be dropped or changed.</p><h2 id=vertex-centric-indexes>Vertex-centric indexes <a href=/3.10/index-and-search/indexing/basics/#vertex-centric-indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>As mentioned above, the most important indexes for graphs are the edge
indexes, indexing the <code>_from</code> and <code>_to</code> attributes of edge collections.
They provide very quick access to all edges originating in or arriving
at a given vertex, which allows you to quickly find all neighbors of a vertex
in a graph.</p><p>In many cases one would like to run more specific queries, for example
finding amongst the edges originating from a given vertex only those
with a timestamp greater than or equal to some date and time. Exactly this
is achieved with &ldquo;vertex-centric indexes&rdquo;. In a sense these are localized
indexes for an edge collection, which sit at every single vertex.</p><p>Technically, they are implemented in ArangoDB as indexes, which sort the
complete edge collection first by <code>_from</code> and then by other attributes
for <em>OUTBOUND</em> traversals, or first by <code>_to</code> and then by other attributes
for <em>INBOUND</em> traversals. For traversals in <em>ANY</em> direction two indexes
are needed, one with <code>_from</code> and the other with <code>_to</code> as first indexed field.</p><p>If we for example have a persistent index on the attributes <code>_from</code> and
<code>timestamp</code> of an edge collection, we can answer the above question
very quickly with a single range lookup in the index.</p><p>You can create sorted persistent indexes that index the special edge attributes
<code>_from</code> or <code>_to</code> and additionally other attributes. These are used
in graph traversals, when appropriate <code>FILTER</code> statements are found
by the optimizer.</p><p>For example, to create a vertex-centric index of the above type, you
would simply do</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>edges</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span><span class=s2>&#34;type&#34;</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=s2>&#34;fields&#34;</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;_from&#34;</span><span class=p>,</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>]});</span></span></span></code></pre></div><p>in arangosh. Then, queries like</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>v</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>p</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>1</span> <span class=kr>OUTBOUND</span> <span class=s2>&#34;V/1&#34;</span> <span class=n>edges</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>e</span><span class=p>.</span><span class=n>timestamp</span> <span class=o>&gt;=</span> <span class=s2>&#34;2018-07-09&#34;</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>p</span></span></span></code></pre></div><p>will be considerably faster in case there are many edges originating
from vertex <code>"V/1"</code> but only few with a recent timestamp. Note that the
optimizer may prefer the default edge index over vertex-centric indexes
based on the costs it estimates, even if a vertex-centric index might
in fact be faster. Vertex-centric indexes are more likely to be chosen
for highly connected graphs.</p><h2 id=persistent-index>Persistent Index <a href=/3.10/index-and-search/indexing/basics/#persistent-index class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The persistent index is a sorted index with logarithmic complexity for insert,
update, and remove operations.</p><p>You can create a persistent index on one or multiple document attributes.
It is a sorted index structure. It can be used to quickly find
documents with specific attribute values (point lookups / equality comparisons),
for range queries, and for returning documents from the index in sorted order,
but only if either all index attributes is provided in a query, or if a leftmost
prefix of the index attributes is specified.</p><p>For example, if a persistent index is created on attributes <code>value1</code> and <code>value2</code>, the
following filter conditions can use the index (note: the <code>&lt;=</code> and <code>>=</code> operators are
intentionally omitted here for the sake of brevity):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>value1</span> <span class=o>==</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>value1</span> <span class=o>&lt;</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>value1</span> <span class=o>&gt;</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>value1</span> <span class=o>&gt;</span> <span class=o>..</span><span class=p>.</span> <span class=o>&amp;&amp;</span> <span class=n>doc</span><span class=p>.</span><span class=n>value1</span> <span class=o>&lt;</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>value1</span> <span class=o>==</span> <span class=o>..</span><span class=p>.</span> <span class=o>&amp;&amp;</span> <span class=n>doc</span><span class=p>.</span><span class=n>value2</span> <span class=o>==</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>value1</span> <span class=o>==</span> <span class=o>..</span><span class=p>.</span> <span class=o>&amp;&amp;</span> <span class=n>doc</span><span class=p>.</span><span class=n>value2</span> <span class=o>&gt;</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>value1</span> <span class=o>==</span> <span class=o>..</span><span class=p>.</span> <span class=o>&amp;&amp;</span> <span class=n>doc</span><span class=p>.</span><span class=n>value2</span> <span class=o>&gt;</span> <span class=o>..</span><span class=p>.</span> <span class=o>&amp;&amp;</span> <span class=n>doc</span><span class=p>.</span><span class=n>value2</span> <span class=o>&lt;</span> <span class=o>..</span><span class=p>.</span></span></span></code></pre></div><p>In order to use a persistent index for sorting, the index attributes must be specified in
the <code>SORT</code> clause of the query in the same order as they appear in the index definition.
Persistent indexes are always created in ascending order, but they can be used to access
the indexed elements in both ascending or descending order. However, for a combined index
(an index on multiple attributes) this requires that the sort orders in a single query
as specified in the <code>SORT</code> clause must be either all ascending (optionally omitted
as ascending is the default) or all descending.</p><p>For example, if a persistent index is created on attributes <code>value1</code> and <code>value2</code>
(in this order), then the following sorts clauses can use the index for sorting:</p><ul><li><code>SORT value1 ASC, value2 ASC</code> (and its equivalent <code>SORT value1, value2</code>)</li><li><code>SORT value1 DESC, value2 DESC</code></li><li><code>SORT value1 ASC</code> (and its equivalent <code>SORT value1</code>)</li><li><code>SORT value1 DESC</code></li></ul><p>The following sort clauses cannot make use of the index order, and require an extra
sort step:</p><ul><li><code>SORT value1 ASC, value2 DESC</code></li><li><code>SORT value1 DESC, value2 ASC</code></li><li><code>SORT value2</code> (and its equivalent <code>SORT value2 ASC</code>)</li><li><code>SORT value2 DESC</code> (because first indexed attribute <code>value1</code> is not used in sort clause)</li></ul><p>Note: the latter two sort clauses cannot use the index because the sort clause does not
refer to a leftmost prefix of the index attributes.</p><p>Persistent indexes support <a href=#indexing-array-values class=link>indexing array values</a> if
the index attribute name is extended with a <code>[*]</code>.</p><p>Persistent indexes can optionally be declared unique, disallowing saving the
same value in the indexed attribute. They can be sparse or non-sparse.</p><p>The different types of persistent indexes have the following characteristics:</p><ul><li><p><strong>unique persistent index</strong>: all documents in the collection must have different values for
the attributes covered by the unique index. Trying to insert a document with the same
key value as an already existing document will lead to a unique constraint
violation.</p><p>This type of index is not sparse. Documents that do not contain the index attributes or
that have a value of <code>null</code> in the index attribute(s) will still be indexed.
A key value of <code>null</code> may only occur once in the index, so this type of index cannot
be used for optional attributes.</p><p>The unique option can also be used to ensure that
<a href=#ensuring-uniqueness-of-relations-in-edge-collections class=link>no duplicate edges</a> are
created, by adding a combined index for the fields <code>_from</code> and <code>_to</code> to an edge collection.</p></li><li><p><strong>unique, sparse persistent index</strong>: all documents in the collection must have different
values for the attributes covered by the unique index. Documents in which at least one
of the index attributes is not set or has a value of <code>null</code> are not included in the
index. This type of index can be used to ensure that there are no duplicate keys in
the collection for documents that have the indexed attributes set. As the index will
exclude documents for which the indexed attributes are <code>null</code> or not set, it can be
used for optional attributes.</p></li><li><p><strong>non-unique persistent index</strong>: all documents in the collection will be indexed. This type
of index is not sparse. Documents that do not contain the index attributes or that have
a value of <code>null</code> in the index attribute(s) will still be indexed. Duplicate key values
can occur and do not lead to unique constraint violations.</p></li><li><p><strong>non-unique, sparse persistent index</strong>: only those documents will be indexed that have all
the indexed attributes set to a value other than <code>null</code>. It can be used for optional
attributes.</p></li></ul><h2 id=inverted-index>Inverted index <a href=/3.10/index-and-search/indexing/basics/#inverted-index class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Inverted indexes store mappings from values (of document attributes) to their
locations in collections. You can add an arbitrary number of document attributes
to an inverted index. For each attribute, you can specify an Analyzer to process
the input with. This enables you tokenize strings for full-text search,
for example. You can also index multiple levels of nested objects in arrays.</p><p>The index can optionally be sorted to optimize away <code>SORT</code> operations if the
sort direction of the fields match. You can also store additional attributes in
the index to cover projections.</p><p>Inverted indexes are eventually consistent. They are updated near real-time when
documents are changed, but you may get stale values until the index catches up
with the changes.</p><p>To accelerate queries with inverted indexes, you need to specify index hints in
these queries. Inverted indexes are not utilized automatically, unlike with
other index types, even if they would be capable of accelerating the queries.</p><h2 id=ttl-time-to-live-index>TTL (time-to-live) Index <a href=/3.10/index-and-search/indexing/basics/#ttl-time-to-live-index class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>You can use the TTL index type for automatically removing expired documents
from a collection.</p><p>A TTL index is set up by setting an <code>expireAfter</code> value and by picking a single
document attribute which contains the documents&rsquo; reference point in time. Documents
are expired after <code>expireAfter</code> seconds after their reference time has been reached.
The document&rsquo;s reference point in time is specified as either a numeric timestamp
(Unix timestamp) or a date string in the format <code>YYYY-MM-DDTHH:MM:SS</code>, optionally
with milliseconds after a decimal point in the format <code>YYYY-MM-DDTHH:MM:SS.MMM</code>
and an optional timezone offset. All date strings without a timezone offset are
interpreted as UTC dates.</p><p>For example, if <code>expireAfter</code> is set to 600 seconds (10 minutes) and the index
attribute is &ldquo;creationDate&rdquo; and there is the following document:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> <span class=nt>&#34;creationDate&#34;</span> <span class=p>:</span> <span class=mi>1550165973</span> <span class=p>}</span>
</span></span></code></pre></div><p>This document will be indexed with a creation date time value of <code>1550165973</code>,
which translates to the human-readable date <code>2019-02-14T17:39:33.000Z</code>. The document
will expire 600 seconds afterwards, which is at timestamp <code>1550166573</code> (or
<code>2019-02-14T17:49:33.000Z</code> in the human-readable version).</p><p>The actual removal of expired documents will not necessarily happen immediately.
Expired documents will eventually be removed by a background thread that is
periodically going through all TTL indexes. The frequency for invoking this
background thread can be configured using the <code>--ttl.frequency</code> startup option.</p><p>There is no guarantee when exactly the removal of expired documents will be carried
out, so queries may still find and return documents that have already expired. These
will eventually be removed when the background thread kicks in and has capacity to
remove the expired documents. It is guaranteed however that only documents which are
past their expiration time will actually be removed.</p><p>Please note that the numeric date time values for the index attribute has to be
specified <strong>in seconds</strong> since January 1st 1970 (Unix timestamp). To calculate the current
timestamp from JavaScript in this format, there is <code>Date.now() / 1000</code>; to calculate it
from an arbitrary Date instance, there is <code>Date.getTime() / 1000</code>. In AQL you can do
<code>DATE_NOW() / 1000</code> or divide an arbitrary Unix timestamp that is in milliseconds
by 1000 to convert it to seconds.</p><p>Alternatively, the index attribute values can be specified as a date string in format
<code>YYYY-MM-DDTHH:MM:SS</code>, optionally with milliseconds after a decimal point in the
format <code>YYYY-MM-DDTHH:MM:SS.MMM</code> and an optional timezone offset. All date strings
without a timezone offset will be interpreted as UTC dates.</p><p>The above example document using a date string attribute value would be</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> <span class=nt>&#34;creationDate&#34;</span> <span class=p>:</span> <span class=s2>&#34;2019-02-14T17:39:33.000Z&#34;</span> <span class=p>}</span>
</span></span></code></pre></div><p>In case the index attribute does not contain a numeric value nor a proper date string,
the document will not be stored in the TTL index and thus will not become a candidate
for expiration and removal. Providing either a non-numeric value or even no value for
the index attribute is a supported way of keeping documents from being expired and removed.</p><p>TTL indexes are designed exactly for the purpose of removing expired documents from
a collection. It is <em>not recommended</em> to rely on TTL indexes for user-land AQL queries.
This is because TTL indexes internally may store a transformed, always numerical version
of the index attribute value even if it was originally passed in as a date string. As a
result TTL indexes will likely not be used for filtering and sort operations in user-land
AQL queries.</p><h2 id=geo-index>Geo Index <a href=/3.10/index-and-search/indexing/basics/#geo-index class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Users can create additional geo indexes on one or multiple attributes in collections.
A geo-spatial index can accelerate queries that filter and sort by the distance
between stored points and points provided in a query.</p><p>The geo index stores two-dimensional coordinate pairs. It can be created on either two
separate document attributes (latitude and longitude) or a single array attribute that
contains both latitude and longitude. Latitude and longitude must be numeric values.</p><p>Furthermore, a geo index can also index standard
<a href=https://datatracker.ietf.org/doc/html/rfc7946 target=_blank rel="noopener noreferrer" class=link>GeoJSON objects</a>&nbsp;<i class="fas fa-external-link-alt"></i>.
GeoJSON uses the JSON syntax to describe geometric objects on the surface
of the Earth. It supports points, lines, and polygons.
See <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/ class=link>Geo-Spatial Indexes</a>.</p><p>The geo index provides operations to find documents with locations nearest to a given
comparison location, and to find documents with locations that are within a specifiable
radius around a comparison location.</p><p>The geo index is used via dedicated functions in AQL
and it is implicitly applied when a <code>SORT</code> or <code>FILTER</code> is used with
the <code>GEO_DISTANCE()</code> function, or if <code>FILTER</code> conditions with <code>GEO_CONTAINS()</code>
or <code>GEO_INTERSECTS()</code> are used. It will not be used for other types of queries
or conditions.</p><h2 id=fulltext-index>Fulltext Index <a href=/3.10/index-and-search/indexing/basics/#fulltext-index class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>The fulltext index type is deprecated from version 3.10 onwards.
It is recommended to use <a href=/3.10/index-and-search/arangosearch/ class=link>ArangoSearch</a> for advanced full-text search capabilities.</div></div></div></div><p>A fulltext index can be used to find words, or prefixes of words inside documents.
A fulltext index can be created on a single attribute only, and will index all words
contained in documents that have a textual value in that attribute. Only words with a (specifiable)
minimum length are indexed. Word tokenization is done using the word boundary analysis
provided by libicu, which is taking into account the selected language provided at
server start. Words are indexed in their lower-cased form. The index supports complete
match queries (full words) and prefix queries, plus basic logical operations such as
<code>and</code>, <code>or</code> and <code>not</code> for combining partial results.</p><p>The fulltext index is sparse, meaning it will only index documents for which the index
attribute is set and contains a string value. Additionally, only words with a configurable
minimum length will be included in the index.</p><p>The fulltext index is used via dedicated functions in AQL, but will
not be enabled for other types of queries or conditions.</p><h2 id=indexes-and-non-ascii-texts>Indexes and non-ASCII texts <a href=/3.10/index-and-search/indexing/basics/#indexes-and-non-ascii-texts class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Before strings are inserted into an index, they are
<a href=http://www.unicode.org/reports/tr15/ target=_blank rel="noopener noreferrer" class=link>normalized by using ICU</a>&nbsp;<i class="fas fa-external-link-alt"></i>.</p><p>There are several characters in the Unicode space, that have a similar meaning.
In order to have all their variants in a result set when querying, the strings
are normalized for the index. This slightly changes the behavior of <code>FILTER</code>
statements with equality comparisons (<code>==</code>) when ran on non-indexed document
attributes.</p><p>While the index may still be useful by fetching a little more results than
you want to actually work with, you may want to have an additional
<code>FILTER MD5(doc.attr) == MD5(@comparisonstring)</code> to make sure that the result
only contains the actual values you need in the end.</p><h2 id=indexing-attributes-and-sub-attributes>Indexing attributes and sub-attributes <a href=/3.10/index-and-search/indexing/basics/#indexing-attributes-and-sub-attributes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Top-level as well as nested attributes can be indexed. For attributes at the top level,
the attribute names alone are required. To index a single field, pass an array with a
single element (string of the attribute key) to the <code>fields</code> parameter of the
<a href=/3.10/index-and-search/indexing/working-with-indexes/#creating-an-index class=link>ensureIndex() method</a>. To create a
combined index over multiple fields, simply add more members to the <code>fields</code> array:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// { name: &#34;Smith&#34;, age: 35 }
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;name&#34;</span> <span class=p>]</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=s2>&#34;age&#34;</span> <span class=p>]</span> <span class=p>})</span></span></span></code></pre></div><p>To index sub-attributes, specify the attribute path using the dot notation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// { name: {last: &#34;Smith&#34;, first: &#34;John&#34; } }
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;name.last&#34;</span> <span class=p>]</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;name.last&#34;</span><span class=p>,</span> <span class=s2>&#34;name.first&#34;</span> <span class=p>]</span> <span class=p>})</span></span></span></code></pre></div><h2 id=indexing-array-values>Indexing array values <a href=/3.10/index-and-search/indexing/basics/#indexing-array-values class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>If an index attribute contains an array, ArangoDB will store the entire array as the index value
by default. Accessing individual members of the array via the index is not possible this
way.</p><p>To make an index insert the individual array members into the index instead of the entire array
value, a special array index needs to be created for the attribute. Array indexes can be set up
like regular persistent indexes using the <code>collection.ensureIndex()</code> function. To make a
persistent index an array index, the index attribute name needs to be extended with <code>[*]</code>
when creating the index and when filtering in an AQL query using the <code>IN</code> operator.</p><p>The following example creates an persistent array index on the <code>tags</code> attribute in a collection named
<code>posts</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;tags[*]&#34;</span> <span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>tags</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;foobar&#34;</span><span class=p>,</span> <span class=s2>&#34;baz&#34;</span><span class=p>,</span> <span class=s2>&#34;quux&#34;</span> <span class=p>]</span> <span class=p>});</span></span></span></code></pre></div><p>This array index can then be used for looking up individual <code>tags</code> values from AQL queries via
the <code>IN</code> operator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>posts</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=s1>&#39;foobar&#39;</span> <span class=kr>IN</span> <span class=n>doc</span><span class=p>.</span><span class=n>tags</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>It is possible to add the <a href=/3.10/aql/operators/#array-expansion class=link>array expansion operator</a>
<code>[*]</code>, but it is not mandatory. You may use it to indicate that an array index is used,
it is purely cosmetic however:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>posts</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=s1>&#39;foobar&#39;</span> <span class=kr>IN</span> <span class=n>doc</span><span class=p>.</span><span class=n>tags</span><span class=p>[</span><span class=o>*</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>The following FILTER conditions will <strong>not use</strong> the array index:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>tags</span> <span class=kr>ANY</span> <span class=o>==</span> <span class=s1>&#39;foobar&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>tags</span> <span class=kr>ANY</span> <span class=kr>IN</span> <span class=s1>&#39;foobar&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>tags</span> <span class=kr>IN</span> <span class=s1>&#39;foobar&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>tags</span> <span class=o>==</span> <span class=s1>&#39;foobar&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>FILTER</span> <span class=s1>&#39;foobar&#39;</span> <span class=o>==</span> <span class=n>doc</span><span class=p>.</span><span class=n>tags</span></span></span></code></pre></div><p>It is also possible to create an index on subattributes of array values. This makes sense
if the index attribute is an array of objects, e.g.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;tags[*].name&#34;</span> <span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>tags</span><span class=o>:</span> <span class=p>[</span> <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;foobar&#34;</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;baz&#34;</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;quux&#34;</span> <span class=p>}</span> <span class=p>]</span> <span class=p>});</span></span></span></code></pre></div><p>The following query will then use the array index (this does require the
<a href=/3.10/aql/operators/#array-expansion class=link>array expansion operator</a>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>posts</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=s1>&#39;foobar&#39;</span> <span class=kr>IN</span> <span class=n>doc</span><span class=p>.</span><span class=n>tags</span><span class=p>[</span><span class=o>*</span><span class=p>].</span><span class=n>name</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>If you store a document having the array which does contain elements not having
the sub-attributes this document will also be indexed with the value <code>null</code>, which
in ArangoDB is equal to attribute not existing.</p><p>ArangoDB supports creating array indexes with a single <code>[*]</code> operator per index
attribute. For example, creating an index as follows is <strong>not supported</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;tags[*].name[*].value&#34;</span> <span class=p>]</span> <span class=p>});</span></span></span></code></pre></div><p>Array values will automatically be de-duplicated before being inserted into an array index.
For example, if the following document is inserted into the collection, the duplicate array
value <code>bar</code> will be inserted only once:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>tags</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;foobar&#34;</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span> <span class=p>]</span> <span class=p>});</span></span></span></code></pre></div><p>This is done to avoid redundant storage of the same index value for the same document, which
would not provide any benefit.</p><p>If an array index is declared <strong>unique</strong>, the de-duplication of array values will happen before
inserting the values into the index, so the above insert operation with two identical values
<code>bar</code> will not necessarily fail</p><p>It will always fail if the index already contains an instance of the <code>bar</code> value. However, if
the value <code>bar</code> is not already present in the index, then the de-duplication of the array values will
effectively lead to <code>bar</code> being inserted only once.</p><p>To turn off the deduplication of array values, it is possible to set the <strong>deduplicate</strong> attribute
on the array index to <code>false</code>. The default value for <strong>deduplicate</strong> is <code>true</code> however, so
de-duplication will take place if not explicitly turned off.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;tags[*]&#34;</span> <span class=p>],</span> <span class=nx>deduplicate</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// will fail now
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>tags</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;foobar&#34;</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span> <span class=p>]</span> <span class=p>});</span> 
</span></span></code></pre></div><p>If an array index is declared and you store documents that do not have an array at the specified attribute
this document will not be inserted in the index. Hence the following objects will not be indexed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;tags[*]&#34;</span> <span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>something</span><span class=o>:</span> <span class=s2>&#34;else&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>tags</span><span class=o>:</span> <span class=kc>null</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>tags</span><span class=o>:</span> <span class=s2>&#34;this is no array&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span> <span class=nx>tags</span><span class=o>:</span> <span class=p>{</span> <span class=nx>content</span><span class=o>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span> <span class=p>}</span> <span class=p>});</span></span></span></code></pre></div><p>An array index is able to index explicit <code>null</code> values. When queried for <code>null</code>values, it
will only return those documents having explicitly <code>null</code> stored in the array, it will not
return any documents that do not have the array at all.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;tags[*]&#34;</span> <span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>tags</span><span class=o>:</span> <span class=kc>null</span><span class=p>})</span> <span class=c1>// Will not be indexed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>tags</span><span class=o>:</span> <span class=p>[]})</span>  <span class=c1>// Will not be indexed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>tags</span><span class=o>:</span> <span class=p>[</span><span class=kc>null</span><span class=p>]});</span> <span class=c1>// Will be indexed for null
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>tags</span><span class=o>:</span> <span class=p>[</span><span class=kc>null</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]});</span> <span class=c1>// Will be indexed for null, 1 and 2
</span></span></span></code></pre></div><p>Declaring an array index as <strong>sparse</strong> does not have an effect on the array part of the index,
this in particular means that explicit <code>null</code> values are also indexed in the <strong>sparse</strong> version.
If an index is combined from an array and a normal attribute the sparsity will apply for the attribute e.g.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;tags[*]&#34;</span><span class=p>,</span> <span class=s2>&#34;name&#34;</span> <span class=p>],</span> <span class=nx>sparse</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>tags</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;alice&#34;</span><span class=p>})</span> <span class=c1>// Will not be indexed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>tags</span><span class=o>:</span> <span class=p>[],</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;alice&#34;</span><span class=p>})</span> <span class=c1>// Will not be indexed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>tags</span><span class=o>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]})</span> <span class=c1>// Will not be indexed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>tags</span><span class=o>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=nx>name</span><span class=o>:</span> <span class=kc>null</span><span class=p>})</span> <span class=c1>// Will not be indexed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>tags</span><span class=o>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;alice&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=c1>// Will be indexed for [1, &#34;alice&#34;], [2, &#34;alice&#34;], [3, &#34;alice&#34;]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>posts</span><span class=p>.</span><span class=nx>insert</span><span class=p>({</span><span class=nx>tags</span><span class=o>:</span> <span class=p>[</span><span class=kc>null</span><span class=p>],</span> <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;bob&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=c1>// Will be indexed for [null, &#34;bob&#34;] 
</span></span></span></code></pre></div><p>Please note that filtering using array indexes only works from within AQL queries and
only if the query filters on the indexed attribute using the <code>IN</code> operator. The other
comparison operators (<code>==</code>, <code>!=</code>, <code>></code>, <code>>=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>ANY</code>, <code>ALL</code>, <code>NONE</code>)
cannot use array indexes currently.</p><h2 id=ensuring-uniqueness-of-relations-in-edge-collections>Ensuring uniqueness of relations in edge collections <a href=/3.10/index-and-search/indexing/basics/#ensuring-uniqueness-of-relations-in-edge-collections class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>You can create a combined index over the edge attributes <code>_from</code> and <code>_to</code>
with the unique option enabled to prevent duplicate relations from being created.</p><p>For example, a document collection <code>users</code> might contain vertices with the document
handles <code>user/A</code>, <code>user/B</code> and <code>user/C</code>. Relations between these documents can
be stored in an edge collection <code>knows</code>, for instance. You may want to make sure
that the vertex <code>user/A</code> is never linked to <code>user/B</code> by an edge more than once.
This can be achieved by adding a unique, non-sparse persistent index for the
fields <code>_from</code> and <code>_to</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>knows</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;_from&#34;</span><span class=p>,</span> <span class=s2>&#34;_to&#34;</span> <span class=p>],</span> <span class=nx>unique</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span></span></span></code></pre></div><p>Creating an edge <code>{ _from: "user/A", _to: "user/B" }</code> in <code>knows</code> will be accepted,
but only once. Another attempt to store an edge with the relation <strong>A</strong> → <strong>B</strong> will
be rejected by the server with a <em>unique constraint violated</em> error. This includes
updates to the <code>_from</code> and <code>_to</code> fields.</p><p>Note that adding a relation <strong>B</strong> → <strong>A</strong> is still possible, so are <strong>A</strong> → <strong>A</strong>
and <strong>B</strong> → <strong>B</strong>, because they are all different relations in a directed graph.
Each one can only occur once however.</p><h2 id=creating-indexes-in-background>Creating Indexes in Background <a href=/3.10/index-and-search/indexing/basics/#creating-indexes-in-background class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Creating new indexes is by default done under an exclusive collection lock. This means
that the collection (or the respective shards) are not available for write operations
as long as the index is being created. This &ldquo;foreground&rdquo; index creation can be undesirable,
if you have to perform it on a live system without a dedicated maintenance window.</p><p>Indexes can also be created in &ldquo;background&rdquo;, not using an
exclusive lock during the entire index creation. The collection remains basically available,
so that other CRUD operations can run on the collection while the index is being created.
This can be achieved by setting the <code>inBackground</code> attribute when creating an index.</p><p>To create an index in the background in <em>arangosh</em> just specify <code>inBackground: true</code>,
like in the following examples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// create the persistent index in the background
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;value&#34;</span> <span class=p>],</span> <span class=nx>unique</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>inBackground</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;persistent&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;email&#34;</span> <span class=p>],</span> <span class=nx>unique</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>inBackground</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// also supported for geo and fulltext indexes
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;geo&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;latitude&#34;</span><span class=p>,</span> <span class=s2>&#34;longitude&#34;</span><span class=p>],</span> <span class=nx>inBackground</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;geo&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;latitude&#34;</span><span class=p>,</span> <span class=s2>&#34;longitude&#34;</span><span class=p>],</span> <span class=nx>inBackground</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>collection</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;fulltext&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;text&#34;</span> <span class=p>],</span> <span class=nx>minLength</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span> <span class=nx>inBackground</span><span class=o>:</span> <span class=kc>true</span> <span class=p>})</span></span></span></code></pre></div><h3 id=behavior>Behavior <a href=/3.10/index-and-search/indexing/basics/#behavior class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Indexes that are still in the build process will not be visible via the ArangoDB APIs.
Nevertheless it is not possible to create the same index twice via the <code>ensureIndex()</code> method
while an index is still begin created. AQL queries also will not use these indexes until
the index reports back as fully created. Note that the initial <code>ensureIndex()</code> call or HTTP
request will still block until the index is completely ready. Existing single-threaded
client programs can thus safely set the <code>inBackground</code> option to <code>true</code> and continue to
work as before.</p><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>Should you be building an index in the background you cannot rename or drop the collection.
These operations will block until the index creation is finished. This is equally the case
with foreground indexing.</div></div></div></div><p>After an interrupted index build (i.e. due to a server crash) the partially built index
will the removed. In the ArangoDB cluster the index might then be automatically recreated
on affected shards.</p><h3 id=performance>Performance <a href=/3.10/index-and-search/indexing/basics/#performance class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Background index creation might be slower than the &ldquo;foreground&rdquo; index creation and require
more RAM. Under a write heavy load (specifically many remove, update or replace operations),
the background index creation needs to keep a list of removed documents in RAM. This might
become unsustainable if this list grows to tens of millions of entries.</p><p>Building an index is always a write heavy operation (internally), it is always a good idea to build indexes
during times with less load.</p><p>In the Enterprise Edition, non-unique indexes can be created with multiple
threads in parallel. The number of parallel index creation threads is currently
set to 2, but future versions of ArangoDB may increase this value.
Parallel index creation is only triggered for collections with at least 120,000
documents.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.10/index-and-search/indexing/><i class="fas fa-chevron-left fa-fw"></i><p>Indexing</p></a></span><span class=next><a class="nav nav-next link" href=/3.10/index-and-search/indexing/which-index-to-use-when/><p>Which index to use when</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.10/index-and-search/indexing/basics.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#primary-index>Primary Index</a></div><div class=level-2><a href=#edge-index>Edge Index</a></div><div class=level-2><a href=#vertex-centric-indexes>Vertex-centric indexes</a></div><div class=level-2><a href=#persistent-index>Persistent Index</a></div><div class=level-2><a href=#inverted-index>Inverted index</a></div><div class=level-2><a href=#ttl-time-to-live-index>TTL (time-to-live) Index</a></div><div class=level-2><a href=#geo-index>Geo Index</a></div><div class=level-2><a href=#fulltext-index>Fulltext Index</a></div><div class=level-2><a href=#indexes-and-non-ascii-texts>Indexes and non-ASCII texts</a></div><div class=level-2><a href=#indexing-attributes-and-sub-attributes>Indexing attributes and sub-attributes</a></div><div class=level-2><a href=#indexing-array-values>Indexing array values</a></div><div class=level-2><a href=#ensuring-uniqueness-of-relations-in-edge-collections>Ensuring uniqueness of relations in edge collections</a></div><div class=level-2><a href=#creating-indexes-in-background>Creating Indexes in Background</a></div><div class=level-3><a href=#behavior>Behavior</a></div><div class=level-3><a href=#performance>Performance</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>