<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743774193></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="Indexing GeoJSON geometry and latitude/longitude pairs can accelerate geo-spatial queries"><meta property="og:url" content="http://localhost/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/"><meta property="og:title" content="Geo-Spatial Indexes"><meta property="og:type" content="website"><meta property="og:description" content="Indexing GeoJSON geometry and latitude/longitude pairs can accelerate geo-spatial queries"><meta name=docsearch:version content="3.10"><title>Geo-Spatial Indexes | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743774193 defer></script>
<script src=/js/featherlight.min.js?1743774193 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743774193 defer></script>
<script src=/js/theme.js?1743774193 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.10"><a itemprop=item class=link href=/3.10/><span itemprop=name class=breadcrumb-entry>3.10.14</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Index and Search"><a itemprop=item class=link href=/3.10/index-and-search/><span itemprop=name class=breadcrumb-entry>Index and Search</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Indexing"><a itemprop=item class=link href=/3.10/index-and-search/indexing/><span itemprop=name class=breadcrumb-entry>Indexing</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Working with Indexes"><a itemprop=item class=link href=/3.10/index-and-search/indexing/working-with-indexes/><span itemprop=name class=breadcrumb-entry>Working with Indexes</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Geo-spatial Indexes"><a itemprop=item class=link href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/><span itemprop=name class=breadcrumb-entry>Geo-spatial Indexes</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.10 reached End of Life (EOL) and is no longer supported.</p><p>This documentation is outdated. Please see the most recent <a href=/3.12/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/ class=link>stable version</a>.</p></div></div></div></div><hgroup><h1>Geo-Spatial Indexes</h1><p class=lead>Indexing GeoJSON geometry and latitude/longitude pairs can accelerate geo-spatial queries</p></hgroup><p>The geo-spatial index type in ArangoDB is based on <a href=http://s2geometry.io/ target=_blank rel="noopener noreferrer" class=link>Google S2</a>&nbsp;<i class="fas fa-external-link-alt"></i>.
Indexing is supported for a subset of the <a href=/3.10/aql/functions/geo/#geojson class=link><strong>GeoJSON</strong></a>
geometry types as well as simple latitude/longitude pairs.</p><p>AQL&rsquo;s geospatial functions and GeoJSON constructors are described in
<a href=/3.10/aql/functions/geo/ class=link>Geo functions</a>.</p><p>You can also perform
<a href=/3.10/index-and-search/arangosearch/geospatial-search/ class=link>geospatial searches with ArangoSearch</a>.</p><h2 id=using-a-geo-spatial-index>Using a Geo-Spatial Index <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#using-a-geo-spatial-index class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The geospatial index supports distance, containment, and intersection
queries for various geometric 2D shapes. You should mainly be using AQL queries
to perform these types of operations. The index can operate in <strong>two different
modes</strong>, depending on if you want to use the GeoJSON data-format or not. The modes
are mainly toggled by using the <code>geoJson</code> field when creating the index.</p><p>This index assumes coordinates with the latitude between -90 and 90 degrees and the
longitude between -180 and 180 degrees. A geo index ignores all
documents which do not fulfill these requirements.</p><h3 id=geojson-mode>GeoJSON Mode <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#geojson-mode class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>To create an index in GeoJSON mode execute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>collection</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;geo&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;geometry&#34;</span> <span class=p>],</span> <span class=nx>geoJson</span><span class=o>:</span> <span class=kc>true</span> <span class=p>})</span></span></span></code></pre></div><p>This creates the index on all documents and uses <em>geometry</em> as the attributed
field where the value is either a
<a href=https://tools.ietf.org/html/rfc7946#section-3.1 target=_blank rel="noopener noreferrer" class=link>Geometry Object</a>&nbsp;<i class="fas fa-external-link-alt"></i>
<strong>or</strong> a <em>coordinate array</em>. The array must contain at least two numeric values
with longitude (first value) and latitude (second value). This corresponds
to the format described in
<a href=https://tools.ietf.org/html/rfc7946#section-3.1.1 target=_blank rel="noopener noreferrer" class=link>RFC 7946 Position</a>&nbsp;<i class="fas fa-external-link-alt"></i>.</p><p>All documents, that do not have the attribute path or have a non-conforming
value in it, are excluded from the index.</p><p>A geo index is implicitly sparse, and there is no way to control its
sparsity.
In case that the index was successfully created, an object with the index
details, including the index-identifier, is returned.</p><p>For technical details on how ArangoDB interprets GeoJSON objects, see
<a href=/3.10/aql/functions/geo/#geojson-interpretation class=link>GeoJSON Interpretation</a>.
In short: the <strong>syntax</strong> of GeoJSON is used, but polygon boundaries and lines
between points are interpreted as geodesics (pieces of great circles on Earth).</p><h3 id=non-geojson-mode>Non-GeoJSON mode <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#non-geojson-mode class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>This index mode exclusively supports indexing on coordinate arrays. Values that
contain GeoJSON or other types of data are ignored. In the non-GeoJSON mode
the index can be created on one or two fields.</p><p>The following examples work in the <em>arangosh</em> command shell.</p><p>To create a geo-spatial index on all documents using <code>latitude</code> and
<code>longitude</code> as separate attribute paths, two paths need to be specified
in the <code>fields</code> array:</p><p><code>collection.ensureIndex({ type: "geo", fields: [ "latitude", "longitude" ] })</code></p><p>The first field is always defined to be the <em>latitude</em> and the second is the
<em>longitude</em>. The <code>geoJson</code> flag is implicitly <em>false</em> in this mode.</p><p>Alternatively you can specify only one field:</p><p><code>collection.ensureIndex({ type: "geo", fields: [ "location" ], geoJson:false })</code></p><p>It creates a geospatial index on all documents using <code>location</code> as the path to the
coordinates. The value of the attribute has to be an array with at least two
numeric values. The array must contain the latitude (first value) and the
longitude (second value).</p><p>All documents, which do not have the attribute path(s) or have a non-conforming
value in it, are excluded from the index.</p><p>A geo index is implicitly sparse, and there is no way to control its
sparsity.
In case that the index was successfully created, an object with the index
details, including the index-identifier, is returned.</p><p>In case that the index was successfully created, an object with the index
details, including the index-identifier, is returned.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>If the <code>geoJson</code> option is <code>false</code>, GeoJSON data is <strong>not indexed</strong>.
Some queries can have different results with and without such a geo-spatial index.</p><p>For example, if you have documents with proper GeoJSON data in an attribute
called <code>geo</code>, then the following query matches all of them:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>GEO_DISTANCE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>geo</span><span class=p>,</span> <span class=nf>GEO_POINT</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span> <span class=o>&gt;=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>The <code>GEO_DISTANCE()</code> function correctly parses the data, takes the centroid,
computes the distance to <code>GEO_POINT(10, 10)</code> (which is non-negative regardless
of the <code>geo</code> object), and lets the document through.</p><p>However, a geo-spatial index with <code>geoJson</code> set to <code>false</code> doesn&rsquo;t index the
<code>geo</code> attribute if it contains GeoJSON data and ignores these documents. If the
same query is executed with the geo-spatial index, it doesn&rsquo;t find the documents.</p></div></div></div></div><h3 id=legacy-polygons>Legacy Polygons <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#legacy-polygons class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Between ArangoDB 3.10 and earlier versions, two things have changed:</p><ul><li>boundaries of polygons are now geodesics and there is no special
and inconsistent treatment of &ldquo;rectangles&rdquo; any more</li><li>linear rings are interpreted according to the rules and no longer
&ldquo;normalized&rdquo;</li></ul><p>See <a href=/3.10/aql/functions/geo/#geojson-interpretation class=link>GeoJSON Interpretation</a>
for details.</p><p>For backward compatibility, a <code>legacyPolygons</code> option has been introduced
for geo indexes. It is relevant for those that have <code>geoJson</code> set to
<code>true</code> only. Geo indexes created in versions before 3.10 always
implicitly have the <code>legacyPolygons</code> option set to <code>true</code>. Newly generated
geo indexes from 3.10 onward have the <code>legacyPolygons</code> option set to <code>false</code>
by default. However, you can still explicitly overwrite the setting with
<code>true</code> to create a legacy index, but it is not recommended.</p><p>A geo index with <code>legacyPolygons</code> set to <code>true</code> uses the old, pre-3.10
rules for the parsing GeoJSON polygons. This allows you to let old indexes
produce the same, potentially wrong results as before an upgrade. A geo index
with <code>legacyPolygons</code> set to <code>false</code> uses the new, correct and consistent
method for parsing of GeoJSON polygons.</p><p>If you use a geo index and upgrade from a version below 3.10 to a version of
3.10 or higher, it is recommended that you drop your old geo indexes
and create new ones with <code>legacyPolygons</code> set to <code>false</code>.</p><p>If you use <code>geojson</code> Analyzers and upgrade from a version below 3.10 to a
version of 3.10 or higher, the interpretation of GeoJSON Polygons changes.
See the <code>legacy</code> property of the <a href=/3.10/index-and-search/analyzers/#geojson class=link><code>geojson</code> Analyzer</a>.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>It is possible that you might have been relying on the old (wrong) parsing of
GeoJSON polygons unknowingly. If you have polygons in your data that mean to
refer to a relatively small region, but have the boundary running clockwise
around the intended interior, they are interpreted as intended prior to 3.10,
but from 3.10 onward, they are interpreted as &ldquo;the other side&rdquo; of the boundary.</p><p>Whether a clockwise boundary specifies the complement of the small region
intentionally or not cannot be determined automatically. Please test the new
behavior manually.</p></div></div></div></div><h3 id=arangosh-examples><em>arangosh</em> Examples <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#arangosh-examples class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Ensures that a geo index exists:</p><p><code>collection.ensureIndex({ type: "geo", fields: [ "location" ] })</code></p><p>Creates a geospatial index on all documents using <code>location</code> as the path to the
coordinates. The value of the attribute has to be an array with at least two
numeric values. The array must contain the latitude (first value) and the
longitude (second value).</p><p>All documents, which do not have the attribute path or have a non-conforming
value in it, are excluded from the index.</p><p>A geo index is implicitly sparse, and there is no way to control its
sparsity.</p><p>The index does not provide a <code>unique</code> option because of its limited usability.
It would prevent identical coordinate pairs from being inserted only, but even a
slightly different location (like 1 inch or 1 cm off) would be unique again and
not considered a duplicate, although it probably should. The desired threshold
for detecting duplicates may vary for every project (including how to calculate
the distance even) and needs to be implemented on the application layer as
needed. You can write a <a href=/3.10/develop/foxx-microservices/ class=link>Foxx service</a> for this purpose and
make use of the <a href=/3.10/aql/functions/geo/ class=link>Geo-spatial functions in AQL</a> to find nearby
locations supported by a geo index.</p><p>In case that the index was successfully created, an object with the index
details, including the index-identifier, is returned.</p><hr><p>To create a geo index on an array attribute that contains longitude first, set
the <code>geoJson</code> attribute to <code>true</code>. This corresponds to the format described in
<a href=https://tools.ietf.org/html/rfc7946#section-3.1.1 target=_blank rel="noopener noreferrer" class=link>RFC 7946 Position</a>&nbsp;<i class="fas fa-external-link-alt"></i></p><p><code>collection.ensureIndex({ type: "geo", fields: [ "location" ], geoJson: true })</code></p><hr><p>To create a geo-spatial index on all documents using <code>latitude</code> and <code>longitude</code>
as separate attribute paths, two paths need to be specified in the <code>fields</code>
array:</p><p><code>collection.ensureIndex({ type: "geo", fields: [ "latitude", "longitude" ] })</code></p><p>In case that the index was successfully created, an object with the index
details, including the index-identifier, is returned.</p><p><strong>Examples</strong></p><p>Create a geo index for an array attribute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>geo</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;geo&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;loc&#34;</span> <span class=p>]</span> <span class=p>});</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;bestIndexedLevel&#34;</span> <span class=o>:</span> <span class=mi>17</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;fields&#34;</span> <span class=o>:</span> <span class=p>[</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;loc&#34;</span> 
</span></span><span class=line><span class=cl>  <span class=p>],</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;geoJson&#34;</span> <span class=o>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;id&#34;</span> <span class=o>:</span> <span class=s2>&#34;geo/79255&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;isNewlyCreated&#34;</span> <span class=o>:</span> <span class=kc>true</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;legacyPolygons&#34;</span> <span class=o>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;maxNumCoverCells&#34;</span> <span class=o>:</span> <span class=mi>8</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;idx_1795421255229243392&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;sparse&#34;</span> <span class=o>:</span> <span class=kc>true</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;type&#34;</span> <span class=o>:</span> <span class=s2>&#34;geo&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;unique&#34;</span> <span class=o>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;worstIndexedLevel&#34;</span> <span class=o>:</span> <span class=mi>4</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;code&#34;</span> <span class=o>:</span> <span class=mi>201</span> 
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><br><p>Create a geo index for an array attribute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>geo2</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;geo&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;location.latitude&#34;</span><span class=p>,</span> <span class=s2>&#34;location.longitude&#34;</span> <span class=p>]</span> <span class=p>});</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;bestIndexedLevel&#34;</span> <span class=o>:</span> <span class=mi>17</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;fields&#34;</span> <span class=o>:</span> <span class=p>[</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;location.latitude&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;location.longitude&#34;</span> 
</span></span><span class=line><span class=cl>  <span class=p>],</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;geoJson&#34;</span> <span class=o>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;id&#34;</span> <span class=o>:</span> <span class=s2>&#34;geo2/79265&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;isNewlyCreated&#34;</span> <span class=o>:</span> <span class=kc>true</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;legacyPolygons&#34;</span> <span class=o>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;maxNumCoverCells&#34;</span> <span class=o>:</span> <span class=mi>8</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;idx_1795421255242874880&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;sparse&#34;</span> <span class=o>:</span> <span class=kc>true</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;type&#34;</span> <span class=o>:</span> <span class=s2>&#34;geo&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;unique&#34;</span> <span class=o>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;worstIndexedLevel&#34;</span> <span class=o>:</span> <span class=mi>4</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;code&#34;</span> <span class=o>:</span> <span class=mi>201</span> 
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><br><p>Use a geo index with the AQL <code>SORT</code> operation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>idx</span> <span class=o>=</span> <span class=nx>db</span><span class=p>.</span><span class=nx>geoSort</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;geo&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;latitude&#34;</span><span class=p>,</span> <span class=s2>&#34;longitude&#34;</span> <span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=nx>i</span> <span class=o>=</span> <span class=o>-</span><span class=mi>90</span><span class=p>;</span>  <span class=nx>i</span> <span class=o>&lt;=</span> <span class=mi>90</span><span class=p>;</span>  <span class=nx>i</span> <span class=o>+=</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=nx>j</span> <span class=o>=</span> <span class=o>-</span><span class=mi>180</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;=</span> <span class=mi>180</span><span class=p>;</span> <span class=nx>j</span> <span class=o>+=</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>geoSort</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>name</span> <span class=o>:</span> <span class=s2>&#34;Name/&#34;</span> <span class=o>+</span> <span class=nx>i</span> <span class=o>+</span> <span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=nx>j</span><span class=p>,</span> <span class=nx>latitude</span> <span class=o>:</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>longitude</span> <span class=o>:</span> <span class=nx>j</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>query</span> <span class=o>=</span> <span class=s2>&#34;FOR doc in geoSort SORT DISTANCE(doc.latitude, doc.longitude, 0, 0) LIMIT 5 RETURN doc&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_explain</span><span class=p>(</span><span class=nx>query</span><span class=p>,</span> <span class=p>{},</span> <span class=p>{</span><span class=nx>colors</span><span class=o>:</span> <span class=kc>false</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span><span class=nx>query</span><span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=s2>&#34;geoSort/80683&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;_key&#34;</span> <span class=o>:</span> <span class=s2>&#34;80683&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;_rev&#34;</span> <span class=o>:</span> <span class=s2>&#34;_holf4EG--F&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>Query</span> <span class=nb>String</span> <span class=p>(</span><span class=mi>86</span> <span class=nx>chars</span><span class=p>,</span> <span class=nx>cacheable</span><span class=o>:</span> <span class=kc>true</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=nx>FOR</span> <span class=nx>doc</span> <span class=k>in</span> <span class=nx>geoSort</span> <span class=nx>SORT</span> <span class=nx>DISTANCE</span><span class=p>(</span><span class=nx>doc</span><span class=p>.</span><span class=nx>latitude</span><span class=p>,</span> <span class=nx>doc</span><span class=p>.</span><span class=nx>longitude</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=nx>LIMIT</span> <span class=mi>5</span> <span class=nx>RETURN</span> <span class=nx>doc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Execution</span> <span class=nx>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=nx>Id</span>   <span class=nx>NodeType</span>        <span class=nx>Est</span><span class=p>.</span>   <span class=nx>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=nx>SingletonNode</span>      <span class=mi>1</span>   <span class=o>*</span> <span class=nx>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=nx>IndexNode</span>          <span class=mi>7</span>     <span class=o>-</span> <span class=nx>FOR</span> <span class=nx>doc</span> <span class=nx>IN</span> <span class=nx>geoSort</span>   <span class=cm>/* geo index scan, index scan + document lookup */</span>    
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=nx>LimitNode</span>          <span class=mi>5</span>       <span class=o>-</span> <span class=nx>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=nx>ReturnNode</span>         <span class=mi>5</span>       <span class=o>-</span> <span class=nx>RETURN</span> <span class=nx>doc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Indexes</span> <span class=nx>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=nx>By</span>   <span class=nx>Name</span>                      <span class=nx>Type</span>   <span class=nx>Collection</span>   <span class=nx>Unique</span>   <span class=nx>Sparse</span>   <span class=nx>Cache</span>   <span class=nx>Selectivity</span>   <span class=nx>Fields</span>                        <span class=nx>Stored</span> <span class=nx>values</span>   <span class=nx>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=nx>idx_1795421255275380736</span>   <span class=nx>geo</span>    <span class=nx>geoSort</span>      <span class=kc>false</span>    <span class=kc>true</span>     <span class=kc>false</span>           <span class=nx>n</span><span class=o>/</span><span class=nx>a</span>   <span class=p>[</span> <span class=sb>`latitude`</span><span class=p>,</span> <span class=sb>`longitude`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=p>(</span><span class=nx>GEO_DISTANCE</span><span class=p>([</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span> <span class=p>],</span> <span class=p>[</span> <span class=nx>doc</span><span class=p>.</span><span class=sb>`longitude`</span><span class=p>,</span> <span class=nx>doc</span><span class=p>.</span><span class=sb>`latitude`</span> <span class=p>])</span> <span class=o>&lt;</span> <span class=s2>&#34;unlimited&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Optimization</span> <span class=nx>rules</span> <span class=nx>applied</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=nx>Id</span>   <span class=nx>RuleName</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=nx>geo</span><span class=o>-</span><span class=nx>index</span><span class=o>-</span><span class=nx>optimizer</span>
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=nx>remove</span><span class=o>-</span><span class=nx>unnecessary</span><span class=o>-</span><span class=nx>calculations</span><span class=o>-</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>43</span> <span class=nx>rule</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span> <span class=nx>executed</span><span class=p>,</span> <span class=mi>1</span> <span class=nx>plan</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span> <span class=nx>created</span><span class=p>,</span> <span class=nx>peak</span> <span class=nx>mem</span> <span class=p>[</span><span class=nx>b</span><span class=p>]</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>exec</span> <span class=nx>time</span> <span class=p>[</span><span class=nx>s</span><span class=p>]</span><span class=o>:</span> <span class=mf>0.00022</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_key&#34;</span> <span class=o>:</span> <span class=s2>&#34;79981&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=s2>&#34;geoSort/79981&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_rev&#34;</span> <span class=o>:</span> <span class=s2>&#34;_holf4Am--B&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;Name/0/0&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;latitude&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;longitude&#34;</span> <span class=o>:</span> <span class=mi>0</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_key&#34;</span> <span class=o>:</span> <span class=s2>&#34;80055&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=s2>&#34;geoSort/80055&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_rev&#34;</span> <span class=o>:</span> <span class=s2>&#34;_holf4BC--_&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;Name/10/0&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;latitude&#34;</span> <span class=o>:</span> <span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;longitude&#34;</span> <span class=o>:</span> <span class=mi>0</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_key&#34;</span> <span class=o>:</span> <span class=s2>&#34;79983&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=s2>&#34;geoSort/79983&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_rev&#34;</span> <span class=o>:</span> <span class=s2>&#34;_holf4Aq---&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;Name/0/10&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;latitude&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;longitude&#34;</span> <span class=o>:</span> <span class=mi>10</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_key&#34;</span> <span class=o>:</span> <span class=s2>&#34;79907&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=s2>&#34;geoSort/79907&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_rev&#34;</span> <span class=o>:</span> <span class=s2>&#34;_holf4AO--_&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;Name/-10/0&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;latitude&#34;</span> <span class=o>:</span> <span class=o>-</span><span class=mi>10</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;longitude&#34;</span> <span class=o>:</span> <span class=mi>0</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_key&#34;</span> <span class=o>:</span> <span class=s2>&#34;79979&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=s2>&#34;geoSort/79979&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_rev&#34;</span> <span class=o>:</span> <span class=s2>&#34;_holf4Am--A&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;Name/0/-10&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;latitude&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;longitude&#34;</span> <span class=o>:</span> <span class=o>-</span><span class=mi>10</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div><br><p>Use a geo index with the AQL <code>FILTER</code> operation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>idx</span> <span class=o>=</span> <span class=nx>db</span><span class=p>.</span><span class=nx>geoFilter</span><span class=p>.</span><span class=nx>ensureIndex</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;geo&#34;</span><span class=p>,</span> <span class=nx>fields</span><span class=o>:</span> <span class=p>[</span> <span class=s2>&#34;latitude&#34;</span><span class=p>,</span> <span class=s2>&#34;longitude&#34;</span> <span class=p>]</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=nx>i</span> <span class=o>=</span> <span class=o>-</span><span class=mi>90</span><span class=p>;</span>  <span class=nx>i</span> <span class=o>&lt;=</span> <span class=mi>90</span><span class=p>;</span>  <span class=nx>i</span> <span class=o>+=</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=nx>j</span> <span class=o>=</span> <span class=o>-</span><span class=mi>180</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;=</span> <span class=mi>180</span><span class=p>;</span> <span class=nx>j</span> <span class=o>+=</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span><span class=p>.</span><span class=nx>geoFilter</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>name</span> <span class=o>:</span> <span class=s2>&#34;Name/&#34;</span> <span class=o>+</span> <span class=nx>i</span> <span class=o>+</span> <span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=nx>j</span><span class=p>,</span> <span class=nx>latitude</span> <span class=o>:</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>longitude</span> <span class=o>:</span> <span class=nx>j</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>query</span> <span class=o>=</span> <span class=s2>&#34;FOR doc in geoFilter FILTER DISTANCE(doc.latitude, doc.longitude, 0, 0) &lt; 2000 RETURN doc&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_explain</span><span class=p>(</span><span class=nx>query</span><span class=p>,</span> <span class=p>{},</span> <span class=p>{</span><span class=nx>colors</span><span class=o>:</span> <span class=kc>false</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span><span class=nx>query</span><span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=s2>&#34;geoFilter/82103&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;_key&#34;</span> <span class=o>:</span> <span class=s2>&#34;82103&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=s2>&#34;_rev&#34;</span> <span class=o>:</span> <span class=s2>&#34;_holf4MW--C&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>Query</span> <span class=nb>String</span> <span class=p>(</span><span class=mi>89</span> <span class=nx>chars</span><span class=p>,</span> <span class=nx>cacheable</span><span class=o>:</span> <span class=kc>true</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=nx>FOR</span> <span class=nx>doc</span> <span class=k>in</span> <span class=nx>geoFilter</span> <span class=nx>FILTER</span> <span class=nx>DISTANCE</span><span class=p>(</span><span class=nx>doc</span><span class=p>.</span><span class=nx>latitude</span><span class=p>,</span> <span class=nx>doc</span><span class=p>.</span><span class=nx>longitude</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2000</span> <span class=nx>RETURN</span> <span class=nx>doc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Execution</span> <span class=nx>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=nx>Id</span>   <span class=nx>NodeType</span>        <span class=nx>Est</span><span class=p>.</span>   <span class=nx>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=nx>SingletonNode</span>      <span class=mi>1</span>   <span class=o>*</span> <span class=nx>ROOT</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=nx>IndexNode</span>          <span class=mi>7</span>     <span class=o>-</span> <span class=nx>FOR</span> <span class=nx>doc</span> <span class=nx>IN</span> <span class=nx>geoFilter</span>   <span class=cm>/* geo index scan, index scan + document lookup */</span>    
</span></span><span class=line><span class=cl>  <span class=mi>5</span>   <span class=nx>ReturnNode</span>         <span class=mi>7</span>       <span class=o>-</span> <span class=nx>RETURN</span> <span class=nx>doc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Indexes</span> <span class=nx>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=nx>By</span>   <span class=nx>Name</span>                      <span class=nx>Type</span>   <span class=nx>Collection</span>   <span class=nx>Unique</span>   <span class=nx>Sparse</span>   <span class=nx>Cache</span>   <span class=nx>Selectivity</span>   <span class=nx>Fields</span>                        <span class=nx>Stored</span> <span class=nx>values</span>   <span class=nx>Ranges</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=nx>idx_1795421255410647040</span>   <span class=nx>geo</span>    <span class=nx>geoFilter</span>    <span class=kc>false</span>    <span class=kc>true</span>     <span class=kc>false</span>           <span class=nx>n</span><span class=o>/</span><span class=nx>a</span>   <span class=p>[</span> <span class=sb>`latitude`</span><span class=p>,</span> <span class=sb>`longitude`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=p>(</span><span class=nx>GEO_DISTANCE</span><span class=p>([</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span> <span class=p>],</span> <span class=p>[</span> <span class=nx>doc</span><span class=p>.</span><span class=sb>`longitude`</span><span class=p>,</span> <span class=nx>doc</span><span class=p>.</span><span class=sb>`latitude`</span> <span class=p>])</span> <span class=o>&lt;</span> <span class=mi>2000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Optimization</span> <span class=nx>rules</span> <span class=nx>applied</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=nx>Id</span>   <span class=nx>RuleName</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=nx>geo</span><span class=o>-</span><span class=nx>index</span><span class=o>-</span><span class=nx>optimizer</span>
</span></span><span class=line><span class=cl>  <span class=mi>2</span>   <span class=nx>remove</span><span class=o>-</span><span class=nx>unnecessary</span><span class=o>-</span><span class=nx>calculations</span><span class=o>-</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>43</span> <span class=nx>rule</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span> <span class=nx>executed</span><span class=p>,</span> <span class=mi>1</span> <span class=nx>plan</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span> <span class=nx>created</span><span class=p>,</span> <span class=nx>peak</span> <span class=nx>mem</span> <span class=p>[</span><span class=nx>b</span><span class=p>]</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>exec</span> <span class=nx>time</span> <span class=p>[</span><span class=nx>s</span><span class=p>]</span><span class=o>:</span> <span class=mf>0.00022</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_key&#34;</span> <span class=o>:</span> <span class=s2>&#34;81401&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span> <span class=o>:</span> <span class=s2>&#34;geoFilter/81401&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_rev&#34;</span> <span class=o>:</span> <span class=s2>&#34;_holf4Iq--C&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=s2>&#34;Name/0/0&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;latitude&#34;</span> <span class=o>:</span> <span class=mi>0</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;longitude&#34;</span> <span class=o>:</span> <span class=mi>0</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div><br><h2 id=indexed-geospatial-queries>Indexed GeoSpatial Queries <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#indexed-geospatial-queries class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The geospatial index supports a variety of AQL queries, which can be built with the help
of the <a href=/3.10/aql/functions/geo/ class=link>geo utility functions</a>. There are three specific
geo functions that can be optimized, provided they are used correctly:
<code>GEO_DISTANCE()</code>, <code>GEO_CONTAINS()</code>, <code>GEO_INTERSECTS()</code>. Additionally, there is a built-in support to optimize
the older geo functions <code>DISTANCE()</code>, <code>NEAR()</code>, and <code>WITHIN()</code> (the last two
only if they are used in their 4 argument version, without <code>distanceName</code>).</p><p>When in doubt whether your query is being properly optimized,
check the <a href=/3.10/aql/execution-and-performance/explaining-queries/ class=link>AQL explain</a>
output to check for index usage.</p><h3 id=query-for-results-near-origin-near-type-query>Query for Results near Origin (NEAR type query) <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#query-for-results-near-origin-near-type-query class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>A basic example of a query for results near an origin point:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>x</span> <span class=kr>IN</span> <span class=n>geo_collection</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>GEO_DISTANCE</span><span class=p>([</span><span class=nv>@lng</span><span class=p>,</span> <span class=nv>@lat</span><span class=p>],</span> <span class=n>x</span><span class=p>.</span><span class=n>geometry</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>100000</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>x</span><span class=p>.</span><span class=n>_key</span></span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>x</span> <span class=kr>IN</span> <span class=n>geo_collection</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>GEO_DISTANCE</span><span class=p>(</span><span class=nv>@geojson</span><span class=p>,</span> <span class=n>x</span><span class=p>.</span><span class=n>geometry</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>100000</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>x</span><span class=p>.</span><span class=n>_key</span></span></span></code></pre></div><p>The function <code>GEO_DISTANCE()</code> always returns the distance in meters, so this
query receives results up until <em>100km</em>.</p><p>The first parameter can be a GeoJSON object or a coordinate array in
<code>[longitude, latitude]</code> ordering. The second parameter is the document field
on that the index was created.</p><p>In case of a GeoJSON object in the first parameter, the distance is measured
from the <strong>centroid of the object to the indexed point</strong>. If the index has
<code>geoJson</code> set to <code>true</code>, then the distance is measured from the
<strong>centroid of the object to the centroid of the indexed object</strong>. This can
be unexpected if not all GeoJSON objects are points, but it is what the index
can actually provide.</p><h3 id=query-for-sorted-results-near-origin-near-type-query>Query for Sorted Results near Origin (NEAR type query) <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#query-for-sorted-results-near-origin-near-type-query class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>A basic example of a query for the 1000 nearest results to an origin point (ascending sorting):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>x</span> <span class=kr>IN</span> <span class=n>geo_collection</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>GEO_DISTANCE</span><span class=p>([</span><span class=nv>@lng</span><span class=p>,</span> <span class=nv>@lat</span><span class=p>],</span> <span class=n>x</span><span class=p>.</span><span class=n>geometry</span><span class=p>)</span> <span class=kr>ASC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>x</span><span class=p>.</span><span class=n>_key</span></span></span></code></pre></div><p>The first parameter can be a GeoJSON object or a coordinate array in
<code>[longitude, latitude]</code> ordering. The second parameter is the document field
on that the index was created.</p><p>In case of a GeoJSON object in the first parameter, the distance is measured
from the <strong>centroid of the object to the indexed point</strong>. If the index has
<code>geoJson</code> set to <code>true</code>, then the distance is measured from the
<strong>centroid of the object to the centroid of the indexed object</strong>. This can
be unexpected if not all GeoJSON objects are points, but it is what the index
can actually provide.</p><p>You may also get results farthest away (distance sorted in descending order):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>x</span> <span class=kr>IN</span> <span class=n>geo_collection</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>GEO_DISTANCE</span><span class=p>([</span><span class=nv>@lng</span><span class=p>,</span> <span class=nv>@lat</span><span class=p>],</span> <span class=n>x</span><span class=p>.</span><span class=n>geometry</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>x</span><span class=p>.</span><span class=n>_key</span></span></span></code></pre></div><h3 id=query-for-results-within-a-distance-range>Query for Results within a Distance Range <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#query-for-results-within-a-distance-range class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>A query which returns documents at a distance of <em>1km</em> or farther away,
and up to <em>100km</em> from the origin:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>x</span> <span class=kr>IN</span> <span class=n>geo_collection</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>GEO_DISTANCE</span><span class=p>([</span><span class=nv>@lng</span><span class=p>,</span> <span class=nv>@lat</span><span class=p>],</span> <span class=n>x</span><span class=p>.</span><span class=n>geometry</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>100000</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>GEO_DISTANCE</span><span class=p>([</span><span class=nv>@lng</span><span class=p>,</span> <span class=nv>@lat</span><span class=p>],</span> <span class=n>x</span><span class=p>.</span><span class=n>geometry</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>x</span></span></span></code></pre></div><p>This returns the documents with a GeoJSON value that is located in
the specified search annulus.</p><p>The first parameter can be a GeoJSON object or a coordinate array in
<code>[longitude, latitude]</code> ordering. The second parameter is the document field
on that the index was created.</p><p>In case of a GeoJSON object in the first parameter, the distance is measured
from the <strong>centroid of the object to the indexed point</strong>. If the index has
<code>geoJson</code> set to <code>true</code>, then the distance is measured from the
<strong>centroid of the object to the centroid of the indexed object</strong>. This can
be unexpected if not all GeoJSON objects are points, but it is what the index
can actually provide.</p><p>Note that all these <code>FILTER GEO_DISTANCE(...)</code> queries can be combined with a
<code>SORT</code> clause on <code>GEO_DISTANCE()</code> (provided they use the same basis point),
resulting in a sequence of findings sorted by distance, but limited to the given
<code>GEO_DISTANCE()</code> boundaries.</p><h3 id=query-for-results-contained-in-polygon>Query for Results contained in Polygon <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#query-for-results-contained-in-polygon class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>A query which returns documents whose stored geometry is contained within a
GeoJSON Polygon.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>polygon</span> <span class=o>=</span> <span class=nf>GEO_POLYGON</span><span class=p>([[[</span><span class=mi>60</span><span class=p>,</span><span class=mi>35</span><span class=p>],[</span><span class=mi>50</span><span class=p>,</span><span class=mi>5</span><span class=p>],[</span><span class=mi>75</span><span class=p>,</span><span class=mi>10</span><span class=p>],[</span><span class=mi>70</span><span class=p>,</span><span class=mi>35</span><span class=p>],[</span><span class=mi>60</span><span class=p>,</span><span class=mi>35</span><span class=p>]]])</span>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>x</span> <span class=kr>IN</span> <span class=n>geo_collection</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>GEO_CONTAINS</span><span class=p>(</span><span class=n>polygon</span><span class=p>,</span> <span class=n>x</span><span class=p>.</span><span class=n>geometry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>x</span></span></span></code></pre></div><p>The first parameter of <code>GEO_CONTAINS()</code> must be a polygon. Other types
are not really sensible, since for example a point cannot contain other GeoJSON
objects than itself, and for others like lines, containment is not defined in a
numerically stable way. The second parameter must contain the document field on
that the index was created.</p><p>This <code>FILTER</code> clause can be combined with a <code>SORT</code> clause using <code>GEO_DISTANCE()</code>.</p><p>Note that containment in the opposite direction is currently not supported by
geo indexes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>polygon</span> <span class=o>=</span> <span class=nf>GEO_POLYGON</span><span class=p>([[[</span><span class=mi>60</span><span class=p>,</span><span class=mi>35</span><span class=p>],[</span><span class=mi>50</span><span class=p>,</span><span class=mi>5</span><span class=p>],[</span><span class=mi>75</span><span class=p>,</span><span class=mi>10</span><span class=p>],[</span><span class=mi>70</span><span class=p>,</span><span class=mi>35</span><span class=p>],[</span><span class=mi>60</span><span class=p>,</span><span class=mi>35</span><span class=p>]]])</span>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>x</span> <span class=kr>IN</span> <span class=n>geo_collection</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>GEO_CONTAINS</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>geometry</span><span class=p>,</span> <span class=n>polygon</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>x</span></span></span></code></pre></div><h3 id=query-for-results-intersecting-a-polygon>Query for Results Intersecting a Polygon <a href=/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes/#query-for-results-intersecting-a-polygon class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>A query that returns documents with an intersection of their stored
geometry and a GeoJSON Polygon.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>polygon</span> <span class=o>=</span> <span class=nf>GEO_POLYGON</span><span class=p>([[[</span><span class=mi>60</span><span class=p>,</span><span class=mi>35</span><span class=p>],[</span><span class=mi>50</span><span class=p>,</span><span class=mi>5</span><span class=p>],[</span><span class=mi>75</span><span class=p>,</span><span class=mi>10</span><span class=p>],[</span><span class=mi>70</span><span class=p>,</span><span class=mi>35</span><span class=p>],[</span><span class=mi>60</span><span class=p>,</span><span class=mi>35</span><span class=p>]]])</span>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>x</span> <span class=kr>IN</span> <span class=n>geo_collection</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>GEO_INTERSECTS</span><span class=p>(</span><span class=n>polygon</span><span class=p>,</span> <span class=n>x</span><span class=p>.</span><span class=n>geometry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>x</span></span></span></code></pre></div><p>The first parameter of <code>GEO_INTERSECTS()</code> is usually a polygon.</p><p>The second parameter must contain the document field on that the index
was created.</p><p>This <code>FILTER</code> clause can be combined with a <code>SORT</code> clause using <code>GEO_DISTANCE()</code>.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.10/index-and-search/indexing/working-with-indexes/multi-dimensional-indexes/><i class="fas fa-chevron-left fa-fw"></i><p>Multi-dimensional Indexes</p></a></span><span class=next><a class="nav nav-next link" href=/3.10/index-and-search/indexing/working-with-indexes/vertex-centric-indexes/><p>Vertex-Centric Indexes</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.10/index-and-search/indexing/working-with-indexes/geo-spatial-indexes.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#using-a-geo-spatial-index>Using a Geo-Spatial Index</a></div><div class=level-3><a href=#geojson-mode>GeoJSON Mode</a></div><div class=level-3><a href=#non-geojson-mode>Non-GeoJSON mode</a></div><div class=level-3><a href=#legacy-polygons>Legacy Polygons</a></div><div class=level-3><a href=#arangosh-examples><em>arangosh</em> Examples</a></div><div class=level-2><a href=#indexed-geospatial-queries>Indexed GeoSpatial Queries</a></div><div class=level-3><a href=#query-for-results-near-origin-near-type-query>Query for Results near Origin (NEAR type query)</a></div><div class=level-3><a href=#query-for-sorted-results-near-origin-near-type-query>Query for Sorted Results near Origin (NEAR type query)</a></div><div class=level-3><a href=#query-for-results-within-a-distance-range>Query for Results within a Distance Range</a></div><div class=level-3><a href=#query-for-results-contained-in-polygon>Query for Results contained in Polygon</a></div><div class=level-3><a href=#query-for-results-intersecting-a-polygon>Query for Results Intersecting a Polygon</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>