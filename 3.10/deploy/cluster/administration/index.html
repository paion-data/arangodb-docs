<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1747031427></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="ArangoDB is a scalable graph database system with native support for other data models and a built-in search engine, for the cloud and on-premises"><meta property="og:url" content="http://localhost/3.10/deploy/cluster/administration/"><meta property="og:title" content="Administrate ArangoDB cluster deployments"><meta property="og:type" content="website"><meta property="og:description" content="ArangoDB is a scalable graph database system with native support for other data models and a built-in search engine, for the cloud and on-premises"><meta name=docsearch:version content="3.10"><title>Administrate ArangoDB cluster deployments | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1747031427 defer></script>
<script src=/js/featherlight.min.js?1747031427 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1747031427 defer></script>
<script src=/js/theme.js?1747031427 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.10"><a itemprop=item class=link href=/3.10/><span itemprop=name class=breadcrumb-entry>3.10.14</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Deploy"><a itemprop=item class=link href=/3.10/deploy/><span itemprop=name class=breadcrumb-entry>Deploy</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Cluster"><a itemprop=item class=link href=/3.10/deploy/cluster/><span itemprop=name class=breadcrumb-entry>Cluster</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Administration"><a itemprop=item class=link href=/3.10/deploy/cluster/administration/><span itemprop=name class=breadcrumb-entry>Administration</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.10 reached End of Life (EOL) and is no longer supported.</p><p>This documentation is outdated. Please see the most recent <a href=/3.12/deploy/cluster/administration/ class=link>stable version</a>.</p></div></div></div></div><hgroup><h1>Administrate ArangoDB cluster deployments</h1></hgroup><p>This section includes information related to the administration of an ArangoDB Cluster.</p><p>For a general introduction to the ArangoDB Cluster, please refer to the
<a href=/3.10/deploy/cluster/ class=link>Cluster</a> chapter.</p><p>There is also a detailed
<a href=https://www.arangodb.com/learn/operations/cluster-course/ target=_blank rel="noopener noreferrer" class=link>Cluster Administration Course</a>&nbsp;<i class="fas fa-external-link-alt"></i>
for download.</p><h2 id=enabling-synchronous-replication>Enabling synchronous replication <a href=/3.10/deploy/cluster/administration/#enabling-synchronous-replication class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>For an introduction about <em>Synchronous Replication</em> in Cluster, please refer
to the <a href=/3.10/deploy/cluster/#synchronous-replication class=link><em>Cluster Architecture</em></a> section.</p><p>You can enable synchronous replication per <em>collection</em>. When you create a
<em>collection</em>, you may specify the number of <em>replicas</em> using the
<code>replicationFactor</code> parameter. You can also adjust it later. The default value
is set to <code>1</code>, which effectively <em>disables</em> synchronous replication among
<em>DB-Servers</em>.</p><div class="box notices cstyle tip"><div class=box-content-container><div class=box-content><i class="fas fa-check"></i><div class=box-text>The number of replicas includes the leader (the master copy) as well as all the
followers (redundancy copies). For example, a replication factor of <code>3</code> means
that there is one leader replica and two follower replicas, and that the data
exists three times in total.</div></div></div></div><p>Whenever you specify a <em>replication factor</em> greater than <code>1</code>, synchronous
replication is activated for this collection. The Cluster determines suitable
<em>leaders</em> and <em>followers</em> for every requested <em>shard</em> (<code>numberOfShards</code>) within
the Cluster.</p><p>An example of creating a collection in <em>arangosh</em> with a replication factor of
<code>3</code>, requiring three replicas to report success for any write operation in this
collection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;test&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=s2>&#34;replicationFactor&#34;</span><span class=o>:</span> <span class=mi>3</span> <span class=p>})</span></span></span></code></pre></div><p>The <code>replicationFactor</code> value can be between the minimum and maximum
replication factor (inclusive) as defined by the following startup options:</p><ul><li><a href=/3.10/components/arangodb-server/options/#--clustermin-replication-factor class=link><code>--cluster.min-replication-factor</code></a></li><li><a href=/3.10/components/arangodb-server/options/#--clustermax-replication-factor class=link><code>--cluster.max-replication-factor</code></a></li></ul><p>The default replication factor for regular and for system collections is defined
by the following startup options:</p><ul><li><a href=/3.10/components/arangodb-server/options/#--clusterdefault-replication-factor class=link><code>--cluster.default-replication-factor</code></a></li><li><a href=/3.10/components/arangodb-server/options/#--clustersystem-replication-factor class=link><code>--cluster.system-replication-factor</code></a></li></ul><h2 id=preparing-growth>Preparing growth <a href=/3.10/deploy/cluster/administration/#preparing-growth class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>You may create a <em>collection</em> with a higher <em>replication factor</em> than
available <em>DB-Servers</em>. When additional <em>DB-Servers</em> become available,
the <em>shards</em> are automatically replicated to the newly available <em>DB-Servers</em>.</p><p>You need to set the <code>enforceReplicationFactor</code> option to <code>false</code> when creating
a <em>collection</em> with a higher <em>replication factor</em> than available <em>DB-Servers</em>
(the default value is <code>true</code>). For example, in <em>arangosh</em> you can pass
a third argument to the <code>db._create()</code> method with this option:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;test&#34;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>replicationFactor</span><span class=o>:</span> <span class=mi>4</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>enforceReplicationFactor</span><span class=o>:</span> <span class=kc>false</span> <span class=p>});</span></span></span></code></pre></div><p>This option is not available in the web interface.</p><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>Multiple <em>replicas</em> of the same <em>shard</em> can never coexist on the same
<em>DB-Server</em> instance.</div></div></div></div><h2 id=sharding>Sharding <a href=/3.10/deploy/cluster/administration/#sharding class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>For an introduction about <em>Sharding</em> in Cluster, please refer to the
<a href=/3.10/deploy/architecture/data-sharding/ class=link><em>Cluster Sharding</em></a> section.</p><p>Number of <em>shards</em> can be configured at <em>collection</em> creation time, e.g. the UI,
or the <em>ArangoDB Shell</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;sharded_collection&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;numberOfShards&#34;</span><span class=o>:</span> <span class=mi>4</span><span class=p>});</span></span></span></code></pre></div><p>To configure a custom <em>hashing</em> for another attribute (default is _<em>key</em>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;sharded_collection&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;numberOfShards&#34;</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span> <span class=s2>&#34;shardKeys&#34;</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;country&#34;</span><span class=p>]});</span></span></span></code></pre></div><p>The example above, where &lsquo;country&rsquo; has been used as <em>shardKeys</em> can be useful
to keep data of every country in one shard, which would result in better
performance for queries working on a per country base.</p><p>It is also possible to specify multiple <code>shardKeys</code>.</p><p>Note however that if you change the shard keys from their default <code>["_key"]</code>,
then finding a document in the collection by its primary key involves a request
to every single shard. However this can be mitigated: All CRUD APIs and AQL
support taking the shard keys as a lookup hint. Just make sure that the shard
key attributes are present in the documents you send, or in case of AQL, that
you use a document reference or an object for the UPDATE, REPLACE or REMOVE
operation which includes the shard key attributes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>sharded_collection</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>_key</span> <span class=o>==</span> <span class=s2>&#34;123&#34;</span>
</span></span><span class=line><span class=cl>  <span class=kr>UPDATE</span> <span class=n>doc</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=err>…</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>sharded_collection</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>UPDATE</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=s2>&#34;123&#34;</span><span class=p>,</span> <span class=n>country</span><span class=o>:</span> <span class=s2>&#34;…&#34;</span> <span class=p>}</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=err>…</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>sharded_collection</span></span></span></code></pre></div><p>Using a string with just the document key as key expression instead is
processed without shard hints and thus perform slower:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>UPDATE</span> <span class=s2>&#34;123&#34;</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=err>…</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>sharded_collection</span></span></span></code></pre></div><p>If custom shard keys are used, you can no longer specify the primary key value
for a new document, but must let the server generate one automatically. This
restriction comes from the fact that ensuring uniqueness of the primary key
would be very inefficient if the user could specify the document key.
If custom shard keys are used, trying to store documents with the primary key value
(<code>_key</code> attribute) set results in a runtime error (&ldquo;must not specify _key
for this collection&rdquo;).</p><p>Unique indexes on sharded collections are only allowed if the fields used to
determine the shard key are also included in the list of attribute paths for the index:</p><table><thead><tr><th style=text-align:right>shardKeys</th><th style=text-align:right>indexKeys</th><th style=text-align:right></th></tr></thead><tbody><tr><td style=text-align:right>a</td><td style=text-align:right>a</td><td style=text-align:right>allowed</td></tr><tr><td style=text-align:right>a</td><td style=text-align:right>b</td><td style=text-align:right>not allowed</td></tr><tr><td style=text-align:right>a</td><td style=text-align:right>a, b</td><td style=text-align:right>allowed</td></tr><tr><td style=text-align:right>a, b</td><td style=text-align:right>a</td><td style=text-align:right>not allowed</td></tr><tr><td style=text-align:right>a, b</td><td style=text-align:right>b</td><td style=text-align:right>not allowed</td></tr><tr><td style=text-align:right>a, b</td><td style=text-align:right>a, b</td><td style=text-align:right>allowed</td></tr><tr><td style=text-align:right>a, b</td><td style=text-align:right>a, b, c</td><td style=text-align:right>allowed</td></tr><tr><td style=text-align:right>a, b, c</td><td style=text-align:right>a, b</td><td style=text-align:right>not allowed</td></tr><tr><td style=text-align:right>a, b, c</td><td style=text-align:right>a, b, c</td><td style=text-align:right>allowed</td></tr></tbody></table><p>On which DB-Server in a Cluster a particular <em>shard</em> is kept is undefined.
There is no option to configure an affinity based on certain <em>shard</em> keys.</p><h2 id=sharding-strategy>Sharding strategy <a href=/3.10/deploy/cluster/administration/#sharding-strategy class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Strategy to use for the collection. There are
different sharding strategies to select from when creating a new
collection. The selected <code>shardingStrategy</code> value remains
fixed for the collection and cannot be changed afterwards. This is
important to make the collection keep its sharding settings and
always find documents already distributed to shards using the same
initial sharding algorithm.</p><p>The available sharding strategies are:</p><ul><li><code>community-compat</code>: default sharding used by ArangoDB
Community Edition before version 3.4</li><li><code>enterprise-compat</code>: default sharding used by ArangoDB
Enterprise Edition before version 3.4</li><li><code>enterprise-smart-edge-compat</code>: default sharding used by smart edge
collections in ArangoDB Enterprise Edition before version 3.4</li><li><code>hash</code>: default sharding used for new collections starting from version 3.4
(excluding smart edge collections)</li><li><code>enterprise-hash-smart-edge</code>: default sharding used for new
smart edge collections starting from version 3.4</li><li><code>enterprise-hex-smart-vertex</code>: sharding used for vertex collections of
EnterpriseGraphs</li></ul><p>If no sharding strategy is specified, the default is <code>hash</code> for
all normal collections, <code>enterprise-hash-smart-edge</code> for all smart edge
collections, and <code>enterprise-hex-smart-vertex</code> for EnterpriseGraph
vertex collections (the latter two require the Enterprise Edition of ArangoDB).
Manually overriding the sharding strategy does not yet provide a
benefit, but it may later in case other sharding strategies are added.</p><p>The <a href=/3.10/deploy/oneshard/ class=link>OneShard</a>
feature does not have its own sharding strategy, it uses <code>hash</code> instead.</p><h2 id=movingrebalancing-shards>Moving/Rebalancing <em>shards</em> <a href=/3.10/deploy/cluster/administration/#movingrebalancing-shards class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Rebalancing redistributes resources in the cluster to optimize resource
allocation - shards and location of leaders/followers.</p><p>It aims to achieve, for example, a balanced load, fair shard distribution,
and resiliency.</p><p>Rebalancing might occur, amongst other scenarios, when:</p><ul><li>There is a change in the number of nodes in the cluster and more (or fewer)
resources are available to the cluster.</li><li>There is a detectable imbalance in the distribution of shards
(i.e. specific nodes holding high number of shards while others don’t) or in
the distribution of leaders/followers across the nodes, resulting in
computational imbalance on the nodes.</li><li>There are changes in the number or size of data collections.</li></ul><p>A <em>shard</em> can be moved from a <em>DB-Server</em> to another, and the entire shard distribution
can be rebalanced using the corresponding buttons in the web <a href=/3.10/components/web-interface/cluster/ class=link>UI</a>.</p><p>You can also do any of the following by using the API:</p><ul><li>Calculate the current cluster imbalance.</li><li>Compute a set of move shard operations to improve balance.</li><li>Execute the given set of move shard operations.</li><li>Compute a set of move shard operations to improve balance and immediately execute them.</li></ul><p>For more information, see the <a href=/3.10/develop/http-api/cluster/#get-the-current-cluster-imbalance class=link>Cluster</a>
section of the HTTP API documentation.</p><h2 id=replacingremoving-a-coordinator>Replacing/Removing a <em>Coordinator</em> <a href=/3.10/deploy/cluster/administration/#replacingremoving-a-coordinator class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><em>Coordinators</em> are effectively stateless and can be replaced, added and
removed without more consideration than meeting the necessities of the
particular installation.</p><p>To take out a <em>Coordinator</em> stop the
<em>Coordinator</em>&rsquo;s instance by issuing <code>kill -SIGTERM &lt;pid></code>.</p><p>About 15 seconds later, the cluster UI on any other <em>Coordinator</em> marks
the <em>Coordinator</em> in question as failed. Almost simultaneously, the recycle bin
icon appears to the right of the name of the <em>Coordinator</em>. Clicking
that icon removes the <em>Coordinator</em> from the Coordinator registry.</p><p>Any new <em>Coordinator</em> instance that is informed of where to find any/all
Agent(s), <code>--cluster.agency-endpoint</code> <code>&lt;some agent endpoint></code> is
integrated as a new <em>Coordinator</em> into the cluster. You may also just
restart the <em>Coordinator</em> as before and it reintegrates itself into
the cluster.</p><h2 id=replacingremoving-a-db-server>Replacing/Removing a <em>DB-Server</em> <a href=/3.10/deploy/cluster/administration/#replacingremoving-a-db-server class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p><em>DB-Servers</em> are where the data of an ArangoDB cluster is stored. They
do not publish a web interface and are not meant to be accessed by any other
entity than <em>Coordinators</em> to perform client requests or other <em>DB-Servers</em>
to uphold replication and resilience.</p><p>The clean way of removing a <em>DB-Server</em> is to first relieve it of all
its responsibilities for shards. This applies to <em>followers</em> as well as
<em>leaders</em> of shards. The requirement for this operation is that no
collection in any of the databases has a <code>replicationFactor</code> greater than
the current number of <em>DB-Servers</em> minus one. In other words, the highest
replication factor must not exceed the future <em>DB-Server</em> count. To clean
out <code>DBServer004</code>, for example, you can issue the following command to
any <em>Coordinator</em> in the cluster:</p><p><code>curl &lt;coord-ip:coord-port>/_admin/cluster/cleanOutServer -d '{"server":"DBServer004"}'</code></p><p>After the <em>DB-Server</em> has been cleaned out, you find the recycle bin
icon to the right of the name of the <em>DB-Server</em> on any <em>Coordinators</em>&rsquo;
UI. Clicking it removes the <em>DB-Server</em> in question from the
cluster.</p><p>Firing up any <em>DB-Server</em> from a clean data directory, while specifying any
of the available Agency endpoints, integrates the new <em>DB-Server</em> into the
cluster.</p><p>To distribute shards onto the new <em>DB-Server</em>, go to the <strong>Rebalance Shards</strong>
tab in the <strong>NODES</strong> page of the web interface and click the
<strong>Rebalance Shards</strong> button.</p><p>The clean out process can be monitored using the following script,
which periodically prints the amount of shards that still need to be moved.
It is basically a countdown to when the process finishes.</p><p>Save the code below to a file named <code>serverCleanMonitor.js</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>dblist</span> <span class=o>=</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_databases</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>internal</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;internal&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>arango</span> <span class=o>=</span> <span class=nx>internal</span><span class=p>.</span><span class=nx>arango</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>server</span> <span class=o>=</span> <span class=nx>ARGUMENTS</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>sleep</span> <span class=o>=</span> <span class=nx>ARGUMENTS</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>|</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>server</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>print</span><span class=p>(</span><span class=s2>&#34;\nNo server name specified. Provide it like:\n\narangosh &lt;options&gt; -- DBServerXXXX&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>sleep</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=nx>sleep</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Checking shard distribution every %d seconds...&#34;</span><span class=p>,</span> <span class=nx>sleep</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=nx>dbase</span> <span class=k>in</span> <span class=nx>dblist</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>sd</span> <span class=o>=</span> <span class=nx>arango</span><span class=p>.</span><span class=nx>GET</span><span class=p>(</span><span class=s2>&#34;/_db/&#34;</span> <span class=o>+</span> <span class=nx>dblist</span><span class=p>[</span><span class=nx>dbase</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;/_admin/cluster/shardDistribution&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>collections</span> <span class=o>=</span> <span class=nx>sd</span><span class=p>.</span><span class=nx>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=nx>collection</span> <span class=k>in</span> <span class=nx>collections</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>current</span> <span class=o>=</span> <span class=nx>collections</span><span class=p>[</span><span class=nx>collection</span><span class=p>].</span><span class=nx>Current</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=nx>shard</span> <span class=k>in</span> <span class=nx>current</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>current</span><span class=p>[</span><span class=nx>shard</span><span class=p>].</span><span class=nx>leader</span> <span class=o>==</span> <span class=nx>server</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>++</span><span class=nx>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Shards to be moved away from node %s: %d&#34;</span><span class=p>,</span> <span class=nx>server</span><span class=p>,</span> <span class=nx>count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>count</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>internal</span><span class=p>.</span><span class=nx>wait</span><span class=p>(</span><span class=nx>sleep</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=nx>count</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>);</span></span></span></code></pre></div><p>This script has to be executed in <a href=/3.10/components/tools/arangodb-shell/ class=link><code>arangosh</code></a>
by issuing the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>arangosh --server.username &lt;username&gt; --server.password &lt;password&gt; --javascript.execute &lt;path/to/serverCleanMonitor.js&gt; -- DBServer&lt;number&gt;
</span></span></code></pre></div><p>The output should be similar to the one below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>arangosh --server.username root --server.password pass --javascript.execute ~./serverCleanMonitor.js -- DBServer0002
</span></span><span class=line><span class=cl><span class=o>[</span>7836<span class=o>]</span> INFO Checking shard distribution every <span class=m>10</span> seconds...
</span></span><span class=line><span class=cl><span class=o>[</span>7836<span class=o>]</span> INFO Shards to be moved away from node DBServer0002: <span class=m>9</span>
</span></span><span class=line><span class=cl><span class=o>[</span>7836<span class=o>]</span> INFO Shards to be moved away from node DBServer0002: <span class=m>4</span>
</span></span><span class=line><span class=cl><span class=o>[</span>7836<span class=o>]</span> INFO Shards to be moved away from node DBServer0002: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>[</span>7836<span class=o>]</span> INFO Shards to be moved away from node DBServer0002: <span class=m>0</span>
</span></span></code></pre></div><p>The current status is logged every 10 seconds. You may adjust the
interval by passing a number after the DB-Server name, e.g.
<code>arangosh &lt;options> -- DBServer0002 60</code> for every 60 seconds.</p><p>Once the count is <code>0</code>, all shards of the underlying DB-Server have been moved
and the <code>cleanOutServer</code> process has finished.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.10/deploy/cluster/deployment/><i class="fas fa-chevron-left fa-fw"></i><p>Deployment</p></a></span><span class=next><a class="nav nav-next link" href=/3.10/deploy/cluster/limitations/><p>Limitations</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.10/deploy/cluster/administration.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#enabling-synchronous-replication>Enabling synchronous replication</a></div><div class=level-2><a href=#preparing-growth>Preparing growth</a></div><div class=level-2><a href=#sharding>Sharding</a></div><div class=level-2><a href=#sharding-strategy>Sharding strategy</a></div><div class=level-2><a href=#movingrebalancing-shards>Moving/Rebalancing <em>shards</em></a></div><div class=level-2><a href=#replacingremoving-a-coordinator>Replacing/Removing a <em>Coordinator</em></a></div><div class=level-2><a href=#replacingremoving-a-db-server>Replacing/Removing a <em>DB-Server</em></a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>