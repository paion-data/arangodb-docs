<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743775370></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="ArangoDB can divide collections into multiple shards to distribute the data across multiple cluster nodes"><meta property="og:url" content="http://localhost/3.10/deploy/architecture/data-sharding/"><meta property="og:title" content="Sharding"><meta property="og:type" content="website"><meta property="og:description" content="ArangoDB can divide collections into multiple shards to distribute the data across multiple cluster nodes"><meta name=docsearch:version content="3.10"><title>Sharding | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743775370 defer></script>
<script src=/js/featherlight.min.js?1743775370 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743775370 defer></script>
<script src=/js/theme.js?1743775370 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.10"><a itemprop=item class=link href=/3.10/><span itemprop=name class=breadcrumb-entry>3.10.14</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Deploy"><a itemprop=item class=link href=/3.10/deploy/><span itemprop=name class=breadcrumb-entry>Deploy</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Architecture"><a itemprop=item class=link href=/3.10/deploy/architecture/><span itemprop=name class=breadcrumb-entry>Architecture</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Data Sharding"><a itemprop=item class=link href=/3.10/deploy/architecture/data-sharding/><span itemprop=name class=breadcrumb-entry>Data Sharding</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.10 reached End of Life (EOL) and is no longer supported.</p><p>This documentation is outdated. Please see the most recent <a href=/3.12/deploy/architecture/data-sharding/ class=link>stable version</a>.</p></div></div></div></div><hgroup><h1>Sharding</h1><p class=lead>ArangoDB can divide collections into multiple shards to distribute the data across multiple cluster nodes</p></hgroup><p>ArangoDB organizes its collection data in <em>shards</em>. Sharding allows to use
multiple machines to run a cluster of ArangoDB instances that together
constitute a single database system.</p><p>Sharding is used to distribute data across physical machines in an ArangoDB
Cluster. It is a method to determine the optimal placement of documents on
individual DB-Servers.</p><p>This enables you to store much more data, since ArangoDB distributes the data
automatically to the different servers. In many situations one can also reap a
benefit in data throughput, again because the load can be distributed to
multiple machines.</p><p>Using sharding allows ArangoDB to support deployments with large amounts of
data, which would not fit on a single machine. A high rate of write / read
operations or AQL queries can also overwhelm a single servers RAM and disk
capacity.</p><p>There are two main ways of scaling a database system:</p><ul><li>Vertical scaling</li><li>Horizontal scaling</li></ul><p>Vertical scaling scaling means to upgrade to better server hardware (faster
CPU, more RAM / disk). This can be a cost effective way of scaling, because
administration is easy and performance characteristics do not change much.
Reasoning about the behavior of a single machine is also a lot easier than
having multiple machines. However at a certain point larger machines are either
not available anymore or the cost becomes prohibitive.</p><p>Horizontal scaling is about increasing the number of servers. Servers typically
being based on commodity hardware, which is readily available from many
different Cloud providers. The capability of each single machine may not be
high, but the combined the computing power of these machines can be arbitrarily
large. Adding more machines on-demand is also typically easier and more
cost-effective than pre-provisioning a single large machine. Increased
complexity in infrastructure can be managed using modern containerization and
cluster orchestrations tools like <a href=/3.10/deploy/kubernetes/ class=link>Kubernetes</a>.</p><p><figure class=image-caption><img alt="Cluster Sharding" src=/images/cluster_sharding.jpg><figcaption></figcaption></figure></p><p>To achieve this ArangoDB splits your dataset into so called <em>shards</em>. The number
of shards is something you may choose according to your needs. Proper sharding
is essential to achieve optimal performance. From the outside the process of
splitting the data and assembling it again is fully transparent and as such we
achieve the goals of what other systems call &ldquo;master-master replication&rdquo;.</p><p>An application may talk to any <em>Coordinator</em> and it automatically figures
out where the data is currently stored when reading or is to be stored
when writing. The information about the <em>shards</em> is shared across all
<em>Coordinators</em> using the <em>Agency</em>.</p><p><em>Shards</em> are configured per <em>collection</em> so multiple <em>shards</em> of data form the
<em>collection</em> as a whole. To determine in which <em>shard</em> the data is to be stored
ArangoDB performs a hash across the values. By default this hash is being
created from the <code>_key</code> document attribute.</p><p>Every shard is a local collection on any <em>DB-Server</em>, that houses such a shard
as depicted above for our example with 5 shards and 3 replicas. Here, every
leading shard <em>S1</em> through <em>S5</em> is followed each by 2 replicas <em>R1</em> through <em>R5</em>.
The collection creation mechanism on ArangoDB <em>Coordinators</em> tries to best
distribute the shards of a collection among the <em>DB-Servers</em>. This seems to
suggest, that one shards the data in 5 parts, to make best use of all our
machines. We further choose a replication factor of 3 as it is a reasonable
compromise between performance and data safety. This means, that the collection
creation ideally distributes 15 shards, 5 of which are leaders to each 2
replicas. This in turn implies, that a complete pristine replication would
involve 10 shards which need to catch up with their leaders.</p><p>Not all use cases require horizontal scalability. In such cases, consider the
<a href=/3.10/deploy/oneshard/ class=link>OneShard</a> feature as alternative to flexible sharding.</p><h2 id=shard-keys>Shard Keys <a href=/3.10/deploy/architecture/data-sharding/#shard-keys class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>ArangoDB uses the specified <em>shard key</em> attributes to determine in which shard
a given document is to be stored. Choosing the right shard key can have
significant impact on your performance can reduce network traffic and increase
performance.</p><p><figure class=image-caption><img alt="Hash Sharding" src=/images/cluster_sharding_hash.jpg><figcaption></figcaption></figure></p><p>ArangoDB uses consistent hashing to compute the target shard from the given
values (as specified via by the <code>shardKeys</code> collection property). The ideal set
of shard keys allows ArangoDB to distribute documents evenly across your shards
and your <em>DB-Servers</em>. By default ArangoDB uses the <code>_key</code> field as a shard key.
For a custom shard key you should consider a few different properties:</p><ul><li><p><strong>Cardinality</strong>: The cardinality of a set is the number of distinct values
that it contains. A shard key with only <em>N</em> distinct values cannot be hashed
onto more than <em>N</em> shards. Consider using multiple shard keys, if one of your
values has a low cardinality.</p></li><li><p><strong>Frequency</strong>: Consider how often a given shard key value may appear in
your data. Having a lot of documents with identical shard keys leads
to unevenly distributed data.</p></li></ul><p>This means that a single shard could become a bottleneck in your cluster.
The effectiveness of horizontal scaling is reduced if most documents end up in
a single shard. Shards are not divisible at this time, so paying attention to
the size of shards is important.</p><p>Consider both frequency and cardinality when picking a shard key, if necessary
consider picking multiple shard keys.</p><h3 id=configuring-shards>Configuring Shards <a href=/3.10/deploy/architecture/data-sharding/#configuring-shards class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The number of <em>shards</em> can be configured at collection creation time, e.g. in
the web interface or via <em>arangosh</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;sharded_collection&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;numberOfShards&#34;</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span> <span class=s2>&#34;shardKeys&#34;</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;country&#34;</span><span class=p>]});</span></span></span></code></pre></div><p>The example above, where <code>country</code> has been used as <em>shardKeys</em> can be useful
to keep data of every country in one shard, which would result in better
performance for queries working on a per country base.</p><p>It is also possible to specify multiple <code>shardKeys</code>.</p><p>Note however that if you change the shard keys from their default <code>["_key"]</code>,
then finding a document in the collection by its primary key involves a request
to every single shard. However this can be mitigated: All CRUD APIs and AQL
support using the shard key values as a lookup hints. Just send them as part
of the update / replace or removal operation, or in case of AQL, that
you use a document reference or an object for the UPDATE, REPLACE or REMOVE
operation which includes the shard key attributes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>UPDATE</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=s2>&#34;123&#34;</span><span class=p>,</span> <span class=n>country</span><span class=o>:</span> <span class=s2>&#34;…&#34;</span> <span class=p>}</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=err>…</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>sharded_collection</span></span></span></code></pre></div><p>If custom shard keys are used, one can no longer prescribe the primary key value of
a new document but must use the automatically generated one. This latter
restriction comes from the fact that ensuring uniqueness of the primary key
would be very inefficient if the user could specify the primary key.</p><p>On which DB-Server in a Cluster a particular <em>shard</em> is kept is undefined.
There is no option to configure an affinity based on certain <em>shard</em> keys.</p><p>For more information on shard rebalancing and administration topics please have
a look in the <a href=/3.10/deploy/cluster/administration/ class=link>Cluster Administration</a> section.</p><h3 id=indexes-on-shards>Indexes On Shards <a href=/3.10/deploy/architecture/data-sharding/#indexes-on-shards class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Unique indexes on sharded collections are only allowed if the fields used to
determine the shard key are also included in the list of attribute paths for the index:</p><table><thead><tr><th style=text-align:right>shardKeys</th><th style=text-align:right>indexKeys</th><th style=text-align:right></th></tr></thead><tbody><tr><td style=text-align:right>a</td><td style=text-align:right>a</td><td style=text-align:right>allowed</td></tr><tr><td style=text-align:right>a</td><td style=text-align:right>b</td><td style=text-align:right>not allowed</td></tr><tr><td style=text-align:right>a</td><td style=text-align:right>a, b</td><td style=text-align:right>allowed</td></tr><tr><td style=text-align:right>a, b</td><td style=text-align:right>a</td><td style=text-align:right>not allowed</td></tr><tr><td style=text-align:right>a, b</td><td style=text-align:right>b</td><td style=text-align:right>not allowed</td></tr><tr><td style=text-align:right>a, b</td><td style=text-align:right>a, b</td><td style=text-align:right>allowed</td></tr><tr><td style=text-align:right>a, b</td><td style=text-align:right>a, b, c</td><td style=text-align:right>allowed</td></tr><tr><td style=text-align:right>a, b, c</td><td style=text-align:right>a, b</td><td style=text-align:right>not allowed</td></tr><tr><td style=text-align:right>a, b, c</td><td style=text-align:right>a, b, c</td><td style=text-align:right>allowed</td></tr></tbody></table><h2 id=high-availability>High Availability <a href=/3.10/deploy/architecture/data-sharding/#high-availability class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>A cluster can still read from a collection if shards become unavailable for
some reason. The data residing on the unavailable shard cannot be accessed,
but reads on other shards can still succeed.</p><p>If you enable data redundancy by setting a replication factor of <code>2</code> or higher
for a collection, the collection data remains fully available for reading as
long as at least one replica of every shard is available.
In a production environment, you should always deploy your collections with a
<code>replicationFactor</code> greater than <code>1</code> to ensure that the shards stay available
even when a machine fails.</p><p>Collection data also remains available for writing as long as a replica of every
shard is available. You can optionally increase the write concern to require a
higher number of in-sync shard replicas for writes. The <code>writeConcern</code> can be
as high as the <code>replicationFactor</code>.</p><h2 id=storage-capacity>Storage Capacity <a href=/3.10/deploy/architecture/data-sharding/#storage-capacity class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The cluster distributes your data across multiple machines in your cluster.
Every machine only contains a subset of your data. Thus, the cluster has
the combined storage capacity of all your machines.</p><p>Please note that increasing the replication factor also increases the space
required to keep all your data in the cluster.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.10/deploy/architecture/scalability/><i class="fas fa-chevron-left fa-fw"></i><p>Scalability</p></a></span><span class=next><a class="nav nav-next link" href=/3.10/deploy/architecture/replication/><p>Replication</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.10/deploy/architecture/data-sharding.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#shard-keys>Shard Keys</a></div><div class=level-3><a href=#configuring-shards>Configuring Shards</a></div><div class=level-3><a href=#indexes-on-shards>Indexes On Shards</a></div><div class=level-2><a href=#high-availability>High Availability</a></div><div class=level-2><a href=#storage-capacity>Storage Capacity</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>