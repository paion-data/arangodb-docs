<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1747031427></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="The PyG Adapter exports Graphs from ArangoDB into PyTorch Geometric (PyG), a PyTorch-based Graph Neural Network library, and vice-versa"><meta property="og:url" content="http://localhost/3.13/data-science/adapters/arangodb-pyg-adapter/"><meta property="og:title" content="PyTorch Geometric (PyG) Adapter"><meta property="og:type" content="website"><meta property="og:description" content="The PyG Adapter exports Graphs from ArangoDB into PyTorch Geometric (PyG), a PyTorch-based Graph Neural Network library, and vice-versa"><meta name=docsearch:version content="3.13"><title>PyTorch Geometric (PyG) Adapter | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1747031427 defer></script>
<script src=/js/featherlight.min.js?1747031427 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1747031427 defer></script>
<script src=/js/theme.js?1747031427 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.13"><a itemprop=item class=link href=/3.13/><span itemprop=name class=breadcrumb-entry>3.13.0</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Data Science"><a itemprop=item class=link href=/3.13/data-science/><span itemprop=name class=breadcrumb-entry>Data Science</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Adapters"><a itemprop=item class=link href=/3.13/data-science/adapters/><span itemprop=name class=breadcrumb-entry>Adapters</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="PyG"><a itemprop=item class=link href=/3.13/data-science/adapters/arangodb-pyg-adapter/><span itemprop=name class=breadcrumb-entry>PyG</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.13 is under development and not released yet.
This documentation is not final and potentially incomplete.</p></div></div></div></div><hgroup><h1>PyTorch Geometric (PyG) Adapter</h1><p class=lead>The PyG Adapter exports Graphs from ArangoDB into PyTorch Geometric (PyG), a PyTorch-based Graph Neural Network library, and vice-versa</p></hgroup><p>PyTorch Geometric (PyG) is a library built upon <a href=https://pytorch.org/ target=_blank rel="noopener noreferrer" class=link>PyTorch</a>&nbsp;<i class="fas fa-external-link-alt"></i>
to easily write and train Graph Neural Networks (GNNs) for a wide range of
applications related to structured data.</p><p>It consists of various methods for deep learning on graphs and other irregular structures,
also known as <a href=https://geometricdeeplearning.com/ target=_blank rel="noopener noreferrer" class=link>geometric deep learning</a>&nbsp;<i class="fas fa-external-link-alt"></i>,
from a variety of published papers. In addition, it consists of easy-to-use
mini-batch loaders for operating on many small and single giant graphs,
<a href=https://github.com/pyg-team/pytorch_geometric/tree/master/examples/multi_gpu target=_blank rel="noopener noreferrer" class=link>multi GPU-support</a>&nbsp;<i class="fas fa-external-link-alt"></i>,
<a href=https://github.com/pyg-team/pytorch_geometric/blob/master/examples/datapipe.py target=_blank rel="noopener noreferrer" class=link><code>DataPipe</code> support</a>&nbsp;<i class="fas fa-external-link-alt"></i>,
distributed graph learning via <a href=https://github.com/pyg-team/pytorch_geometric/tree/master/examples/quiver target=_blank rel="noopener noreferrer" class=link>Quiver</a>&nbsp;<i class="fas fa-external-link-alt"></i>,
a large number of common benchmark datasets (based on simple interfaces to create your own),
the <a href=https://pytorch-geometric.readthedocs.io/en/latest/notes/graphgym.html target=_blank rel="noopener noreferrer" class=link>GraphGym</a>&nbsp;<i class="fas fa-external-link-alt"></i>
experiment manager, and helpful transforms, both for learning on arbitrary
graphs as well as on 3D meshes or point clouds.</p><h2 id=resources>Resources <a href=/3.13/data-science/adapters/arangodb-pyg-adapter/#resources class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The <a href=https://github.com/arangoml/pyg-adapter target=_blank rel="noopener noreferrer" class=link>PyG Adapter repository</a>&nbsp;<i class="fas fa-external-link-alt"></i>
is available on Github. Check it out!</p><h2 id=installation>Installation <a href=/3.13/data-science/adapters/arangodb-pyg-adapter/#installation class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>To install the latest release of the PyG Adapter,
run the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install torch
</span></span><span class=line><span class=cl>pip install adbpyg-adapter
</span></span></code></pre></div><h2 id=quickstart>Quickstart <a href=/3.13/data-science/adapters/arangodb-pyg-adapter/#quickstart class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The following examples show how to get started with the PyG Adapter.
Check also the
<a href=https://colab.research.google.com/github/arangoml/pyg-adapter/blob/master/examples/ArangoDB_PyG_Adapter.ipynb target=_blank rel="noopener noreferrer" class=link>interactive tutorial</a>&nbsp;<i class="fas fa-external-link-alt"></i>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>torch</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>torch_geometric.datasets</span> <span class=kn>import</span> <span class=n>FakeHeteroDataset</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>arango</span> <span class=kn>import</span> <span class=n>ArangoClient</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>adbpyg_adapter</span> <span class=kn>import</span> <span class=n>ADBPyG_Adapter</span><span class=p>,</span> <span class=n>ADBPyG_Controller</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>adbpyg_adapter.encoders</span> <span class=kn>import</span> <span class=n>IdentityEncoder</span><span class=p>,</span> <span class=n>CategoricalEncoder</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Connect to ArangoDB</span>
</span></span><span class=line><span class=cl><span class=n>db</span> <span class=o>=</span> <span class=n>ArangoClient</span><span class=p>()</span><span class=o>.</span><span class=n>db</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Instantiate the adapter</span>
</span></span><span class=line><span class=cl><span class=n>adbpyg_adapter</span> <span class=o>=</span> <span class=n>ADBPyG_Adapter</span><span class=p>(</span><span class=n>db</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create a PyG Heterogeneous Graph</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>FakeHeteroDataset</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>num_node_types</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>num_edge_types</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>avg_num_nodes</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>avg_num_channels</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>  <span class=c1># avg number of features per node</span>
</span></span><span class=line><span class=cl>    <span class=n>edge_dim</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>  <span class=c1># number of features per edge</span>
</span></span><span class=line><span class=cl>    <span class=n>num_classes</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>  <span class=c1># number of unique label values</span>
</span></span><span class=line><span class=cl><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span></code></pre></div><h3 id=pyg-to-arangodb>PyG to ArangoDB <a href=/3.13/data-science/adapters/arangodb-pyg-adapter/#pyg-to-arangodb class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Note: If the PyG graph contains <code>_key</code>, <code>_v_key</code>, or <code>_e_key</code> properties for any node / edge types, the adapter will assume to persist those values as <a href=https://www.arangodb.com/docs/stable/data-modeling-naming-conventions-document-keys.html target=_blank rel="noopener noreferrer" class=link>ArangoDB document keys</a>&nbsp;<i class="fas fa-external-link-alt"></i>. See the <code>Full Cycle (ArangoDB -> PyG -> ArangoDB)</code> section below for an example.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1>#############################</span>
</span></span><span class=line><span class=cl><span class=c1># 1.1: without a  Metagraph #</span>
</span></span><span class=line><span class=cl><span class=c1>#############################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>adb_g</span> <span class=o>=</span> <span class=n>adbpyg_adapter</span><span class=o>.</span><span class=n>pyg_to_arangodb</span><span class=p>(</span><span class=s2>&#34;FakeData&#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#########################</span>
</span></span><span class=line><span class=cl><span class=c1># 1.2: with a Metagraph #</span>
</span></span><span class=line><span class=cl><span class=c1>#########################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Specifying a Metagraph provides customized adapter behavior</span>
</span></span><span class=line><span class=cl><span class=n>metagraph</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;nodeTypes&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;v0&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;x&#34;</span><span class=p>:</span> <span class=s2>&#34;features&#34;</span><span class=p>,</span>  <span class=c1># 1) You can specify a string value if you want to rename your PyG data when stored in ArangoDB</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;y&#34;</span><span class=p>:</span> <span class=n>y_tensor_to_2_column_dataframe</span><span class=p>,</span>  <span class=c1># 2) you can specify a function for user-defined handling, as long as the function returns a Pandas DataFrame</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=c1># 3) You can specify set of strings if you want to preserve the same PyG attribute names for the node/edge type</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;v1&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;x&#34;</span><span class=p>}</span> <span class=c1># this is equivalent to {&#34;x&#34;: &#34;x&#34;}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;edgeTypes&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;v0&#34;</span><span class=p>,</span> <span class=s2>&#34;e0&#34;</span><span class=p>,</span> <span class=s2>&#34;v0&#34;</span><span class=p>):</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1># 4) You can specify a list of strings for tensor dissasembly (if you know the number of node/edge features in advance)</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;edge_attr&#34;</span><span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;a&#34;</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>]</span>  
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>y_tensor_to_2_column_dataframe</span><span class=p>(</span><span class=n>pyg_tensor</span><span class=p>:</span> <span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>,</span> <span class=n>adb_df</span><span class=p>:</span> <span class=n>pandas</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pandas</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;A user-defined function to create two
</span></span></span><span class=line><span class=cl><span class=s2>    ArangoDB attributes out of the &#39;user&#39; label tensor
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    :param pyg_tensor: The PyG Tensor containing the data
</span></span></span><span class=line><span class=cl><span class=s2>    :type pyg_tensor: torch.Tensor
</span></span></span><span class=line><span class=cl><span class=s2>    :param adb_df: The ArangoDB DataFrame to populate, whose
</span></span></span><span class=line><span class=cl><span class=s2>        size is preset to the length of **pyg_tensor**.
</span></span></span><span class=line><span class=cl><span class=s2>    :type adb_df: pandas.DataFrame
</span></span></span><span class=line><span class=cl><span class=s2>    :return: The populated ArangoDB DataFrame
</span></span></span><span class=line><span class=cl><span class=s2>    :rtype: pandas.DataFrame
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>label_map</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>:</span> <span class=s2>&#34;Kiwi&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>:</span> <span class=s2>&#34;Blueberry&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>:</span> <span class=s2>&#34;Avocado&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>adb_df</span><span class=p>[</span><span class=s2>&#34;label_num&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pyg_tensor</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>adb_df</span><span class=p>[</span><span class=s2>&#34;label_str&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>adb_df</span><span class=p>[</span><span class=s2>&#34;label_num&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>label_map</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>adb_df</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>adb_g</span> <span class=o>=</span> <span class=n>adbpyg_adapter</span><span class=o>.</span><span class=n>pyg_to_arangodb</span><span class=p>(</span><span class=s2>&#34;FakeData&#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>metagraph</span><span class=p>,</span> <span class=n>explicit_metagraph</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#######################################################</span>
</span></span><span class=line><span class=cl><span class=c1># 1.3: with a Metagraph and `explicit_metagraph=True` #</span>
</span></span><span class=line><span class=cl><span class=c1>#######################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># With `explicit_metagraph=True`, the node &amp; edge types omitted from the metagraph will NOT be converted to ArangoDB.</span>
</span></span><span class=line><span class=cl><span class=n>adb_g</span> <span class=o>=</span> <span class=n>adbpyg_adapter</span><span class=o>.</span><span class=n>pyg_to_arangodb</span><span class=p>(</span><span class=s2>&#34;FakeData&#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>metagraph</span><span class=p>,</span> <span class=n>explicit_metagraph</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>########################################</span>
</span></span><span class=line><span class=cl><span class=c1># 1.4: with a custom ADBPyG Controller #</span>
</span></span><span class=line><span class=cl><span class=c1>########################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Custom_ADBPyG_Controller</span><span class=p>(</span><span class=n>ADBPyG_Controller</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_prepare_pyg_node</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>pyg_node</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>node_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Optionally modify a PyG node object before it gets inserted into its designated ArangoDB collection.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        :param pyg_node: The PyG node object to (optionally) modify.
</span></span></span><span class=line><span class=cl><span class=s2>        :param node_type: The PyG Node Type of the node.
</span></span></span><span class=line><span class=cl><span class=s2>        :return: The PyG Node object
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>pyg_node</span><span class=p>[</span><span class=s2>&#34;foo&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;bar&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pyg_node</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_prepare_pyg_edge</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>pyg_edge</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>edge_type</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Optionally modify a PyG edge object before it gets inserted into its designated ArangoDB collection.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        :param pyg_edge: The PyG edge object to (optionally) modify.
</span></span></span><span class=line><span class=cl><span class=s2>        :param edge_type: The Edge Type of the PyG edge. Formatted
</span></span></span><span class=line><span class=cl><span class=s2>            as (from_collection, edge_collection, to_collection)
</span></span></span><span class=line><span class=cl><span class=s2>        :return: The PyG Edge object
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>pyg_edge</span><span class=p>[</span><span class=s2>&#34;bar&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;foo&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pyg_edge</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>adb_g</span> <span class=o>=</span> <span class=n>ADBPyG_Adapter</span><span class=p>(</span><span class=n>db</span><span class=p>,</span> <span class=n>Custom_ADBPyG_Controller</span><span class=p>())</span><span class=o>.</span><span class=n>pyg_to_arangodb</span><span class=p>(</span><span class=s2>&#34;FakeData&#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=arangodb-to-pyg>ArangoDB to PyG <a href=/3.13/data-science/adapters/arangodb-pyg-adapter/#arangodb-to-pyg class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># Start from scratch!</span>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>delete_graph</span><span class=p>(</span><span class=s2>&#34;FakeData&#34;</span><span class=p>,</span> <span class=n>drop_collections</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ignore_missing</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>adbpyg_adapter</span><span class=o>.</span><span class=n>pyg_to_arangodb</span><span class=p>(</span><span class=s2>&#34;FakeData&#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#######################</span>
</span></span><span class=line><span class=cl><span class=c1># 2.1: via Graph name #</span>
</span></span><span class=line><span class=cl><span class=c1>#######################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Due to risk of ambiguity, this method does not transfer attributes</span>
</span></span><span class=line><span class=cl><span class=n>pyg_g</span> <span class=o>=</span> <span class=n>adbpyg_adapter</span><span class=o>.</span><span class=n>arangodb_graph_to_pyg</span><span class=p>(</span><span class=s2>&#34;FakeData&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#############################</span>
</span></span><span class=line><span class=cl><span class=c1># 2.2: via Collection names #</span>
</span></span><span class=line><span class=cl><span class=c1>#############################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Due to risk of ambiguity, this method does not transfer attributes</span>
</span></span><span class=line><span class=cl><span class=n>pyg_g</span> <span class=o>=</span> <span class=n>adbpyg_adapter</span><span class=o>.</span><span class=n>arangodb_collections_to_pyg</span><span class=p>(</span><span class=s2>&#34;FakeData&#34;</span><span class=p>,</span> <span class=n>v_cols</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;v0&#34;</span><span class=p>,</span> <span class=s2>&#34;v1&#34;</span><span class=p>},</span> <span class=n>e_cols</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;e0&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>######################</span>
</span></span><span class=line><span class=cl><span class=c1># 2.3: via Metagraph #</span>
</span></span><span class=line><span class=cl><span class=c1>######################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Transfers attributes &#34;as is&#34;, meaning they are already formatted to PyG data standards.</span>
</span></span><span class=line><span class=cl><span class=n>metagraph_v1</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;vertexCollections&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1># Move the &#34;x&#34; &amp; &#34;y&#34; ArangoDB attributes to PyG as &#34;x&#34; &amp; &#34;y&#34; Tensors</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;v0&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;x&#34;</span><span class=p>,</span> <span class=s2>&#34;y&#34;</span><span class=p>},</span> <span class=c1># equivalent to {&#34;x&#34;: &#34;x&#34;, &#34;y&#34;: &#34;y&#34;}</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;v1&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;v1_x&#34;</span><span class=p>:</span> <span class=s2>&#34;x&#34;</span><span class=p>},</span> <span class=c1># store the &#39;x&#39; feature matrix as &#39;v1_x&#39; in PyG</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;edgeCollections&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;e0&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;edge_attr&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pyg_g</span> <span class=o>=</span> <span class=n>adbpyg_adapter</span><span class=o>.</span><span class=n>arangodb_to_pyg</span><span class=p>(</span><span class=s2>&#34;FakeData&#34;</span><span class=p>,</span> <span class=n>metagraph_v1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#################################################</span>
</span></span><span class=line><span class=cl><span class=c1># 2.4: via Metagraph with user-defined encoders #</span>
</span></span><span class=line><span class=cl><span class=c1>#################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Transforms attributes via user-defined encoders</span>
</span></span><span class=line><span class=cl><span class=c1># For more info on user-defined encoders in PyG, see https://pytorch-geometric.readthedocs.io/en/latest/notes/load_csv.html</span>
</span></span><span class=line><span class=cl><span class=n>metagraph_v2</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;vertexCollections&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Movies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;x&#34;</span><span class=p>:</span> <span class=p>{</span>  <span class=c1># Build a feature matrix from the &#34;Action&#34; &amp; &#34;Drama&#34; document attributes</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Action&#34;</span><span class=p>:</span> <span class=n>IdentityEncoder</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>torch</span><span class=o>.</span><span class=n>long</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Drama&#34;</span><span class=p>:</span> <span class=n>IdentityEncoder</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>torch</span><span class=o>.</span><span class=n>long</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;y&#34;</span><span class=p>:</span> <span class=s2>&#34;Comedy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Users&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;x&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Gender&#34;</span><span class=p>:</span> <span class=n>CategoricalEncoder</span><span class=p>(</span><span class=n>mapping</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;M&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;F&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Age&#34;</span><span class=p>:</span> <span class=n>IdentityEncoder</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>torch</span><span class=o>.</span><span class=n>long</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;edgeCollections&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Ratings&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=s2>&#34;edge_weight&#34;</span><span class=p>:</span> <span class=s2>&#34;Rating&#34;</span> <span class=p>}</span> <span class=c1># Use the &#39;Rating&#39; attribute for the PyG &#39;edge_weight&#39; property</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pyg_g</span> <span class=o>=</span> <span class=n>adbpyg_adapter</span><span class=o>.</span><span class=n>arangodb_to_pyg</span><span class=p>(</span><span class=s2>&#34;imdb&#34;</span><span class=p>,</span> <span class=n>metagraph_v2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##################################################</span>
</span></span><span class=line><span class=cl><span class=c1># 2.5: via Metagraph with user-defined functions #</span>
</span></span><span class=line><span class=cl><span class=c1>##################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Transforms attributes via user-defined functions</span>
</span></span><span class=line><span class=cl><span class=n>metagraph_v3</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;vertexCollections&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;v0&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;x&#34;</span><span class=p>:</span> <span class=n>udf_v0_x</span><span class=p>,</span>  <span class=c1># supports named functions</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;y&#34;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>df</span><span class=p>:</span> <span class=n>torch</span><span class=o>.</span><span class=n>tensor</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s2>&#34;y&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>to_list</span><span class=p>()),</span>  <span class=c1># also supports lambda functions</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;v1&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;x&#34;</span><span class=p>:</span> <span class=n>udf_v1_x</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;edgeCollections&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;e0&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;edge_attr&#34;</span><span class=p>:</span> <span class=p>(</span><span class=k>lambda</span> <span class=n>df</span><span class=p>:</span> <span class=n>torch</span><span class=o>.</span><span class=n>tensor</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s2>&#34;edge_attr&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>to_list</span><span class=p>()))},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>udf_v0_x</span><span class=p>(</span><span class=n>v0_df</span><span class=p>:</span> <span class=n>pandas</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># v0_df[&#34;x&#34;] = ...</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>torch</span><span class=o>.</span><span class=n>tensor</span><span class=p>(</span><span class=n>v0_df</span><span class=p>[</span><span class=s2>&#34;x&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>to_list</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>udf_v1_x</span><span class=p>(</span><span class=n>v1_df</span><span class=p>:</span> <span class=n>pandas</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>torch</span><span class=o>.</span><span class=n>Tensor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># v1_df[&#34;x&#34;] = ...</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>torch</span><span class=o>.</span><span class=n>tensor</span><span class=p>(</span><span class=n>v1_df</span><span class=p>[</span><span class=s2>&#34;x&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>to_list</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pyg_g</span> <span class=o>=</span> <span class=n>adbpyg_adapter</span><span class=o>.</span><span class=n>arangodb_to_pyg</span><span class=p>(</span><span class=s2>&#34;FakeData&#34;</span><span class=p>,</span> <span class=n>metagraph_v3</span><span class=p>)</span>
</span></span></code></pre></div><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.13/data-science/adapters/arangodb-cugraph-adapter/><i class="fas fa-chevron-left fa-fw"></i><p>cuGraph</p></a></span><span class=next><a class="nav nav-next link" href=/3.13/data-science/adapters/arangodb-dgl-adapter/><p>DGL</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.13/data-science/adapters/arangodb-pyg-adapter.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#resources>Resources</a></div><div class=level-2><a href=#installation>Installation</a></div><div class=level-2><a href=#quickstart>Quickstart</a></div><div class=level-3><a href=#pyg-to-arangodb>PyG to ArangoDB</a></div><div class=level-3><a href=#arangodb-to-pyg>ArangoDB to PyG</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>