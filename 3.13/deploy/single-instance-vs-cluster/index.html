<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743774193></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="Similarities and differences in behavior between single servers and clusters"><meta property="og:url" content="http://localhost/3.13/deploy/single-instance-vs-cluster/"><meta property="og:title" content="Single instance vs. Cluster deployments"><meta property="og:type" content="website"><meta property="og:description" content="Similarities and differences in behavior between single servers and clusters"><meta name=docsearch:version content="3.13"><title>Single instance vs. Cluster deployments | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743774193 defer></script>
<script src=/js/featherlight.min.js?1743774193 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743774193 defer></script>
<script src=/js/theme.js?1743774193 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.13"><a itemprop=item class=link href=/3.13/><span itemprop=name class=breadcrumb-entry>3.13.0</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Deploy"><a itemprop=item class=link href=/3.13/deploy/><span itemprop=name class=breadcrumb-entry>Deploy</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Single instance vs. Cluster"><a itemprop=item class=link href=/3.13/deploy/single-instance-vs-cluster/><span itemprop=name class=breadcrumb-entry>Single instance vs. Cluster</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.13 is under development and not released yet.
This documentation is not final and potentially incomplete.</p></div></div></div></div><hgroup><h1>Single instance vs. Cluster deployments</h1><p class=lead>Similarities and differences in behavior between single servers and clusters</p></hgroup><p>In general, a single server configuration and a cluster configuration
of ArangoDB behave very similarly. However, there are differences due to
the different nature of these setups. This can lead to a discrepancy in behavior
between these two configurations. A summary of potential differences follows.</p><h2 id=migrating-from-a-single-instance-to-a-cluster>Migrating from a <em>Single Instance</em> to a <em>Cluster</em> <a href=/3.13/deploy/single-instance-vs-cluster/#migrating-from-a-single-instance-to-a-cluster class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>To migrate from a <em>Single Instance</em> to a <em>Cluster</em> you will need
to take a backup from the <em>Single Instance</em> and restore it into
the <em>Cluster</em> with the tools <a href=/3.13/components/tools/arangodump/ class=link><em>arangodump</em></a>
and <a href=/3.13/components/tools/arangorestore/ class=link><em>arangorestore</em></a>.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>If you have developed your application using a <em>Single Instance</em>
and you would like to use a <em>Cluster</em> now, before upgrading your production
system please test your application with the <em>Cluster</em> first.</p><p>If both your <em>Single Instance</em> and <em>Cluster</em> are running on the same
machine, they should have distinct data directories. It is not possible
to start a <em>Cluster</em> on the data directory of a <em>Single Instance</em>.</p></div></div></div></div><h2 id=locking-and-dead-lock-prevention>Locking and dead-lock prevention <a href=/3.13/deploy/single-instance-vs-cluster/#locking-and-dead-lock-prevention class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>In a single server configuration all data is local and dead-locks can
easily be detected. In a cluster configuration data is distributed to
many servers and some conflicts cannot be detected easily. Therefore
we have to do some things (like locking shards) sequentially and in a
strictly predefined order, to avoid dead-locks in this way by design.</p><h2 id=document-keys>Document Keys <a href=/3.13/deploy/single-instance-vs-cluster/#document-keys class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>In a cluster the <em>autoincrement</em> key generator is supported for single-sharded
collections. It cannot be used for collections with more than one shard.</p><h2 id=indexes>Indexes <a href=/3.13/deploy/single-instance-vs-cluster/#indexes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=unique-constraints>Unique constraints <a href=/3.13/deploy/single-instance-vs-cluster/#unique-constraints class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>There are restrictions on the allowed unique constraints in a cluster.
Any unique constraint which cannot be checked locally on a per shard
basis is not allowed in a cluster setup. More concretely, unique
constraints in a cluster are only allowed in the following situations:</p><ul><li>there is always a unique constraint on the primary key <code>_key</code>, if
the collection is not sharded by <code>_key</code>, then <code>_key</code> must be
automatically generated by the database and cannot be prescribed by
the client</li><li>the collection has only one shard, in which case the same unique
constraints are allowed as in the single instance case</li><li>if the collection is sharded by exactly one other attribute than
<code>_key</code>, then there can be a unique constraint on that attribute</li></ul><p>These restrictions are imposed, because otherwise checking for a unique
constraint violation would involve checking with all shards, which would have
a considerable performance impact.</p><h2 id=renaming>Renaming <a href=/3.13/deploy/single-instance-vs-cluster/#renaming class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>It is not possible to rename collections or views in a cluster.</p><h2 id=aql>AQL <a href=/3.13/deploy/single-instance-vs-cluster/#aql class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The AQL syntax for single server and cluster is identical. However,
there is one additional requirement (regarding <em>with</em>) and possible
performance differences.</p><h3 id=with>WITH <a href=/3.13/deploy/single-instance-vs-cluster/#with class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The <code>WITH</code> keyword in AQL must be used to declare which collections
are used in the AQL. For most AQL requires the required collections
can be deduced from the query itself. However, with traversals this is
not possible, if edge collections are used directly. See
<a href=/3.13/aql/high-level-operations/with/ class=link>AQL WITH operation</a>
for details. The <code>WITH</code> statement is not necessary when using named graphs
for the traversals.</p><p>There is a <code>--query.require-with</code> startup option
to make single server installations also require the <code>WITH</code> statements
in the same places where are cluster installation would. This option
is false by default, but be set to true to remove this behavior
difference between single servers and clusters.</p><h3 id=performance>Performance <a href=/3.13/deploy/single-instance-vs-cluster/#performance class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Performance of AQL queries can vary between single server and cluster.
If a query can be distributed to many DB-Server and executed in
parallel then cluster performance can be better. For example, if you
do a distributed <code>COLLECT</code> aggregation or a distributed <code>FILTER</code>
operation.</p><p>On the other hand, if you do a join or a traversal and the data is not
local to one server then the performance can be worse compared to a
single server. This is especially true for traversal if the data is
not sharded with care. Our SmartGraph feature helps with this for
traversals.</p><p>Single document operations can have a higher throughput in cluster but
will also have a higher latency, due to an additional network hop from
Coordinator to DB-Server.</p><p>Any operation that needs to find documents by anything else but the
shard key will have to fan out to all shards, so it will be a lot
slower than when referring to the documents using the shard
key. Optimized lookups by shard key can only be used for equality
lookups, e.g. not for range lookups.</p><h3 id=memory-usage>Memory usage <a href=/3.13/deploy/single-instance-vs-cluster/#memory-usage class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Some query results must be built up in memory on a Coordinator, for
example if a dataset needs to be sorted on the fly. This can relatively
easily overwhelm a Coordinator if the dataset is sharded across multiple
DB-Servers. Use indexes and streaming cursors to circumvent this
problem.</p><h2 id=transactions>Transactions <a href=/3.13/deploy/single-instance-vs-cluster/#transactions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Using a single instance of ArangoDB, multi-document / multi-collection
queries are guaranteed to be fully ACID. This is more than many other
NoSQL database systems support. In cluster mode, single-document
operations are also fully ACID. Multi-document / multi-collection
queries in a cluster are not ACID, which is equally the case for
competing database systems. See <a href=/3.13/develop/transactions/ class=link>Transactions</a>
for details.</p><p>Batch operations for multiple documents in the same collection are only
fully transactional in a single instance.</p><h2 id=smartgraphs>SmartGraphs <a href=/3.13/deploy/single-instance-vs-cluster/#smartgraphs class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>In SmartGraphs there are restrictions on the values of the <code>_key</code>
attributes. Essentially, the <code>_key</code> attribute values for vertices must
be prefixed with the string value of the SmartGraph attribute and a
colon. A similar restriction applies for the edges.</p><h2 id=foxx>Foxx <a href=/3.13/deploy/single-instance-vs-cluster/#foxx class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Foxx apps run on the Coordinators of a cluster. Since Coordinators are
stateless, one must not use regular file accesses in Foxx apps in a
cluster.</p><h2 id=agency>Agency <a href=/3.13/deploy/single-instance-vs-cluster/#agency class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>A cluster deployment needs a central, RAFT-based key/value store called
&ldquo;the Agency&rdquo; to keep the current cluster configuration and manage
failover. Being RAFT-based, this is a real-time system. If your servers
running the Agency instances (typically three or five) receive too much
load, the RAFT protocol stops working and the whole stability of the
cluster is endangered. If you foresee this problem, run the Agency
instances on separate nodes. All this is not necessary in a single
server deployment.</p><h2 id=dumprestore>Dump/Restore <a href=/3.13/deploy/single-instance-vs-cluster/#dumprestore class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>In a cluster, the <code>arangodump</code> utility cannot guarantee a consistent snapshot
across multiple shards or even multiple collections. In a single server,
<code>arangodump</code> produces a consistent snapshot.</p><p>In the Enterprise Edition, there is an additional utility
<code>arangobackup</code> and an HTTP API for <a href=/3.13/operations/backup-and-restore/#hot-backups class=link>Hot Backups</a>
to create consistent cluster snapshots.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.13/deploy/in-the-cloud/><i class="fas fa-chevron-left fa-fw"></i><p>In the Cloud</p></a></span><span class=next><a class="nav nav-next link" href=/3.13/deploy/production-checklist/><p>Production Checklist</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.13/deploy/single-instance-vs-cluster.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#migrating-from-a-single-instance-to-a-cluster>Migrating from a <em>Single Instance</em> to a <em>Cluster</em></a></div><div class=level-2><a href=#locking-and-dead-lock-prevention>Locking and dead-lock prevention</a></div><div class=level-2><a href=#document-keys>Document Keys</a></div><div class=level-2><a href=#indexes>Indexes</a></div><div class=level-3><a href=#unique-constraints>Unique constraints</a></div><div class=level-2><a href=#renaming>Renaming</a></div><div class=level-2><a href=#aql>AQL</a></div><div class=level-3><a href=#with>WITH</a></div><div class=level-3><a href=#performance>Performance</a></div><div class=level-3><a href=#memory-usage>Memory usage</a></div><div class=level-2><a href=#transactions>Transactions</a></div><div class=level-2><a href=#smartgraphs>SmartGraphs</a></div><div class=level-2><a href=#foxx>Foxx</a></div><div class=level-2><a href=#agency>Agency</a></div><div class=level-2><a href=#dumprestore>Dump/Restore</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>