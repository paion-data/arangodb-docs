<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743775370></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="ArangoSearch offers various AQL functions for search queries to control the search context, for filtering and scoring"><meta property="og:url" content="http://localhost/3.13/aql/functions/arangosearch/"><meta property="og:title" content="ArangoSearch functions in AQL"><meta property="og:type" content="website"><meta property="og:description" content="ArangoSearch offers various AQL functions for search queries to control the search context, for filtering and scoring"><meta name=docsearch:version content="3.13"><title>ArangoSearch functions in AQL | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743775370 defer></script>
<script src=/js/featherlight.min.js?1743775370 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743775370 defer></script>
<script src=/js/theme.js?1743775370 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.13"><a itemprop=item class=link href=/3.13/><span itemprop=name class=breadcrumb-entry>3.13.0</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="AQL"><a itemprop=item class=link href=/3.13/aql/><span itemprop=name class=breadcrumb-entry>AQL</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Functions"><a itemprop=item class=link href=/3.13/aql/functions/><span itemprop=name class=breadcrumb-entry>Functions</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="ArangoSearch"><a itemprop=item class=link href=/3.13/aql/functions/arangosearch/><span itemprop=name class=breadcrumb-entry>ArangoSearch</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.13 is under development and not released yet.
This documentation is not final and potentially incomplete.</p></div></div></div></div><hgroup><h1>ArangoSearch functions in AQL</h1><p class=lead>ArangoSearch offers various AQL functions for search queries to control the search context, for filtering and scoring</p></hgroup><p>You can form search expressions by composing ArangoSearch function calls,
logical operators and comparison operators. This allows you to filter Views
as well as to utilize inverted indexes to filter collections.</p><p>The AQL <a href=/3.13/aql/high-level-operations/search/ class=link><code>SEARCH</code> operation</a> accepts search expressions,
such as <code>PHRASE(doc.text, "foo bar", "text_en")</code>, for querying Views. You can
combine ArangoSearch filter and context functions as well as operators like
<code>AND</code> and <code>OR</code> to form complex search conditions. Similarly, the
<a href=/3.13/aql/high-level-operations/filter/ class=link><code>FILTER</code> operation</a> accepts such search expressions
when using <a href=/3.13/index-and-search/indexing/working-with-indexes/inverted-indexes/ class=link>inverted indexes</a>.</p><p>Scoring functions allow you to rank matches and to sort results by relevance.
They are limited to Views.</p><p>Search highlighting functions let you retrieve the string positions of matches.
They are limited to Views.</p><p>You can use most functions also without an inverted index or a View and the
<code>SEARCH</code> keyword, but then they are not accelerated by an index.</p><p>See <a href=/3.13/index-and-search/arangosearch/ class=link>Information Retrieval with ArangoSearch</a> for an
introduction.</p><h2 id=context-functions>Context Functions <a href=/3.13/aql/functions/arangosearch/#context-functions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=analyzer>ANALYZER() <a href=/3.13/aql/functions/arangosearch/#analyzer class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>ANALYZER(expr, analyzer) → retVal</code></p><p>Sets the Analyzer for the given search expression.</p><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text><p>The <code>ANALYZER()</code> function is only applicable for queries against <code>arangosearch</code> Views.</p><p>In queries against <code>search-alias</code> Views and inverted indexes, you don&rsquo;t need to
specify Analyzers because every field can be indexed with a single Analyzer only
and they are inferred from the index definition.</p></div></div></div></div><p>The default Analyzer is <code>identity</code> for any search expression that is used for
filtering <code>arangosearch</code> Views. This utility function can be used
to wrap a complex expression to set a particular Analyzer. It also sets it for
all the nested functions which require such an argument to avoid repeating the
Analyzer parameter. If an Analyzer argument is passed to a nested function
regardless, then it takes precedence over the Analyzer set via <code>ANALYZER()</code>.</p><p>The <code>TOKENS()</code> function is an exception. It requires the Analyzer name to be
passed in in all cases even if wrapped in an <code>ANALYZER()</code> call, because it is
not an ArangoSearch function but a regular string function which can be used
outside of <code>SEARCH</code> operations.</p><ul><li><strong>expr</strong> (expression): any valid search expression</li><li><strong>analyzer</strong> (string): name of an <a href=/3.13/index-and-search/analyzers/ class=link>Analyzer</a>.</li><li>returns <strong>retVal</strong> (any): the expression result that it wraps</li></ul><h4 id=example-using-a-custom-analyzer>Example: Using a custom Analyzer <a href=/3.13/aql/functions/arangosearch/#example-using-a-custom-analyzer class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Assuming a View definition with an Analyzer whose name and type is <code>delimiter</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;links&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;coll&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;analyzers&#34;</span><span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;delimiter&#34;</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;includeAllFields&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>… with the Analyzer properties <code>{ "delimiter": "|" }</code> and an example document
<code>{ "text": "foo|bar|baz" }</code> in the collection <code>coll</code>, the following query would
return the document:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=o>==</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span> <span class=s2>&#34;delimiter&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>The expression <code>doc.text == "bar"</code> has to be wrapped by <code>ANALYZER()</code> in order
to set the Analyzer to <code>delimiter</code>. Otherwise the expression would be evaluated
with the default <code>identity</code> Analyzer. <code>"foo|bar|baz" == "bar"</code> would not match,
but the View does not even process the indexed fields with the <code>identity</code>
Analyzer. The following query would also return an empty result because of
the Analyzer mismatch:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=o>==</span> <span class=s2>&#34;foo|bar|baz&#34;</span>
</span></span><span class=line><span class=cl>  <span class=c1>//SEARCH ANALYZER(doc.text == &#34;foo|bar|baz&#34;, &#34;identity&#34;)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h4 id=example-setting-the-analyzer-context-with-and-without-analyzer>Example: Setting the Analyzer context with and without <code>ANALYZER()</code> <a href=/3.13/aql/functions/arangosearch/#example-setting-the-analyzer-context-with-and-without-analyzer class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>In below query, the search expression is swapped by <code>ANALYZER()</code> to set the
<code>text_en</code> Analyzer for both <code>PHRASE()</code> functions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;foo&#34;</span><span class=p>)</span> <span class=kr>OR</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Without the usage of <code>ANALYZER()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;foo&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>OR</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h4 id=example-analyzer-precedence-and-specifics-of-the-tokens-function>Example: Analyzer precedence and specifics of the <code>TOKENS()</code> function <a href=/3.13/aql/functions/arangosearch/#example-analyzer-precedence-and-specifics-of-the-tokens-function class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>In the following example <code>ANALYZER()</code> is used to set the Analyzer <code>text_en</code>,
but in the second call to <code>PHRASE()</code> a different Analyzer is set (<code>identity</code>)
which overrules <code>ANALYZER()</code>. Therefore, the <code>text_en</code> Analyzer is used to find
the phrase <em>foo</em> and the <code>identity</code> Analyzer to find <em>bar</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;foo&#34;</span><span class=p>)</span> <span class=kr>OR</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span> <span class=s2>&#34;identity&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Despite the wrapping <code>ANALYZER()</code> function, the Analyzer name cannot be
omitted in calls to the <code>TOKENS()</code> function. Both occurrences of <code>text_en</code>
are required, to set the Analyzer for the expression <code>doc.text IN ...</code> and
for the <code>TOKENS()</code> function itself. This is because the <code>TOKENS()</code> function
is a regular string function that does not take the Analyzer context into
account:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>IN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;foo&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h3 id=boost>BOOST() <a href=/3.13/aql/functions/arangosearch/#boost class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>BOOST(expr, boost) → retVal</code></p><p>Override boost in the context of a search expression with a specified value,
making it available for scorer functions. By default, the context has a boost
value equal to <code>1.0</code>.</p><ul><li><strong>expr</strong> (expression): any valid search expression</li><li><strong>boost</strong> (number): numeric boost value</li><li>returns <strong>retVal</strong> (any): the expression result that it wraps</li></ul><h4 id=example-boosting-a-search-sub-expression>Example: Boosting a search sub-expression <a href=/3.13/aql/functions/arangosearch/#example-boosting-a-search-sub-expression class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>BOOST</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=o>==</span> <span class=s2>&#34;foo&#34;</span><span class=p>,</span> <span class=mf>2.5</span><span class=p>)</span> <span class=kr>OR</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=o>==</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>score</span> <span class=o>=</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>score</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>text</span><span class=o>:</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=n>score</span> <span class=p>}</span></span></span></code></pre></div><p>Assuming a View with the following documents indexed and processed by the
<code>text_en</code> Analyzer:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span> <span class=s2>&#34;text&#34;</span><span class=o>:</span> <span class=s2>&#34;foo bar&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span> <span class=s2>&#34;text&#34;</span><span class=o>:</span> <span class=s2>&#34;foo&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span> <span class=s2>&#34;text&#34;</span><span class=o>:</span> <span class=s2>&#34;bar&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span> <span class=s2>&#34;text&#34;</span><span class=o>:</span> <span class=s2>&#34;foo baz&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span> <span class=s2>&#34;text&#34;</span><span class=o>:</span> <span class=s2>&#34;baz&#34;</span> <span class=p>}</span></span></span></code></pre></div><p>… the result of above query would be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;foo bar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;score&#34;</span><span class=p>:</span> <span class=mf>2.787301540374756</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;foo baz&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;score&#34;</span><span class=p>:</span> <span class=mf>1.6895781755447388</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;score&#34;</span><span class=p>:</span> <span class=mf>1.525835633277893</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;score&#34;</span><span class=p>:</span> <span class=mf>0.9913395643234253</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><h2 id=filter-functions>Filter Functions <a href=/3.13/aql/functions/arangosearch/#filter-functions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=exists>EXISTS() <a href=/3.13/aql/functions/arangosearch/#exists class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>If you use <code>arangosearch</code> Views, the <code>EXISTS()</code> function only matches values if
you set the <strong>storeValues</strong> link property to <code>"id"</code> in the View definition
(the default is <code>"none"</code>).</div></div></div></div><h4 id=testing-for-attribute-presence>Testing for attribute presence <a href=/3.13/aql/functions/arangosearch/#testing-for-attribute-presence class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><code>EXISTS(path)</code></p><p>Match documents where the attribute at <code>path</code> is present.</p><ul><li><strong>path</strong> (attribute path expression): the attribute to test in the document</li><li>returns nothing: the function evaluates to a boolean, but this value cannot be
returned. The function can only be called in a search expression. It throws
an error if used outside of a <a href=/3.13/aql/high-level-operations/search/ class=link><code>SEARCH</code> operation</a> or
a <code>FILTER</code> operation that uses an inverted index.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>EXISTS</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h4 id=testing-for-attribute-type>Testing for attribute type <a href=/3.13/aql/functions/arangosearch/#testing-for-attribute-type class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><code>EXISTS(path, type)</code></p><p>Match documents where the attribute at <code>path</code> is present <em>and</em> is of the
specified data type.</p><ul><li><strong>path</strong> (attribute path expression): the attribute to test in the document</li><li><strong>type</strong> (string): data type to test for, can be one of:<ul><li><code>"null"</code></li><li><code>"bool"</code> / <code>"boolean"</code></li><li><code>"numeric"</code></li><li><code>"type"</code> (matches <code>null</code>, <code>boolean</code>, and <code>numeric</code> values)</li><li><code>"string"</code></li><li><code>"analyzer"</code> (see below)</li></ul></li><li>returns nothing: the function evaluates to a boolean, but this value cannot be
returned. The function can only be called in a search expression. It throws
an error if used outside of a <a href=/3.13/aql/high-level-operations/search/ class=link><code>SEARCH</code> operation</a> or
a <code>FILTER</code> operation that uses an inverted index.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>EXISTS</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;string&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h4 id=testing-for-analyzer-index-status>Testing for Analyzer index status <a href=/3.13/aql/functions/arangosearch/#testing-for-analyzer-index-status class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><code>EXISTS(path, "analyzer", analyzer)</code></p><p>Match documents where the attribute at <code>path</code> is present <em>and</em> was indexed
by the specified <code>analyzer</code>.</p><ul><li><strong>path</strong> (attribute path expression): the attribute to test in the document</li><li><strong>type</strong> (string): string literal <code>"analyzer"</code></li><li><strong>analyzer</strong> (string, <em>optional</em>): name of an <a href=/3.13/index-and-search/analyzers/ class=link>Analyzer</a>.
Uses the Analyzer of a wrapping <code>ANALYZER()</code> call if not specified or
defaults to <code>"identity"</code></li><li>returns nothing: the function evaluates to a boolean, but this value cannot be
returned. The function can only be called in a search expression. It throws
an error if used outside of a <a href=/3.13/aql/high-level-operations/search/ class=link><code>SEARCH</code> operation</a> or
a <code>FILTER</code> operation that uses an inverted index.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>EXISTS</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;analyzer&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h4 id=testing-for-nested-fields>Testing for nested fields <a href=/3.13/aql/functions/arangosearch/#testing-for-nested-fields class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><code>EXISTS(path, "nested")</code></p><p>Match documents where the attribute at <code>path</code> is present <em>and</em> is indexed
as a nested field for <a href=/3.13/index-and-search/arangosearch/nested-search/ class=link>nested search with Views</a>
or <a href=/3.13/index-and-search/indexing/working-with-indexes/inverted-indexes/#nested-search-enterprise-edition class=link>inverted indexes</a>.</p><ul><li><strong>path</strong> (attribute path expression): the attribute to test in the document</li><li><strong>type</strong> (string): string literal <code>"nested"</code></li><li>returns nothing: the function evaluates to a boolean, but this value cannot be
returned. The function can only be called in a search expression. It throws
an error if used outside of a <a href=/3.13/aql/high-level-operations/search/ class=link><code>SEARCH</code> operation</a> or
a <code>FILTER</code> operation that uses an inverted index.</li></ul><p><strong>Examples</strong></p><p>Only return documents from the View <code>viewName</code> whose <code>text</code> attribute is indexed
as a nested field:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>EXISTS</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;nested&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Only return documents whose <code>attr</code> attribute and its nested <code>text</code> attribute are
indexed as nested fields:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=n>doc</span><span class=p>.</span><span class=n>attr</span><span class=p>[</span><span class=o>?</span> <span class=kr>FILTER</span> <span class=nf>EXISTS</span><span class=p>(</span><span class=bp>CURRENT</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;nested&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Only return documents from the collection <code>coll</code> whose <code>text</code> attribute is indexed
as a nested field by an inverted index:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span> <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>indexHint</span><span class=o>:</span> <span class=s2>&#34;inv-idx&#34;</span><span class=p>,</span> <span class=n>forceIndexHint</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>EXISTS</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;nested&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Only return documents whose <code>attr</code> attribute and its nested <code>text</code> attribute are
indexed as nested fields:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>coll</span> <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>indexHint</span><span class=o>:</span> <span class=s2>&#34;inv-idx&#34;</span><span class=p>,</span> <span class=n>forceIndexHint</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>doc</span><span class=p>.</span><span class=n>attr</span><span class=p>[</span><span class=o>?</span> <span class=kr>FILTER</span> <span class=nf>EXISTS</span><span class=p>(</span><span class=bp>CURRENT</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;nested&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h3 id=in_range>IN_RANGE() <a href=/3.13/aql/functions/arangosearch/#in_range class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>IN_RANGE(path, low, high, includeLow, includeHigh) → included</code></p><p>Match documents where the attribute at <code>path</code> is greater than (or equal to)
<code>low</code> and less than (or equal to) <code>high</code>.</p><p>You can use <code>IN_RANGE()</code> for searching more efficiently compared to an equivalent
expression that combines two comparisons with a logical conjunction:</p><ul><li><code>IN_RANGE(path, low, high, true, true)</code> instead of <code>low &lt;= value AND value &lt;= high</code></li><li><code>IN_RANGE(path, low, high, true, false)</code> instead of <code>low &lt;= value AND value &lt; high</code></li><li><code>IN_RANGE(path, low, high, false, true)</code> instead of <code>low &lt; value AND value &lt;= high</code></li><li><code>IN_RANGE(path, low, high, false, false)</code> instead of <code>low &lt; value AND value &lt; high</code></li></ul><p><code>low</code> and <code>high</code> can be numbers or strings (technically also <code>null</code>, <code>true</code>
and <code>false</code>), but the data type must be the same for both.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>The alphabetical order of characters is not taken into account by ArangoSearch,
i.e. range queries in SEARCH operations against Views will not follow the
language rules as per the defined Analyzer locale (except for the
<a href=/3.13/index-and-search/analyzers/#collation class=link><code>collation</code> Analyzer</a>) nor the server language
(startup option <code>--default-language</code>)!
Also see <a href=/3.13/release-notes/version-3.13/known-issues-in-3-13/#arangosearch class=link>Known Issues</a>.</div></div></div></div><p>There is a corresponding <a href=/3.13/aql/functions/miscellaneous/#in_range class=link><code>IN_RANGE()</code> Miscellaneous Function</a>
that is used outside of <code>SEARCH</code> operations.</p><ul><li><strong>path</strong> (attribute path expression):
the path of the attribute to test in the document</li><li><strong>low</strong> (number|string): minimum value of the desired range</li><li><strong>high</strong> (number|string): maximum value of the desired range</li><li><strong>includeLow</strong> (bool): whether the minimum value shall be included in
the range (left-closed interval) or not (left-open interval)</li><li><strong>includeHigh</strong> (bool): whether the maximum value shall be included in
the range (right-closed interval) or not (right-open interval)</li><li>returns <strong>included</strong> (bool): whether <code>value</code> is in the range</li></ul><p>If <code>low</code> and <code>high</code> are the same, but <code>includeLow</code> and/or <code>includeHigh</code> is set
to <code>false</code>, then nothing will match. If <code>low</code> is greater than <code>high</code> nothing will
match either.</p><h4 id=example-using-numeric-ranges>Example: Using numeric ranges <a href=/3.13/aql/functions/arangosearch/#example-using-numeric-ranges class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>To match documents with the attribute <code>value >= 3</code> and <code>value &lt;= 5</code> using the
default <code>"identity"</code> Analyzer you would write the following query:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>IN_RANGE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>value</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=kc>true</span><span class=p>,</span> <span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>value</span></span></span></code></pre></div><p>This will also match documents which have an array of numbers as <code>value</code>
attribute where at least one of the numbers is in the specified boundaries.</p><h4 id=example-using-string-ranges>Example: Using string ranges <a href=/3.13/aql/functions/arangosearch/#example-using-string-ranges class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Using string boundaries and a text Analyzer allows to match documents which
have at least one token within the specified character range:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>valView</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>IN_RANGE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>value</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>,</span><span class=s2>&#34;f&#34;</span><span class=p>,</span> <span class=kc>true</span><span class=p>,</span> <span class=kc>false</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>This will match <code>{ "value": "bar" }</code> and <code>{ "value": "foo bar" }</code> because the
<em>b</em> of <em>bar</em> is in the range (<code>"a" &lt;= "b" &lt; "f"</code>), but not <code>{ "value": "foo" }</code>
because the <em>f</em> of <em>foo</em> is excluded (<code>high</code> is &ldquo;f&rdquo; but <code>includeHigh</code> is false).</p><h3 id=min_match>MIN_MATCH() <a href=/3.13/aql/functions/arangosearch/#min_match class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>MIN_MATCH(expr1, ... exprN, minMatchCount) → fulfilled</code></p><p>Match documents where at least <code>minMatchCount</code> of the specified
search expressions are satisfied.</p><p>There is a corresponding <a href=/3.13/aql/functions/miscellaneous/#min_match class=link><code>MIN_MATCH()</code> Miscellaneous function</a>
that is used outside of <code>SEARCH</code> operations.</p><ul><li><strong>expr</strong> (expression, <em>repeatable</em>): any valid search expression</li><li><strong>minMatchCount</strong> (number): minimum number of search expressions that should
be satisfied</li><li>returns <strong>fulfilled</strong> (bool): whether at least <code>minMatchCount</code> of the
specified expressions are <code>true</code></li></ul><h4 id=example-matching-a-subset-of-search-sub-expressions>Example: Matching a subset of search sub-expressions <a href=/3.13/aql/functions/arangosearch/#example-matching-a-subset-of-search-sub-expressions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Assuming a View with a text Analyzer, you may use it to match documents where
the attribute contains at least two out of three tokens:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>t</span> <span class=o>=</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;quick brown fox&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>MIN_MATCH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=o>==</span> <span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=o>==</span> <span class=n>t</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=o>==</span> <span class=n>t</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>2</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p>This will match <code>{ "text": "the quick brown fox" }</code> and <code>{ "text": "some brown fox" }</code>,
but not <code>{ "text": "snow fox" }</code> which only fulfills one of the conditions.</p><p>Note that you can also use the <code>AT LEAST</code> <a href=/3.13/aql/high-level-operations/search/#array-comparison-operators class=link>array comparison operator</a>
in the specific case of matching a subset of tokens against a single attribute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;quick brown fox&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>AT LEAST</span> <span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=o>==</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><h3 id=minhash_match>MINHASH_MATCH() <a href=/3.13/aql/functions/arangosearch/#minhash_match class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>MINHASH_MATCH(path, target, threshold, analyzer) → fulfilled</code></p><p>Match documents with an approximate Jaccard similarity of at least the
<code>threshold</code>, approximated with the specified <code>minhash</code> Analyzer.</p><p>To only compute the MinHash signatures, see the
<a href=/3.13/aql/functions/miscellaneous/#minhash class=link><code>MINHASH()</code> Miscellaneous function</a>.</p><ul><li><strong>path</strong> (attribute path expression|string): the path of the attribute in
a document or a string</li><li><strong>target</strong> (string): the string to hash with the specified Analyzer and to
compare against the stored attribute</li><li><strong>threshold</strong> (number, <em>optional</em>): a value between <code>0.0</code> and <code>1.0</code>.</li><li><strong>analyzer</strong> (string): the name of a <a href=/3.13/index-and-search/analyzers/#minhash class=link><code>minhash</code> Analyzer</a>.</li><li>returns <strong>fulfilled</strong> (bool): <code>true</code> if the approximate Jaccard similarity
is greater than or equal to the specified threshold, <code>false</code> otherwise</li></ul><h4 id=example-find-documents-with-a-text-similar-to-a-target-text>Example: Find documents with a text similar to a target text <a href=/3.13/aql/functions/arangosearch/#example-find-documents-with-a-text-similar-to-a-target-text class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Assuming a View with a <code>minhash</code> Analyzer, you can use the stored
MinHash signature to find candidates for the more expensive Jaccard similarity
calculation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>target</span> <span class=o>=</span> <span class=s2>&#34;the quick brown fox jumps over the lazy dog&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>LET</span> <span class=n>targetSignature</span> <span class=o>=</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=s2>&#34;myMinHash&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>MINHASH_MATCH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=n>target</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=s2>&#34;myMinHash&#34;</span><span class=p>)</span> <span class=c1>// approximation
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>LET</span> <span class=n>jaccard</span> <span class=o>=</span> <span class=nf>JACCARD</span><span class=p>(</span><span class=n>targetSignature</span><span class=p>,</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;myMinHash&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>jaccard</span> <span class=o>&gt;</span> <span class=mf>0.75</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>jaccard</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><h3 id=ngram_match>NGRAM_MATCH() <a href=/3.13/aql/functions/arangosearch/#ngram_match class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>NGRAM_MATCH(path, target, threshold, analyzer) → fulfilled</code></p><p>Match documents whose attribute value has an
<a href=https://webdocs.cs.ualberta.ca/~kondrak/papers/spire05.pdf target=_blank rel="noopener noreferrer" class=link><em>n</em>-gram similarity</a>&nbsp;<i class="fas fa-external-link-alt"></i>
higher than the specified threshold compared to the target value.</p><p>The similarity is calculated by counting how long the longest sequence of
matching <em>n</em>-grams is, divided by the target&rsquo;s total <em>n</em>-gram count.
Only fully matching <em>n</em>-grams are counted.</p><p>The <em>n</em>-grams for both attribute and target are produced by the specified
Analyzer. Increasing the <em>n</em>-gram length will increase accuracy, but reduce
error tolerance. In most cases a size of 2 or 3 will be a good choice.</p><p>Also see the String Functions
<a href=/3.13/aql/functions/string/#ngram_positional_similarity class=link><code>NGRAM_POSITIONAL_SIMILARITY()</code></a>
and <a href=/3.13/aql/functions/string/#ngram_similarity class=link><code>NGRAM_SIMILARITY()</code></a>
for calculating <em>n</em>-gram similarity that cannot be accelerated by a View index.</p><ul><li><strong>path</strong> (attribute path expression|string): the path of the attribute in
a document or a string</li><li><strong>target</strong> (string): the string to compare against the stored attribute</li><li><strong>threshold</strong> (number, <em>optional</em>): a value between <code>0.0</code> and <code>1.0</code>. Defaults
to <code>0.7</code> if none is specified.</li><li><strong>analyzer</strong> (string): the name of an <a href=/3.13/index-and-search/analyzers/ class=link>Analyzer</a>.</li><li>returns <strong>fulfilled</strong> (bool): <code>true</code> if the evaluated <em>n</em>-gram similarity value
is greater than or equal to the specified threshold, <code>false</code> otherwise</li></ul><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text><p>Use an Analyzer of type <code>ngram</code> with <code>preserveOriginal: false</code> and <code>min</code> equal
to <code>max</code>. Otherwise, the similarity score calculated internally will be lower
than expected.</p><p>The Analyzer must have the <code>"position"</code> and <code>"frequency"</code> features enabled or
the <code>NGRAM_MATCH()</code> function will not find anything.</p></div></div></div></div><h4 id=example-using-a-custom-bigram-analyzer>Example: Using a custom bigram Analyzer <a href=/3.13/aql/functions/arangosearch/#example-using-a-custom-bigram-analyzer class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Given a View indexing an attribute <code>text</code>, a custom <em>n</em>-gram Analyzer <code>"bigram"</code>
(<code>min: 2, max: 2, preserveOriginal: false, streamType: "utf8"</code>) and a document
<code>{ "text": "quick red fox" }</code>, the following query would match it (with a
threshold of <code>1.0</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>NGRAM_MATCH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;quick fox&#34;</span><span class=p>,</span> <span class=s2>&#34;bigram&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p>The following will also match (note the low threshold value):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>NGRAM_MATCH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;quick blue fox&#34;</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>,</span> <span class=s2>&#34;bigram&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p>The following will not match (note the high threshold value):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>NGRAM_MATCH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;quick blue fox&#34;</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>,</span> <span class=s2>&#34;bigram&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><h4 id=example-using-constant-values>Example: Using constant values <a href=/3.13/aql/functions/arangosearch/#example-using-constant-values class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p><code>NGRAM_MATCH()</code> can be called with constant arguments, but for such calls the
<code>analyzer</code> argument is mandatory (even for calls inside of a <code>SEARCH</code> clause):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>NGRAM_MATCH</span><span class=p>(</span><span class=s2>&#34;quick fox&#34;</span><span class=p>,</span> <span class=s2>&#34;quick blue fox&#34;</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>,</span> <span class=s2>&#34;bigram&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>RETURN</span> <span class=nf>NGRAM_MATCH</span><span class=p>(</span><span class=s2>&#34;quick fox&#34;</span><span class=p>,</span> <span class=s2>&#34;quick blue fox&#34;</span><span class=p>,</span> <span class=s2>&#34;bigram&#34;</span><span class=p>)</span></span></span></code></pre></div><h3 id=phrase>PHRASE() <a href=/3.13/aql/functions/arangosearch/#phrase class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>PHRASE(path, phrasePart, analyzer)</code></p><p><code>PHRASE(path, phrasePart1, skipTokens1, ... phrasePartN, skipTokensN, analyzer)</code></p><p><code>PHRASE(path, [ phrasePart1, skipTokens1, ... phrasePartN, skipTokensN ], analyzer)</code></p><p>Search for a phrase in the referenced attribute. It only matches documents in
which the tokens appear in the specified order. To search for tokens in any
order use <a href=/3.13/aql/functions/string/#tokens class=link><code>TOKENS()</code></a> instead.</p><p>The phrase can be expressed as an arbitrary number of <code>phraseParts</code> separated by
<em>skipTokens</em> number of tokens (wildcards), either as separate arguments or as
array as second argument.</p><ul><li><strong>path</strong> (attribute path expression): the attribute to test in the document</li><li><strong>phrasePart</strong> (string|array|object): text to search for in the tokens.
Can also be an <a href=#example-using-phrase-with-an-array-of-tokens class=link>array</a>
comprised of string, array and <a href=#object-tokens class=link>object tokens</a>, or tokens
interleaved with numbers of <code>skipTokens</code>. The specified <code>analyzer</code> is applied
to string and array tokens, but not for object tokens.</li><li><strong>skipTokens</strong> (number, <em>optional</em>): amount of tokens to treat
as wildcards</li><li><strong>analyzer</strong> (string, <em>optional</em>): name of an <a href=/3.13/index-and-search/analyzers/ class=link>Analyzer</a>.
Uses the Analyzer of a wrapping <code>ANALYZER()</code> call if not specified or
defaults to <code>"identity"</code></li><li>returns nothing: the function evaluates to a boolean, but this value cannot be
returned. The function can only be called in a search expression. It throws
an error if used outside of a <a href=/3.13/aql/high-level-operations/search/ class=link><code>SEARCH</code> operation</a> or
a <code>FILTER</code> operation that uses an inverted index.</li></ul><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>The selected Analyzer must have the <code>"position"</code> and <code>"frequency"</code> features
enabled. The <code>PHRASE()</code> function will otherwise not find anything.</div></div></div></div><h4 id=object-tokens>Object tokens <a href=/3.13/aql/functions/arangosearch/#object-tokens class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><ul><li><code>{IN_RANGE: [low, high, includeLow, includeHigh]}</code>:
see <a href=#in_range class=link><code>IN_RANGE()</code></a>. <em>low</em> and <em>high</em> can only be strings.</li><li><code>{LEVENSHTEIN_MATCH: [token, maxDistance, transpositions, maxTerms, prefix]}</code>:<ul><li><code>token</code> (string): a string to search</li><li><code>maxDistance</code> (number): maximum Levenshtein / Damerau-Levenshtein distance</li><li><code>transpositions</code> (bool, <em>optional</em>): if set to <code>false</code>, a Levenshtein
distance is computed, otherwise a Damerau-Levenshtein distance (default)</li><li><code>maxTerms</code> (number, <em>optional</em>): consider only a specified number of the
most relevant terms. One can pass <code>0</code> to consider all matched terms, but it may
impact performance negatively. The default value is <code>64</code>.</li><li><code>prefix</code> (string, <em>optional</em>): if defined, then a search for the exact
prefix is carried out, using the matches as candidates. The Levenshtein /
Damerau-Levenshtein distance is then computed for each candidate using the
remainders of the strings. This option can improve performance in cases where
there is a known common prefix. The default value is an empty string
(introduced in v3.7.13, v3.8.1).</li></ul></li><li><code>{STARTS_WITH: [prefix]}</code>: see <a href=#starts_with class=link><code>STARTS_WITH()</code></a>.
Array brackets are optional</li><li><code>{TERM: [token]}</code>: equal to <code>token</code> but without Analyzer tokenization.
Array brackets are optional</li><li><code>{TERMS: [token1, ..., tokenN]}</code>: one of <code>token1, ..., tokenN</code> can be found
in specified position. Inside an array the object syntax can be replaced with
the object field value, e.g., <code>[..., [token1, ..., tokenN], ...]</code>.</li><li><code>{WILDCARD: [token]}</code>: see <a href=#like class=link><code>LIKE()</code></a>.
Array brackets are optional</li></ul><p>An array token inside an array can be used in the <code>TERMS</code> case only.</p><p>Also see <a href=#example-using-object-tokens class=link>Example: Using object tokens</a>.</p><h4 id=example-using-a-text-analyzer-for-a-phrase-search>Example: Using a text Analyzer for a phrase search <a href=/3.13/aql/functions/arangosearch/#example-using-a-text-analyzer-for-a-phrase-search class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Given a View indexing an attribute <code>text</code> with the <code>"text_en"</code> Analyzer and a
document <code>{ "text": "Lorem ipsum dolor sit amet, consectetur adipiscing elit" }</code>,
the following query would match it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;lorem ipsum&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p>However, this search expression does not because the tokens <code>"ipsum"</code> and
<code>"lorem"</code> do not appear in this order:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;ipsum lorem&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span></span></span></code></pre></div><h4 id=example-skip-tokens-for-a-proximity-search>Example: Skip tokens for a proximity search <a href=/3.13/aql/functions/arangosearch/#example-skip-tokens-for-a-proximity-search class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>To match <code>"ipsum"</code> and <code>"amet"</code> with any two tokens in between, you can use the
following search expression:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;ipsum&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;amet&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span></span></span></code></pre></div><p>The <code>skipTokens</code> value of <code>2</code> defines how many wildcard tokens have to appear
between <em>ipsum</em> and <em>amet</em>. A <code>skipTokens</code> value of <code>0</code> means that the tokens
must be adjacent. Negative values are allowed, but not very useful. These three
search expressions are equivalent:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;lorem ipsum&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;lorem&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;ipsum&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;ipsum&#34;</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;lorem&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span></span></span></code></pre></div><h4 id=example-using-phrase-with-an-array-of-tokens>Example: Using <code>PHRASE()</code> with an array of tokens <a href=/3.13/aql/functions/arangosearch/#example-using-phrase-with-an-array-of-tokens class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The <code>PHRASE()</code> function also accepts an array as second argument with
<code>phrasePart</code> and <code>skipTokens</code> parameters as elements.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;quick brown fox&#34;</span><span class=p>],</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>RETURN</span> <span class=n>doc</span>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;quick&#34;</span><span class=p>,</span> <span class=s2>&#34;brown&#34;</span><span class=p>,</span> <span class=s2>&#34;fox&#34;</span><span class=p>],</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>This syntax variation enables the usage of computed expressions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>proximityCondition</span> <span class=o>=</span> <span class=p>[</span> <span class=s2>&#34;foo&#34;</span><span class=p>,</span> <span class=nf>ROUND</span><span class=p>(</span><span class=nf>RAND</span><span class=p>()</span><span class=o>*</span><span class=mi>10</span><span class=p>),</span> <span class=s2>&#34;bar&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=n>proximityCondition</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>tokens</span> <span class=o>=</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;quick brown fox&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=c1>// [&#34;quick&#34;, &#34;brown&#34;, &#34;fox&#34;]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=n>tokens</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Above example is equivalent to the more cumbersome and static form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=s2>&#34;quick&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;brown&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;fox&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>You can optionally specify the number of skipTokens in the array form before
every string element:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;quick&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;fox&#34;</span><span class=p>,</span> <span class=s2>&#34;jumps&#34;</span><span class=p>],</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>It is the same as the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=s2>&#34;quick&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;fox&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;jumps&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h4 id=example-handling-of-arrays-with-no-members>Example: Handling of arrays with no members <a href=/3.13/aql/functions/arangosearch/#example-handling-of-arrays-with-no-members class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Empty arrays are skipped:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=s2>&#34;quick&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=p>[],</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;jumps&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>The query is equivalent to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=s2>&#34;quick&#34;</span><span class=p>,</span> <span class=mi>2</span> <span class=s2>&#34;jumps&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Providing only empty arrays is valid, but will yield no results.</p><h4 id=example-using-object-tokens>Example: Using object tokens <a href=/3.13/aql/functions/arangosearch/#example-using-object-tokens class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Using object tokens <code>STARTS_WITH</code>, <code>WILDCARD</code>, <code>LEVENSHTEIN_MATCH</code>, <code>TERMS</code> and
<code>IN_RANGE</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=n>STARTS_WITH</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;qui&#34;</span><span class=p>]},</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=n>WILDCARD</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;b%o_n&#34;</span><span class=p>]},</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=n>LEVENSHTEIN_MATCH</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;foks&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>]},</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=n>TERMS</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;jump&#34;</span><span class=p>,</span> <span class=s2>&#34;run&#34;</span><span class=p>]},</span> <span class=mi>0</span><span class=p>,</span> <span class=c1>// Analyzer not applied!
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>{</span><span class=n>IN_RANGE</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;over&#34;</span><span class=p>,</span> <span class=s2>&#34;through&#34;</span><span class=p>,</span> <span class=kc>true</span><span class=p>,</span> <span class=kc>false</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><p>Note that the <code>text_en</code> Analyzer has stemming enabled, but for object tokens
the Analyzer isn&rsquo;t applied. <code>{TERMS: ["jumps", "runs"]}</code> would not match the
indexed (and stemmed!) attribute value. Therefore, the trailing <code>s</code> which would
be stemmed away is removed from both words manually in the example.</p><p>Above example is equivalent to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>myView</span> <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=n>STARTS_WITH</span><span class=o>:</span> <span class=s2>&#34;qui&#34;</span><span class=p>},</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=n>WILDCARD</span><span class=o>:</span> <span class=s2>&#34;b%o_n&#34;</span><span class=p>},</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=n>LEVENSHTEIN_MATCH</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;foks&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>]},</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=s2>&#34;jumps&#34;</span><span class=p>,</span> <span class=s2>&#34;runs&#34;</span><span class=p>],</span> <span class=mi>0</span><span class=p>,</span> <span class=c1>// Analyzer is applied using this syntax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>{</span><span class=n>IN_RANGE</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;over&#34;</span><span class=p>,</span> <span class=s2>&#34;through&#34;</span><span class=p>,</span> <span class=kc>true</span><span class=p>,</span> <span class=kc>false</span><span class=p>]}</span>
</span></span><span class=line><span class=cl><span class=p>],</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span> <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h3 id=starts_with>STARTS_WITH() <a href=/3.13/aql/functions/arangosearch/#starts_with class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>STARTS_WITH(path, prefix) → startsWith</code></p><p>Match the value of the attribute that starts with <code>prefix</code>. If the attribute
is processed by a tokenizing Analyzer (type <code>"text"</code> or <code>"delimiter"</code>) or if it
is an array, then a single token/element starting with the prefix is sufficient
to match the document.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>The alphabetical order of characters is not taken into account by ArangoSearch,
i.e. range queries in SEARCH operations against Views will not follow the
language rules as per the defined Analyzer locale (except for the
<a href=/3.13/index-and-search/analyzers/#collation class=link><code>collation</code> Analyzer</a>) nor the server language
(startup option <code>--default-language</code>)!
Also see <a href=/3.13/release-notes/version-3.13/known-issues-in-3-13/#arangosearch class=link>Known Issues</a>.</div></div></div></div><p>There is a corresponding <a href=/3.13/aql/functions/string/#starts_with class=link><code>STARTS_WITH()</code> String function</a>
that is used outside of <code>SEARCH</code> operations.</p><ul><li><strong>path</strong> (attribute path expression): the path of the attribute to compare
against in the document</li><li><strong>prefix</strong> (string): a string to search at the start of the text</li><li>returns <strong>startsWith</strong> (bool): whether the specified attribute starts with
the given prefix</li></ul><hr><p><code>STARTS_WITH(path, prefixes, minMatchCount) → startsWith</code></p><p>Match the value of the attribute that starts with one of the <code>prefixes</code>, or
optionally with at least <code>minMatchCount</code> of the prefixes.</p><ul><li><strong>path</strong> (attribute path expression): the path of the attribute to compare
against in the document</li><li><strong>prefixes</strong> (array): an array of strings to search at the start of the text</li><li><strong>minMatchCount</strong> (number, <em>optional</em>): minimum number of search prefixes
that should be satisfied (see
<a href=#example-searching-for-one-or-multiple-prefixes class=link>example</a>). The default is <code>1</code></li><li>returns <strong>startsWith</strong> (bool): whether the specified attribute starts with at
least <code>minMatchCount</code> of the given prefixes</li></ul><h4 id=example-searching-for-an-exact-value-prefix>Example: Searching for an exact value prefix <a href=/3.13/aql/functions/arangosearch/#example-searching-for-an-exact-value-prefix class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>To match a document <code>{ "text": "lorem ipsum..." }</code> using a prefix and the
<code>"identity"</code> Analyzer you can use it like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>STARTS_WITH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;lorem ip&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h4 id=example-searching-for-a-prefix-in-text>Example: Searching for a prefix in text <a href=/3.13/aql/functions/arangosearch/#example-searching-for-a-prefix-in-text class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>This query will match <code>{ "text": "lorem ipsum" }</code> as well as
<code>{ "text": [ "lorem", "ipsum" ] }</code> given a View which indexes the <code>text</code>
attribute and processes it with the <code>"text_en"</code> Analyzer:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>STARTS_WITH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;ips&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p>Note that it will not match <code>{ "text": "IPS (in-plane switching)" }</code> without
modification to the query. The prefixes were passed to <code>STARTS_WITH()</code> as-is,
but the built-in <code>text_en</code> Analyzer used for indexing has stemming enabled.
So the indexed values are the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>RETURN</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;IPS (in-plane switching)&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ip&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;in&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;plane&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;switch&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>The <em>s</em> is removed from <em>ips</em>, which leads to the prefix <em>ips</em> not matching
the indexed token <em>ip</em>. You may either create a custom text Analyzer with
stemming disabled to avoid this issue, or apply stemming to the prefixes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>STARTS_WITH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=nf>TOKENS</span><span class=p>(</span><span class=s2>&#34;ips&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><h4 id=example-searching-for-one-or-multiple-prefixes>Example: Searching for one or multiple prefixes <a href=/3.13/aql/functions/arangosearch/#example-searching-for-one-or-multiple-prefixes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The <code>STARTS_WITH()</code> function accepts an array of prefix alternatives of which
only one has to match:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>STARTS_WITH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;something&#34;</span><span class=p>,</span> <span class=s2>&#34;ips&#34;</span><span class=p>]),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p>It will match a document <code>{ "text": "lorem ipsum" }</code> but also
<code>{ "text": "that is something" }</code>, as at least one of the words start with a
given prefix.</p><p>The same query again, but with an explicit <code>minMatchCount</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>STARTS_WITH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;wrong&#34;</span><span class=p>,</span> <span class=s2>&#34;ips&#34;</span><span class=p>],</span> <span class=mi>1</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p>The number can be increased to require that at least this many prefixes must
be present:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=nf>STARTS_WITH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;lo&#34;</span><span class=p>,</span> <span class=s2>&#34;ips&#34;</span><span class=p>,</span> <span class=s2>&#34;something&#34;</span><span class=p>],</span> <span class=mi>2</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p>This will still match <code>{ "text": "lorem ipsum" }</code> because at least two prefixes
(<code>lo</code> and <code>ips</code>) are found, but not <code>{ "text": "that is something" }</code> which only
contains one of the prefixes (<code>something</code>).</p><h3 id=levenshtein_match>LEVENSHTEIN_MATCH() <a href=/3.13/aql/functions/arangosearch/#levenshtein_match class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>LEVENSHTEIN_MATCH(path, target, distance, transpositions, maxTerms, prefix) → fulfilled</code></p><p>Match documents with a <a href=https://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance target=_blank rel="noopener noreferrer" class=link>Damerau-Levenshtein distance</a>&nbsp;<i class="fas fa-external-link-alt"></i>
lower than or equal to <code>distance</code> between the stored attribute value and
<code>target</code>. It can optionally match documents using a pure Levenshtein distance.</p><p>See <a href=/3.13/aql/functions/string/#levenshtein_distance class=link><code>LEVENSHTEIN_DISTANCE()</code></a>
if you want to calculate the edit distance of two strings.</p><ul><li><strong>path</strong> (attribute path expression|string): the path of the attribute to
compare against in the document or a string</li><li><strong>target</strong> (string): the string to compare against the stored attribute</li><li><strong>distance</strong> (number): the maximum edit distance, which can be between
<code>0</code> and <code>4</code> if <code>transpositions</code> is <code>false</code>, and between <code>0</code> and <code>3</code> if
it is <code>true</code></li><li><strong>transpositions</strong> (bool, <em>optional</em>): if set to <code>false</code>, a Levenshtein
distance is computed, otherwise a Damerau-Levenshtein distance (default)</li><li><strong>maxTerms</strong> (number, <em>optional</em>): consider only a specified number of the
most relevant terms. One can pass <code>0</code> to consider all matched terms, but it may
impact performance negatively. The default value is <code>64</code>.</li><li>returns <strong>fulfilled</strong> (bool): <code>true</code> if the calculated distance is less than
or equal to <em>distance</em>, <code>false</code> otherwise</li><li><strong>prefix</strong> (string, <em>optional</em>): if defined, then a search for the exact
prefix is carried out, using the matches as candidates. The Levenshtein /
Damerau-Levenshtein distance is then computed for each candidate using
the <code>target</code> value and the remainders of the strings, which means that the
<strong>prefix needs to be removed from <code>target</code></strong> (see
<a href=#example-matching-with-prefix-search class=link>example</a>). This option can improve
performance in cases where there is a known common prefix. The default value
is an empty string (introduced in v3.7.13, v3.8.1).</li></ul><h4 id=example-matching-with-and-without-transpositions>Example: Matching with and without transpositions <a href=/3.13/aql/functions/arangosearch/#example-matching-with-and-without-transpositions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>The Levenshtein distance between <em>quick</em> and <em>quikc</em> is <code>2</code> because it requires
two operations to go from one to the other (remove <em>k</em>, insert <em>k</em> at a
different position).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>LEVENSHTEIN_MATCH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;quikc&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=kc>false</span><span class=p>)</span> <span class=c1>// matches &#34;quick&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p>The Damerau-Levenshtein distance is <code>1</code> (move <em>k</em> to the end).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>LEVENSHTEIN_MATCH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;quikc&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=c1>// matches &#34;quick&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><h4 id=example-matching-with-prefix-search>Example: Matching with prefix search <a href=/3.13/aql/functions/arangosearch/#example-matching-with-prefix-search class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Match documents with a Levenshtein distance of 1 with the prefix <code>qui</code>. The edit
distance is calculated using the search term <code>kc</code> (<code>quikc</code> with the prefix <code>qui</code>
removed) and the stored value without the prefix (e.g. <code>ck</code>). The prefix <code>qui</code>
is constant.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>LEVENSHTEIN_MATCH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;kc&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=s2>&#34;qui&#34;</span><span class=p>)</span> <span class=c1>// matches &#34;quick&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p>You may compute the prefix and suffix from the input string as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>input</span> <span class=o>=</span> <span class=s2>&#34;quikc&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>LET</span> <span class=n>prefixSize</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=kd>LET</span> <span class=n>prefix</span> <span class=o>=</span> <span class=nf>LEFT</span><span class=p>(</span><span class=n>input</span><span class=p>,</span> <span class=n>prefixSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>LET</span> <span class=n>suffix</span> <span class=o>=</span> <span class=nf>SUBSTRING</span><span class=p>(</span><span class=n>input</span><span class=p>,</span> <span class=n>prefixSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>LEVENSHTEIN_MATCH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=n>suffix</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=n>prefix</span><span class=p>)</span> <span class=c1>// matches &#34;quick&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><h4 id=example-basing-the-edit-distance-on-string-length>Example: Basing the edit distance on string length <a href=/3.13/aql/functions/arangosearch/#example-basing-the-edit-distance-on-string-length class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>You may want to pick the maximum edit distance based on string length.
If the stored attribute is the string <em>quick</em> and the target string is
<em>quicksands</em>, then the Levenshtein distance is 5, with 50% of the
characters mismatching. If the inputs are <em>q</em> and <em>qu</em>, then the distance
is only 1, although it is also a 50% mismatch.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>target</span> <span class=o>=</span> <span class=s2>&#34;input&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>LET</span> <span class=n>targetLength</span> <span class=o>=</span> <span class=nf>LENGTH</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>LET</span> <span class=n>maxDistance</span> <span class=o>=</span> <span class=p>(</span><span class=n>targetLength</span> <span class=o>&gt;</span> <span class=mi>5</span> <span class=o>?</span> <span class=mi>2</span> <span class=o>:</span> <span class=p>(</span><span class=n>targetLength</span> <span class=o>&gt;=</span> <span class=mi>3</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>LEVENSHTEIN_MATCH</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=n>target</span><span class=p>,</span> <span class=n>maxDistance</span><span class=p>,</span> <span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><h3 id=like>LIKE() <a href=/3.13/aql/functions/arangosearch/#like class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>LIKE(path, search) → bool</code></p><p>Check whether the pattern <code>search</code> is contained in the attribute denoted by <code>path</code>,
using wildcard matching.</p><ul><li><code>_</code>: A single arbitrary character</li><li><code>%</code>: Zero, one or many arbitrary characters</li><li><code>\\_</code>: A literal underscore</li><li><code>\\%</code>: A literal percent sign</li></ul><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text><p>Literal backlashes require different amounts of escaping depending on the
context:</p><ul><li><code>\</code> in bind variables (<em>Table</em> view mode) in the web interface (automatically
escaped to <code>\\</code> unless the value is wrapped in double quotes and already
escaped properly)</li><li><code>\\</code> in bind variables (<em>JSON</em> view mode) and queries in the web interface</li><li><code>\\</code> in bind variables in arangosh</li><li><code>\\\\</code> in queries in arangosh</li><li>Double the amount compared to arangosh in shells that use backslashes for
escaping (<code>\\\\</code> in bind variables and <code>\\\\\\\\</code> in queries)</li></ul></div></div></div></div><p>Searching with the <code>LIKE()</code> function in the context of a <code>SEARCH</code> operation
is backed by View indexes. The <a href=/3.13/aql/functions/string/#like class=link>String <code>LIKE()</code> function</a>
is used in other contexts such as in <code>FILTER</code> operations and cannot be
accelerated by any sort of index on the other hand. Another difference is that
the ArangoSearch variant does not accept a third argument to enable
case-insensitive matching. This can be controlled with Analyzers instead.</p><ul><li><strong>path</strong> (attribute path expression): the path of the attribute to compare
against in the document</li><li><strong>search</strong> (string): a search pattern that can contain the wildcard characters
<code>%</code> (meaning any sequence of characters, including none) and <code>_</code> (any single
character). Literal <code>%</code> and <code>_</code> must be escaped with backslashes.</li><li>returns <strong>bool</strong> (bool): <code>true</code> if the pattern is contained in <code>text</code>,
and <code>false</code> otherwise</li></ul><h4 id=example-searching-with-wildcards>Example: Searching with wildcards <a href=/3.13/aql/functions/arangosearch/#example-searching-with-wildcards class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=kr>LIKE</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;foo%b_r&#34;</span><span class=p>),</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><p><code>LIKE</code> can also be used in operator form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>ANALYZER</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>text</span> <span class=kr>LIKE</span> <span class=s2>&#34;foo%b_r&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span></span></span></code></pre></div><h2 id=geo-functions>Geo functions <a href=/3.13/aql/functions/arangosearch/#geo-functions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The following functions can be accelerated by View indexes. There are
corresponding <a href=/3.13/aql/functions/geo/ class=link>Geo Functions</a> for the regular geo index
type, but also general purpose functions such as GeoJSON constructors that can
be used in conjunction with ArangoSearch.</p><h3 id=geo_contains>GEO_CONTAINS() <a href=/3.13/aql/functions/arangosearch/#geo_contains class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.8.0</small></p><p><code>GEO_CONTAINS(geoJsonA, geoJsonB) → bool</code></p><p>Checks whether the <a href=/3.13/aql/functions/geo/#geojson class=link>GeoJSON object</a> <code>geoJsonA</code>
fully contains <code>geoJsonB</code> (every point in B is also in A).</p><ul><li><strong>geoJsonA</strong> (object|array): first GeoJSON object or coordinate array
(in longitude, latitude order)</li><li><strong>geoJsonB</strong> (object|array): second GeoJSON object or coordinate array
(in longitude, latitude order)</li><li>returns <strong>bool</strong> (bool): <code>true</code> when every point in B is also contained in A,
<code>false</code> otherwise</li></ul><h3 id=geo_distance>GEO_DISTANCE() <a href=/3.13/aql/functions/arangosearch/#geo_distance class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.8.0</small></p><p><code>GEO_DISTANCE(geoJsonA, geoJsonB) → distance</code></p><p>Return the distance between two <a href=/3.13/aql/functions/geo/#geojson class=link>GeoJSON objects</a>,
measured from the <code>centroid</code> of each shape.</p><ul><li><strong>geoJsonA</strong> (object|array): first GeoJSON object or coordinate array
(in longitude, latitude order)</li><li><strong>geoJsonB</strong> (object|array): second GeoJSON object or coordinate array
(in longitude, latitude order)</li><li>returns <strong>distance</strong> (number): the distance between the centroid points of
the two objects on the reference ellipsoid</li></ul><h3 id=geo_in_range>GEO_IN_RANGE() <a href=/3.13/aql/functions/arangosearch/#geo_in_range class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.8.0</small></p><p><code>GEO_IN_RANGE(geoJsonA, geoJsonB, low, high, includeLow, includeHigh) → bool</code></p><p>Checks whether the distance between two <a href=/3.13/aql/functions/geo/#geojson class=link>GeoJSON objects</a>
lies within a given interval. The distance is measured from the <code>centroid</code> of
each shape.</p><ul><li><strong>geoJsonA</strong> (object|array): first GeoJSON object or coordinate array
(in longitude, latitude order)</li><li><strong>geoJsonB</strong> (object|array): second GeoJSON object or coordinate array
(in longitude, latitude order)</li><li><strong>low</strong> (number): minimum value of the desired range</li><li><strong>high</strong> (number): maximum value of the desired range</li><li><strong>includeLow</strong> (bool, optional): whether the minimum value shall be included
in the range (left-closed interval) or not (left-open interval). The default
value is <code>true</code></li><li><strong>includeHigh</strong> (bool): whether the maximum value shall be included in the
range (right-closed interval) or not (right-open interval). The default value
is <code>true</code></li><li>returns <strong>bool</strong> (bool): whether the evaluated distance lies within the range</li></ul><h3 id=geo_intersects>GEO_INTERSECTS() <a href=/3.13/aql/functions/arangosearch/#geo_intersects class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><small>Introduced in: v3.8.0</small></p><p><code>GEO_INTERSECTS(geoJsonA, geoJsonB) → bool</code></p><p>Checks whether the <a href=/3.13/aql/functions/geo/#geojson class=link>GeoJSON object</a> <code>geoJsonA</code>
intersects with <code>geoJsonB</code> (i.e. at least one point of B is in A or vice versa).</p><ul><li><strong>geoJsonA</strong> (object|array): first GeoJSON object or coordinate array
(in longitude, latitude order)</li><li><strong>geoJsonB</strong> (object|array): second GeoJSON object or coordinate array
(in longitude, latitude order)</li><li>returns <strong>bool</strong> (bool): <code>true</code> if A and B intersect, <code>false</code> otherwise</li></ul><h2 id=scoring-functions>Scoring Functions <a href=/3.13/aql/functions/arangosearch/#scoring-functions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>Scoring functions return a ranking value for the documents found by a
<a href=/3.13/aql/high-level-operations/search/ class=link>SEARCH operation</a>. The better the documents match
the search expression the higher the returned number.</p><p>The first argument to any scoring function is always the document emitted by
a <code>FOR</code> operation over an <code>arangosearch</code> View.</p><p>To sort the result set by relevance, with the more relevant documents coming
first, sort in <strong>descending order</strong> by the score (e.g. <code>SORT BM25(...) DESC</code>).</p><p>You may calculate custom scores based on a scoring function using document
attributes and numeric functions (e.g. <code>TFIDF(doc) * LOG(doc.value)</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>movie</span> <span class=kr>IN</span> <span class=n>imdbView</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=nf>PHRASE</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=s2>&#34;Star Wars&#34;</span><span class=p>,</span> <span class=s2>&#34;text_en&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>movie</span><span class=p>)</span> <span class=o>*</span> <span class=nf>LOG</span><span class=p>(</span><span class=n>movie</span><span class=p>.</span><span class=n>runtime</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>movie</span></span></span></code></pre></div><p>Sorting by more than one score is allowed. You may also sort by a mix of
scores and attributes from multiple Views as well as collections:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>a</span> <span class=kr>IN</span> <span class=n>viewA</span>
</span></span><span class=line><span class=cl>  <span class=kr>FOR</span> <span class=n>c</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>    <span class=kr>FOR</span> <span class=n>b</span> <span class=kr>IN</span> <span class=n>viewB</span>
</span></span><span class=line><span class=cl>      <span class=kr>SORT</span> <span class=nf>TFIDF</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=n>c</span><span class=p>.</span><span class=n>name</span><span class=p>,</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>..</span><span class=p>.</span></span></span></code></pre></div><h3 id=bm25>BM25() <a href=/3.13/aql/functions/arangosearch/#bm25 class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>BM25(doc, k, b) → score</code></p><p>Sorts documents using the
<a href=https://en.wikipedia.org/wiki/Okapi_BM25 target=_blank rel="noopener noreferrer" class=link><strong>Best Matching 25</strong> algorithm</a>&nbsp;<i class="fas fa-external-link-alt"></i>
(Okapi BM25).</p><ul><li><strong>doc</strong> (document): must be emitted by <code>FOR ... IN viewName</code></li><li><strong>k</strong> (number, <em>optional</em>): calibrates the text term frequency scaling.
The value needs to be non-negative (<code>0.0</code> or higher), or the returned
score is an undefined value that may cause unpredictable results.
The default is <code>1.2</code>. A <code>k</code> value of <code>0</code> corresponds to a binary model
(no term frequency), and a large value corresponds to using raw term frequency</li><li><strong>b</strong> (number, <em>optional</em>): determines the scaling by the total text length.
The value needs to be between <code>0.0</code> and <code>1.0</code> (inclusive), or the returned
score is an undefined value that may cause unpredictable results.
The default is <code>0.75</code>. At the extreme values of the coefficient <code>b</code>, BM25
turns into the ranking functions known as:<ul><li>BM11 for <code>b</code> = <code>1</code> (corresponds to fully scaling the term weight by the
total text length)</li><li>BM15 for <code>b</code> = <code>0</code> (corresponds to no length normalization)</li></ul></li><li>returns <strong>score</strong> (number): computed ranking value</li></ul><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>The Analyzers used for indexing document attributes must have the <code>"frequency"</code>
feature enabled. The <code>BM25()</code> function will otherwise return a score of 0.
The Analyzers should have the <code>"norm"</code> feature enabled, too, or normalization
will be disabled, which is not meaningful for BM25 and BM11. BM15 does not need
the <code>"norm"</code> feature as it has no length normalization.</div></div></div></div><h4 id=example-sorting-by-default-bm25-score>Example: Sorting by default <code>BM25()</code> score <a href=/3.13/aql/functions/arangosearch/#example-sorting-by-default-bm25-score class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Sorting by relevance with BM25 at default settings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h4 id=example-sorting-with-tuned-bm25-ranking>Example: Sorting with tuned <code>BM25()</code> ranking <a href=/3.13/aql/functions/arangosearch/#example-sorting-with-tuned-bm25-ranking class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Sorting by relevance, with double-weighted term frequency and with full text
length normalization:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>BM25</span><span class=p>(</span><span class=n>doc</span><span class=p>,</span> <span class=mf>2.4</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h3 id=tfidf>TFIDF() <a href=/3.13/aql/functions/arangosearch/#tfidf class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>TFIDF(doc, normalize) → score</code></p><p>Sorts documents using the
<a href=https://en.wikipedia.org/wiki/TF-IDF target=_blank rel="noopener noreferrer" class=link><strong>term frequency–inverse document frequency</strong> algorithm</a>&nbsp;<i class="fas fa-external-link-alt"></i>
(TF-IDF).</p><ul><li><strong>doc</strong> (document): must be emitted by <code>FOR ... IN viewName</code></li><li><strong>normalize</strong> (bool, <em>optional</em>): specifies whether scores should be
normalized. The default is <code>false</code>.</li><li>returns <strong>score</strong> (number): computed ranking value</li></ul><div class="box notices cstyle info"><div class=box-content-container><div class=box-content><i class="fas fa-info-circle"></i><div class=box-text>The Analyzers used for indexing document attributes must have the <code>"frequency"</code>
feature enabled. The <code>TFIDF()</code> function will otherwise return a score of 0.
The Analyzers need to have the <code>"norm"</code> feature enabled, too, if you want to use
<code>TFIDF()</code> with the <code>normalize</code> parameter set to <code>true</code>.</div></div></div></div><h4 id=example-sorting-by-default-tfidf-score>Example: Sorting by default <code>TFIDF()</code> score <a href=/3.13/aql/functions/arangosearch/#example-sorting-by-default-tfidf-score class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Sort by relevance using the TF-IDF score:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>TFIDF</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h4 id=example-sorting-by-tfidf-score-with-normalization>Example: Sorting by <code>TFIDF()</code> score with normalization <a href=/3.13/aql/functions/arangosearch/#example-sorting-by-tfidf-score-with-normalization class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Sort by relevance using a normalized TF-IDF score:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=nf>TFIDF</span><span class=p>(</span><span class=n>doc</span><span class=p>,</span> <span class=kc>true</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h4 id=example-sort-by-value-and-tfidf>Example: Sort by value and <code>TFIDF()</code> <a href=/3.13/aql/functions/arangosearch/#example-sort-by-value-and-tfidf class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h4><p>Sort by the value of the <code>text</code> attribute in ascending order, then by the TFIDF
score in descending order where the attribute values are equivalent:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>viewName</span>
</span></span><span class=line><span class=cl>  <span class=kp>SEARCH</span> <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=kr>SORT</span> <span class=n>doc</span><span class=p>.</span><span class=n>text</span><span class=p>,</span> <span class=nf>TFIDF</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span> <span class=kr>DESC</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>doc</span></span></span></code></pre></div><h2 id=search-highlighting-functions>Search Highlighting Functions <a href=/3.13/aql/functions/arangosearch/#search-highlighting-functions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p class=labels><span class=label>ArangoDB Enterprise Edition</span>
<span class=label>ArangoGraph</span></p><h3 id=offset_info>OFFSET_INFO() <a href=/3.13/aql/functions/arangosearch/#offset_info class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p><code>OFFSET_INFO(doc, paths) → offsetInfo</code></p><p>Returns the attribute paths and substring offsets of matched terms, phrases, or
<em>n</em>-grams for search highlighting purposes.</p><ul><li><strong>doc</strong> (document): must be emitted by <code>FOR ... IN viewName</code></li><li><strong>paths</strong> (string|array): a string or an array of strings, each describing an
attribute and array element path you want to get the offsets for. Use <code>.</code> to
access nested objects, and <code>[n]</code> with <code>n</code> being an array index to specify array
elements. The attributes need to be indexed by Analyzers with the <code>offset</code>
feature enabled.</li><li>returns <strong>offsetInfo</strong> (array): an array of objects, limited to a default of
10 offsets per path. Each object has the following attributes:<ul><li><p><strong>name</strong> (array): the attribute and array element path as an array of
strings and numbers. You can pass this name to the
<a href=/3.13/aql/functions/document-object/ class=link><code>VALUE()</code> function</a> to dynamically look up the value.</p></li><li><p><strong>offsets</strong> (array): an array of arrays with the matched positions. Each
inner array has two elements with the start offset and the length of a match.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>The offsets describe the positions in bytes, not characters. You may need
to account for characters encoded using multiple bytes.</div></div></div></div></li></ul></li></ul><hr><p><code>OFFSET_INFO(doc, rules) → offsetInfo</code></p><ul><li><strong>doc</strong> (document): must be emitted by <code>FOR ... IN viewName</code></li><li><strong>rules</strong> (array): an array of objects with the following attributes:<ul><li><strong>name</strong> (string): an attribute and array element path
you want to get the offsets for. Use <code>.</code> to access nested objects,
and <code>[n]</code> with <code>n</code> being an array index to specify array elements. The
attributes need to be indexed by Analyzers with the <code>offset</code> feature enabled.</li><li><strong>options</strong> (object): an object with the following attributes:<ul><li><strong>maxOffsets</strong> (number, <em>optional</em>): the total number of offsets to
collect per path. Default: <code>10</code>.</li><li><strong>limits</strong> (object, <em>optional</em>): an object with the following attributes:<ul><li><strong>term</strong> (number, <em>optional</em>): the total number of term offsets to
collect per path. Default: 2<sup>32</sup>.</li><li><strong>phrase</strong> (number, <em>optional</em>): the total number of phrase offsets to
collect per path. Default: 2<sup>32</sup>.</li><li><strong>ngram</strong> (number, <em>optional</em>): the total number of <em>n</em>-gram offsets to
collect per path. Default: 2<sup>32</sup>.</li></ul></li></ul></li></ul></li><li>returns <strong>offsetInfo</strong> (array): an array of objects, each with the following
attributes:<ul><li><p><strong>name</strong> (array): the attribute and array element path as an array of
strings and numbers. You can pass this name to the
<a href=/3.13/aql/functions/document-object/ class=link><code>VALUE()</code></a> to dynamically look up the value.</p></li><li><p><strong>offsets</strong> (array): an array of arrays with the matched positions, capped
to the specified limits. Each inner array has two elements with the start
offset and the length of a match.</p><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text>The start offsets and lengths describe the positions in bytes, not characters.
You may need to account for characters encoded using multiple bytes.</div></div></div></div></li></ul></li></ul><p><strong>Examples</strong></p><p>Search a View and get the offset information for the matches:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>  FOR doc IN food_view
</span></span></span><span class=line><span class=cl><span class=sb>    SEARCH ANALYZER(TOKENS(&#34;avocado tomato&#34;, &#34;text_en_offset&#34;) ANY == doc.description.en, &#34;text_en_offset&#34;)
</span></span></span><span class=line><span class=cl><span class=sb>    RETURN OFFSET_INFO(doc, [&#34;description.en&#34;])`</span><span class=p>);</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>[</span><span class=nx>object</span> <span class=nx>ArangoQueryCursor</span><span class=p>,</span> <span class=nx>count</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span> <span class=nx>cached</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>hasMore</span><span class=o>:</span> <span class=kc>false</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>[</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=p>[</span> 
</span></span><span class=line><span class=cl>        <span class=s2>&#34;description&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=s2>&#34;en&#34;</span> 
</span></span><span class=line><span class=cl>      <span class=p>],</span> 
</span></span><span class=line><span class=cl>      <span class=s2>&#34;offsets&#34;</span> <span class=o>:</span> <span class=p>[</span> 
</span></span><span class=line><span class=cl>        <span class=p>[</span> 
</span></span><span class=line><span class=cl>          <span class=mi>4</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>          <span class=mi>7</span> 
</span></span><span class=line><span class=cl>        <span class=p>]</span> 
</span></span><span class=line><span class=cl>      <span class=p>]</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl>  <span class=p>],</span> 
</span></span><span class=line><span class=cl>  <span class=p>[</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=s2>&#34;name&#34;</span> <span class=o>:</span> <span class=p>[</span> 
</span></span><span class=line><span class=cl>        <span class=s2>&#34;description&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=s2>&#34;en&#34;</span> 
</span></span><span class=line><span class=cl>      <span class=p>],</span> 
</span></span><span class=line><span class=cl>      <span class=s2>&#34;offsets&#34;</span> <span class=o>:</span> <span class=p>[</span> 
</span></span><span class=line><span class=cl>        <span class=p>[</span> 
</span></span><span class=line><span class=cl>          <span class=mi>4</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>          <span class=mi>6</span> 
</span></span><span class=line><span class=cl>        <span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=p>[</span> 
</span></span><span class=line><span class=cl>          <span class=mi>38</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>          <span class=mi>6</span> 
</span></span><span class=line><span class=cl>        <span class=p>]</span> 
</span></span><span class=line><span class=cl>      <span class=p>]</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl>  <span class=p>]</span> 
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div><br><p>For full examples, see <a href=/3.13/index-and-search/arangosearch/search-highlighting/ class=link>Search Highlighting</a>.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.13/aql/functions/><i class="fas fa-chevron-left fa-fw"></i><p>Functions</p></a></span><span class=next><a class="nav nav-next link" href=/3.13/aql/functions/array/><p>Array</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.13/aql/functions/arangosearch.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#context-functions>Context Functions</a></div><div class=level-3><a href=#analyzer>ANALYZER()</a></div><div class=level-3><a href=#boost>BOOST()</a></div><div class=level-2><a href=#filter-functions>Filter Functions</a></div><div class=level-3><a href=#exists>EXISTS()</a></div><div class=level-3><a href=#in_range>IN_RANGE()</a></div><div class=level-3><a href=#min_match>MIN_MATCH()</a></div><div class=level-3><a href=#minhash_match>MINHASH_MATCH()</a></div><div class=level-3><a href=#ngram_match>NGRAM_MATCH()</a></div><div class=level-3><a href=#phrase>PHRASE()</a></div><div class=level-3><a href=#starts_with>STARTS_WITH()</a></div><div class=level-3><a href=#levenshtein_match>LEVENSHTEIN_MATCH()</a></div><div class=level-3><a href=#like>LIKE()</a></div><div class=level-2><a href=#geo-functions>Geo functions</a></div><div class=level-3><a href=#geo_contains>GEO_CONTAINS()</a></div><div class=level-3><a href=#geo_distance>GEO_DISTANCE()</a></div><div class=level-3><a href=#geo_in_range>GEO_IN_RANGE()</a></div><div class=level-3><a href=#geo_intersects>GEO_INTERSECTS()</a></div><div class=level-2><a href=#scoring-functions>Scoring Functions</a></div><div class=level-3><a href=#bm25>BM25()</a></div><div class=level-3><a href=#tfidf>TFIDF()</a></div><div class=level-2><a href=#search-highlighting-functions>Search Highlighting Functions</a></div><div class=level-3><a href=#offset_info>OFFSET_INFO()</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>