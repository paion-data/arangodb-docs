<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743774193></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="Query examples for joining documents with one-to-many and many-to-many relationships"><meta property="og:url" content="http://localhost/3.13/aql/examples-and-query-patterns/joins/"><meta property="og:title" content="Using Joins in AQL"><meta property="og:type" content="website"><meta property="og:description" content="Query examples for joining documents with one-to-many and many-to-many relationships"><meta name=docsearch:version content="3.13"><title>Using Joins in AQL | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743774193 defer></script>
<script src=/js/featherlight.min.js?1743774193 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743774193 defer></script>
<script src=/js/theme.js?1743774193 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.13"><a itemprop=item class=link href=/3.13/><span itemprop=name class=breadcrumb-entry>3.13.0</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="AQL"><a itemprop=item class=link href=/3.13/aql/><span itemprop=name class=breadcrumb-entry>AQL</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Examples & Query Patterns"><a itemprop=item class=link href=/3.13/aql/examples-and-query-patterns/><span itemprop=name class=breadcrumb-entry>Examples & Query Patterns</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="Joins"><a itemprop=item class=link href=/3.13/aql/examples-and-query-patterns/joins/><span itemprop=name class=breadcrumb-entry>Joins</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.13 is under development and not released yet.
This documentation is not final and potentially incomplete.</p></div></div></div></div><hgroup><h1>Using Joins in AQL</h1><p class=lead>Query examples for joining documents with one-to-many and many-to-many relationships</p></hgroup><p>The two common scenarios when you want to join documents of collections are:</p><ul><li><p><strong>One-to-Many</strong>:
You may have a <code>users</code> collection and a <code>cities</code> collection. A user lives in
a city and you need the city information during a query about the user.</p></li><li><p><strong>Many-To-Many</strong>:
You may have a <code>authors</code> collection and a <code>books</code> collection. An author can write many
books and a book can have many authors. You want to return a list of books
with their authors. Therefore you need to join the authors and books.</p></li></ul><p>Unlike many NoSQL databases, ArangoDB does support joins in AQL queries. This
is similar to the way traditional relational databases handle this. However,
because documents allow for more flexibility, joins are also more flexible.
The following sections provide solutions for common questions.</p><p>So far, we have only dealt with one collection (<code>users</code>) at a time. We also have a
collection <code>relations</code> that stores relationships between users. We now use
this extra collection to create a result from two collections.</p><p>First of all, we query a few users together with their friends&rsquo; IDs. For that,
we use all <code>relations</code> that have a value of <code>friend</code> in their <code>type</code> attribute.
Relationships are established by using the <code>friendOf</code> and <code>thisUser</code> attributes in the
<code>relations</code> collection, which point to the <code>userId</code> values in the <code>users</code> collection.</p><h2 id=one-to-many>One-To-Many <a href=/3.13/aql/examples-and-query-patterns/joins/#one-to-many class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>You have a collection called <code>users</code>. Users live in city and a city is identified
by its primary key. In principle you can embedded the city document into the
users document and be happy with it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;users/2151975421&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2151975421&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2151975421&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;city&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;Metropolis&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This works well for many use cases. Now assume that you have additional
information about the city, like the number of people living in it. It would be
impractical to change each and every user document if this numbers changes.
Therefore it is good idea to hold the city information in a separate collection.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>cities</span><span class=p>.</span><span class=nb>document</span><span class=p>(</span><span class=s2>&#34;cities/2241300989&#34;</span><span class=p>);</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;population&#34;</span> <span class=p>:</span> <span class=mi>1000</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;Metropolis&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;cities/2241300989&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2241300989&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2241300989&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Instead of embedding the city directly in the user document, you can use
the key of the city.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nb>document</span><span class=p>(</span><span class=s2>&#34;users/2290649597&#34;</span><span class=p>);</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;city&#34;</span> <span class=p>:</span> <span class=s2>&#34;cities/2241300989&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;users/2290649597&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2290649597&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2290649597&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We can now join these two collections very easily.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;FOR u IN users &#34;</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;  FOR c IN cities &#34;</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;    FILTER u.city == c._id RETURN { user: u, city: c }&#34;</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=p>).</span><span class=nx>toArray</span><span class=p>()</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span> 
</span></span><span class=line><span class=cl>      <span class=p>},</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;city&#34;</span> <span class=p>:</span> <span class=s2>&#34;cities/2241300989&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;users/2290649597&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2290649597&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2290649597&#34;</span> 
</span></span><span class=line><span class=cl>    <span class=p>},</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;city&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;population&#34;</span> <span class=p>:</span> <span class=mi>1000</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;Metropolis&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;cities/2241300989&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2241300989&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2241300989&#34;</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>Unlike in SQL, there is no special <code>JOIN</code> keyword. The optimizer ensures that the
primary index is used in the above query.</p><p>However, very often it is much more convenient for the client of the query if a
single document would be returned, where the city information is embedded in the
user document - as in the simple example above. With AQL, you do not need
to forgo this simplification.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;FOR u IN users &#34;</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;  FOR c IN cities &#34;</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;    FILTER u.city == c._id RETURN merge(u, {city: c})&#34;</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=p>).</span><span class=nx>toArray</span><span class=p>()</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;users/2290649597&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2290649597&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2290649597&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span> 
</span></span><span class=line><span class=cl>    <span class=p>},</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;city&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;cities/2241300989&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2241300989&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2241300989&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;population&#34;</span> <span class=p>:</span> <span class=mi>1000</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=s2>&#34;Metropolis&#34;</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>You can have both: the convenient representation of the result for your
client and the flexibility of joins for your data model.</p><h2 id=many-to-many>Many-To-Many <a href=/3.13/aql/examples-and-query-patterns/joins/#many-to-many class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>In the relational world, you need a third table to model the many-to-many
relation. In ArangoDB, you have a choice depending on the information you are
going to store and the type of questions you are going to ask.</p><p>Assume that authors are stored in one collection and books in a second. If all
you need is &ldquo;who are the authors of a book&rdquo;, then you can easily model this as
a list attribute in users.</p><p>If you want to store more information, for example, which author wrote which
page in a conference proceeding, or if you also want to know &ldquo;which books were
written by which author&rdquo;, you can use edge collections. This is very similar to
the &ldquo;join table&rdquo; from the relational world.</p><h3 id=embedded-lists>Embedded Lists <a href=/3.13/aql/examples-and-query-patterns/joins/#embedded-lists class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>If you only want to store the authors of a book, you can embed them as list in
the book document. There is no need for a separate collection.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>authors</span><span class=p>.</span><span class=nx>toArray</span><span class=p>()</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2661190141&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2661190141&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2661190141&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;Maxima&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Musterfrau&#34;</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2658437629&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2658437629&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2658437629&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>You can query books:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span><span class=s2>&#34;FOR b IN books RETURN b&#34;</span><span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2681506301&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2681506301&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2681506301&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;title&#34;</span> <span class=p>:</span> <span class=s2>&#34;The beauty of JOINS&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;authors&#34;</span> <span class=p>:</span> <span class=p>[</span> 
</span></span><span class=line><span class=cl>      <span class=s2>&#34;authors/2661190141&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=s2>&#34;authors/2658437629&#34;</span> 
</span></span><span class=line><span class=cl>    <span class=p>]</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>And you can join the authors in a very similar manner given in the one-to-many section:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;FOR b IN books &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;  LET a = (FOR x IN b.authors &#34;</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;             FOR a IN authors FILTER x == a._id RETURN a) &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;   RETURN { book: b, authors: a }&#34;</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;book&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;title&#34;</span> <span class=p>:</span> <span class=s2>&#34;The beauty of JOINS&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;authors&#34;</span> <span class=p>:</span> <span class=p>[</span> 
</span></span><span class=line><span class=cl>        <span class=s2>&#34;authors/2661190141&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=s2>&#34;authors/2658437629&#34;</span> 
</span></span><span class=line><span class=cl>      <span class=p>],</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2681506301&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2681506301&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2681506301&#34;</span> 
</span></span><span class=line><span class=cl>    <span class=p>},</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;authors&#34;</span> <span class=p>:</span> <span class=p>[</span> 
</span></span><span class=line><span class=cl>      <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>          <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;Maxima&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>          <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Musterfrau&#34;</span> 
</span></span><span class=line><span class=cl>        <span class=p>},</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2661190141&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2661190141&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2661190141&#34;</span> 
</span></span><span class=line><span class=cl>      <span class=p>},</span> 
</span></span><span class=line><span class=cl>      <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>          <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>          <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span> 
</span></span><span class=line><span class=cl>        <span class=p>},</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2658437629&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2658437629&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2658437629&#34;</span> 
</span></span><span class=line><span class=cl>      <span class=p>}</span> 
</span></span><span class=line><span class=cl>    <span class=p>]</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>Or you can embed the authors directly:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;FOR b IN books LET a = (&#34;</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;     FOR x IN b.authors &#34;</span> <span class=o>+</span> 
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;        FOR a IN authors FILTER x == a._id RETURN a)&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;  RETURN merge(b, { authors: a })&#34;</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2681506301&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2681506301&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2681506301&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;title&#34;</span> <span class=p>:</span> <span class=s2>&#34;The beauty of JOINS&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;authors&#34;</span> <span class=p>:</span> <span class=p>[</span> 
</span></span><span class=line><span class=cl>      <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2661190141&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2661190141&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2661190141&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>          <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;Maxima&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>          <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Musterfrau&#34;</span> 
</span></span><span class=line><span class=cl>        <span class=p>}</span> 
</span></span><span class=line><span class=cl>      <span class=p>},</span> 
</span></span><span class=line><span class=cl>      <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2658437629&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2658437629&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2658437629&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>          <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>          <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span> 
</span></span><span class=line><span class=cl>        <span class=p>}</span> 
</span></span><span class=line><span class=cl>      <span class=p>}</span> 
</span></span><span class=line><span class=cl>    <span class=p>]</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><h3 id=using-edge-collections>Using Edge Collections <a href=/3.13/aql/examples-and-query-patterns/joins/#using-edge-collections class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>If you also want to query which books are written by a given author, embedding authors
in the book document is possible, but it is more efficient to use a edge collections for
speed.</p><p>Or you are publishing a proceeding, then you want to store the pages the author has written
as well. This information can be stored in the edge document.</p><p>First off, create the users:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;authors&#34;</span><span class=p>);</span></span></span></code></pre></div><pre tabindex=0><code>[ArangoCollection 2926807549, &#34;authors&#34; (type document, status loaded)]
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>authors</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=p>{</span> <span class=nx>first</span><span class=o>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span> <span class=nx>last</span><span class=o>:</span> <span class=s2>&#34;Doe&#34;</span> <span class=p>}</span> <span class=p>})</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span> <span class=p>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2935261693&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>authors</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=p>{</span> <span class=nx>first</span><span class=o>:</span> <span class=s2>&#34;Maxima&#34;</span><span class=p>,</span> <span class=nx>last</span><span class=o>:</span> <span class=s2>&#34;Musterfrau&#34;</span> <span class=p>}</span> <span class=p>})</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span> <span class=p>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2938210813&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2938210813&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2938210813&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now, create the books without any author information:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_create</span><span class=p>(</span><span class=s2>&#34;books&#34;</span><span class=p>);</span></span></span></code></pre></div><pre tabindex=0><code>[ArangoCollection 2928380413, &#34;books&#34; (type document, status loaded)]
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>books</span><span class=p>.</span><span class=nx>save</span><span class=p>({</span> <span class=nx>title</span><span class=o>:</span> <span class=s2>&#34;The beauty of JOINS&#34;</span> <span class=p>});</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span> <span class=p>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2980088317&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>An edge collection is now used to link authors and books:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_createEdgeCollection</span><span class=p>(</span><span class=s2>&#34;written&#34;</span><span class=p>);</span></span></span></code></pre></div><pre tabindex=0><code>[ArangoCollection 2931132925, &#34;written&#34; (type edge, status loaded)]
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>written</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=s2>&#34;authors/2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;books/2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=p>{</span> <span class=nx>pages</span><span class=o>:</span> <span class=s2>&#34;1-10&#34;</span> <span class=p>})</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span> <span class=p>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;written/3006237181&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;3006237181&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;3006237181&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>written</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=s2>&#34;authors/2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=s2>&#34;books/2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>........</span><span class=o>&gt;</span><span class=p>{</span> <span class=nx>pages</span><span class=o>:</span> <span class=s2>&#34;11-20&#34;</span> <span class=p>})</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span> <span class=p>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;written/3012856317&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;3012856317&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;3012856317&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In order to get all books with their authors, you can use a
<a href=/3.13/aql/graphs/traversals/#working-with-collection-sets class=link>graph traversal</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;FOR b IN books &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;LET authorsByBook = ( &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    FOR author, writtenBy IN INBOUND b written &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    RETURN { &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;        vertex: author, &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;        edge: writtenBy &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    } &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;) &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;RETURN { &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    book: b, &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    authors: authorsByBook &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;} &#34;</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;book&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;title&#34;</span> <span class=p>:</span> <span class=s2>&#34;The beauty of JOINS&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;authors&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;vertex&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;edge&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;written/2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_from&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_to&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;3006237181&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;pages&#34;</span> <span class=p>:</span> <span class=s2>&#34;1-10&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;vertex&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;Maxima&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Musterfrau&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;edge&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;6833274&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;written/6833274&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_from&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_to&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;3012856317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;pages&#34;</span> <span class=p>:</span> <span class=s2>&#34;11-20&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>Or if you want only the information stored in the vertices, you can use this query:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;FOR b IN books &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;LET authorsByBook = ( &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    FOR author IN INBOUND b written &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    OPTIONS { &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;        order: &#39;bfs&#39;, &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;        uniqueVertices: &#39;global&#39; &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    } &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    RETURN author &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;) &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;RETURN { &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    book: b, &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    authors: authorsByBook &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;} &#34;</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;book&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;title&#34;</span> <span class=p>:</span> <span class=s2>&#34;The beauty of JOINS&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;authors&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;Maxima&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Musterfrau&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>Or again embed the authors directly into the book document:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>arangosh</span><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;FOR b IN books &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;LET authors = ( &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    FOR author IN INBOUND b written &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    OPTIONS { &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;        order: &#39;bfs&#39;, &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;        uniqueVertices: &#39;global&#39; &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    } &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    RETURN author &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;) &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;RETURN MERGE(b, {authors: authors}) &#34;</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;title&#34;</span> <span class=p>:</span> <span class=s2>&#34;The beauty of JOINS&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;authors&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;Maxima&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Musterfrau&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>If you need the authors and their books, simply reverse the direction:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>&gt;</span> <span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;FOR a IN authors &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;LET booksByAuthor = ( &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    FOR b IN OUTBOUND a written &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    OPTIONS { &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;        order: &#39;bfs&#39;, &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;        uniqueVertices: &#39;global&#39; &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    } &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;    RETURN b&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;) &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=s2>&#34;RETURN MERGE(a, {books: booksByAuthor}) &#34;</span>
</span></span><span class=line><span class=cl><span class=p>...</span><span class=o>&gt;</span> <span class=p>).</span><span class=nx>toArray</span><span class=p>();</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2935261693&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;John&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Doe&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;books&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;title&#34;</span> <span class=p>:</span> <span class=s2>&#34;The beauty of JOINS&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;authors/2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2938210813&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span> <span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;first&#34;</span> <span class=p>:</span> <span class=s2>&#34;Maxima&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;last&#34;</span> <span class=p>:</span> <span class=s2>&#34;Musterfrau&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;books&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_key&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_id&#34;</span> <span class=p>:</span> <span class=s2>&#34;books/2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;_rev&#34;</span> <span class=p>:</span> <span class=s2>&#34;2980088317&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;title&#34;</span> <span class=p>:</span> <span class=s2>&#34;The beauty of JOINS&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><h2 id=more-examples>More examples <a href=/3.13/aql/examples-and-query-patterns/joins/#more-examples class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><h3 id=join-tuples>Join tuples <a href=/3.13/aql/examples-and-query-patterns/joins/#join-tuples class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>We will start with a SQL-ish result set and return each tuple (user name, friends userId)
separately. The AQL query to generate such result is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>active</span> <span class=o>==</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=kr>FOR</span> <span class=n>f</span> <span class=kr>IN</span> <span class=n>relations</span>
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>f</span><span class=p>.</span><span class=n>type</span> <span class=o>==</span> <span class=nv>@friend</span> <span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>.</span><span class=n>friendOf</span> <span class=o>==</span> <span class=n>u</span><span class=p>.</span><span class=n>userId</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;friendId&#34;</span> <span class=o>:</span> <span class=n>f</span><span class=p>.</span><span class=n>thisUser</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div><strong>Bind Parameters</strong><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;friend&#34;</span><span class=p>:</span> <span class=s2>&#34;friend&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><div class=expand><a class=expand-label onclick=toggleExpandShortcode(event)>Show output</a><div class=expand-content style=display:none><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=p>[</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=s2>&#34;Abigail&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendId&#34;</span> <span class=o>:</span> <span class=mi>2</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=s2>&#34;Abigail&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendId&#34;</span> <span class=o>:</span> <span class=mi>3</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=s2>&#34;Abigail&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendId&#34;</span> <span class=o>:</span> <span class=mi>4</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=s2>&#34;Fred&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendId&#34;</span> <span class=o>:</span> <span class=mi>5</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=s2>&#34;Fred&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendId&#34;</span> <span class=o>:</span> <span class=mi>2</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=s2>&#34;Mary&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendId&#34;</span> <span class=o>:</span> <span class=mi>4</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=s2>&#34;Mary&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendId&#34;</span> <span class=o>:</span> <span class=mi>1</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=s2>&#34;Mariah&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendId&#34;</span> <span class=o>:</span> <span class=mi>1</span> 
</span></span><span class=line><span class=cl>  <span class=p>},</span> 
</span></span><span class=line><span class=cl>  <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=s2>&#34;Mariah&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendId&#34;</span> <span class=o>:</span> <span class=mi>2</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div><br><p>We iterate over the collection users. Only the &lsquo;active&rsquo; users will be examined.
For each of these users we will search for up to 4 friends. We locate friends
by comparing the <code>userId</code> of our current user with the <code>friendOf</code> attribute of the
<code>relations</code> document. For each of those relations found we return the users name
and the userId of the friend.</p><h3 id=horizontal-lists>Horizontal lists <a href=/3.13/aql/examples-and-query-patterns/joins/#horizontal-lists class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Note that in the above result, a user can be returned multiple times. This is the
SQL way of returning data. If this is not desired, the friends&rsquo; ids of each user
can be returned in a horizontal list. This will return each user at most once.</p><p>The AQL query for doing so is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>active</span> <span class=o>==</span> <span class=kc>true</span> <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendIds&#34;</span> <span class=o>:</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=kr>FOR</span> <span class=n>f</span> <span class=kr>IN</span> <span class=n>relations</span>
</span></span><span class=line><span class=cl>        <span class=kr>FILTER</span> <span class=n>f</span><span class=p>.</span><span class=n>friendOf</span> <span class=o>==</span> <span class=n>u</span><span class=p>.</span><span class=n>userId</span> <span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;friend&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kr>RETURN</span> <span class=n>f</span><span class=p>.</span><span class=n>thisUser</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=s2>&#34;Abigail&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;friendIds&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=mi>108</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mi>102</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mi>106</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=s2>&#34;Fred&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;friendIds&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=mi>209</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=s2>&#34;Mary&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;friendIds&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=mi>207</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mi>104</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=s2>&#34;Mariah&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;friendIds&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=mi>203</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=mi>205</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>In this query we are still iterating over the users in the <code>users</code> collection
and for each matching user we are executing a subquery to create the matching
list of related users.</p><h3 id=self-joins>Self joins <a href=/3.13/aql/examples-and-query-patterns/joins/#self-joins class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>To not only return friend ids but also the names of friends, we could &ldquo;join&rdquo; the
<code>users</code> collection once more (something like a &ldquo;self join&rdquo;):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>active</span> <span class=o>==</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=kr>LIMIT</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;friendIds&#34;</span> <span class=o>:</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=kr>FOR</span> <span class=n>f</span> <span class=kr>IN</span> <span class=n>relations</span>
</span></span><span class=line><span class=cl>        <span class=kr>FILTER</span> <span class=n>f</span><span class=p>.</span><span class=n>friendOf</span> <span class=o>==</span> <span class=n>u</span><span class=p>.</span><span class=n>userId</span> <span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&#34;friend&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kr>FOR</span> <span class=n>u2</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>          <span class=kr>FILTER</span> <span class=n>f</span><span class=p>.</span><span class=n>thisUser</span> <span class=o>==</span> <span class=n>u2</span><span class=p>.</span><span class=n>useId</span>
</span></span><span class=line><span class=cl>          <span class=kr>RETURN</span> <span class=n>u2</span><span class=p>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=s2>&#34;Abigail&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;friendIds&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Jim&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Jacob&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Daniel&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=s2>&#34;Fred&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;friendIds&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Mariah&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=s2>&#34;Mary&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;friendIds&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Isabella&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Michael&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=s2>&#34;Mariah&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;friendIds&#34;</span> <span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Madison&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Eva&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>This query will then again in term fetch the clear text name of the
friend from the users collection. So here we iterate the users collection,
and for each hit the relations collection, and for each hit once more the
users collection.</p><h3 id=outer-joins>Outer joins <a href=/3.13/aql/examples-and-query-patterns/joins/#outer-joins class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Lets find the lonely people in our database - those without friends.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>user</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>friendList</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kr>FOR</span> <span class=n>f</span> <span class=kr>IN</span> <span class=n>relations</span>
</span></span><span class=line><span class=cl>      <span class=kr>FILTER</span> <span class=n>f</span><span class=p>.</span><span class=n>friendOf</span> <span class=o>==</span> <span class=n>u</span><span class=p>.</span><span class=n>userId</span>
</span></span><span class=line><span class=cl>      <span class=kr>RETURN</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=nf>LENGTH</span><span class=p>(</span><span class=n>friendList</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=p>{</span> <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=n>user</span><span class=p>.</span><span class=n>name</span> <span class=p>}</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=s2>&#34;Abigail&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span> <span class=p>:</span> <span class=s2>&#34;Fred&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>So, for each user we pick the list of their friends and count them. The ones where
count equals zero are the lonely people. Using <code>RETURN 1</code> in the subquery
saves even more precious CPU cycles and gives the optimizer more alternatives.</p><h3 id=index-usage>Index usage <a href=/3.13/aql/examples-and-query-patterns/joins/#index-usage class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>For joins in particular, you should make sure indexes can be utilized to
<a href=/3.13/aql/execution-and-performance/explaining-queries/ class=link>speed up your queries</a>.</p><p>Note that sparse indexes don&rsquo;t qualify for joins. Often, You also want to join
documents not containing the property you join with. However, sparse indexes
don&rsquo;t contain references to documents that don&rsquo;t contain the indexed
attributes - thus they would be missing from the join operation. For this reason,
you should provide non-sparse indexes.</p><p>The <code>join-index-nodes</code> AQL optimizer rule automatically recognizes whether a
better strategy for joining collections can be used if suitable indexes are present.</p><p>If two or more collections are joined using nested <code>FOR</code> loops and the
attributes you join on are indexed by primary indexes or persistent indexes,
then a merge join can be performed. This is possible because these indexes are
always sorted.</p><p>Note that returning document attributes from the outer loop is limited to
attributes covered by the index, or the improved join strategy cannot be used.
The outer loop can be a different <code>FOR</code> operation in the execution plan than
defined in your query.</p><p>The following example query shows an inner join between orders and users on
user ID. Each document in the <code>orders</code> collection references a <code>user</code>, and the
<code>users</code> collection stores the user ID in the <code>_key</code> attribute. The query returns
the <code>total</code> attribute of every order along with the user information:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>o</span> <span class=kr>IN</span> <span class=n>orders</span>
</span></span><span class=line><span class=cl>  <span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>    <span class=kr>FILTER</span> <span class=n>o</span><span class=p>.</span><span class=n>user</span> <span class=o>==</span> <span class=n>u</span><span class=p>.</span><span class=n>_key</span>
</span></span><span class=line><span class=cl>    <span class=kr>RETURN</span> <span class=p>{</span> <span class=n>orderTotal</span><span class=o>:</span> <span class=n>o</span><span class=p>.</span><span class=n>total</span><span class=p>,</span> <span class=n>user</span><span class=o>:</span> <span class=n>u</span> <span class=p>}</span></span></span></code></pre></div><p>The <code>_key</code> attribute is covered by the primary index of the <code>users</code> collection.
If the <code>orders</code> collection has a persistent index defined over the <code>user</code>
attribute and additionally includes the <code>total</code> attribute in
<a href=/3.13/index-and-search/indexing/working-with-indexes/persistent-indexes/#storing-additional-values-in-indexes class=link><code>storedValues</code></a>,
then the query is eligible for a merge join. You can check the query explain
output for <code>JoinNode</code> entries:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=n>Execution</span> <span class=n>plan</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>Id</span>   <span class=n>NodeType</span>          <span class=n>Par</span>     <span class=n>Est</span><span class=p>.</span>   <span class=n>Comment</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span>   <span class=n>SingletonNode</span>                <span class=mi>1</span>   <span class=o>*</span> <span class=n>ROOT</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>JoinNode</span>            <span class=err></span>   <span class=mi>500000</span>     <span class=o>-</span> <span class=n>JOIN</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>JoinNode</span>                <span class=mi>500000</span>       <span class=o>-</span> <span class=kr>FOR</span> <span class=n>o</span> <span class=kr>IN</span> <span class=n>orders</span>   <span class=kd>LET</span> <span class=nl>#8</span> <span class=o>=</span> <span class=n>o</span><span class=p>.</span><span class=n>`total`</span>   <span class=cm>/* index scan (projections: `total`) */</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>JoinNode</span>                     <span class=mi>1</span>       <span class=o>-</span> <span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>   <span class=cm>/* index scan + document lookup */</span>
</span></span><span class=line><span class=cl>  <span class=mi>6</span>   <span class=n>CalculationNode</span>     <span class=err></span>   <span class=mi>500000</span>     <span class=o>-</span> <span class=kd>LET</span> <span class=nl>#4</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;orderTotal&#34;</span> <span class=o>:</span> <span class=nl>#8</span><span class=p>,</span> <span class=s2>&#34;user&#34;</span> <span class=o>:</span> <span class=n>u</span> <span class=p>}</span>   <span class=cm>/* simple expression */</span>   <span class=cm>/* collections used: u : users */</span>
</span></span><span class=line><span class=cl>  <span class=mi>7</span>   <span class=n>ReturnNode</span>              <span class=mi>500000</span>     <span class=o>-</span> <span class=kr>RETURN</span> <span class=nl>#4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Indexes</span> <span class=n>used</span><span class=o>:</span>
</span></span><span class=line><span class=cl> <span class=n>By</span>   <span class=n>Name</span>                      <span class=n>Type</span>         <span class=n>Collection</span>   <span class=n>Unique</span>   <span class=n>Sparse</span>   <span class=n>Cache</span>   <span class=n>Selectivity</span>   <span class=n>Fields</span>       <span class=n>Stored</span> <span class=n>values</span>   <span class=n>Ranges</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>idx_1784521139132825600</span>   <span class=n>persistent</span>   <span class=n>orders</span>       <span class=kc>false</span>    <span class=kc>false</span>    <span class=kc>false</span>      <span class=mi>10</span><span class=mf>0.00</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`user`</span> <span class=p>]</span>   <span class=p>[</span> <span class=n>`total`</span> <span class=p>]</span>     <span class=o>*</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span>   <span class=n>primary</span>                   <span class=n>primary</span>      <span class=n>users</span>        <span class=kc>true</span>     <span class=kc>false</span>    <span class=kc>false</span>      <span class=mi>10</span><span class=mf>0.00</span> <span class=o>%</span>   <span class=p>[</span> <span class=n>`_key`</span> <span class=p>]</span>   <span class=p>[</span>  <span class=p>]</span>            <span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>`user`</span> <span class=o>==</span> <span class=n>u</span><span class=p>.</span><span class=n>`_key`</span><span class=p>)</span></span></span></code></pre></div><p>More complex merge joins are supported as well, for example, joining three or
two-by-two collections, also with additional filters, sort and limit.
Optimizations like early pruning and late materialization may get applied.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc1</span> <span class=kr>IN</span> <span class=n>coll1</span>
</span></span><span class=line><span class=cl>  <span class=kr>FOR</span> <span class=n>doc2</span> <span class=kr>IN</span> <span class=n>coll2</span>
</span></span><span class=line><span class=cl>    <span class=kr>FOR</span> <span class=n>doc3</span> <span class=kr>IN</span> <span class=n>coll3</span>
</span></span><span class=line><span class=cl>      <span class=kr>FOR</span> <span class=n>doc4</span> <span class=kr>IN</span> <span class=n>coll4</span>
</span></span><span class=line><span class=cl>      <span class=kr>FILTER</span> <span class=n>doc1</span><span class=p>.</span><span class=n>x</span> <span class=o>==</span> <span class=n>doc3</span><span class=p>.</span><span class=n>y</span> <span class=kr>AND</span> <span class=n>doc3</span><span class=p>.</span><span class=n>z</span> <span class=kr>IN</span> <span class=p>[</span><span class=s2>&#34;foo&#34;</span><span class=p>,</span> <span class=s2>&#34;bar&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=kr>FILTER</span> <span class=n>doc2</span><span class=p>.</span><span class=n>x</span> <span class=o>==</span> <span class=n>doc4</span><span class=p>.</span><span class=n>y</span>
</span></span><span class=line><span class=cl>      <span class=kr>SORT</span> <span class=n>doc4</span><span class=p>.</span><span class=n>y</span>
</span></span><span class=line><span class=cl>      <span class=kr>LIMIT</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>      <span class=kr>RETURN</span> <span class=p>[</span><span class=n>doc1</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>doc2</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>doc3</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>doc4</span><span class=p>.</span><span class=n>y</span><span class=p>]</span></span></span></code></pre></div><p>In exceptional cases, merge joins can be slower than the regular joining strategy.
For example, if the values of two collections are interleaved, it can better to
disable the <code>join-index-nodes</code> optimizer rule. For example, in <em>arangosh</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>_query</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=sb>`FOR o IN odd FOR e IN even FILTER o.val == e.val RETURN e.val`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span> <span class=nx>optimizer</span><span class=o>:</span> <span class=p>{</span> <span class=nx>rules</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;-join-index-nodes&#34;</span><span class=p>]</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div><h3 id=pitfalls>Pitfalls <a href=/3.13/aql/examples-and-query-patterns/joins/#pitfalls class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Since we&rsquo;re free of schemata, there is by default no way to tell the format of the
documents. So, if your documents don&rsquo;t contain an attribute, it defaults to
null. We can however check our data for accuracy like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>RETURN</span> <span class=nf>LENGTH</span><span class=p>(</span><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span> <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>userId</span> <span class=o>==</span> <span class=kc>null</span> <span class=kr>RETURN</span> <span class=mi>1</span><span class=p>)</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=mi>10000</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>RETURN</span> <span class=nf>LENGTH</span><span class=p>(</span><span class=kr>FOR</span> <span class=n>f</span> <span class=kr>IN</span> <span class=n>relations</span> <span class=kr>FILTER</span> <span class=n>f</span><span class=p>.</span><span class=n>friendOf</span> <span class=o>==</span> <span class=kc>null</span> <span class=kr>RETURN</span> <span class=mi>1</span><span class=p>)</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=mi>10000</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>So if the above queries return 10k matches each, the result of the Join tuples
query will become 100,000,000 items larger and use much memory plus computation
time. So it is generally a good idea to revalidate that the criteria for your
join conditions exist.</p><p>Using indexes on the properties can speed up the operation significantly.
You can use the explain helper to revalidate your query actually uses them.</p><p>If you work with joins on edge collections you would typically aggregate over
the internal fields <code>_id</code>, <code>_from</code> and <code>_to</code> (where <code>_id</code> equals <code>userId</code>,
<code>_from</code> <code>friendOf</code> and <code>_to</code> would be <code>thisUser</code> in our examples). ArangoDB
implicitly creates indexes on them.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.13/aql/examples-and-query-patterns/projections-and-filters/><i class="fas fa-chevron-left fa-fw"></i><p>Projections and filters</p></a></span><span class=next><a class="nav nav-next link" href=/3.13/aql/examples-and-query-patterns/grouping/><p>Grouping</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.13/aql/examples-and-query-patterns/joins.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#one-to-many>One-To-Many</a></div><div class=level-2><a href=#many-to-many>Many-To-Many</a></div><div class=level-3><a href=#embedded-lists>Embedded Lists</a></div><div class=level-3><a href=#using-edge-collections>Using Edge Collections</a></div><div class=level-2><a href=#more-examples>More examples</a></div><div class=level-3><a href=#join-tuples>Join tuples</a></div><div class=level-3><a href=#horizontal-lists>Horizontal lists</a></div><div class=level-3><a href=#self-joins>Self joins</a></div><div class=level-3><a href=#outer-joins>Outer joins</a></div><div class=level-3><a href=#index-usage>Index usage</a></div><div class=level-3><a href=#pitfalls>Pitfalls</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>