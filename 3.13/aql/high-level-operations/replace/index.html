<!doctype html><html lang=en><head><link href=//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css rel=stylesheet><link href=//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css rel=stylesheet></noscript><link href=/css/featherlight.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/featherlight.min.css rel=stylesheet></noscript><link href=/css/nucleus.css rel=stylesheet><link href=/css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css rel=stylesheet></noscript><link href=/css/theme.css rel=stylesheet><link href=/css/theme-relearn-light.css rel=stylesheet id=variant-style><link href=/css/print.css rel=stylesheet media=print><script src=/js/variant.js?1743775370></script>
<script>var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="",window.T_Copied_to_clipboard="",window.T_Copy_link_to_clipboard="",window.T_Link_copied_to_clipboard="",baseUriFull="http://localhost/",window.variants&&variants.init(["relearn-light"])</script><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta itemprop=description property="description" content="The REPLACE operation removes all attributes of a document and sets the given attributes, excluding immutable system attributes"><meta property="og:url" content="http://localhost/3.13/aql/high-level-operations/replace/"><meta property="og:title" content="REPLACE operation in AQL"><meta property="og:type" content="website"><meta property="og:description" content="The REPLACE operation removes all attributes of a document and sets the given attributes, excluding immutable system attributes"><meta name=docsearch:version content="3.13"><title>REPLACE operation in AQL | ArangoDB Documentation</title><link href=/images/favicon.png rel=icon type=image/png><script src=/js/jquery.min.js></script>
<script src=/js/clipboard.min.js?1743775370 defer></script>
<script src=/js/featherlight.min.js?1743775370 defer></script>
<script>var versions=[{alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"},{alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"},{alias:"3.11",deprecated:!1,name:"3.11",version:"3.11.13"},{alias:"3.10",deprecated:!0,name:"3.10",version:"3.10.14"}]</script><script>var develVersion={alias:"devel",deprecated:!1,name:"3.13",version:"3.13.0"}</script><script>var stableVersion={alias:"stable",deprecated:!1,name:"3.12",version:"3.12.4"}</script><script src=/js/codeblocks.js?1743775370 defer></script>
<script src=/js/theme.js?1743775370 defer></script></head><body><noscript>You need to enable JavaScript to use the ArangoDB documentation.</noscript><div id=page-wrapper class=page_content_splash style=height:auto;opacity:0><section id=page-main><section class=page-container id=page-container><header id=header style="transition:.5s padding ease-out,.15s" class="zn_header_white header-splash-new nav-down header-splash-wrap header1"><div class=header-block-left><div class=mobile-menu-toggle><button id=sidebar-toggle-navigation onclick=showSidebarHandler()><svg width="1.33em" height="1.33em" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div><div class=version-logo-container><div class="logo-container hasinfocard_img arangodb-logo-large"><div class=logo><a href=https://www.arangodb.com/><img src=/images/logo_main.png alt=ArangoDB title></a></div></div><div class=arangodb-logo-small><a href=https://arangodb.com/><img alt="ArangoDB Logo" src=/images/ArangoDB_Logo_White_small.png></a></div></div></div><div class=container-right style=display:hidden></div><div class=search-and-version-container><a href=# class="home-link is-current" aria-label="Go to home page" onclick=goToHomepage(event)></a><div id=searchbox></div><script type=text/javascript>const SCRIPT_SRC="https://unpkg.com/@inkeep/widgets-embed@0.2.290/dist/embed.js";function loadAndInitializeInkeep(){if(document.querySelector(`script[src="${SCRIPT_SRC}]"`))return;const e=document.createElement("script");e.type="module",e.src=SCRIPT_SRC,e.onload=initializeInkeep,document.head.appendChild(e)}function initializeInkeep(){const e=Inkeep({integrationId:"clo4lx6jk0000s601cp21x2ok",apiKey:"13b4e56966a76e86c6ff359cd795ee6a0412f751d75d6383",organizationId:"org_HGBkkzGAa4KeGJGh",organizationDisplayName:"ArangoDB",primaryBrandColor:"#80a54d",stringReplacementRules:[{matchingRule:{ruleType:"Substring",string:"Arangograph"},replaceWith:"ArangoGraph"},{matchingRule:{ruleType:"Substring",string:"Aql"},replaceWith:"AQL"},{matchingRule:{ruleType:"Substring",string:"Arangodb"},replaceWith:"ArangoDB"}],customCardSettings:[{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arango.qubitpi.org"}},searchTabLabel:"Official Docs"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"developer.arangodb.com"}},searchTabLabel:"Developer Hub"},{filters:{UrlMatch:{ruleType:"PartialUrl",partialUrl:"arangodb.com"}},searchTabLabel:"Home"}]}),t=e.embed({componentType:"ChatButton",properties:{stylesheetUrls:["/css/fonts.css"],fixedPositionXOffset:"52px",baseSettings:{theme:{primaryColors:{textColorOnPrimary:"white"},tokens:{fonts:{body:"'Inter'",heading:"'Inter'"},zIndex:{overlay:1e4,modal:11e3,popover:12e3,skipLink:13e3,toast:14e3,tooltip:15e3}}}},aiChatSettings:{botAvatarSrcUrl:"/images/ArangoDB_Logo_White_small.png",quickQuestions:["What can you do with AQL that is not feasible with SQL?","How do I search for objects within arrays?","Where can I deploy my ArangoDB instance?"],getHelpCallToActions:[{icon:{builtIn:"FaSlack"},name:"Slack",url:"https://arangodb-community.slack.com/"}]},searchSettings:{tabSettings:{isAllTabEnabled:!1,alwaysDisplayedTabs:["Official Docs","Developer Hub","Home"]}}}})}loadAndInitializeInkeep()</script><div class=version-selector><select id=arangodb-version onchange=changeVersion()><option value=3.13>3.13</option><option value=3.12>3.12</option><option value=3.11>3.11</option><option value=3.10>3.10</option><option value=3.9>3.9</option><option value=3.8>3.8</option></select></div></div></header><iframe src=/nav.html title=description id=menu-iframe class="menu-iframe active" style=opacity:0></iframe><div class=container-main><div class=row-main><nav id=breadcrumbs><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><meta itemprop=itemListOrder content="Descending"><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="3.13"><a itemprop=item class=link href=/3.13/><span itemprop=name class=breadcrumb-entry>3.13.0</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="AQL"><a itemprop=item class=link href=/3.13/aql/><span itemprop=name class=breadcrumb-entry>AQL</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="High-level Operations"><a itemprop=item class=link href=/3.13/aql/high-level-operations/><span itemprop=name class=breadcrumb-entry>High-level Operations</span></a>
<i class="fas fa-chevron-right fa-fw"></i></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><meta itemprop=position content="REPLACE"><a itemprop=item class=link href=/3.13/aql/high-level-operations/replace/><span itemprop=name class=breadcrumb-entry>REPLACE</span></a></li></ol></nav><article class=default><div class="box notices cstyle warning"><div class=box-content-container><div class=box-content><i class="fas fa-exclamation-triangle"></i><div class=box-text><p>ArangoDB v3.13 is under development and not released yet.
This documentation is not final and potentially incomplete.</p></div></div></div></div><hgroup><h1><code>REPLACE</code> operation in AQL</h1><p class=lead>The <code>REPLACE</code> operation removes all attributes of a document and sets the given attributes, excluding immutable system attributes</p></hgroup><p>Each <code>REPLACE</code> operation is restricted to a single collection, and the
<a href=/3.13/concepts/data-structure/collections/#collection-names class=link>collection name</a> must not be dynamic.
Only a single <code>REPLACE</code> statement per collection is allowed per AQL query, and
it cannot be followed by read or write operations that access the same collection,
by traversal operations, or AQL functions that can read documents.</p><p>You cannot replace the <code>_id</code>, <code>_key</code>, and <code>_rev</code> system attributes, but you can
replace the <code>_from</code> and <code>_to</code> attributes.</p><p>Replacing a document modifies the document&rsquo;s revision number (<code>_rev</code> attribute)
with a server-generated value.</p><h2 id=syntax>Syntax <a href=/3.13/aql/high-level-operations/replace/#syntax class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The two syntaxes for a replace operation are:</p><pre><code>REPLACE <em>document</em> IN <em>collection</em>
REPLACE <em>keyExpression</em> WITH <em>document</em> IN <em>collection</em></code></pre><p>Both variants can optionally end with an <code>OPTIONS { â€¦ }</code> clause.</p><p><code>collection</code> must contain the name of the collection in which the document
should be replaced.</p><p><code>document</code> must be an object and contain the attributes and values to set.
<strong>All existing attributes</strong> in the stored document <strong>are removed</strong> from it and
<strong>only the provided attributes are set</strong> (excluding the immutable <code>_id</code> and
<code>_key</code> attributes and the system-managed <code>_rev</code> attribute). This distinguishes
the <code>REPLACE</code> from the <code>UPDATE</code> operation, which only affects the attributes
you specify in the operation and doesn&rsquo;t change other attributes of the stored
document.</p><h3 id=replace-document-in-collection><code>REPLACE &lt;document> IN &lt;collection></code> <a href=/3.13/aql/high-level-operations/replace/#replace-document-in-collection class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Using the first syntax, the <code>document</code> object must have a <code>_key</code> attribute with
the document key. The existing document with this key is replaced with the
attributes provided by the <code>document</code> object (except for the <code>_id</code>, <code>_key</code>, and
<code>_rev</code> system attributes).</p><p>The following query replaces the document identified by the key <code>my_key</code> in the
<code>users</code> collection, only setting a <code>name</code> and a <code>status</code> attribute. The key is
passed via the <code>_key</code> attribute alongside other attributes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=s2>&#34;my_key&#34;</span><span class=p>,</span> <span class=n>name</span><span class=o>:</span> <span class=s2>&#34;Jon&#34;</span><span class=p>,</span> <span class=n>status</span><span class=o>:</span> <span class=s2>&#34;active&#34;</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><p>The following query is invalid because the object does not contain a <code>_key</code>
attribute and thus it is not possible to determine the document to
be replaced:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=s2>&#34;Jon&#34;</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><p>You can combine the <code>REPLACE</code> operation with a <code>FOR</code> loop to determine the
necessary key attributes, like shown below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>_key</span><span class=p>,</span> <span class=n>name</span><span class=o>:</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>firstName</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=n>u</span><span class=p>.</span><span class=n>lastName</span><span class=p>),</span> <span class=n>status</span><span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>status</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><p>Note that the <code>REPLACE</code> and <code>FOR</code> operations are independent of each other and
<code>u</code> does not automatically define a document for the <code>REPLACE</code> statement.
Thus, the following query is invalid:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>firstName</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=n>u</span><span class=p>.</span><span class=n>lastName</span><span class=p>),</span> <span class=n>status</span><span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>status</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><h3 id=replace-keyexpression-with-document-in-collection><code>REPLACE &lt;keyExpression> WITH &lt;document> IN &lt;collection></code> <a href=/3.13/aql/high-level-operations/replace/#replace-keyexpression-with-document-in-collection class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Using the second syntax, the document to replace is defined by the
<code>keyExpression</code>. It can either be a string with the document key, an object
which contains a <code>_key</code> attribute with the document key, or an expression that
evaluates to either of these two. The existing document with this key is
replaced with the attributes provided by the <code>document</code> object (except for
the <code>_id</code>, <code>_key</code>, and <code>_rev</code> system attributes).</p><p>The following query replaces the document identified by the key <code>my_key</code> in the
<code>users</code> collection, only setting a <code>name</code> and a <code>status</code> attribute. The key is
passed as a string in the <code>keyExpression</code>. The attributes to set are passed
separately as the <code>document</code> object:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=s2>&#34;my_key&#34;</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=s2>&#34;Jon&#34;</span><span class=p>,</span> <span class=n>status</span><span class=o>:</span> <span class=s2>&#34;active&#34;</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><p>The <code>document</code> object may contain a <code>_key</code> attribute, but it is ignored.</p><p>You cannot define the document to replace using an <code>_id</code> attribute, nor pass a
document identifier as a string (like <code>"users/john"</code>). However, you can use
<code>PARSE_IDENTIFIER(&lt;id>).key</code> as <code>keyExpression</code> to get the document key as a
string:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kd>LET</span> <span class=n>key</span> <span class=o>=</span> <span class=nf>PARSE_IDENTIFIER</span><span class=p>(</span><span class=s2>&#34;users/john&#34;</span><span class=p>).</span><span class=n>key</span>
</span></span><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=n>key</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=o>..</span><span class=p>.</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><h3 id=comparison-of-the-syntaxes>Comparison of the syntaxes <a href=/3.13/aql/high-level-operations/replace/#comparison-of-the-syntaxes class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Both syntaxes of the <code>REPLACE</code> operation allow you to define the document to
modify and the attributes to set. The document to update is effectively
identified by a document key in combination with the specified collection.</p><p>The <code>REPLACE</code> operation supports different ways of specifying the document key.
You can choose the syntax variant that is the most convenient for you.</p><p>The following queries are equivalent:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=n>u</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>firstName</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=n>u</span><span class=p>.</span><span class=n>lastName</span><span class=p>),</span> <span class=n>status</span><span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>status</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=n>u</span><span class=p>.</span><span class=n>_key</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>firstName</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=n>u</span><span class=p>.</span><span class=n>lastName</span><span class=p>),</span> <span class=n>status</span><span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>status</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>_key</span> <span class=p>}</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>firstName</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=n>u</span><span class=p>.</span><span class=n>lastName</span><span class=p>),</span> <span class=n>status</span><span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>status</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>_key</span><span class=p>,</span> <span class=n>name</span><span class=o>:</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=n>firstName</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=n>u</span><span class=p>.</span><span class=n>lastName</span><span class=p>),</span> <span class=n>status</span><span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>status</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><h2 id=dynamic-key-expressions>Dynamic key expressions <a href=/3.13/aql/high-level-operations/replace/#dynamic-key-expressions class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>A <code>REPLACE</code> operation may replace arbitrary documents, using either of the two
syntaxes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>i</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>1000</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=s2>&#34;test&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>),</span> <span class=n>name</span><span class=o>:</span> <span class=s2>&#34;Paula&#34;</span><span class=p>,</span> <span class=n>status</span><span class=o>:</span> <span class=s2>&#34;active&#34;</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>i</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>1000</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=s2>&#34;test&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=n>name</span><span class=o>:</span> <span class=s2>&#34;Paula&#34;</span><span class=p>,</span> <span class=n>status</span><span class=o>:</span> <span class=s2>&#34;active&#34;</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span></span></span></code></pre></div><h2 id=target-a-different-collection>Target a different collection <a href=/3.13/aql/high-level-operations/replace/#target-a-different-collection class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>The documents a <code>REPLACE</code> operation modifies can be in a different collection
than the ones produced by a preceding <code>FOR</code> operation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>FILTER</span> <span class=n>u</span><span class=p>.</span><span class=n>active</span> <span class=o>==</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=n>u</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=n>status</span><span class=o>:</span> <span class=s2>&#34;inactive&#34;</span><span class=p>,</span> <span class=n>name</span><span class=o>:</span> <span class=n>u</span><span class=p>.</span><span class=n>name</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>backup</span></span></span></code></pre></div><p>Note how documents are read from the <code>users</code> collection but replaced in another
collection called <code>backup</code>. Both collections need to use matching document keys
for this to work.</p><p>Although the <code>u</code> variable holds a whole document, it is only used to define the
target document. The <code>_key</code> attribute of the object is extracted and the target
document is solely defined by the document key string value and the specified
collection of the <code>REPLACE</code> operation (<code>backup</code>). There is no link to the
original collection (<code>users</code>).</p><h2 id=query-options>Query options <a href=/3.13/aql/high-level-operations/replace/#query-options class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>You can optionally set query options for the <code>REPLACE</code> operation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=o>..</span><span class=p>.</span> <span class=kr>IN</span> <span class=n>users</span> <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=o>..</span><span class=p>.</span> <span class=p>}</span></span></span></code></pre></div><h3 id=ignoreerrors><code>ignoreErrors</code> <a href=/3.13/aql/high-level-operations/replace/#ignoreerrors class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>You can use <code>ignoreErrors</code> to suppress query errors that may occur when trying to
replace non-existing documents or when violating unique key constraints:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>i</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>1000</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=s2>&#34;test&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>WITH</span> <span class=p>{</span> <span class=n>foobar</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>ignoreErrors</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span></span></span></code></pre></div><p>You cannot modify the <code>_id</code>, <code>_key</code>, and <code>_rev</code> system attributes, but attempts
to change them are ignored and not considered errors.</p><h3 id=waitforsync><code>waitForSync</code> <a href=/3.13/aql/high-level-operations/replace/#waitforsync class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>To make sure data are durable when a replace query returns, there is the <code>waitForSync</code>
query option:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>i</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>1000</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=s2>&#34;test&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>WITH</span> <span class=p>{</span> <span class=n>foobar</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>waitForSync</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span></span></span></code></pre></div><h3 id=ignorerevs><code>ignoreRevs</code> <a href=/3.13/aql/high-level-operations/replace/#ignorerevs class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>In order to not accidentally overwrite documents that have been modified since you last fetched
them, you can use the option <code>ignoreRevs</code> to either let ArangoDB compare the <code>_rev</code> value and only
succeed if they still match, or let ArangoDB ignore them (default):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>i</span> <span class=kr>IN</span> <span class=mf>1</span><span class=o>..</span><span class=mi>1000</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=nf>CONCAT</span><span class=p>(</span><span class=s2>&#34;test&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>),</span> <span class=n>_rev</span><span class=o>:</span> <span class=s2>&#34;1287623&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>WITH</span> <span class=p>{</span> <span class=n>foobar</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>ignoreRevs</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}</span></span></span></code></pre></div><h3 id=exclusive><code>exclusive</code> <a href=/3.13/aql/high-level-operations/replace/#exclusive class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>The RocksDB engine does not require collection-level locks. Different write
operations on the same collection do not block each other, as
long as there are no <em>write-write conflicts</em> on the same documents. From an application
development perspective it can be desired to have exclusive write access on collections,
to simplify the development. Note that writes do not block reads in RocksDB.
Exclusive access can also speed up modification queries, because we avoid conflict checks.</p><p>Use the <code>exclusive</code> option to achieve this effect on a per query basis:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>doc</span> <span class=kr>IN</span> <span class=n>collection</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=n>doc</span>
</span></span><span class=line><span class=cl>  <span class=kr>WITH</span> <span class=p>{</span> <span class=n>replaced</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>collection</span>
</span></span><span class=line><span class=cl>  <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>exclusive</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span></span></span></code></pre></div><h3 id=refillindexcaches><code>refillIndexCaches</code> <a href=/3.13/aql/high-level-operations/replace/#refillindexcaches class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>Whether to update existing entries in in-memory index caches if documents
replacements affect the edge index or cache-enabled persistent indexes.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=s2>&#34;123&#34;</span><span class=p>,</span> <span class=n>_from</span><span class=o>:</span> <span class=s2>&#34;vert/C&#34;</span><span class=p>,</span> <span class=n>_to</span><span class=o>:</span> <span class=s2>&#34;vert/D&#34;</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>edgeColl</span>
</span></span><span class=line><span class=cl>  <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>refillIndexCaches</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span></span></span></code></pre></div><h3 id=versionattribute><code>versionAttribute</code> <a href=/3.13/aql/high-level-operations/replace/#versionattribute class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h3><p>You can use the <code>versionAttribute</code> option for external versioning support.
If set, the attribute with the name specified by the option is looked up in the
stored document and the attribute value is compared numerically to the value of
the versioning attribute in the supplied document that is supposed to replace it.</p><p>If the version number in the new document is higher (rounded down to a whole number)
than in the document that already exists in the database, then the replace
operation is performed normally. This is also the case if the new versioning
attribute has a non-numeric value, if it is a negative number, or if the
attribute doesn&rsquo;t exist in the supplied or stored document.</p><p>If the version number in the new document is lower or equal to what exists in
the database, the operation is not performed and the existing document thus not
changed. No error is returned in this case.</p><p>The attribute can only be a top-level attribute.</p><p>For example, the following query conditionally replaces an existing document with
the key <code>"123"</code> if the attribute <code>externalVersion</code> currently has a value below <code>5</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=p>{</span> <span class=n>_key</span><span class=o>:</span> <span class=s2>&#34;123&#34;</span><span class=p>,</span> <span class=n>externalVersion</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span> <span class=n>anotherAttribute</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>coll</span>
</span></span><span class=line><span class=cl>  <span class=kp>OPTIONS</span> <span class=p>{</span> <span class=n>versionAttribute</span><span class=o>:</span> <span class=s2>&#34;externalVersion&#34;</span> <span class=p>}</span></span></span></code></pre></div><p>You can check if <code>OLD._rev</code> and <code>NEW._rev</code> are different to determine if the
document has been changed.</p><h2 id=returning-the-modified-documents>Returning the modified documents <a href=/3.13/aql/high-level-operations/replace/#returning-the-modified-documents class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>You can optionally return the documents modified by the query. In this case, the <code>REPLACE</code>
operation needs to be followed by a <code>RETURN</code> operation. Intermediate <code>LET</code> operations are
allowed, too. These operations can refer to the pseudo-variables <code>OLD</code> and <code>NEW</code>.
The <code>OLD</code> pseudo-variable refers to the document revisions before the replace, and <code>NEW</code>
refers to the document revisions after the replace.</p><p>Both <code>OLD</code> and <code>NEW</code> contain all document attributes, even those not specified
in the replace expression.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=n>document</span> <span class=kr>IN</span> <span class=n>collection</span> <span class=n>options</span> <span class=kr>RETURN</span> <span class=bp>OLD</span>
</span></span><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=n>document</span> <span class=kr>IN</span> <span class=n>collection</span> <span class=n>options</span> <span class=kr>RETURN</span> <span class=bp>NEW</span>
</span></span><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=n>keyExpression</span> <span class=kr>WITH</span> <span class=n>document</span> <span class=kr>IN</span> <span class=n>collection</span> <span class=n>options</span> <span class=kr>RETURN</span> <span class=bp>OLD</span>
</span></span><span class=line><span class=cl><span class=kr>REPLACE</span> <span class=n>keyExpression</span> <span class=kr>WITH</span> <span class=n>document</span> <span class=kr>IN</span> <span class=n>collection</span> <span class=n>options</span> <span class=kr>RETURN</span> <span class=bp>NEW</span></span></span></code></pre></div><p>Following is an example using a variable named <code>previous</code> to return the original
documents before modification. For each replaced document, the document key is
returned:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=n>u</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=n>value</span><span class=o>:</span> <span class=s2>&#34;test&#34;</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>previous</span> <span class=o>=</span> <span class=bp>OLD</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=n>previous</span><span class=p>.</span><span class=n>_key</span></span></span></code></pre></div><p>The following query uses the <code>NEW</code> pseudo-value to return the replaced
documents, without some of their system attributes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-aql data-lang=aql><span class=line><span class=cl><span class=kr>FOR</span> <span class=n>u</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kr>REPLACE</span> <span class=n>u</span> <span class=kr>WITH</span> <span class=p>{</span> <span class=n>value</span><span class=o>:</span> <span class=s2>&#34;test&#34;</span> <span class=p>}</span> <span class=kr>IN</span> <span class=n>users</span>
</span></span><span class=line><span class=cl>  <span class=kd>LET</span> <span class=n>replaced</span> <span class=o>=</span> <span class=bp>NEW</span>
</span></span><span class=line><span class=cl>  <span class=kr>RETURN</span> <span class=nf>UNSET</span><span class=p>(</span><span class=n>replaced</span><span class=p>,</span> <span class=s2>&#34;_key&#34;</span><span class=p>,</span> <span class=s2>&#34;_id&#34;</span><span class=p>,</span> <span class=s2>&#34;_rev&#34;</span><span class=p>)</span></span></span></code></pre></div><h2 id=transactionality>Transactionality <a href=/3.13/aql/high-level-operations/replace/#transactionality class=header-link onclick=copyURI(event)><span></span><i class="fa fa-link"></i></a></h2><p>On a single server, replace operations are executed transactionally in an
all-or-nothing fashion.</p><p>A query may execute intermediate transaction commits in case the running
transaction (AQL query) hits the specified size thresholds. In this case, the
query&rsquo;s operations carried out so far are committed and not rolled back in case
of a later abort/rollback. This behavior can be controlled by adjusting the
intermediate commit settings for the RocksDB engine. See
<a href=/3.13/aql/fundamentals/limitations/#storage-engine-properties class=link>Known limitations for AQL queries</a>.</p><p>For sharded collections, the entire query and/or replace operation may not be
transactional, especially if it involves different shards and/or DB-Servers.</p><nav class=pagination><span class=prev><a class="nav nav-prev link" href=/3.13/aql/high-level-operations/update/><i class="fas fa-chevron-left fa-fw"></i><p>UPDATE</p></a></span><span class=next><a class="nav nav-next link" href=/3.13/aql/high-level-operations/insert/><p>INSERT</p><i class="fas fa-chevron-right fa-fw"></i></a></span></nav></article><div class=toc-container><a class=edit-page aria-label href=https://github.com/arangodb/docs-hugo/edit/main/site/content/3.13/aql/high-level-operations/replace.md target=_blank><i class="fab fa-fw fa-github edit-page-icon"></i></a><div class=toc><div class=toc-content><div class=toc-header><p>On this page</p></div><nav id=TableOfContents><div class=level-2><a href=#syntax>Syntax</a></div><div class=level-3><a href=#replace-document-in-collection><code>REPLACE &lt;document> IN &lt;collection></code></a></div><div class=level-3><a href=#replace-keyexpression-with-document-in-collection><code>REPLACE &lt;keyExpression> WITH &lt;document> IN &lt;collection></code></a></div><div class=level-3><a href=#comparison-of-the-syntaxes>Comparison of the syntaxes</a></div><div class=level-2><a href=#dynamic-key-expressions>Dynamic key expressions</a></div><div class=level-2><a href=#target-a-different-collection>Target a different collection</a></div><div class=level-2><a href=#query-options>Query options</a></div><div class=level-3><a href=#ignoreerrors><code>ignoreErrors</code></a></div><div class=level-3><a href=#waitforsync><code>waitForSync</code></a></div><div class=level-3><a href=#ignorerevs><code>ignoreRevs</code></a></div><div class=level-3><a href=#exclusive><code>exclusive</code></a></div><div class=level-3><a href=#refillindexcaches><code>refillIndexCaches</code></a></div><div class=level-3><a href=#versionattribute><code>versionAttribute</code></a></div><div class=level-2><a href=#returning-the-modified-documents>Returning the modified documents</a></div><div class=level-2><a href=#transactionality>Transactionality</a></div></nav></div></div></div></div></div></section></section></div><button class="back-to-top hidden" onclick=goToTop(event) href=#><i class="fa fa-arrow-up"></i></button><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3>
<script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script>
<script type=text/javascript>window.setupDocSearch=function(e){if(!window.docsearch)return;docsearch({appId:"OK3ZBQ5982",apiKey:"500c85ccecb335d507fe4449aed12e1d",indexName:"arangodbdocs",insights:!0,container:"#searchbox",debug:!1,maxResultsPerGroup:10,searchParameters:{facetFilters:[`version:${e}`]}})}</script></body></html>